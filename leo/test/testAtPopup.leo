<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet ekr_test?>
<leo_file>
<leo_header file_format="2" tnodes="0" max_tnode_index="0" clone_windows="0"/>
<globals body_outline_ratio="0.43829787234">
	<global_window_position top="47" left="147" height="672" width="1175"/>
	<global_log_window_position top="0" left="0" height="0" width="0"/>
</globals>
<preferences/>
<find_panel_settings/>
<vnodes>
<v t="bobjack.20080329075629.2"><vh>@startup</vh>
<v t="bobjack.20080324163716.1"><vh>@chapters</vh></v>
</v>
<v t="bobjack.20080329075629.3"><vh>Notes</vh></v>
<v t="bobjack.20080329063457.1"><vh>@button show-menu-tables</vh></v>
<v t="bobjack.20080329075629.4" a="E"><vh>Experiments</vh>
<v t="bobjack.20080330095006.2"><vh>Replacing the log menu</vh></v>
<v t="bobjack.20080330095006.3" a="TV"><vh>Editing the 'edit-menu' fragment</vh></v>
</v>
<v t="bobjack.20080329070612.1"><vh>Test context sesitive items</vh>
<v t="bobjack.20080329070612.2"><vh>&lt;&lt; test 'Help on: ...' &gt;&gt;	</vh></v>
<v t="bobjack.20080329070612.3"><vh>&lt;&lt; test 'Open URL: ...'&gt;&gt;</vh></v>
</v>
<v t="bobjack.20080324164314.1"><vh>@settings</vh>
<v t="bobjack.20080329054053.1"><vh>provide a fragment for use in other menus</vh>
<v t="bobjack.20080329053100.1"><vh>@popup find change fragment</vh>
<v t="bobjack.20080326150321.6"><vh>@item *find-next</vh></v>
<v t="bobjack.20080326150321.7"><vh>@item *find-prev</vh></v>
<v t="bobjack.20080326150321.8"><vh>@item *change</vh></v>
<v t="bobjack.20080326150321.9"><vh>@item *change-then-find</vh></v>
</v>
</v>
<v t="bobjack.20080329062304.13"><vh>Provide context menus for ...</vh></v>
<v t="bobjack.20080329054053.2"><vh>... the log pane</vh>
<v t="bobjack.20080326150321.5"><vh>@popup log</vh>
<v t="bobjack.20080329051459.3"><vh>column one</vh>
<v t="bobjack.20080329043447.3"><vh>@item &amp;</vh></v>
</v>
<v t="bobjack.20080329051459.7"><vh>column two</vh>
<v t="bobjack.20080329043447.2"><vh>@item |</vh></v>
<v t="bobjack.20080326150321.1"><vh>@item 1</vh></v>
<v t="bobjack.20080326150321.2"><vh>@item 2</vh></v>
<v t="bobjack.20080326150321.3"><vh>@item 3</vh></v>
<v t="bobjack.20080326150321.4"><vh>@item 4</vh></v>
</v>
<v t="bobjack.20080329051459.4"><vh>column three</vh>
<v t="bobjack.20080329052834.1"><vh>@item |</vh></v>
<v t="bobjack.20080329053100.2"><vh>@item &amp;</vh></v>
</v>
</v>
</v>
<v t="bobjack.20080329054053.3"><vh>... the body pane</vh>
<v t="bobjack.20080329054053.4"><vh>@popup body</vh>
<v t="bobjack.20080329061920.1"><vh>@item *undo</vh></v>
<v t="bobjack.20080329061920.2"><vh>@item -</vh></v>
<v t="bobjack.20080329054053.5"><vh>@item cut-text</vh></v>
<v t="bobjack.20080329054053.6"><vh>@item copy-text</vh></v>
<v t="bobjack.20080329054053.7"><vh>@item paste-text</vh></v>
<v t="bobjack.20080329054053.8"><vh>@item -</vh></v>
<v t="bobjack.20080329054053.9"><vh>@item *select-all</vh></v>
<v t="bobjack.20080329054053.10"><vh>@item -</vh></v>
<v t="bobjack.20080329054053.11"><vh>@menu Block Ops</vh>
<v t="bobjack.20080329054053.12"><vh>@item indent-region</vh></v>
<v t="bobjack.20080329054053.13"><vh>@item unindent-region</vh></v>
</v>
<v t="bobjack.20080329054053.15"><vh>@menu Find Change</vh>
<v t="bobjack.20080329054053.16"><vh>@item &amp;</vh></v>
</v>
<v t="bobjack.20080329061442.1"><vh>another pre-defined fragment</vh>
<v t="bobjack.20080329061442.2"><vh>@item &amp;</vh></v>
</v>
<v t="bobjack.20080329054053.17"><vh>@item -</vh></v>
<v t="bobjack.20080329054053.18"><vh>@item *execute-script</vh></v>
<v t="bobjack.20080329054053.19"><vh>@item *</vh></v>
</v>
</v>
<v t="bobjack.20080329062304.14"><vh>... the find-text entry</vh>
<v t="bobjack.20080329062304.1"><vh>@popup find-text</vh>
<v t="bobjack.20080329062304.2"><vh>column one</vh>
<v t="bobjack.20080329062304.3"><vh>@item &amp;</vh></v>
</v>
<v t="bobjack.20080329062304.10"><vh>column two</vh>
<v t="bobjack.20080329062304.11"><vh>@item |</vh></v>
<v t="bobjack.20080329062304.12"><vh>@item &amp;</vh></v>
</v>
</v>
</v>
<v t="bobjack.20080329062304.15"><vh>... the change-text entry</vh>
<v t="bobjack.20080329062956.1"><vh>@popup change-text</vh>
<v t="bobjack.20080329062304.16"><vh>@item &amp;</vh></v>
</v>
</v>
</v>
</vnodes>
<tnodes>
<t tx="bobjack.20080324163716.1"></t>
<t tx="bobjack.20080324164314.1"></t>
<t tx="bobjack.20080326150321.1"></t>
<t tx="bobjack.20080326150321.2"></t>
<t tx="bobjack.20080326150321.3"></t>
<t tx="bobjack.20080326150321.4"></t>
<t tx="bobjack.20080326150321.5"></t>
<t tx="bobjack.20080326150321.6"></t>
<t tx="bobjack.20080326150321.7"></t>
<t tx="bobjack.20080326150321.8"></t>
<t tx="bobjack.20080326150321.9"></t>
<t tx="bobjack.20080329043447.2"></t>
<t tx="bobjack.20080329043447.3">edit-menu</t>
<t tx="bobjack.20080329051459.3">Example of using a pre-defined fragment.</t>
<t tx="bobjack.20080329051459.4">Example of using a user defined fragment.</t>
<t tx="bobjack.20080329051459.7">These do nothing! but could be made
to do something if you want.</t>
<t tx="bobjack.20080329052834.1"></t>
<t tx="bobjack.20080329053100.1">Example of a user defined fragment for inclusion
in other menus.</t>
<t tx="bobjack.20080329053100.2">find change fragment</t>
<t tx="bobjack.20080329054053.1"></t>
<t tx="bobjack.20080329054053.2"></t>
<t tx="bobjack.20080329054053.3"></t>
<t tx="bobjack.20080329054053.4"></t>
<t tx="bobjack.20080329054053.5">Cut</t>
<t tx="bobjack.20080329054053.6">Copy</t>
<t tx="bobjack.20080329054053.7">Paste</t>
<t tx="bobjack.20080329054053.8"></t>
<t tx="bobjack.20080329054053.9"></t>
<t tx="bobjack.20080329054053.10">this is an optional label</t>
<t tx="bobjack.20080329054053.11"></t>
<t tx="bobjack.20080329054053.12">Indent</t>
<t tx="bobjack.20080329054053.13">Dedent</t>
<t tx="bobjack.20080329054053.15"></t>
<t tx="bobjack.20080329054053.16">find change fragment</t>
<t tx="bobjack.20080329054053.17"></t>
<t tx="bobjack.20080329054053.18"></t>
<t tx="bobjack.20080329054053.19">rclick-gen-context-sensitive-commands</t>
<t tx="bobjack.20080329061442.1"></t>
<t tx="bobjack.20080329061442.2">recent-files-menu</t>
<t tx="bobjack.20080329061920.1"></t>
<t tx="bobjack.20080329061920.2"></t>
<t tx="bobjack.20080329062304.1"></t>
<t tx="bobjack.20080329062304.2">Example of using a pre-defined fragment.</t>
<t tx="bobjack.20080329062304.3">edit-menu</t>
<t tx="bobjack.20080329062304.10">Example of using a user defined fragment.</t>
<t tx="bobjack.20080329062304.11"></t>
<t tx="bobjack.20080329062304.12">find change fragment</t>
<t tx="bobjack.20080329062304.13"></t>
<t tx="bobjack.20080329062304.14"></t>
<t tx="bobjack.20080329062304.15">Set this to use the same menu as the find-text entry</t>
<t tx="bobjack.20080329062304.16">find-text</t>
<t tx="bobjack.20080329062956.1"></t>
<t tx="bobjack.20080329063457.1">from pprint import pformat

g.es_print(pformat(c.context_menus))</t>
<t tx="bobjack.20080329070612.1">Here is a couple of tests you might like to try out:

    &lt;&lt; test 'Help on: ...' &gt;&gt;
    
    &lt;&lt; test 'Open URL: ...'&gt;&gt;
    
    http://localhost/
    
Select all the text above then right click.</t>
<t tx="bobjack.20080329070612.2">Hello,why dont you right click on

leoGlobals

then click on 'Help on: leoGlobals'</t>
<t tx="bobjack.20080329070612.3">Place the cursor in the url below, then right click.

    http://code.launchpad.net/leo-editor/
    
    http://localhost/</t>
<t tx="bobjack.20080329075629.2"></t>
<t tx="bobjack.20080329075629.3">@popup &lt;name&gt; menus are converted to a list of tuples and stored in::
    
     c.context_menus[&lt;name&gt;]

Some of these names are special, like 'body', 'log', 'find-text', 'change-text'.
The menus with these names are used for any widget whose name starts with those
names, eg a widget with a name 'body3' will, by default, get a menu from
c.context_menus['body'] when it is right clicked.

Other names are not special, menus with these names are 'fragments', that is
they are there to be included in other menus. This can be done using the '@item
&amp;' node with the name of the fragment to be included as the body text of the
node.

Widgets may be given a context_menu attribute, eg

    w.context_menu = 'my special menu'

in which case the menu table in c.context_menus['my special menu'] will be used
as the popup.

Widgets must have &lt;Button-3&gt; bound to a callback that eventually raises a
'bodyrclick1' hook, such as c.frame.OnBodyRClick.

Problems with log.

    1 There are no minibuffer commands for cut/copy/past in text regions other
    than the body, so rclick provides an 'edit-text' fragment for inclusion in
    @popup menus.
    
    2 Only the first Log pane will have a right click menu. rclick has no way of
    knowing when new log tabs are created or if they want a right click menu.
    You must bind newly created log text widgets &lt;Button-3&gt; as above.
    
Menu tables in c.context_menus are live, they can be manipulated by scripts and
the changes will show up immediately.  See @button experiments.


Changes to a fragment that is included in other menus will likewise show up
immediately in all those menus.



There is no support for tree or canvas widgets yet, I am experiencing problems
working with these.


</t>
<t tx="bobjack.20080329075629.4"># Experiment with using scripts to create or manipulate menu tables.

def cb( x=None):

    def testMenuCallback(c, event, x=x):

        if x is None:
            x = event.rc_label
        g.es('%s in %s' %(x,c.widget_name(event.widget)), color='blue')

    return testMenuCallback

xx=1

if xx==1:


elif xx==2:


</t>
<t tx="bobjack.20080330095006.2">c.context_menus['log'] = [

    ('11', cb()),
    ('12', cb('12')),
    ('13', cb('13')),
    ('14', cb('14')),
    ('|', None),
    ('xone', cb('one')),
    ('xtwo', cb()),
    ('xthree', cb('three')),
    ('xfour', cb('four')),
    ('|', None),    
    ('&amp;', 'edit-menu'),
]
g.es('replaced log menu', color='blue')</t>
<t tx="bobjack.20080330095006.3">"""This change will be reflected in all menus that use the 'edit-menu'
fragment. Check before and after in the log and find and change text boxes. """

et = c.context_menus['edit-menu'] 
c.context_menus['edit-menu'] = et[:-2]
g.es('removed select-all from ALL edit-menus', color='blue')</t>
</tnodes>
</leo_file>
