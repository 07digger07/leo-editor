<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>Appendices</title>
<style type="text/css">

/*ORIGINAL GOODGER + changes; up to line 224 it's standard reST stylesheet
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:date: $Date: 2006/10/19 13:23:15 $
:version: $Revision: 1.2 $
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
*/

/* EKR 10/19/06 */
/* some browsers require imported rules to precede all rulesets */
@import url(leo_rst.css);
@import url(silver_city.css);

.first {
  margin-top: 0 }

.last {
  margin-bottom: 0 }

a.toc-backref {
  text-decoration: none ;
  color: black }

dd {
  margin-bottom: 0.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.attention, div.caution, div.danger, div.error, div.hint,
div.important, div.note, div.tip, div.warning, div.admonition {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

div.hint p.admonition-title, div.important p.admonition-title,
div.note p.admonition-title, div.tip p.admonition-title,
div.admonition p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em }

div.footer, div.header {
  font-size: smaller }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 0em 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.line-block {
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;}
  /*background-color: #eeeeee }*/
  /*for some reason i can't overide in an import*/

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

table {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.citation {
  border-left: solid thin gray ;
  padding-left: 0.5ex }

table.docinfo {
  margin: 2em 4em }

table.footnote {
  border-left: solid thin black ;
  padding-left: 0.5ex }

td, th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

th.docinfo-name, th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap }

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
  font-size: 100% }

/*for some reason, the following isn't being overridden by the imports
at the end of this style sheet so I've commented it out*/
/*tt {
  background-color: #eeeeee }*/

ul.auto-toc {
  list-style-type: none }
  
hr { /* EKR */
  width: 100%;
  height: 1pt;
  color: gray;
}



</style>
</head>
<body>
<div class="document" id="appendices">
<h1 class="title">Appendices</h1>

<!-- rst3: filename: html\appendices.html -->
<!-- .. contents:: -->
<!-- Relative links. -->
<!-- References to the glossary. -->
<div class="section" id="bugs">
<h1>Bugs</h1>
<p>The following bugs can not be fixed:</p>
<ol class="arabic">
<li><p class="first">The <tt class="docutils literal"><span class="pre">Untangle</span></tt> command has no way of updating a section whose name has been changed in the derived file.</p>
<p>Because of the <tt class="docutils literal"><span class="pre">&#64;unit</span></tt> directive, there is not even a way to issue a meaningful warning.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">Tangle</span></tt> command treats <tt class="docutils literal"><span class="pre">&#64;c</span></tt> like <tt class="docutils literal"><span class="pre">&#64;code</span></tt> in <tt class="docutils literal"><span class="pre">CWEB</span></tt> mode.</p>
<p>I recommend changing <tt class="docutils literal"><span class="pre">&#64;c</span></tt> to <tt class="docutils literal"><span class="pre">&#64;&lt;</span> <span class="pre">c</span> <span class="pre">&#64;&gt;=</span></tt> throughout your <tt class="docutils literal"><span class="pre">CWEB</span></tt> sources
and adding a reference to <tt class="docutils literal"><span class="pre">&#64;&lt;</span> <span class="pre">c</span> <span class="pre">&#64;&gt;</span></tt> in all roots of <tt class="docutils literal"><span class="pre">CWEB</span></tt> files.</p>
</li>
</ol>
</div>
<div class="section" id="errors-while-tangling">
<h1>Errors while tangling</h1>
<p>The following error messages may be generated by the <tt class="docutils literal"><span class="pre">Tangle</span></tt> commands.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Can</span> <span class="pre">not</span> <span class="pre">re-open</span> <span class="pre">temp</span> <span class="pre">file</span></tt></dt>
<dd>A file error occurred while trying to reopen the temporary file used during tangling.</dd>
<dt><tt class="docutils literal"><span class="pre">Can</span> <span class="pre">not</span> <span class="pre">rename</span> <span class="pre">temporary</span> <span class="pre">file</span> <span class="pre">name</span></tt></dt>
<dd>A file error occurred while trying to change the name of the temporary file used during tangling.</dd>
<dt><tt class="docutils literal"><span class="pre">&#64;code</span> <span class="pre">expects</span> <span class="pre">the</span> <span class="pre">header:</span> <span class="pre">[text</span> <span class="pre">of</span> <span class="pre">header]</span> <span class="pre">to</span> <span class="pre">contain</span> <span class="pre">a</span> <span class="pre">section</span> <span class="pre">name</span></tt></dt>
<dd>An &#64;code directive appeared in body text whose header does not contain a section name.</dd>
<dt><tt class="docutils literal"><span class="pre">&#64;directive</span> <span class="pre">not</span> <span class="pre">valid</span> <span class="pre">here</span></tt></dt>
<dd>An &#64;directive was seen somewhere other than the start of a line.</dd>
<dt><tt class="docutils literal"><span class="pre">Halting</span> <span class="pre">Tangle:</span> <span class="pre">too</span> <span class="pre">many</span> <span class="pre">errors</span></tt></dt>
<dd>Tangle detected more than 20 errors.</dd>
<dt><tt class="docutils literal"><span class="pre">Invalid</span> <span class="pre">recursive</span> <span class="pre">reference</span> <span class="pre">of</span> <span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;</span></tt></dt>
<dd>A section was defined in terms of itself, either directly or indirectly.
The trace shows the chain of section definitions that resulted in the illegal definition.</dd>
<dt><tt class="docutils literal"><span class="pre">This</span> <span class="pre">message</span> <span class="pre">is</span> <span class="pre">followed</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">walkback</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">section</span> <span class="pre">names</span> <span class="pre">that</span> <span class="pre">recursively</span> <span class="pre">reference</span> <span class="pre">the</span> <span class="pre">section.</span></tt></dt>
<dd><p class="first">The walkback looks like this:</p>
<pre class="last literal-block">
called from &lt;&lt; section name &gt;&gt;
called from &lt;&lt; section name &gt;&gt;
...
</pre>
</dd>
<dt><tt class="docutils literal"><span class="pre">Multiple</span> <span class="pre">parts</span> <span class="pre">not</span> <span class="pre">allowed</span> <span class="pre">for</span> <span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;</span></tt></dt>
<dd><p class="first">Sections can be defined in several parts in two ways:</p>
<ol class="arabic simple">
<li>Using <tt class="docutils literal"><span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;=</span></tt> in several places with the same section name.</li>
<li>Using several <tt class="docutils literal"><span class="pre">&#64;code</span></tt> directives within the same body text.</li>
</ol>
<p class="last">As a precaution against mistakenly defining a section in more than one place,
it is invalid to use &#64;code in different nodes to define multiple parts for the same section.
In particular, this error may arise when using cloned nodes.
This error may always be eliminated by using <tt class="docutils literal"><span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;=</span></tt> instead of <tt class="docutils literal"><span class="pre">&#64;code</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">No</span> <span class="pre">file</span> <span class="pre">written</span> <span class="pre">because</span> <span class="pre">of</span> <span class="pre">errors</span></tt></dt>
<dd>Tangle did not write a file because errors were found.</dd>
<dt><tt class="docutils literal"><span class="pre">Run</span> <span class="pre">on</span> <span class="pre">comment</span></tt></dt>
<dd>A C-language comment was not properly terminated.</dd>
<dt><tt class="docutils literal"><span class="pre">Run</span> <span class="pre">on</span> <span class="pre">file</span> <span class="pre">name</span> <span class="pre">in</span> <span class="pre">&#64;root</span> <span class="pre">directive</span></tt></dt>
<dd>The file name in an &#64;root directive was not terminated with the proper delimiter.</dd>
<dt><tt class="docutils literal"><span class="pre">Run</span> <span class="pre">on</span> <span class="pre">section</span> <span class="pre">name</span></tt></dt>
<dd>A section name was not properly terminated before the end of the line in which it started.</dd>
<dt><tt class="docutils literal"><span class="pre">Run</span> <span class="pre">on</span> <span class="pre">string</span></tt></dt>
<dd>A C-language string or character constant was not properly terminated.</dd>
<dt><tt class="docutils literal"><span class="pre">Section</span> <span class="pre">definition</span> <span class="pre">not</span> <span class="pre">valid</span> <span class="pre">here.</span></tt></dt>
<dd>Something that looks like a section definition was seen in the middle of a line.</dd>
<dt><tt class="docutils literal"><span class="pre">Sections</span> <span class="pre">nested</span> <span class="pre">too</span> <span class="pre">deeply</span></tt></dt>
<dd>A section was defined using more than 100 levels of section definitions (!)
You could easily create an outline containing every computer program ever written in less than 50 levels.</dd>
<dt><tt class="docutils literal"><span class="pre">The</span> <span class="pre">outline</span> <span class="pre">contains</span> <span class="pre">no</span> <span class="pre">roots</span></tt></dt>
<dd>The selected outline contained no &#64;root directive.</dd>
<dt><tt class="docutils literal"><span class="pre">Undefined</span> <span class="pre">section:</span>&nbsp; <span class="pre">&lt;&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;&gt;</span></tt></dt>
<dd>A reference to an undefined section was encountered.</dd>
<dt><tt class="docutils literal"><span class="pre">Unexpected</span> <span class="pre">&#64;directive</span> <span class="pre">while</span> <span class="pre">putting</span> <span class="pre">code</span></tt></dt>
<dd>Tangle outputs 2-character WEB control code in a comment.
This message is given if we find such comments in a code definition.</dd>
<dt><tt class="docutils literal"><span class="pre">Warning:</span> <span class="pre">possible</span> <span class="pre">duplicate</span> <span class="pre">definition</span> <span class="pre">of:</span> <span class="pre">&lt;&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;&gt;</span></tt></dt>
<dd>(The text of the duplicate definition follows.)
The section may have been defined in more than one place.</dd>
<dt><tt class="docutils literal"><span class="pre">Warning:</span> <span class="pre">&lt;&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;&gt;</span> <span class="pre">has</span> <span class="pre">been</span> <span class="pre">defined</span> <span class="pre">but</span> <span class="pre">not</span> <span class="pre">used</span></tt></dt>
<dd>The indicated section appears in the outline but is never referenced.</dd>
</dl>
</div>
<div class="section" id="errors-while-untangling">
<h1>Errors while untangling</h1>
<p>The following error messages may be generated by the Untangle commands.</p>
<dl class="docutils">
<dt>Incompatible definitions of &lt;&lt;&lt; section name &gt;&gt;&gt;</dt>
<dd>Two expansions of <tt class="docutils literal"><span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;</span></tt> were different in the derived file.
This typically arises when the programmer changes one of the expansions but not the other.</dd>
<dt>Missing root part</dt>
<dd>No end sentinel line was found for a part of the expansion of the code in the <tt class="docutils literal"><span class="pre">&#64;root</span></tt> node.
This is likely the result of adding, deleting or altering a sentinel line.</dd>
<dt><tt class="docutils literal"><span class="pre">Missing</span> <span class="pre">root</span> <span class="pre">section</span></tt></dt>
<dd>No end sentinel line was found for the expansion of the code in the <tt class="docutils literal"><span class="pre">&#64;root</span></tt> node.
This is likely the result of adding, deleting or altering a sentinel line.</dd>
<dt><tt class="docutils literal"><span class="pre">Missing</span> <span class="pre">sentinel</span> <span class="pre">line</span> <span class="pre">for</span> <span class="pre">&lt;&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;&gt;</span></tt></dt>
<dd>The end sentinel name for <tt class="docutils literal"><span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;</span></tt> was expected but not found.
This is likely the result of adding, deleting or altering a sentinel line.</dd>
<dt><tt class="docutils literal"><span class="pre">Unterminated</span> <span class="pre">section:</span> <span class="pre">&lt;&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;&gt;</span></tt></dt>
<dd>The end of the file was reached before encountering the end sentinel line for <tt class="docutils literal"><span class="pre">&lt;&lt;</span> <span class="pre">section</span> <span class="pre">name</span> <span class="pre">&gt;&gt;</span></tt>.
This is likely the result of adding, deleting or altering a sentinel line.</dd>
</dl>
</div>
<div class="section" id="errors-while-reading-file-nodes">
<h1>Errors while reading &#64;file nodes</h1>
<p>The following are all serious errors, meaning that the data in a derived file has been corrupted:</p>
<pre class="literal-block">
Bad &#64;+leosentinel in &lt;filename&gt;
Bad &#64;delims
Bad attribute field in &#64;+node
Bad child index in &#64;+node
File may have damaged sentinels!
Ignoring &lt;sentinel kind&gt; sentinel.  Expecting &lt;sentinel kind&gt;
Ignoring unexpected &#64;+leo sentinel
Missing &lt;sentinel kind&gt; sentinel
Missing &#64;file in root &#64;node sentinel
Outline corrupted: different nodes have same clone index!
Replacing body text of orphan &lt;node name&gt;
Unexpected end of file. Expecting &lt;sentinel kind&gt; sentinel
Unknown sentinel: &lt;sentinel line&gt;
</pre>
<p>You should restore the information from a backup .leo file using the <tt class="docutils literal"><span class="pre">Read</span> <span class="pre">Outline</span> <span class="pre">Only</span></tt> commands,
followed by a <tt class="docutils literal"><span class="pre">Write</span> <span class="pre">&#64;file</span> <span class="pre">Nodes</span></tt> command</p>
</div>
<div class="section" id="errors-while-writing-file-nodes">
<h1>Errors while writing &#64;file nodes</h1>
<p>Errors while writing <tt class="docutils literal"><span class="pre">&#64;file</span></tt> nodes are harmless.
No information is lost because all information is written to the .leo file rather than the derived file.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">bad</span> <span class="pre">&#64;delims</span> <span class="pre">directive</span></tt></dt>
<dd>A node contains an ill-formed <tt class="docutils literal"><span class="pre">&#64;delims</span></tt> directive.</dd>
<dt><tt class="docutils literal"><span class="pre">&#64;ignore</span> <span class="pre">node</span> <span class="pre">&lt;headline&gt;</span></tt></dt>
<dd>The body text of <em>headline</em> contains an <tt class="docutils literal"><span class="pre">&#64;ignore</span></tt> directive.</dd>
<dt><tt class="docutils literal"><span class="pre">orphan</span> <span class="pre">node:</span> <span class="pre">&lt;headline&gt;</span></tt></dt>
<dd>The node is referenced by no ancestor node, and no <tt class="docutils literal"><span class="pre">&#64;others</span></tt> directive applies to it.</dd>
<dt><tt class="docutils literal"><span class="pre">&#64;others</span> <span class="pre">already</span> <span class="pre">expanded</span> <span class="pre">in:</span> <span class="pre">&lt;headline&gt;</span></tt></dt>
<dd>The node contains more than one <tt class="docutils literal"><span class="pre">&#64;others</span></tt> directive.</dd>
<dt><tt class="docutils literal"><span class="pre">Rename</span> <span class="pre">failed:</span> <span class="pre">no</span> <span class="pre">file</span> <span class="pre">created!</span> <span class="pre">(file</span> <span class="pre">may</span> <span class="pre">be</span> <span class="pre">read-only)</span></tt></dt>
<dd>Leo's <tt class="docutils literal"><span class="pre">Save</span></tt> command writes derived files to a temporary file,
and replaces the derived file by the temporary files only if the two files are different.
A problem with the file system prevented the temporary file from being renamed.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">Path</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">exist:</span> <span class="pre">&lt;filename&gt;</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">undefined</span> <span class="pre">section:</span> <span class="pre">&lt;section</span> <span class="pre">name&gt;</span> <span class="pre">referenced</span> <span class="pre">from:</span> <span class="pre">&lt;headline&gt;</span></tt></dt>
<dd>The node given by <em>headline</em> contains a reference to <em>section name</em>
but no section definition node for <em>section name</em> exists in the descendants of <em>headline</em>.</dd>
</dl>
</div>
<div class="section" id="format-of-leo-files">
<h1>Format of .leo files</h1>
<p>This technical information may be of use to those wanting to process Leo files with special-purpose filters.
Leo's uses XML for its file format.
The following sections describe this format in detail.
<strong>Important</strong>:
The actual read/write code in leoFileCommands.py is the authoritative guide.
When in doubt about what Leo actually writes, look at an actual .leo file in another editor.</p>
<p>Here are the elements that may appear in Leo files.
These elements must appear in this order.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">&lt;?xml&gt;</span></tt></dt>
<dd><p class="first">Leo files start with the following line:</p>
<pre class="last literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
</pre>
</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;?xml-stylesheet&gt;</span></tt></dt>
<dd><p class="first">An xml-stylesheet line is option.  For example:</p>
<pre class="last literal-block">
&lt;?xml-stylesheet ekr_stylesheet?&gt;
</pre>
</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;leo_file&gt;</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">&lt;leo_file&gt;</span></tt> element opens an element that contains the entire file.
<tt class="docutils literal"><span class="pre">&lt;/leo_file&gt;</span></tt> ends the file.</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;leo_header&gt;</span></tt></dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">&lt;leo_header&gt;</span></tt> element specifies version information and other information
that affects how Leo parses the file.  For example:</p>
<pre class="literal-block">
&lt;leo_header file_format=&quot;2&quot; tnodes=&quot;0&quot; max_tnode_index=&quot;5725&quot; clone_windows=&quot;0&quot;/&gt;
</pre>
<p class="last">The <tt class="docutils literal"><span class="pre">file_format</span></tt> attribute gives the 'major' format number.
It is '2' for all 4.x versions of Leo.
The <tt class="docutils literal"><span class="pre">tnodes</span></tt> and <tt class="docutils literal"><span class="pre">clone_windows</span></tt> attributes are no longer used.
The <tt class="docutils literal"><span class="pre">max_tnode_index</span></tt>     attribute is the largest tnode index.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;globals&gt;</span></tt></dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">globals</span></tt> element specifies information relating to the entire file.
For example:</p>
<pre class="literal-block">
&lt;globals body_outline_ratio=&quot;0.50&quot;&gt;
    &lt;global_window_position top=&quot;27&quot; left=&quot;27&quot; height=&quot;472&quot; width=&quot;571&quot;/&gt;
    &lt;global_log_window_position top=&quot;183&quot; left=&quot;446&quot; height=&quot;397&quot; width=&quot;534&quot;/&gt;
&lt;/globals&gt;
</pre>
<ul class="last simple">
<li>The <tt class="docutils literal"><span class="pre">body_outline_ratio</span> <span class="pre">attribute</span></tt> specifies the ratio of the height of the body pane to
the total height of the Leo window.
It initializes the position of the splitter separating the outline pane from the body pane.</li>
<li>The <tt class="docutils literal"><span class="pre">global_window_position</span></tt> and <tt class="docutils literal"><span class="pre">global_log_window_position</span></tt> elements
specify the position of the Leo window and Log window in global coordinates:</li>
</ul>
</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;preferences&gt;</span></tt></dt>
<dd>This element is vestigial.
Leo ignores the <tt class="docutils literal"><span class="pre">&lt;preferences&gt;</span></tt> element when reading.
Leo writes an empty <tt class="docutils literal"><span class="pre">&lt;preferences&gt;</span></tt> element.</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;find_panel_settings&gt;</span></tt></dt>
<dd>This element is vestigial.
Leo ignores the <tt class="docutils literal"><span class="pre">&lt;find_panel_settings&gt;</span></tt> element when reading.
Leo writes an empty <tt class="docutils literal"><span class="pre">&lt;find_panel_settings&gt;</span></tt> element.</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;clone_windows&gt;</span></tt></dt>
<dd>This element is vestigial.
Leo ignores the <tt class="docutils literal"><span class="pre">&lt;clone_windows&gt;</span></tt> element when reading.
Leo no longer writes <tt class="docutils literal"><span class="pre">&lt;clone_windows&gt;</span></tt> elements.</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;vnodes&gt;</span></tt></dt>
<dd>A single <tt class="docutils literal"><span class="pre">&lt;vnodes&gt;</span></tt> element contains nested <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements.
<tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements correspond to vnodes.
The nesting of <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements indicates outline structure in the obvious way.</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt></dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> element represents a single vnode and has the following form:</p>
<pre class="literal-block">
&lt;v...&gt;&lt;vh&gt;sss&lt;/vh&gt; (zero or more nested v elements) &lt;/v&gt;
</pre>
<p>The <tt class="docutils literal"><span class="pre">&lt;vh&gt;</span></tt> element specifies the headline text.
<tt class="docutils literal"><span class="pre">sss</span></tt> is the headline text encoded with the usual XML escapes.
As shown above, a <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> element may contain nested <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements.
This nesting indicates outline structure in the obvious way.
Zero or more of the following attributes may appear in <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements:</p>
<pre class="literal-block">
t=name.timestamp.n
a=&quot;xxx&quot;
</pre>
<p>The <tt class="docutils literal"><span class="pre">t=&quot;Tnnn&quot;</span></tt> attribute specifies the tnode associated with this vnode.
The <tt class="docutils literal"><span class="pre">a=&quot;xxx&quot;</span></tt> attribute specifies vnode attributes.
The <tt class="docutils literal"><span class="pre">xxx</span></tt> denotes one or more upper-case letters whose meanings are as follows:</p>
<pre class="literal-block">
C       The vnode is a clone. (Not used in 4.x)
E       The vnode is expanded so its children are visible.
M       The vnode is marked.
T       The vnode is the top visible node.
V       The vnode is the current vnode.
</pre>
<p>For example, <tt class="docutils literal"><span class="pre">a=&quot;EM&quot;</span></tt>  specifies that the vnode is expanded and is marked.</p>
<p><strong>New in 4.0</strong>:</p>
<ul class="last simple">
<li><tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements corresponding to <tt class="docutils literal"><span class="pre">&#64;file</span></tt> nodes now contain <tt class="docutils literal"><span class="pre">tnodeList</span></tt> attributes.
The <tt class="docutils literal"><span class="pre">tnodeList</span></tt> attribute allows Leo to recreate the order in which nodes should appear in the outline.
The <tt class="docutils literal"><span class="pre">tnodeList</span></tt> attribute is a list of gnx's: global node indices.
See <tt class="docutils literal"><span class="pre">Format</span> <span class="pre">of</span> <span class="pre">derived</span> <span class="pre">files</span> <span class="pre">(4.x)</span></tt> for the format of gnx's.</li>
<li>Plugins and scripts may add attributes to <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements.
See <a class="reference external" href="writingPlugins.html">Chapter 13: Writing plugins</a> for details.</li>
</ul>
</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;tnodes&gt;</span></tt></dt>
<dd>A single <tt class="docutils literal"><span class="pre">&lt;tnodes&gt;</span></tt> element contains a non-nested list of <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements.</dd>
<dt><tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt></dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> element represents a single tnode and has this form:</p>
<pre class="literal-block">
&lt;t tx=&quot;Tnnn&quot;&gt;&lt;tb&gt;sss&lt;/tb&gt;&lt;/t&gt;
</pre>
<p>The <tt class="docutils literal"><span class="pre">tx</span></tt> attribute is required.
The <tt class="docutils literal"><span class="pre">t</span></tt> attribute of <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements refer to this <tt class="docutils literal"><span class="pre">tx</span></tt> attribute.
The <tt class="docutils literal"><span class="pre">&lt;tb&gt;</span></tt> element specifies the body text.
<tt class="docutils literal"><span class="pre">sss</span></tt> is the headline text encoded with the usual XML escapes.</p>
<p class="last"><strong>New in 4.0</strong>:
Plugins and scripts may add attributes to <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements.
See <a class="reference external" href="writingPlugins.html">Chapter 13: Writing plugins</a> for details.</p>
</dd>
</dl>
</div>
<div class="section" id="format-of-derived-files">
<h1>Format of derived files</h1>
<p>This section describe the format of derived files.
Leo's <a class="reference external" href="glossary.html#sentinel-lines">sentinel lines</a> are comments, and this section describes those comments.</p>
<p>The format of derived files produced by Leo 4.0 and later meets the following goals:</p>
<ul class="simple">
<li>The minimum of sentinels needed to properly recreate the outline.</li>
<li>A robust way of telling whether newlines belong to sentinels or not.
Prior to Leo 4.0, deleting blank lines before and after sentinel lines
could corrupt the outline structure of the derived file.</li>
<li>A minimum of intrusion and ugliness.</li>
</ul>
<p><strong>New in Leo 4.2</strong>:
Files derived from <tt class="docutils literal"><span class="pre">&#64;thin</span></tt> use gnx's in <tt class="docutils literal"><span class="pre">&#64;+node</span></tt> and <tt class="docutils literal"><span class="pre">&#64;-node</span></tt> sentinels.
Such gnx's permanently and uniquely identify nodes.
Gnx's have the form:</p>
<pre class="literal-block">
id.yyyymmddhhmmss
id.yyyymmddhhmmss.n
</pre>
<p>The second form is used if two gnx's would otherwise be identical.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">id</span></tt> is a string unique to a developer, e.g., a cvs id.</li>
<li><tt class="docutils literal"><span class="pre">yyyymmddhhmmss</span></tt> is the node's creation date.</li>
<li><tt class="docutils literal"><span class="pre">n</span></tt> is an integer.</li>
</ul>
<p>Here are the sentinels used by Leo, in alphabetical order.
Unless otherwise noted, the documentation applies to all versions of Leo.
In the following discussion, <tt class="docutils literal"><span class="pre">gnx</span></tt> denotes a gnx as described above.</p>
<dl class="docutils">
<dt>&#64;&lt;&lt;</dt>
<dd><p class="first">A sentinel of the form <tt class="docutils literal"><span class="pre">&#64;&lt;&lt;section_name&gt;&gt;</span></tt> represents a section reference.</p>
<p class="last">If the reference does not end the line,
the sentinel line ending the expansion is followed by the remainder of the reference line.
This allows the Read code to recreate the reference line exactly.</p>
</dd>
<dt>&#64;&#64;</dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">&#64;&#64;</span></tt> sentinel represents any line starting with <tt class="docutils literal"><span class="pre">&#64;</span></tt> in body text
except <tt class="docutils literal"><span class="pre">&#64;``*whitespace*,</span> <span class="pre">``&#64;doc</span></tt> and <tt class="docutils literal"><span class="pre">&#64;others</span></tt>.
Examples:</p>
<pre class="last literal-block">
&#64;&#64;nocolor
&#64;&#64;pagewidth 80
&#64;&#64;tabwidth 4
&#64;&#64;code
</pre>
</dd>
<dt>&#64;afterref <strong>(Leo 4.0 and later)</strong></dt>
<dd>Marks non-whitespace text appearing after a section references.</dd>
<dt>&#64;+all <strong>(Leo 4.0 and later)</strong></dt>
<dd>Marks the start of text generated by the <tt class="docutils literal"><span class="pre">&#64;all</span></tt> directive.</dd>
<dt>&#64;-all <strong>(Leo 4.0 and later)</strong></dt>
<dd>Marks the end of text generated by the <tt class="docutils literal"><span class="pre">&#64;all</span></tt> directive.</dd>
<dt>&#64;at and &#64;doc</dt>
<dd><p class="first">The <tt class="docutils literal"><span class="pre">&#64;+doc</span></tt> and <tt class="docutils literal"><span class="pre">&#64;-doc</span></tt> sentinels delimit doc parts within a node that starts with <tt class="docutils literal"><span class="pre">&#64;doc</span></tt>.
These sentinels are nested within <tt class="docutils literal"><span class="pre">&#64;body</span></tt> directives.
Similarly, <tt class="docutils literal"><span class="pre">&#64;+at</span></tt> and <tt class="docutils literal"><span class="pre">&#64;-at</span></tt> sentinels delimit doc parts within a node that start with <tt class="docutils literal"><span class="pre">&#64;</span></tt> <em>whitespace</em>.
We use the following <strong>trailing whitespace convention</strong>
to determine where putDocPart has inserted line breaks:</p>
<pre class="literal-block">
A line in a doc part is followed by an inserted newline
if and only if the newline if preceded by whitespace.
</pre>
<p>To make this convention work,
Leo's write code deletes the trailing whitespace of all lines that are followed by a &quot;real&quot; newline.</p>
<p class="last"><strong>Leo 4.0 and later</strong>:
The <tt class="docutils literal"><span class="pre">&#64;+doc</span></tt> and <tt class="docutils literal"><span class="pre">&#64;+at</span></tt> sentinels now contain the whitespace that follows
the corresponding <tt class="docutils literal"><span class="pre">&#64;doc</span></tt> or <tt class="docutils literal"><span class="pre">&#64;</span></tt> directives.</p>
</dd>
<dt>&#64;+body <strong>(Leo 3.x only)</strong></dt>
<dd>Marks the start of body text.</dd>
<dt>&#64;-body <strong>(Leo 3.x only)</strong></dt>
<dd>Marks the end of body text.</dd>
<dt>&#64;delims</dt>
<dd>The <tt class="docutils literal"><span class="pre">&#64;delims</span></tt> sentinel inserts <tt class="docutils literal"><span class="pre">&#64;&#64;delims</span></tt> sentinels into the derived file.
The new delimiter strings continue in effect until the next <tt class="docutils literal"><span class="pre">&#64;&#64;delims</span></tt> sentinel
<em>in the derived file</em> or until the end of the derived file.
Adding, deleting or changing <tt class="docutils literal"><span class="pre">&#64;&#64;delim</span></tt> <em>sentinels</em> will destroy Leo's ability to read the derived file.
Mistakes in using the <tt class="docutils literal"><span class="pre">&#64;delims</span></tt> <em>directives</em> have no effect on Leo,
though such mistakes will thoroughly mess up a derived file as far as compilers,
HTML renderers, etc. are concerned.</dd>
<dt>&#64;+leo</dt>
<dd><p class="first">Marks the start of any derived file.
This sentinel has the form:</p>
<pre class="literal-block">
&lt;opening_delim&gt;&#64;leo&lt;closing_delim&gt;
</pre>
<p>The read code uses single-line comments if <tt class="docutils literal"><span class="pre">&lt;closing_delim&gt;</span></tt> is empty.
The write code generates single-line comments if possible.</p>
<p><strong>New in Leo 4.0</strong>: The <tt class="docutils literal"><span class="pre">&#64;+leo</span></tt> sentinel contains other information following
<tt class="docutils literal"><span class="pre">&#64;leo</span></tt>.  For example:</p>
<pre class="last literal-block">
&lt;opening_delim&gt;&#64;leo-ver=4-thin&lt;closing_delim&gt;
</pre>
</dd>
<dt>&#64;-leo</dt>
<dd>Marks the end of the Leo file.
Nothing but whitespace should follow this directive.</dd>
<dt>&#64;+middle <strong>(Leo 4.0 and later)</strong></dt>
<dd>Marks the start of intermediate nodes between the node that
references a section and the node that defines the section.
Typically no such sentinels are needed: most sections are defined in a direct child of the referencing node.</dd>
<dt>&#64;-middle <strong>(Leo 4.0 and later)</strong></dt>
<dd>Marks the end of intermediate nodes between the node that
references a section and the node that defines the section.</dd>
<dt>&#64;+node and &#64;-node</dt>
<dd><p class="first">Mark the start and end of a node.</p>
<p><strong>Leo 4.2 and later</strong>::
<tt class="docutils literal"><span class="pre">&#64;+node</span></tt> and <tt class="docutils literal"><span class="pre">&#64;-node</span></tt> sentinels use gnx's as described above:</p>
<pre class="literal-block">
&#64;+node:gnx:&lt;headline&gt;
&#64;-node:gnx:&lt;headline&gt;
</pre>
<p>Leo generates these sentinels only for nodes containing body text.
Leo no longer generates other <tt class="docutils literal"><span class="pre">&#64;+node</span></tt> sentinels to indicate outline structure.
As a result, there is no longer any need for <tt class="docutils literal"><span class="pre">&#64;+body</span></tt> sentinels.</p>
<p><strong>Before Leo 4.2</strong>::
<tt class="docutils literal"><span class="pre">&#64;+node</span></tt> and <tt class="docutils literal"><span class="pre">&#64;-node</span></tt> sentinels used child indices, and status fields as described below:</p>
<pre class="literal-block">
&#64;+node:&lt;child_index&gt;:&lt;status_fields&gt;:&lt;headline&gt;
&#64;-node::&lt;child_index&gt;:&lt;status_fields&gt;:&lt;headline&gt;
</pre>
<p class="last"><tt class="docutils literal"><span class="pre">&lt;child_index&gt;</span></tt> is a number from 1 to n indicating the index of the node in the list of its parent's children.
<tt class="docutils literal"><span class="pre">&lt;status_field&gt;</span></tt> is the cloneIndex field of the form: &quot;C=nnn&quot;, where nnn is an immutable clone index.
<tt class="docutils literal"><span class="pre">&lt;headline&gt;</span></tt> contains <em>headline</em> text, not reference text.</p>
</dd>
<dt>&#64;nl <strong>(Leo 4.0 and later)</strong></dt>
<dd>Adds a newline to the body text.</dd>
<dt>&#64;nonl <strong>(Leo 4.0 and later)</strong></dt>
<dd>Suppresses a newline from the body text.</dd>
<dt>&#64;others</dt>
<dd>The <tt class="docutils literal"><span class="pre">&#64;+others</span></tt> sentinel indicates the start of the expansion of an <tt class="docutils literal"><span class="pre">&#64;+others</span></tt> directive,
which continues until the matching <tt class="docutils literal"><span class="pre">&#64;-others</span></tt> sentinel.
<tt class="docutils literal"><span class="pre">&#64;others</span></tt> sentinels are nested within <tt class="docutils literal"><span class="pre">&#64;body</span></tt> sentinels;
the expansion of the <tt class="docutils literal"><span class="pre">&#64;others</span></tt> directive always occurs within the body text of some node.</dd>
<dt>&#64;verbatim</dt>
<dd><tt class="docutils literal"><span class="pre">&#64;verbatim</span></tt> indicates that the next line of the derived file is not a sentinel.
This escape convention allows body text to contain lines that would otherwise be considered sentinel lines.</dd>
<dt>&#64;&#64;verbatimAfterRef</dt>
<dd><p class="first"><tt class="docutils literal"><span class="pre">&#64;verbatimAfterRef</span></tt> is generated when a comment following a section reference would otherwise be treated as a sentinel.
In Python code, an example would be:</p>
<pre class="literal-block">
&lt;&lt; ref &gt;&gt; #+others
</pre>
<p class="last">This sentinel is required only when blank lines are suppressed between sentinel lines.</p>
</dd>
</dl>
</div>
<div class="section" id="unicode-reference">
<h1>Unicode reference</h1>
<p>Leo uses unicode internally for all strings.</p>
<ol class="arabic">
<li><p class="first">Leo converts headline and body text to unicode when reading .leo files and derived files.
Both .leo files and derived files may specify their encoding.  The default is <tt class="docutils literal"><span class="pre">utf-8</span></tt>.
If the encoding used in a derived file is not &quot;utf-8&quot; it is represented in the <tt class="docutils literal"><span class="pre">&#64;+leo</span></tt> sentinel line.
For example:</p>
<pre class="literal-block">
#&#64;+leo-encoding=iso-8859-1.
</pre>
<p>The <tt class="docutils literal"><span class="pre">utf-8</span></tt> encoding is a &quot;lossless&quot; encoding (it can represent all unicode code points),
so converting to and from utf-8 plain strings will never cause a problem.
When reading or writing a character not in a &quot;lossy&quot; encoding,
Leo converts such characters to '?' and issues a warning.</p>
</li>
<li><p class="first">When writing .leo files and derived files Leo uses the same encoding used to read the file,
again with <tt class="docutils literal"><span class="pre">utf-8</span></tt> used as a default.</p>
</li>
<li><p class="first">leoSettings.leo contains the following Unicode settings, with the defaults as shown:</p>
<pre class="literal-block">
default_derived_file_encoding = UTF-8
new_leo_file_encoding = UTF-8
</pre>
<p>These control the default encodings used when writing derived files and .leo files.
Changing the <tt class="docutils literal"><span class="pre">new_leo_file_encoding</span></tt> setting is not recommended.
See the comments in leoSettings.leo.
You may set <tt class="docutils literal"><span class="pre">default_derived_file_encoding</span></tt> to anything that makes sense for you.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">&#64;encoding</span></tt> directive specifies the encoding used in a derived file.
You can't mix encodings in a single derived file.</p>
</li>
</ol>
</div>
</div>
</body>
</html>
