<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title>Chapter 8: Customizing Leo</title>
<style type="text/css">

/*ORIGINAL GOODGER + changes; up to line 224 it's standard reST stylesheet
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:date: $Date: 2006/10/19 13:23:15 $
:version: $Revision: 1.2 $
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
*/

/* EKR 10/19/06 */
/* some browsers require imported rules to precede all rulesets */
@import url(leo_rst.css);
@import url(silver_city.css);

.first {
  margin-top: 0 }

.last {
  margin-bottom: 0 }

a.toc-backref {
  text-decoration: none ;
  color: black }

dd {
  margin-bottom: 0.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.attention, div.caution, div.danger, div.error, div.hint,
div.important, div.note, div.tip, div.warning, div.admonition {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

div.hint p.admonition-title, div.important p.admonition-title,
div.note p.admonition-title, div.tip p.admonition-title,
div.admonition p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em }

div.footer, div.header {
  font-size: smaller }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 0em 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.line-block {
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;}
  /*background-color: #eeeeee }*/
  /*for some reason i can't overide in an import*/

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

table {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.citation {
  border-left: solid thin gray ;
  padding-left: 0.5ex }

table.docinfo {
  margin: 2em 4em }

table.footnote {
  border-left: solid thin black ;
  padding-left: 0.5ex }

td, th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

th.docinfo-name, th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap }

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
  font-size: 100% }

/*for some reason, the following isn't being overridden by the imports
at the end of this style sheet so I've commented it out*/
/*tt {
  background-color: #eeeeee }*/

ul.auto-toc {
  list-style-type: none }
  
hr { /* EKR */
  width: 100%;
  height: 1pt;
  color: gray;
}



</style>
</head>
<body>
<div class="document" id="chapter-8-customizing-leo">
<h1 class="title">Chapter 8: Customizing Leo</h1>
<!-- rst3: filename: html\customizing.html -->
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 3)</p>
<p>Substitution definition &quot;back&quot; empty or invalid.</p>
<pre class="literal-block">
.. |back| |leo| |next|

</pre>
</div>
<p>This chapter discusses how to customize Leo using the plugins and other means.
See <a class="reference" href="commands.html#specifying-settings">Specifying settings</a> for a description of how to change Leo's settings.</p>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#id1" id="id2" name="id2">Specifying settings</a><ul>
<li><a class="reference" href="#configuration-directories" id="id3" name="id3">Configuration directories</a></li>
<li><a class="reference" href="#search-order-for-settings-files" id="id4" name="id4">Search order for settings files</a></li>
<li><a class="reference" href="#safe-rules-for-local-settings" id="id5" name="id5">Safe rules for local settings</a></li>
<li><a class="reference" href="#organizer-nodes" id="id6" name="id6">Organizer nodes</a></li>
<li><a class="reference" href="#ignore-and-if-nodes" id="id7" name="id7">&#64;ignore and &#64;if nodes</a></li>
<li><a class="reference" href="#simple-settings-nodes" id="id8" name="id8">Simple settings nodes</a></li>
<li><a class="reference" href="#complex-settings-nodes" id="id9" name="id9">Complex settings nodes</a><ul>
<li><a class="reference" href="#button" id="id10" name="id10">&#64;button</a></li>
<li><a class="reference" href="#commands" id="id11" name="id11">&#64;commands</a></li>
<li><a class="reference" href="#data" id="id12" name="id12">&#64;data</a></li>
<li><a class="reference" href="#enabled-plugins" id="id13" name="id13">&#64;enabled-plugins</a></li>
<li><a class="reference" href="#font" id="id14" name="id14">&#64;font</a></li>
<li><a class="reference" href="#menuat" id="id15" name="id15">&#64;menuat</a></li>
<li><a class="reference" href="#menus" id="id16" name="id16">&#64;menus</a></li>
<li><a class="reference" href="#mode" id="id17" name="id17">&#64;mode</a></li>
<li><a class="reference" href="#recentfiles" id="id18" name="id18">&#64;recentfiles</a></li>
<li><a class="reference" href="#shortcuts" id="id19" name="id19">&#64;shortcuts</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference" href="#input-modes" id="id20" name="id20">Input modes</a></li>
<li><a class="reference" href="#adding-extensible-attributes-to-nodes-and-leo-files" id="id21" name="id21">Adding extensible attributes to nodes and .leo files</a></li>
<li><a class="reference" href="#specifying-tk-options-using-leo-xresources" id="id22" name="id22">Specifying Tk options using .leo_xresources</a></li>
<li><a class="reference" href="#translating-leo-s-menus-and-messages" id="id23" name="id23">Translating Leo's menus and messages</a></li>
</ul>
</div>
<!-- WARNING: image targets may not have upper case letters! -->
<div class="section">
<h1><a class="toc-backref" href="#id2" id="id1" name="id1">Specifying settings</a></h1>
<p>Leo stores options in <strong>&#64;settings trees</strong>, outlines whose headline is
&#64;settings. When opening a .leo file, Leo looks for &#64;settings trees not only
in the outline being opened but also in various leoSettings.leo files.
This scheme allows for the following kinds of settings:</p>
<ul class="simple">
<li>Per-installation or per-machine settings.</li>
<li>Per-user settings.</li>
<li>Per-folder settings.</li>
<li>Per-file settings.</li>
</ul>
<p>There are four kinds of settings files:</p>
<ol class="arabic simple">
<li><strong>Default settings files</strong>, named <strong>leoSettings.leo</strong>.
Although they can be used in other ways, they typically contain default settings.</li>
<li><strong>Personal settings files</strong>, named <strong>myLeoSettings.leo</strong>. They provide a way
of ensuring that your customized settings are not altered when updating Leo
from bzr or while installing a new version of Leo. The myLeoSettings.leo acts
much like Python's site-customize.py file. myLeoSettings.leo will never be
part of any Leo distribution, and it will never exist in Leo's cvs
repository. This solution is <em>much</em> better than trying to update
leoSettings.leo with scripts.</li>
<li><strong>Machine settings files</strong>, named <strong>LeoSettings.leo</strong> (note the capital 'L'),
and appearing in a unique directory.</li>
<li><strong>Command-line settings files</strong>, specified using Leo's -c command-line
option. Any .leo file may be used, provided it has an &#64;settings tree. These
files typically provide a common set of settings for files scattered in
various places on the file system.</li>
</ol>
<p>The following sections describe the kinds of nodes in &#64;settings trees.</p>
<div class="section">
<h2><a class="toc-backref" href="#id3" id="configuration-directories" name="configuration-directories">Configuration directories</a></h2>
<p>Settings files can be found in the following directories:</p>
<ul class="simple">
<li><strong>homeDir</strong>, the HOME/.leo directory. HOME is given by Python's HOME
environment variable, or by os.expanduser('~') if no HOME environment variable
exists.</li>
<li><strong>configDir</strong>, Leo's configuration directory: leo/config.</li>
<li><strong>machineDir</strong>, the HOME/.leo/MACHINE directory. MACHINE is given by Python's
HOSTNAME environment variable, or by Python's COMPUTERNAME environment
variable if there is no HOSTNAME variable, or by the value returned by
socket.gethostname() if neither environment variable exists.</li>
<li><strong>localDir</strong>, the directory containing the .leo file being loaded.</li>
</ul>
<p>In addition, Leo's -c command-line option can specify any .leo file anywhere.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id4" id="search-order-for-settings-files" name="search-order-for-settings-files">Search order for settings files</a></h2>
<p>When reading a .leo file, Leo looks for settings in default settings
files first, then settings in personal settings files, and finally
settings in local settings files.  The exact search order is:</p>
<ol class="arabic simple">
<li>Default settings files:<ol class="loweralpha">
<li>configDir/leoSettings.leo</li>
<li>homeDir/leoSettings.leo</li>
<li>localDir/leoSettings.leo</li>
</ol>
</li>
<li>Personal settings files:<ol class="loweralpha">
<li>configDir/myLeoSettings.leo</li>
<li>homeDir/myLeoSettings.leo</li>
<li>homeDir/&lt;machine-name&gt;LeoSettings.leo (note capitalization)</li>
<li>localDir/myLeoSettings.leo</li>
</ol>
</li>
<li>Local settings files:<ol class="loweralpha">
<li>The file specified by the -c command-line option.</li>
<li>The file being loaded.</li>
</ol>
</li>
</ol>
<p>Settings that appear later in this list override settings that
appear earlier in this list.  This happens on a setting-by-setting
basis, <em>not</em> on a file-by-file basis.  In other words, each individual
setting overrides only the <em>corresponding</em> setting in previously-read
files.  Reading a setting file does <em>not</em> reset all previous settings.
Note that the same file might appear several times in the search list.
Leo detects such duplicate file names and only loads each settings file once.
Leo remembers all the settings in settings files and does not reread those
settings when reading another .leo file.</p>
<p><strong>Caution</strong>: This search order offers almost too much flexibilty. This can be
confusing, even for power users. It's important to choose the &quot;simplest
configuration scheme that could possibly work&quot;.  Something like:</p>
<ul class="simple">
<li>Use a single leoSettings.leo file for installation-wide defaults.</li>
<li>Use a single myLeoSettings.leo files for personal defaults.</li>
<li>Use local settings sparingly.</li>
</ul>
<p><strong>Important</strong>: it is good style to limit settings placed in
myLeoSettings.leo to those settings that differ from default settings.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id5" id="safe-rules-for-local-settings" name="safe-rules-for-local-settings">Safe rules for local settings</a></h2>
<p>You should use special care when placing default or personal settings files in
<strong>local</strong> directories, that is, directories other than homeDir, configDir or
machineDir. In particular, the value of localDir can change when Leo reads
additional files. This can result in Leo finding new default and personal
settings files. The values of these newly-read settings files will, as always,
override any previously-read settings.</p>
<p>Let us say that a setting is <strong>volatile</strong> if it is different from a default
setting. Let us say that settings file A.leo <strong>covers</strong> settings file if B.leo
if all volatile settings in B.leo occur in A.leo. With these definitions, the
<strong>safe rule</strong> for placing settings files in local directories is:</p>
<pre class="literal-block">
Settings files in local directories should
cover all other settings files.
</pre>
<p>Following this rule will ensure that the per-directory defaults specified in the
local settings file will take precedence over all previously-read default and
personal settings files. Ignore this principle at your peril.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id6" id="organizer-nodes" name="organizer-nodes">Organizer nodes</a></h2>
<p>Organizer nodes have headlines that do no start with &#64;.
Organizer nodes may be inserted freely without changing the meaning of an &#64;setting tree.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id7" id="ignore-and-if-nodes" name="ignore-and-if-nodes">&#64;ignore and &#64;if nodes</a></h2>
<p>Leo ignores any subtree of an <tt class="docutils literal"><span class="pre">&#64;settings</span></tt> tree whose headline starts with <tt class="docutils literal"><span class="pre">&#64;ignore</span></tt>.</p>
<p>You can use several other kinds of nodes to cause Leo to ignore parts of  an <tt class="docutils literal"><span class="pre">&#64;settings</span></tt> tree:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">&#64;if</span></tt> <em>expression</em></p>
<p>A node whose headline starts with <tt class="docutils literal"><span class="pre">&#64;if</span></tt> <em>expression</em> acts like an organizer node if the expression evaluates to True,
otherwise acts like an <tt class="docutils literal"><span class="pre">&#64;ignore</span></tt> node.
If the expression is empty the body text should contain a script that will be evaluated (in an empty context).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">&#64;ifplatform</span></tt> <em>platform-name</em></p>
<p>Same as <tt class="docutils literal"><span class="pre">&#64;if</span> <span class="pre">sys.platform</span> <span class="pre">==</span> <span class="pre">&quot;platform-name&quot;:</span></tt> except that it isn't necessary to import sys.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">&#64;ifhostname</span></tt> <em>hostA,!hostB</em></p>
<p>Evaluates to True iff: h=g.computeMachineName(); h==hostA and h!=hostB.
The &quot;!&quot; version allows matching to every machineName except the given one
to allow differing settings on only a few machines.</p>
</li>
</ul>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id8" id="simple-settings-nodes" name="simple-settings-nodes">Simple settings nodes</a></h2>
<p>Simple settings nodes have headlines of the form:</p>
<pre class="literal-block">
&#64;&lt;type&gt; name = val
</pre>
<p>set the value of <tt class="docutils literal"><span class="pre">name</span></tt> to <tt class="docutils literal"><span class="pre">val</span></tt>, with the indicated type.</p>
<p>&lt;type&gt; may be one of the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr><td>&lt;type&gt;</td>
<td>Valid values</td>
</tr>
<tr><td>&#64;bool</td>
<td>True, False, 0, 1</td>
</tr>
<tr><td>&#64;color</td>
<td>A Tk color name or value, such as 'red' or 'xf2fddff' (without the quotes)</td>
</tr>
<tr><td>&#64;directory</td>
<td>A path to a directory</td>
</tr>
<tr><td>&#64;float</td>
<td>A floating point number of the form nn.ff.</td>
</tr>
<tr><td>&#64;int</td>
<td>An integer</td>
</tr>
<tr><td>&#64;ints[list]</td>
<td>An integer (must be one of the ints in the list).
Example: &#64;ints meaningOfLife[0,42,666]=42</td>
</tr>
<tr><td>&#64;keys[name]</td>
<td>Gives a name to a set of bindings for the Check Bindings script in leoSettings.leo.</td>
</tr>
<tr><td>&#64;path</td>
<td>A path to a directory or file</td>
</tr>
<tr><td>&#64;ratio</td>
<td>A floating point number between 0.0 and 1.0, inclusive.</td>
</tr>
<tr><td>&#64;string</td>
<td>A string</td>
</tr>
<tr><td>&#64;strings[list]</td>
<td>A string (must be one of the strings in the list).
Example: &#64;strings tk_relief['flat','groove','raised']='groove'</td>
</tr>
</tbody>
</table>
<p><strong>Note</strong>: For a list of Tk color specifiers see:</p>
<ul class="simple">
<li><a class="reference" href="http://www.tcl.tk/man/tcl8.4/TkCmd/colors.htm">http://www.tcl.tk/man/tcl8.4/TkCmd/colors.htm</a></li>
<li><a class="reference" href="http://www.tcl.tk/man/tcl8.4/TkLib/GetColor.htm">http://www.tcl.tk/man/tcl8.4/TkLib/GetColor.htm</a></li>
</ul>
<p><strong>Important</strong>: you can use the show-colors minibuffer command to guide you in making these settings.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id9" id="complex-settings-nodes" name="complex-settings-nodes">Complex settings nodes</a></h2>
<p>Complex settings nodes have headlines of the form:</p>
<pre class="literal-block">
&#64;&lt;type&gt; description
</pre>
<p>The type may be one of the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr><td>&lt;type&gt;</td>
<td>Valid values</td>
</tr>
<tr><td>&#64;buttons</td>
<td>Child &#64;button nodes create global buttons</td>
</tr>
<tr><td>&#64;commands</td>
<td>Child &#64;command nodes create global buttons</td>
</tr>
<tr><td>&#64;data</td>
<td>Body text contains a list of strings, one per line.</td>
</tr>
<tr><td>&#64;enabled-plugins</td>
<td>Body text contains a list of enabled plugins</td>
</tr>
<tr><td>&#64;font</td>
<td>Body text contains a font description</td>
</tr>
<tr><td>&#64;menus</td>
<td>Child &#64;menu and &#64;item nodes create menus and menu items.</td>
</tr>
<tr><td>&#64;menuat</td>
<td>Child &#64;menu and &#64;item nodes modify menu tree create by &#64;menus.</td>
</tr>
<tr><td>&#64;mode [name]</td>
<td>Body text contains a list of shortcut specifiers.</td>
</tr>
<tr><td>&#64;recentfiles</td>
<td>Body text contains a list of file paths.</td>
</tr>
<tr><td>&#64;shortcuts</td>
<td>Body text contains a list of shortcut specifies.</td>
</tr>
</tbody>
</table>
<p>Complex nodes specify settings in their body text.
See the following sections for details.</p>
<div class="section">
<h3><a class="toc-backref" href="#id10" id="button" name="button">&#64;button</a></h3>
<p>An &#64;buttons tree in a settings file defines global buttons that
are created in the icon area of all .leo files.
All &#64;button nodes in the &#64;commands tree create global buttons.
All &#64;button nodes outside the commands tree create buttons local to the settings file.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id11" id="commands" name="commands">&#64;commands</a></h3>
<p>An &#64;commands tree in a settings file defines global commands.
All &#64;command nodes in the &#64;commands tree create global commands.
All &#64;command nodes outside the commands tree create commands local to the settings file.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id12" id="data" name="data">&#64;data</a></h3>
<p>The body text contains a list of strings, one per line.
Lines starting with '#' are ignored.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id13" id="enabled-plugins" name="enabled-plugins">&#64;enabled-plugins</a></h3>
<p>The body text of the &#64;enabled plugins node contains a list of enabled plugins,
one per line. Comment lines starting with '#' are ignored. Leo loads plugins in
the order they appear.
<strong>Important</strong>: Leo handles &#64;enabled-plugins nodes a differently from other kinds
of settings. To avoid confusion, <strong>please read the following carefully</strong>.</p>
<p>As always, Leo looks for &#64;enabled-plugins nodes in settings files in the order
specified by <a class="reference" href="#search-order-for-settings-files">Search order for settings files</a>. Leo will enable all plugins
found in the &#64;enabled-plugins node it finds <em>last</em> in the search order. Leo does
<em>not</em> enable plugins found in any other &#64;enabled-plugins node. In particular,
<strong>you can not specify a list of default plugins by placing that list in a
settings file that appears early in the search list</strong>. Instead, the last
&#64;enabled-plugins node found in the search list specifies all and <em>only</em> the plugins
that will be enabled.</p>
<p>Let us distinguish two different situations. First, what Leo does when loading a
file, say x.leo. Second, what Leo does when loading a second file, say y.leo,
<em>from x.leo</em>. When loading the first .leo file, Leo enables plugins from the
&#64;enabled-plugins node it finds <em>last</em> in the search order. But after plugins
have <em>already</em> been loaded and enabled, there is no way to disable previously
loaded-and-enabled plugins. But local settings files can enable additional
plugins.</p>
<p>To avoid confusion, I highly recommend following another kind of safe rule.
We say that an &#64;enabled-plugin node in file A.leo <strong>covers</strong> an &#64;enabled-plugin
node in file B.leo if all plugins specified in B's &#64;enabled-plugin node appear
A's &#64;enabled-plugin node. The safe rule for plugins is:</p>
<pre class="literal-block">
&#64;enabled-plugin nodes in settings files in local directories
should cover &#64;enabled-plugins nodes in all other settings files.
</pre>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id14" id="font" name="font">&#64;font</a></h3>
<p>The body text contains a list of settings for a font.  For example:</p>
<pre class="literal-block">
body_text_font_family = Courier New
body_text_font_size = None
body_text_font_slant = None
body_text_font_weight = None
</pre>
<p><strong>Important</strong>: you can use the show-fonts minibuffer command to guide you in making these settings.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id15" id="menuat" name="menuat">&#64;menuat</a></h3>
<p>The form of this node is:</p>
<pre class="literal-block">
&#64;menuat *&lt;path&gt;* *&lt;action&gt;* *[clipboard]*
</pre>
<p>The &#64;menuat setting has 2-3 parameters in its head text, its children are &#64;menu and
&#64;item nodes as for the &#64;menu setting.  &#64;menuat modifies the menu tree created by &#64;menus.
It is intended to be used in myLeoSettings.leo to modify the menu tree created
in leoSettings.leo. This allows you to change the menus without having to
re-create the entire menu tree from leoSettings.leo, and ensures you don't miss
out when new things are added in the &#64;menus in leoSettings.leo, as you would if
you replaced the &#64;menus in leoSettings.leo with one in myLeoSettings.leo.
&#64;menuat should occur in a &#64;settings tree, but not as a descendant of a &#64;menus
tree. There is an example of the use of the
&#64;menuat setting in the file .../leo/core/test/menuAtTest.leo.</p>
<p>The <strong>path</strong> argument specifies a target location in the menu tree as defined by
&#64;menus and modified by earlier &#64;menuat settings. The path takes the form
/entry1/entry2/entry3 where each entry is the name of a menu or item with all
text except a-z and 0-9 removed. Upper case letters are converted to lower case.
So for example to use the <cite>Outline-&gt;Move-&gt;Move Down</cite> menu item as a target, you
would specify a path as <cite>/outline/move/movedown</cite>.</p>
<p>The <strong>action</strong> argument specifies what the menu item does.
There are 5 available actions:</p>
<ul class="simple">
<li><strong>before</strong>: The supplied items and sub menus will be inserted immediately
before the target menu or item.</li>
<li><strong>after</strong>: The supplied items and sub menus will be inserted immediately after
the target menu or item.</li>
<li><strong>append</strong>: The supplied items and sub menus will be appended at the end of
the menu containing the target menu or item.</li>
<li><strong>cut</strong>: The target menu or item will be removed from the menu tree and saved
to an internal clipboard. This can be used for deleting menus or items.
Descendants of the &#64;menuat setting are ignored.</li>
<li><strong>copy</strong>: The target menu or item will be copied and saved to
an internal clipboard.  Descendants of the &#64;menuat setting are ignored.</li>
</ul>
<p>The optional <strong>clipboard</strong> argument modifies the action of the before, after,
and append actions. By default these actions insert the menus and items supplied
as descendants of the &#64;menuat setting. If you specify &quot;clipboard&quot; (without the
quotes) as the source, the contents of the clipboard from a previous cut or copy
action will be used instead. This parameter is optional and can be left blank.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id16" id="menus" name="menus">&#64;menus</a></h3>
<p>Leo creates its menus from the &#64;menu, &#64;item and &#64;popup nodes in the &#64;menus tree.
Within &#64;menus trees, &#64;menu nodes create menus and &#64;item nodes create menu items.</p>
<p>The menu name always follows &#64;menu. If the menu name is 'Plugins', Leo will
create the Plugins menu and populate the menu by calling the
'create-optional-menus' hook. This creates the Plugins menu as usual. Nested
&#64;menu nodes define submenus.</p>
<p>The command name follows &#64;item. If the body text of an &#64;item node exists, this
body text is the menu name. Otherwise, the menu name is the command name.
However, if the command name starts with a <tt class="docutils literal"><span class="pre">'*'</span></tt>, hyphens are removed from the
menu name. Menu names and command names may contain a single ampersand (&amp;). If
present, the following character is underlined in the name. If the command
name in an &#64;item node is just a hyphen (-), the item represents a menu
separator.</p>
<p><tt class="docutils literal"><span class="pre">&#64;popup</span></tt> <em>&lt;widget-name&gt;</em> creates a popup menu for use by the rClick plugin.
The children of this node should be &#64;menu and &#64;item nodes, used as with
&#64;menus.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id17" id="mode" name="mode">&#64;mode</a></h3>
<p>The form of this node is:</p>
<pre class="literal-block">
&#64;mode *&lt;mode name&gt;*
</pre>
<p>The body text contains a list of shortcut specifiers. <tt class="docutils literal"><span class="pre">&#64;mode</span></tt> nodes work just
like <tt class="docutils literal"><span class="pre">&#64;shortcuts</span></tt> nodes, but in addition they have the side effect of creating
the <tt class="docutils literal"><span class="pre">enter-&lt;mode</span> <span class="pre">name&gt;-mode</span></tt> command.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id18" id="recentfiles" name="recentfiles">&#64;recentfiles</a></h3>
<p>The body text contains a list of paths of recently opened files, one path per
line. Leo writes the list of recent files to <tt class="docutils literal"><span class="pre">.leoRecentFiles.txt</span></tt> in Leo's
<tt class="docutils literal"><span class="pre">config</span></tt> directory, again one file per line.</p>
</div>
<div class="section">
<h3><a class="toc-backref" href="#id19" id="shortcuts" name="shortcuts">&#64;shortcuts</a></h3>
<p>The body text contains a list of shortcut specifiers.</p>
</div>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id20" id="input-modes" name="input-modes">Input modes</a></h1>
<p>Leo now allows you to specify input modes. You enter mode <tt class="docutils literal"><span class="pre">x</span></tt> with the
<tt class="docutils literal"><span class="pre">enter-x-mode</span></tt> command. The purpose of a mode is to create different bindings
for keys within a mode. Often plain keys are useful in input modes.</p>
<p>You can specify modes with <tt class="docutils literal"><span class="pre">&#64;mode</span></tt> nodes in leoSettings.leo. <tt class="docutils literal"><span class="pre">&#64;mode</span></tt> nodes work
just like <tt class="docutils literal"><span class="pre">&#64;shortcuts</span></tt> nodes, but in addition they have the side effect of
creating the <tt class="docutils literal"><span class="pre">enter-&lt;mode</span> <span class="pre">name&gt;-mode</span></tt> command.</p>
<p>Notes:</p>
<ul class="simple">
<li>You can exit any mode using the <tt class="docutils literal"><span class="pre">keyboard-quit</span></tt> (Control-g) command. This is the
<strong>only</strong> binding that is automatically created in each mode. All other bindings
must be specified in the <tt class="docutils literal"><span class="pre">&#64;mode</span></tt> node. In particular, the bindings specified in
&#64;shortcuts nodes are <strong>not</strong> in effect in mode (again, except for the
keyboard-quit binding).</li>
<li>Leo supports something akin to tab completion within modes: if you type a key
that isn't bound in a mode a 'Mode' tab will appear in the log pane. This tab
shows all the keys that you can type and the commands to which they are bound.
The mode-help command does the same thing.</li>
<li><tt class="docutils literal"><span class="pre">&#64;shortcuts</span></tt> nodes specify the bindings for what might be called the 'top-level'
mode. These are the bindings in effect when no internal state is present, for
example, just after executing the keyboard-quit command.</li>
<li>The <tt class="docutils literal"><span class="pre">top_level_unbound_key_action</span></tt> setting determines what happens to
unbound keys in the top-level mode. Leo ignores unbound keys in all other modes.
The possibilities are 'insert', 'replace' and 'ignore'.</li>
<li>The <tt class="docutils literal"><span class="pre">set-insert-mode</span></tt>, <tt class="docutils literal"><span class="pre">set-overwrite-mode</span></tt> and <tt class="docutils literal"><span class="pre">set-ignore-mode</span></tt>
commands alter what happens to unbound keys in the top-level mode.</li>
</ul>
<p>With all these options it should be possible to emulate the keyboard behavior of any other editor.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id21" id="adding-extensible-attributes-to-nodes-and-leo-files" name="adding-extensible-attributes-to-nodes-and-leo-files">Adding extensible attributes to nodes and .leo files</a></h1>
<p>Leo's .leo file format is extensible. The basis for extending .leo files are the
<tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt> and <tt class="docutils literal"><span class="pre">v.unknownAttributes</span></tt> ivars of tnodes and vnodes,
or uA's for short. Leo translates between uA's and xml attributes in the
corresponding <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements in .leo files. Plugins may also use
<tt class="docutils literal"><span class="pre">v.tempAttributes</span></tt> or <tt class="docutils literal"><span class="pre">t.tempAttributes</span></tt> ivars to hold temporary information
that will <em>not</em> be written to the .leo file.</p>
<p>Collectively, these four kinds of ivars are called <strong>attribute ivars</strong>.
Attribute ivars must be Python dictionaries, whose keys are names of plugins and
whose values are <em>other</em> dictionaries, called <strong>inner dictionaries</strong>, for
exclusive use of each plugin. For example, a plugin named 'xyzzy' would set
<tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt> as follows:</p>
<pre class="literal-block">
# Create the uA if necessary.
if not hasattr(p.v.t,'unknownAttributes'):
    p.v.t.unknownAttributes = {}

# Get the inner dictionary for the 'xyzzy' plugin, creating it if necessary.
d = p.v.t.unknownAttributes.get('xyzzy',{})

# Set some values. These values must be picklable.
d ['duration'] = 5
d ['notes'] = &quot;This is a note.&quot;

# Update the uA.
p.v.t.unknownAttributes ['xyzzy'] = d

if hasattr(p.v.t,&quot;unknownAttributes&quot;):
    d = p.v.t.unknownAttributes.get(&quot;xyzzy&quot;,{})
    g.es(d['duration'])
    g.es(d['notes'])
</pre>
<p>Plugins would use similar code to create <tt class="docutils literal"><span class="pre">v.unknownAttributes</span></tt>,
<tt class="docutils literal"><span class="pre">t.tempAttributes</span></tt>, and <tt class="docutils literal"><span class="pre">v.tempAttributes</span></tt> ivars.</p>
<p><strong>Important</strong>: All members of inner dictionaries should be picklable: Leo
uses Python's Pickle module to encode all values in these dictionaries. Leo will
discard any attributes that can not be pickled. This should not be a major
problem to plugins. For example, instead of putting a tnode into these
dictionaries, a plugin could put the tnode's gnx (a string) in the dictionary.</p>
<p><strong>Note</strong>: Leo does <em>not</em> pickle members of inner dictionaries whose name (key) starts with <tt class="docutils literal"><span class="pre">str_</span></tt>.
The values of such members should be a Python string.
This convention allows strings to appear in .leo files in a more readable format.</p>
<p><strong>Important</strong>: Plugins must <em>not</em> use <tt class="docutils literal"><span class="pre">v.unknownAttributes</span></tt> inside <tt class="docutils literal"><span class="pre">&#64;thin</span></tt>
trees. Indeed Leo uses <strong>hidden machinery</strong> to write <tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt>.
Leo does <em>not</em> write <tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt> to thin derived files. Instead Leo
writes a representation of all <tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt> contained in the
<tt class="docutils literal"><span class="pre">&#64;thin</span></tt> tree to a special xml attribute called
<tt class="docutils literal"><span class="pre">descendentTnodeUnknownAttributes</span></tt> in the <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> element corresponding to the
<tt class="docutils literal"><span class="pre">&#64;thin</span></tt> node. Yes, this is complicated, but it works. Leo can <em>not</em> write
<tt class="docutils literal"><span class="pre">v.unknownAttributes</span></tt> in <tt class="docutils literal"><span class="pre">&#64;thin</span></tt> trees because <strong>only tnodes have gnx's in
thin derived files</strong>. In effect, vnodes are anonymous.</p>
<p>Plugins that must associate attributes with vnodes should support only <tt class="docutils literal"><span class="pre">&#64;file</span></tt>
trees. A completely different alternative would be for the plugin to extend how
Leo reads and writes <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements in .leo files, but that would be much more
complicated than using <tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt></p>
<p>Here are the details about how Leo associates uA's with <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements in .leo files:</p>
<ul class="simple">
<li><strong>Native xml attributes</strong> are the attributes of <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements that are
known (treated specially) by Leo's read/write code.
The only native attribute of <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements is <tt class="docutils literal"><span class="pre">tx</span></tt>.
The native attributes of <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> elements are <tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="docutils literal"><span class="pre">t</span></tt>, <tt class="docutils literal"><span class="pre">vtag</span></tt>, <tt class="docutils literal"><span class="pre">tnodeList</span></tt>,
<tt class="docutils literal"><span class="pre">marks</span></tt>, <tt class="docutils literal"><span class="pre">expanded</span></tt> and <tt class="docutils literal"><span class="pre">descendentTnodeUnknownAttributes</span></tt>.
All other attributes of <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements are <strong>foreign xml attributes</strong>.</li>
<li>When reading a .leo file, Leo will create <tt class="docutils literal"><span class="pre">t.unknownAttributes</span></tt> or <tt class="docutils literal"><span class="pre">v.unknownAttributes</span></tt> ivars for
any <tt class="docutils literal"><span class="pre">tnode</span></tt> or <tt class="docutils literal"><span class="pre">vnode</span></tt> whose corresponding <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> or <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> element contains a foreign xml attribute.</li>
<li>When writing a file, Leo will write foreign xml attributes in <tt class="docutils literal"><span class="pre">&lt;v&gt;</span></tt> or <tt class="docutils literal"><span class="pre">&lt;t&gt;</span></tt> elements
if the corresponding  vnode or tnode contains an <tt class="docutils literal"><span class="pre">unknownAttributes</span></tt> ivar.</li>
<li>Leo performs the usual xml escapes on these strings when reading or writing the <tt class="docutils literal"><span class="pre">unknownAttributes</span></tt> ivars.</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id22" id="specifying-tk-options-using-leo-xresources" name="specifying-tk-options-using-leo-xresources">Specifying Tk options using .leo_xresources</a></h1>
<p>Leo looks for a file called <tt class="docutils literal"><span class="pre">.leo_xresources</span></tt> in the users home directory. If
found, Leo will pass that file to Tk's <tt class="docutils literal"><span class="pre">option_readfile</span></tt> method for the top
widget. This allows users to set Tk options.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id23" id="translating-leo-s-menus-and-messages" name="translating-leo-s-menus-and-messages">Translating Leo's menus and messages</a></h1>
<p>It is easy to translate Leo's menu strings: simply create an &#64;menus tree in
leoSettings.leo or myLeoSettings.leo that contains the translated menu names.</p>
<p><strong>New in Leo 4.4.8</strong>:
Leo now contains support for translating messages sent to Leo's log:</p>
<ul class="simple">
<li>Rather than using an '_' function to denote strings to be translated, Leo's
g.es and g.es_print functions translate &quot;odd&quot; (first, third, fifth) arguments,
leaving &quot;even&quot; arguments untranslated. Keyword arguments, color, newline, etc.
are never translated.</li>
<li>All calls to g.es and g.es_print in Leo's core follow this convention.</li>
<li>g.translateString does the actual translation using Python's <a class="reference" href="http://docs.python.org/lib/module-gettext.html">gettext</a> module.</li>
<li>You can use the script in the node &quot;&#64;button print g.es stats&quot; in scripts.leo
to create catalogs of all scripts that need to be translated. Such catalogs
are used by Python's gettext module. (This script was also used to check that
the proper arguments to g.es and g.es_print were translated.)</li>
</ul>
</div>
</div>
</body>
</html>
