<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4.1: http://docutils.sourceforge.net/" />
<title>Chapter 16: Debugging with Leo</title>
<style type="text/css">

/*ORIGINAL GOODGER + changes; up to line 224 it's standard reST stylesheet
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:date: $Date: 2006/10/19 13:23:15 $
:version: $Revision: 1.2 $
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
*/

/* EKR 10/19/06 */
/* some browsers require imported rules to precede all rulesets */
@import url(leo_rst.css);
@import url(silver_city.css);

.first {
  margin-top: 0 }

.last {
  margin-bottom: 0 }

a.toc-backref {
  text-decoration: none ;
  color: black }

dd {
  margin-bottom: 0.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.attention, div.caution, div.danger, div.error, div.hint,
div.important, div.note, div.tip, div.warning, div.admonition {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

div.hint p.admonition-title, div.important p.admonition-title,
div.note p.admonition-title, div.tip p.admonition-title,
div.admonition p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em }

div.footer, div.header {
  font-size: smaller }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 0em 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.line-block {
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;}
  /*background-color: #eeeeee }*/
  /*for some reason i can't overide in an import*/

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

table {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.citation {
  border-left: solid thin gray ;
  padding-left: 0.5ex }

table.docinfo {
  margin: 2em 4em }

table.footnote {
  border-left: solid thin black ;
  padding-left: 0.5ex }

td, th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

th.docinfo-name, th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap }

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
  font-size: 100% }

/*for some reason, the following isn't being overridden by the imports
at the end of this style sheet so I've commented it out*/
/*tt {
  background-color: #eeeeee }*/

ul.auto-toc {
  list-style-type: none }
  
hr { /* EKR */
  width: 100%;
  height: 1pt;
  color: gray;
}



</style>
</head>
<body>
<div class="document" id="chapter-16-debugging-with-leo">
<h1 class="title">Chapter 16: Debugging with Leo</h1>
<!-- rst3: filename: html\debuggers.html -->
<p>This chapter discusses debugging Python scripts with Leo.
Be aware of the distinction between <strong>Leo-specific</strong> scripts and <strong>general</strong> scripts.
Leo-specific scripts access data in the Leo outline in which they are contained;
general scripts do not.</p>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#using-g-trace-and-g-pdb" id="id1" name="id1">Using g.trace and g.pdb</a></li>
<li><a class="reference" href="#settings-for-winpdb" id="id2" name="id2">Settings for winpdb</a></li>
<li><a class="reference" href="#debugging-scripts-with-winpdb" id="id3" name="id3">Debugging scripts with winpdb</a><ul>
<li><a class="reference" href="#the-debug-command" id="id4" name="id4">The debug command</a></li>
<li><a class="reference" href="#button-winpdb" id="id5" name="id5">&#64;button winpdb</a></li>
<li><a class="reference" href="#the-execute-script-command-with-explicit-debugger-breaks" id="id6" name="id6">The execute-script command with explicit debugger breaks</a></li>
</ul>
</li>
</ul>
</div>
<!-- External links... -->
<div class="section">
<h1><a class="toc-backref" href="#id1" id="using-g-trace-and-g-pdb" name="using-g-trace-and-g-pdb">Using g.trace and g.pdb</a></h1>
<p>Inserting g.trace statements in my Python code is usually my first debugging
choice. The g.trace statement prints the name of the function in which the call
to g.trace occurs, followed by the value of its arguments. The output of the
g.trace goes to the console, so you must be <a class="reference" href="http://webpages.charter.net/edreamleo/FAQ.html#how-can-i-run-leo-from-a-console-window">running Leo in a console</a> to use
g.trace.</p>
<p>Inserting and deleting g.trace statements is fast, provided that your <a class="reference" href="http://webpages.charter.net/edreamleo/FAQ.html#how-can-i-use-leo-to-develop-leo-itself">work
flow</a> makes it easy to restart the program under test. As a result, using
g.trace statements is similar to setting tracepoints in a debugger, with the
advantage that (disabled) tracepoints remain in the source code for future use.
You will find many examples of using g.trace throughout Leo's source code.</p>
<p>My second choice is using g.pdb to set breakpoints for the <a class="reference" href="http://docs.python.org/lib/module-pdb.html">pdb</a> debugger. Pdb
uses the console for all interaction, so you must be <a class="reference" href="http://webpages.charter.net/edreamleo/FAQ.html#how-can-i-run-leo-from-a-console-window">running Leo in a
console</a>. See <a class="reference" href="http://webpages.charter.net/edreamleo/FAQ.html#how-can-i-use-python-s-pdb-debugger-with-leo">the FAQ</a> for a discussion of both g.trace and g.pdb.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id2" id="settings-for-winpdb" name="settings-for-winpdb">Settings for winpdb</a></h1>
<p>The following settings in leoSettings.leo control debugger operation.
The settings shown here will be assumed to be in effect throughout this chapter.</p>
<p><tt class="docutils literal"><span class="pre">&#64;string</span> <span class="pre">debugger_kind</span> <span class="pre">=</span> <span class="pre">winpdb</span></tt></p>
<p>This setting controls what debugger the 'Debug Script' script button uses.
Eventually this setting will control what debugger the debug command uses.
At present the only valid value is 'winpdb'</p>
<p><tt class="docutils literal"><span class="pre">&#64;bool</span> <span class="pre">write_script_file</span> <span class="pre">=</span> <span class="pre">True</span></tt></p>
<p>True: The execute script command writes the script to be executed to a file,
then executes the script using Python's execFile function. The script_file_path
setting specifies the path to this file. False (legacy): The execute script
command uses Python's exec command to execute the script.</p>
<p><tt class="docutils literal"><span class="pre">&#64;string</span> <span class="pre">script_file_path</span> <span class="pre">=</span> <span class="pre">../test/scriptFile.py</span></tt></p>
<p>The path to the file to be written by the execute-script command. Notes:</p>
<ul class="simple">
<li>This setting has effect only if the write_script_file setting is True.</li>
<li>Use <tt class="docutils literal"><span class="pre">/</span></tt> as the path delimiter, regardless of platform.</li>
<li>The default path is <tt class="docutils literal"><span class="pre">../test/scriptFile.py</span></tt> if no path is given.</li>
<li>The path starts at g.app.loadDir, so for example <tt class="docutils literal"><span class="pre">../test/scriptFile.py</span></tt> is equivalent to <tt class="docutils literal"><span class="pre">leo/test/scriptFile.py</span></tt>.</li>
<li>The filename should end in <tt class="docutils literal"><span class="pre">.py</span></tt>.</li>
</ul>
<p><tt class="docutils literal"><span class="pre">&#64;string</span> <span class="pre">debugger_path</span></tt> = None</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id3" id="debugging-scripts-with-winpdb" name="debugging-scripts-with-winpdb">Debugging scripts with winpdb</a></h1>
<p>The following three section discuss three ways of debugging scripts with <a class="reference" href="http://www.digitalpeers.com/pythondebugger/">winpdb</a>.
The first two sections tell how to debug general scripts;
the last section tells how to debug Leo-specific scripts.</p>
<p><a class="reference" href="http://www.digitalpeers.com/pythondebugger/">winpdb</a> and its documentation have been improved recently.
For more details, see the <a class="reference" href="http://www.digitalpeers.com/pythondebugger/embedded.htm">embedded winpdb</a> docs.
The discussion of embedded debugging may have been written specifically with Leo in mind.</p>
<div class="section">
<h2><a class="toc-backref" href="#id4" id="the-debug-command" name="the-debug-command">The debug command</a></h2>
<p>This way of debugging can only be used for general scripts, not leo-specific scripts.
The debug command writes the script to scriptFile.py and invokes winpdb.
winpdb opens and is already 'attached' to the script to be debugged.
You can single-step as you like.
Leo continues to run, but killing the debugger will also kill Leo.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id5" id="button-winpdb" name="button-winpdb">&#64;button winpdb</a></h2>
<p><tt class="docutils literal"><span class="pre">test.leo</span></tt> contains an <tt class="docutils literal"><span class="pre">&#64;button</span> <span class="pre">windpdb</span></tt> node.
Select the test to be debugged, then press the winpdb button or do <tt class="docutils literal"><span class="pre">&lt;Alt&gt;x</span> <span class="pre">winpdb&lt;return&gt;</span></tt>.
This way is essentially the same as using the debug command, though the code is slightly different.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id6" id="the-execute-script-command-with-explicit-debugger-breaks" name="the-execute-script-command-with-explicit-debugger-breaks">The execute-script command with explicit debugger breaks</a></h2>
<p>This way of debugging scripts allows winpdb to debug scripts that use c, g and p.
A bit more work is needed because winpdb does not start automatically.
Here are step-by step instructions:</p>
<ol class="arabic">
<li><p class="first">Insert the following two lines of code at the start of the script to be debugged:</p>
<pre class="literal-block">
import rpdb2
rpdb2.start_embedded_debugger('go',fAllowUnencrypted=True)
</pre>
</li>
<li><p class="first">Execute Leo's execute-script command (<em>not</em> the debug command).
Leo will appear to hang: start_embedded_debugger is waiting for <em>another</em> copy of winpdb to 'attach' to the script's process.
The default timeout is 5 minutes, after which an exception gets thrown.</p>
</li>
<li><p class="first">Start winpdb explicitly by executing something like the following in a console:</p>
<pre class="literal-block">
python /python25/Scripts/_winpdb.py -t
</pre>
<p>The -t option tells winpdb that no encoding of password is necessary.
The password is specified in the call to rpdb2.start_embedded_debugger in your script.
In our example, the password is 'go'.</p>
</li>
<li><p class="first">Use winpdb's <tt class="docutils literal"><span class="pre">File:Attach</span></tt> command to attach winpdb to Leo.
Specify the password as 'go' and you will see the scriptFile.py containing your entire script.
You can now execute or single-step through the script.
To repeat, c, g and p are defined, so you can debug any script this way.</p>
</li>
</ol>
</div>
</div>
</div>
</body>
</html>
