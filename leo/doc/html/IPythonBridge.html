<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Chapter 21: IPython and Leo</title>
<style type="text/css">

/*ORIGINAL GOODGER + changes; up to line 224 it's standard reST stylesheet
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:date: $Date: 2006/10/19 13:23:15 $
:version: $Revision: 1.2 $
:copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
*/

/* EKR 10/19/06 */
/* some browsers require imported rules to precede all rulesets */
@import url(leo_rst.css);
@import url(silver_city.css);

.first {
  margin-top: 0 }

.last {
  margin-bottom: 0 }

a.toc-backref {
  text-decoration: none ;
  color: black }

dd {
  margin-bottom: 0.5em }

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.attention, div.caution, div.danger, div.error, div.hint,
div.important, div.note, div.tip, div.warning, div.admonition {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

div.hint p.admonition-title, div.important p.admonition-title,
div.note p.admonition-title, div.tip p.admonition-title,
div.admonition p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em }

div.footer, div.header {
  font-size: smaller }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 0em 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.line-block {
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;}
  /*background-color: #eeeeee }*/
  /*for some reason i can't overide in an import*/

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.option-argument {
  font-style: italic }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

table {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.citation {
  border-left: solid thin gray ;
  padding-left: 0.5ex }

table.docinfo {
  margin: 2em 4em }

table.footnote {
  border-left: solid thin black ;
  padding-left: 0.5ex }

td, th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

th.docinfo-name, th.field-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap }

h1 tt, h2 tt, h3 tt, h4 tt, h5 tt, h6 tt {
  font-size: 100% }

/*for some reason, the following isn't being overridden by the imports
at the end of this style sheet so I've commented it out*/
/*tt {
  background-color: #eeeeee }*/

ul.auto-toc {
  list-style-type: none }
  
hr { /* EKR */
  width: 100%;
  height: 1pt;
  color: gray;
}



</style>
</head>
<body>
<div class="document">


<!-- rst3: filename: html\IPythonBridge.html -->
<!-- June, 2007 -->
<p><a class="reference" href="unitTesting.html"><img alt="back" src="arrow_lt.gif" /></a> <a class="reference" href="front.html"><img alt="leo" src="leo.gif" /></a> <a class="reference" href="appendices.html"><img alt="next" src="arrow_rt.gif" /></a></p>
<div class="section" id="chapter-21-ipython-and-leo">
<h1><a class="toc-backref" href="#id2">Chapter 21: IPython and Leo</a></h1>
<p>To use this plugin, you must run Leo from a console window. When this plugin is
enabled, Leo's start-ipython command starts <a class="reference" href="http://ipython.scipy.org/">IPython</a> in this console. Leo's
ipython plugin provides two-way communication (a bridge) between Leo and
IPython: you can run Leo scripts from IPython, and IPython scripts from Leo.</p>
<p>Remarkably, Leo and IPython run simultaneously in the same process,
yet their separate event loops do not interfere with each other.
Even more remarkably, scripts run from IPython <em>immediately</em> change Leo,
<em>exactly</em> as if the script were run from Leo.
Conversely, scripts run from Leo <em>immediately</em> affect the IPython interpreter.
Care may be needed when running such scripts while lengthy IPython scripts are running.
As the result of this truly remarkable connection between Leo and IPython,
Leo might plausibly be said to be an <a class="reference" href="http://projects.scipy.org/ipython/ipython/wiki/NoteBook">IPython Notebook</a>.</p>
<p>The bridge between Leo and IPython is powerful because it is simple. Indeed,</p>
<p>1. <strong>You can run any IPython script from Leo</strong>.
On the Leo side, as single variable:</p>
<pre class="literal-block">
ip = c.ipythonController.ip
</pre>
<p>assigns ip to IPython's _ip variable. The ip variable allows scripts running in
Leo to do <em>anything</em> that an IPython script can do.</p>
<p>2. <strong>You can run any Leo script from IPython</strong>.
The ipython plugin injects a single object, typically called leox,
into the IPython namespace. IPython scripts access Leo's c and g objects as
follows:</p>
<pre class="literal-block">
c,g = leox.c, leox.g
</pre>
<p>The c and g variables allow scripts running in IPython to do <em>anything</em> that a
Leo script can do.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference" href="#chapter-21-ipython-and-leo" id="id2" name="id2">Chapter 21: IPython and Leo</a><ul>
<li><a class="reference" href="#startup" id="id3" name="id3">Startup</a></li>
<li><a class="reference" href="#commands" id="id4" name="id4">Commands</a></li>
<li><a class="reference" href="#scripting-ipython-from-leo" id="id5" name="id5">Scripting IPython from Leo</a></li>
<li><a class="reference" href="#scripting-leo-from-ipython" id="id6" name="id6">Scripting Leo from IPython</a></li>
<li><a class="reference" href="#acknowledgements" id="id7" name="id7">Acknowledgements</a></li>
</ul>
</li>
</ul>
</div>
<!-- Links -->
<!-- WARNING: image targets may not have upper case letters! -->
<div class="section" id="startup">
<h2><a class="toc-backref" href="#id3">Startup</a></h2>
<p>This plugin creates an instance of the <strong>ipythonController</strong> class for each Leo
window. The ipythonController objects manage a singleton instance of IPython's
IPShellEmbed class. See <a class="reference" href="http://ipython.scipy.org/doc/manual/node9.html">http://ipython.scipy.org/doc/manual/node9.html</a>. Creating
this singleton instance starts IPython running in the console from which Leo was
run. As mentioned in the introduction, Leo and IPython appear to run
simultaneously. Their event loops do not interfere with each other.</p>
<p>The term <strong>startup time</strong> refers to the time that the singleton IPython instance is created.</p>
<p>Initializing Leo from IPython is easier than initializing IPython from Leo.
Indeed, the start-ipython command typically blocks and never returns, so it is not possible
to schedule a Leo script to be run after the start-ipython command returns.
Instead, it will typically be more convenient to use IPython's normal facilities to
schedule a script that initializes Leo when IPython starts.</p>
<p>The start-ipython command starts IPython running in the console and injects leox, a
<strong>Leo Interface Object</strong> into IPython's user namespace.
Using the leox object, IPython scripts can gain access to Leo's c and g variables:</p>
<pre class="literal-block">
c,g = leox.c,leox.g
</pre>
<p>Thus, IPython scripts can do <em>anything</em> that can be done in Leo.
See <a class="reference" href="#scripting-leo-from-ipython">Scripting Leo from IPython</a> for full details.</p>
<p>Conversely, Leo scripts can gain access to IPython's _ip variable:</p>
<pre class="literal-block">
ip = c.ipythonController.ip
</pre>
<p>Thus, Leo scripts can do <em>anything</em> that can be done in IPython.
See <a class="reference" href="#scripting-ipython-from-leo">Scripting IPython from Leo</a> for full details.</p>
</div>
<div class="section" id="commands">
<h2><a class="toc-backref" href="#id4">Commands</a></h2>
<p>This plugin creates the following Leo commands commands:</p>
<ul>
<li><p class="first">The start-ipython command starts the singleton IPython instance running in the
console and injects a Leo Interface Object into IPython's user namespace.
<strong>Run the start-ipython command before running the other commands</strong>.</p>
<p><strong>Important</strong>: The start-ipython command blocks. That is, the command does not
finish execution until IPython exits. In a typical workflow, IPython exits
after Leo does, so the the start-ipython command <em>never</em> completes.</p>
<p>Remarkably, this does not affect Leo's main loop: Leo itself does not block.
However, because the start-ipython command blocks, it is not possible for the
command to do any follow up initialization of IPython. In practice, this does
not matter, because IPython provides several ways of executing scripts on
startup. In short, it is often more convenient to initialize Leo from IPython
than to initialize IPython from Leo.</p>
</li>
<li><p class="first">The push-to-ipython command pushes data to IPython.
By default, it executes the body text of the presently
selected node in IPython.</p>
</li>
</ul>
</div>
<div class="section" id="scripting-ipython-from-leo">
<h2><a class="toc-backref" href="#id5">Scripting IPython from Leo</a></h2>
<p>Just as c and g provide full access to all aspects of Leo,
IPython's _ip var (and _ip.IP) provide full access of all of IPython's internals.
See <a class="reference" href="http://ipython.scipy.org/moin/IpythonExtensionApi">extensionAPI</a> for details.
The following script sets ip to IPython's _ip var:</p>
<pre class="literal-block">
ip = c.ipythonController.ip # set ip to IPython's _ip var.
</pre>
<p>With ip defined as above, IPython scripts <strong>running in Leo</strong>
can do anything that a script running in IPython can do.</p>
<p>Leo scripts can simulate this plugins's minibuffer commands as follows.</p>
<p>To simulate the start-ipython command:</p>
<pre class="literal-block">
x = c.ipythonController
if x and not x.started(): x.startIPython()
</pre>
<p>To simulate the push-to-ipython command:</p>
<pre class="literal-block">
x = c.ipythonController
if x and x.started(): x.pushToIPython()
</pre>
<p>To run a given script in IPython:</p>
<pre class="literal-block">
x = c.ipythonController
if x and x.started(): x.pushToIPython(script=script)
</pre>
</div>
<div class="section" id="scripting-leo-from-ipython">
<h2><a class="toc-backref" href="#id6">Scripting Leo from IPython</a></h2>
<p>The start-ipython command injects the leox object into IPython's
user namespace.
The c and g ivars of the leox object are
the leoGlobals module and
the commander of the Leo outline that created the IPython shell, respectively.
Thus scripts <strong>running in IPython</strong> can do <em>anything</em> a Leo script can do.
For, such scripts can insert and delete nodes in Leo outlines.
The changes will become visible as soon as the script (running in IPython)
redraws the screen.</p>
<p>See <a class="reference" href="scripting.html">Chapter 7: Scripting Leo with Python</a> for full details about how to script
Leo.  The following are merely examples about what can be done from IPython.
All these examples have been tested.</p>
<ol class="arabic">
<li><p class="first">g.app.windowList is a list of all open Leo frames, so an IPython script can
get a list of all commanders as follows:</p>
<pre class="literal-block">
c,g = leox.c, leox.g
commanders = [f.c for f in g.app.windowList]
</pre>
</li>
<li><p class="first">IPython scripts can use the c.config object to get Leo settings.
Suppose the body text of an &#64;data
ipython-bridge-startup-script setting contains a script to be executed when
ipython starts up. An Ipython script can get that startup script as follows:</p>
<pre class="literal-block">
c = leox.c
startupScript = c.config.getData('ipython-bridge-startup-script')
</pre>
</li>
<li><p class="first">Suppose the body text of an &#64;data ipython-bridge-auto-open setting contains a
list of .leo files to be automatically opened on startup. The following
IPython script opens those files:</p>
<pre class="literal-block">
c,g = leox.c, leox.g
files = c.config.getData('ipython-bridge-auto-open-leo-files')
    # getData strips lines starting with '#'.
for z in files:
    fileName = g.os_path_abspath(g.os_path_join(g.app.loadDir,z))
    g.openWithFileName(fileName, old_c=c)
</pre>
</li>
</ol>
</div>
<div class="section" id="acknowledgements">
<h2><a class="toc-backref" href="#id7">Acknowledgements</a></h2>
<p>This plugin would not have been possible without the help of Ville M. Vainio.
<a class="reference" href="http://sourceforge.net/forum/forum.php?thread_id=1911662&amp;forum_id=10226">Discussions</a> on SourceForge show how the goal of close cooperation between Leo and IPython went from
vague dream to completed reality over the span of about 10 days.</p>
<hr class="docutils" />
<p><a class="reference" href="unitTesting.html"><img alt="back" src="arrow_lt.gif" /></a> <a class="reference" href="front.html"><img alt="leo" src="leo.gif" /></a> <a class="reference" href="appendices.html"><img alt="next" src="arrow_rt.gif" /></a></p>
</div>
</div>
</div>
</body>
</html>
