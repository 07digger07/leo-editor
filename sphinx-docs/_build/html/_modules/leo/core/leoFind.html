<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>leo.core.leoFind &mdash; Leo API 4.11dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.11dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Leo API 4.11dev documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for leo.core.leoFind</h1><div class="highlight"><pre>
<span class="c">#@+leo-ver=5-thin</span>
<span class="c">#@+node:ekr.20060123151617: * @file leoFind.py</span>
<span class="sd">&#39;&#39;&#39;Leo&#39;s gui-independent find classes.&#39;&#39;&#39;</span>

<span class="c">#@@language python</span>
<span class="c">#@@tabwidth -4</span>
<span class="c">#@@pagewidth 70</span>

<span class="kn">import</span> <span class="nn">leo.core.leoGlobals</span> <span class="kn">as</span> <span class="nn">g</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c">#@+&lt;&lt; Theory of operation of find/change &gt;&gt;</span>
<span class="c">#@+node:ekr.20031218072017.2414: ** &lt;&lt; Theory of operation of find/change &gt;&gt;</span>
<span class="c">#@@nocolor-node</span>
<span class="c">#@+at</span>
<span class="c"># The find and change commands are tricky; there are many details that must be</span>
<span class="c"># handled properly. This documentation describes the leo.py code. Previous</span>
<span class="c"># versions of Leo used an inferior scheme. The following principles govern the</span>
<span class="c"># leoFind class:</span>
<span class="c"># </span>
<span class="c"># 1. Find and Change commands initialize themselves using only the state of the</span>
<span class="c">#    present Leo window. In particular, the Find class must not save internal</span>
<span class="c">#    state information from one invocation to the next. This means that when the</span>
<span class="c">#    user changes the nodes, or selects new text in headline or body text, those</span>
<span class="c">#    changes will affect the next invocation of any Find or Change command.</span>
<span class="c">#    Failure to follow this principle caused all kinds of problems in the Borland</span>
<span class="c">#    and Macintosh codes. There is one exception to this rule: we must remember</span>
<span class="c">#    where interactive wrapped searches start. This principle simplifies the code</span>
<span class="c">#    because most ivars do not persist. However, each command must ensure that the</span>
<span class="c">#    Leo window is left in a state suitable for restarting the incremental</span>
<span class="c">#    (interactive) Find and Change commands. Details of initialization are</span>
<span class="c">#    discussed below.</span>
<span class="c"># </span>
<span class="c"># 2. The Find and Change commands must not change the state of the outline or body</span>
<span class="c">#    pane during execution. That would cause severe flashing and slow down the</span>
<span class="c">#    commands a great deal. In particular, c.selectVnode and c.editPosition</span>
<span class="c">#    methods must not be called while looking for matches.</span>
<span class="c"># </span>
<span class="c"># 3. When incremental Find or Change commands succeed they must leave the Leo</span>
<span class="c">#    window in the proper state to execute another incremental command. We restore</span>
<span class="c">#    the Leo window as it was on entry whenever an incremental search fails and</span>
<span class="c">#    after any Find All and Change All command.</span>
<span class="c"># </span>
<span class="c"># Initialization involves setting the c, p, in_headline, wrapping and s_ctrl</span>
<span class="c"># ivars. Setting in_headline is tricky; we must be sure to retain the state of the</span>
<span class="c"># outline pane until initialization is complete. Initializing the Find All and</span>
<span class="c"># Change All commands is much easier because such initialization does not depend</span>
<span class="c"># on the state of the Leo window.</span>
<span class="c"># </span>
<span class="c"># Using Tk.Text widgets for both headlines and body text results in a huge</span>
<span class="c"># simplification of the code. Indeed, the searching code does not know whether it</span>
<span class="c"># is searching headline or body text. The search code knows only that s_ctrl is a</span>
<span class="c"># Tk.Text widget that contains the text to be searched or changed and the insert</span>
<span class="c"># and sel Tk attributes of self.search_text indicate the range of text to be</span>
<span class="c"># searched. Searching headline and body text simultaneously is complicated. The</span>
<span class="c"># selectNextPosition() method handles the many details involved by setting s_ctrl</span>
<span class="c"># and its insert and sel attributes.</span>
<span class="c">#@-&lt;&lt; Theory of operation of find/change &gt;&gt;</span>

<span class="c">#@+others</span>
<span class="c">#@+node:ekr.20070105092022.1: ** class searchWidget</span>
<div class="viewcode-block" id="searchWidget"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget">[docs]</a><span class="k">class</span> <span class="nc">searchWidget</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;A class to simulating a hidden Tk Text widget.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;searchWidget id: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20070105092438: *3* ctor (searchWidget)</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="c"># g.trace (&#39;searchWidget&#39;,g.callers())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>    <span class="c"># The widget text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>     <span class="c"># The insert point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span> <span class="c"># The selection range</span>
    <span class="c">#@+node:ekr.20070105093138: *3* getters</span>
<div class="viewcode-block" id="searchWidget.getAllText"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.getAllText">[docs]</a>    <span class="k">def</span> <span class="nf">getAllText</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span></div>
<div class="viewcode-block" id="searchWidget.getInsertPoint"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.getInsertPoint">[docs]</a>    <span class="k">def</span> <span class="nf">getInsertPoint</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span>       <span class="c"># Returns Python index.</span></div>
<div class="viewcode-block" id="searchWidget.getSelectionRange"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.getSelectionRange">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectionRange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span>     <span class="c"># Returns Python indices.</span>

    <span class="c">#@+node:ekr.20070105102419: *3* setters (leoFind)</span></div>
<div class="viewcode-block" id="searchWidget.delete"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">:]</span>
        <span class="c"># Bug fix: 2011/11/13: Significant in external tests.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span><span class="n">i</span>
</div>
<div class="viewcode-block" id="searchWidget.insert"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span><span class="n">i</span>
</div>
<div class="viewcode-block" id="searchWidget.setAllText"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.setAllText">[docs]</a>    <span class="k">def</span> <span class="nf">setAllText</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
</div>
<div class="viewcode-block" id="searchWidget.setInsertPoint"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.setInsertPoint">[docs]</a>    <span class="k">def</span> <span class="nf">setInsertPoint</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span>
</div>
<div class="viewcode-block" id="searchWidget.setSelectionRange"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.setSelectionRange">[docs]</a>    <span class="k">def</span> <span class="nf">setSelectionRange</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">insert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20070105092022.4: *3* toPythonIndex (leoFind)</span></div>
<div class="viewcode-block" id="searchWidget.toPythonIndex"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.searchWidget.toPythonIndex">[docs]</a>    <span class="k">def</span> <span class="nf">toPythonIndex</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20061212084717: ** class leoFind</span></div></div>
<div class="viewcode-block" id="leoFind"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind">[docs]</a><span class="k">class</span> <span class="nc">leoFind</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;The base class for Leo&#39;s Find commands.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20031218072017.3053: *3* leoFind.__init__ &amp; helpers</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># g.trace(&#39;leoFind&#39;,c)</span>

        <span class="c"># Spell checkers use this class, so we can&#39;t always compute a title.</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; compute self.title &gt;&gt;</span>
            <span class="c">#@+node:ekr.20041121145452: *4* &lt;&lt; compute self.title &gt;&gt;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;untitled&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_split</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Find/Change for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>  <span class="n">s</span>
            <span class="c">#@-&lt;&lt; compute self.title &gt;&gt;</span>

        <span class="c">#@+&lt;&lt; init the gui-independent ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20031218072017.3054: *4* &lt;&lt; init the gui-independent ivars &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backwardAttempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_text</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_text</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unstick</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">re_obj</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c">#@+at</span>
        <span class="c"># New in 4.3:</span>
        <span class="c"># - These are the names of leoFind ivars. (no more _flag hack).</span>
        <span class="c"># - There are no corresponding commander ivars to keep in synch (hurray!)</span>
        <span class="c"># - These ivars are inited (in the subclass by init) when this class is created.</span>
        <span class="c"># - These ivars are updated by update_ivars just before doing any find.</span>
        <span class="c">#@@c</span>

        <span class="c">#@+&lt;&lt; do dummy initialization to keep Pychecker happy &gt;&gt;</span>
        <span class="c">#@+node:ekr.20050123164539: *5* &lt;&lt; do dummy initialization to keep Pychecker happy &gt;&gt;</span>
        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ignore_case</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_only</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pattern_match</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_body</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_changes</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_finds</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">script_change</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">whole_word</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#@-&lt;&lt; do dummy initialization to keep Pychecker happy &gt;&gt;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;batch&quot;</span><span class="p">,</span><span class="s">&quot;ignore_case&quot;</span><span class="p">,</span> <span class="s">&quot;node_only&quot;</span><span class="p">,</span>
            <span class="s">&quot;pattern_match&quot;</span><span class="p">,</span> <span class="s">&quot;search_headline&quot;</span><span class="p">,</span> <span class="s">&quot;search_body&quot;</span><span class="p">,</span>
            <span class="s">&quot;suboutline_only&quot;</span><span class="p">,</span> <span class="s">&quot;mark_changes&quot;</span><span class="p">,</span> <span class="s">&quot;mark_finds&quot;</span><span class="p">,</span> <span class="s">&quot;reverse&quot;</span><span class="p">,</span>
            <span class="s">&quot;script_search&quot;</span><span class="p">,</span><span class="s">&quot;script_change&quot;</span><span class="p">,</span><span class="s">&quot;selection_only&quot;</span><span class="p">,</span>
            <span class="s">&quot;wrap&quot;</span><span class="p">,</span> <span class="s">&quot;whole_word&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newStringKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;radio-find-type&quot;</span><span class="p">,</span> <span class="s">&quot;radio-search-scope&quot;</span><span class="p">]</span>

        <span class="c"># Ivars containing internal state...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The commander for this search.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all_flattened</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The position being searched.  Never saved between searches!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True: searching headline text.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_ctrl</span> <span class="o">=</span> <span class="n">searchWidget</span><span class="p">()</span> <span class="c"># The search text for this search.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True: wrapping is enabled.</span>
            <span class="c"># This is _not_ the same as self.wrap for batch searches.</span>

        <span class="c">#@+at</span>
        <span class="c"># Initializing a wrapped search is tricky. The search() method will fail</span>
        <span class="c"># if p==wrapPosition and pos &gt;= wrapPos. selectNextPosition() will fail</span>
        <span class="c"># if p == wrapPosition. We set wrapPos on entry, before the first</span>
        <span class="c"># search. We set wrapPosition in selectNextPosition after the first</span>
        <span class="c"># search fails. We also set wrapPosition on exit if the first search</span>
        <span class="c"># suceeds.</span>
        <span class="c"># </span>
        <span class="c"># 2011/06/13: wrapPosition must be reset when the find pattern changes.</span>
        <span class="c">#@@c</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The start of wrapped searches: persists between calls.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The starting node for suboutline-only searches.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapPos</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The starting position of the wrapped search: persists between calls.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#@-&lt;&lt; init the gui-independent ivars &gt;&gt;</span>

<div class="viewcode-block" id="leoFind.init"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20060123065756.1: *3* Top Level Buttons</span>
    <span class="c">#@+node:ekr.20031218072017.3057: *4* changeAllButton</span>
    <span class="c"># The user has pushed the &quot;Change All&quot; button from the find panel.</span>
</div>
<div class="viewcode-block" id="leoFind.changeAllButton"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeAllButton">[docs]</a>    <span class="k">def</span> <span class="nf">changeAllButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_button</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">clearAllVisited</span><span class="p">()</span> <span class="c"># Clear visited for context reporting.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_change</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doChangeAllScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeAll</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3056: *4* changeButton</span>
    <span class="c"># The user has pushed the &quot;Change&quot; button from the find panel.</span>
</div>
<div class="viewcode-block" id="leoFind.changeButton"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeButton">[docs]</a>    <span class="k">def</span> <span class="nf">changeButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_button</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_change</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doChangeScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3058: *4* changeThenFindButton</span>
    <span class="c"># The user has pushed the &quot;Change Then Find&quot; button from the find panel.</span>
</div>
<div class="viewcode-block" id="leoFind.changeThenFindButton"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeThenFindButton">[docs]</a>    <span class="k">def</span> <span class="nf">changeThenFindButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_button</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_change</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doChangeScript</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doFindScript</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">change</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doFindScript</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">changeThenFind</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3060: *4* findAllButton</span>
    <span class="c"># The user has pushed the &quot;Find All&quot; button from the find panel.</span>
</div>
<div class="viewcode-block" id="leoFind.findAllButton"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findAllButton">[docs]</a>    <span class="k">def</span> <span class="nf">findAllButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_button</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">clearAllVisited</span><span class="p">()</span> <span class="c"># Clear visited for context reporting.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doFindAllScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3059: *4* findButton</span>
    <span class="c"># The user has pushed the &quot;Find&quot; button from the find panel.</span>
</div>
<div class="viewcode-block" id="leoFind.findButton"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findButton">[docs]</a>    <span class="k">def</span> <span class="nf">findButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_button</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doFindScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3065: *4* setup_button</span>
    <span class="c"># Initializes a search when a button is pressed in the Find panel.</span>
</div>
<div class="viewcode-block" id="leoFind.setup_button"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.setup_button">[docs]</a>    <span class="k">def</span> <span class="nf">setup_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">p</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bringToFront</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># We _must_ retain the editing status for incremental searches!</span>
            <span class="n">c</span><span class="o">.</span><span class="n">endEditing</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_ivars</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3055: *3* Top Level Commands</span>
    <span class="c">#@+node:ekr.20031218072017.3061: *4* changeCommand</span>
    <span class="c"># The user has selected the &quot;Replace&quot; menu item.</span>
</div>
<div class="viewcode-block" id="leoFind.changeCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeCommand">[docs]</a>    <span class="k">def</span> <span class="nf">changeCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doChangeScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3062: *4* changeThenFindCommand</span>
    <span class="c"># The user has pushed the &quot;Change Then Find&quot; button from the Find menu.</span>
</div>
<div class="viewcode-block" id="leoFind.changeThenFindCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeThenFindCommand">[docs]</a>    <span class="k">def</span> <span class="nf">changeThenFindCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doChangeScript</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doFindScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeThenFind</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20051013084200.1: *4* dismiss: defined in subclass class</span></div>
<div class="viewcode-block" id="leoFind.dismiss"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.dismiss">[docs]</a>    <span class="k">def</span> <span class="nf">dismiss</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="c">#@+node:ekr.20031218072017.3063: *4* findNextCommand</span>
    <span class="c"># The user has selected the &quot;Find Next&quot; menu item.</span>
</div>
<div class="viewcode-block" id="leoFind.findNextCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findNextCommand">[docs]</a>    <span class="k">def</span> <span class="nf">findNextCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doFindScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3064: *4* findPreviousCommand</span>
    <span class="c"># The user has selected the &quot;Find Previous&quot; menu item.</span>
</div>
<div class="viewcode-block" id="leoFind.findPreviousCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findPreviousCommand">[docs]</a>    <span class="k">def</span> <span class="nf">findPreviousCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_search</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doFindScript</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span>
    <span class="c">#@+node:EKR.20040503070514: *4* handleUserClick</span></div>
<div class="viewcode-block" id="leoFind.handleUserClick"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.handleUserClick">[docs]</a>    <span class="k">def</span> <span class="nf">handleUserClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Reset suboutline-only search when the user clicks a headline.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span><span class="p">:</span>
                <span class="c"># g.trace(p)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="c">#@+node:ekr.20031218072017.3066: *4* setup_command</span>
    <span class="c"># Initializes a search when a command is invoked from the menu.</span>
</div>
<div class="viewcode-block" id="leoFind.setup_command"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.setup_command">[docs]</a>    <span class="k">def</span> <span class="nf">setup_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;leoFind&#39;)</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># We _must_ retain the editing status for incremental searches!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">endEditing</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_ivars</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3067: *3* Find/change utils</span>
    <span class="c">#@+node:ekr.20031218072017.2293: *4* batchChange (leoFind) (sets start of change-all group)</span>
    <span class="c">#@+at This routine performs a single batch change operation, updating the</span>
    <span class="c"># head or body string of p and leaving the result in s_ctrl. We update</span>
    <span class="c"># the body if we are changing the body text of c.currentVnode().</span>
    <span class="c"># </span>
    <span class="c"># s_ctrl contains the found text on entry and contains the changed text</span>
    <span class="c"># on exit. pos and pos2 indicate the selection. The selection will never</span>
    <span class="c"># be empty. NB: we can not assume that self.p is visible.</span>
    <span class="c">#@@c</span>
</div>
<div class="viewcode-block" id="leoFind.batchChange"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.batchChange">[docs]</a>    <span class="k">def</span> <span class="nf">batchChange</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">undoer</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_ctrl</span>
        <span class="c"># Replace the selection with self.change_text</span>
        <span class="k">if</span> <span class="n">pos1</span> <span class="o">&gt;</span> <span class="n">pos2</span><span class="p">:</span> <span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span><span class="o">=</span><span class="n">pos2</span><span class="p">,</span><span class="n">pos1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pos1</span> <span class="o">!=</span> <span class="n">pos2</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">change_text</span><span class="p">)</span>
        <span class="c"># Update the selection.</span>
        <span class="n">insert</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="n">pos1</span><span class="p">,</span><span class="n">pos1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_text</span><span class="p">))</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="n">insert</span><span class="p">,</span><span class="n">insert</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
        <span class="c"># Update the node</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span> <span class="c"># Used below.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; change headline &gt;&gt;</span>
            <span class="c">#@+node:ekr.20031218072017.2294: *5* &lt;&lt; change headline &gt;&gt;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>

                <span class="n">undoData</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">beforeChangeNodeContents</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

                <span class="n">p</span><span class="o">.</span><span class="n">initHeadString</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mark_changes</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">setMarked</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">setDirty</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isChanged</span><span class="p">():</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">setChanged</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

                <span class="n">u</span><span class="o">.</span><span class="n">afterChangeNodeContents</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Change Headline&#39;</span><span class="p">,</span><span class="n">undoData</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; change headline &gt;&gt;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; change body &gt;&gt;</span>
            <span class="c">#@+node:ekr.20031218072017.2295: *5* &lt;&lt; change body &gt;&gt;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="p">:</span>

                <span class="n">undoData</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">beforeChangeNodeContents</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

                <span class="n">c</span><span class="o">.</span><span class="n">setBodyString</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mark_changes</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">setMarked</span><span class="p">()</span>
                <span class="n">p</span><span class="o">.</span><span class="n">setDirty</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isChanged</span><span class="p">():</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">setChanged</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

                <span class="n">u</span><span class="o">.</span><span class="n">afterChangeNodeContents</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Change Body&#39;</span><span class="p">,</span><span class="n">undoData</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; change body &gt;&gt;</span>
    <span class="c">#@+node:ekr.20031218072017.3068: *4* change (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.change"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.change">[docs]</a>    <span class="k">def</span> <span class="nf">change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkArgs</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initInHeadline</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">changeSelection</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3069: *4* changeAll (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.changeAll"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeAll">[docs]</a>    <span class="k">def</span> <span class="nf">changeAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;leoFind&#39;,g.callers())</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">undoer</span> <span class="p">;</span> <span class="n">undoType</span> <span class="o">=</span> <span class="s">&#39;Change All&#39;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">p</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkArgs</span><span class="p">():</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initInHeadline</span><span class="p">()</span>
        <span class="n">saveData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initBatchCommands</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">u</span><span class="o">.</span><span class="n">beforeChangeGroup</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="n">undoType</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findNextMatch</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pos1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batchChange</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span><span class="n">pos2</span><span class="p">)</span>
            <span class="c"># if 0:</span>
                <span class="c"># w = self.s_ctrl</span>
                <span class="c"># s = w.getAllText()</span>
                <span class="c"># i,j = g.getLine(s,pos1)</span>
                <span class="c"># line = s[i:j]</span>
                <span class="c"># self.printLine(line,allFlag=True)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">p</span>
        <span class="n">u</span><span class="o">.</span><span class="n">afterChangeGroup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">undoType</span><span class="p">,</span><span class="n">reportFlag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;changed:&quot;</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="s">&quot;instances&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">saveData</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3070: *4* changeSelection (leoFind)</span>
    <span class="c"># Replace selection with self.change_text.</span>
    <span class="c"># If no selection, insert self.change_text at the cursor.</span>
</div>
<div class="viewcode-block" id="leoFind.changeSelection"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeSelection">[docs]</a>    <span class="k">def</span> <span class="nf">changeSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">bodyCtrl</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">bodyCtrl</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">bodyCtrl</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">oldSel</span> <span class="o">=</span> <span class="n">sel</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>
        <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">sel</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">,</span><span class="n">start</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;no text selected&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="bp">False</span>

        <span class="c"># g.trace(start,end)</span>

        <span class="c"># Replace the selection in _both_ controls.</span>
        <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">oldSel</span>
        <span class="n">change_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_text</span>

        <span class="c"># Perform regex substitutions of \1, \2, ...\9 in the change text.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_match</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_obj</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_obj</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">change_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeRegexSubs</span><span class="p">(</span><span class="n">change_text</span><span class="p">,</span><span class="n">groups</span><span class="p">)</span>
        <span class="c"># change_text = change_text.replace(&#39;\\n&#39;,&#39;\n&#39;).replace(&#39;\\t&#39;,&#39;\t&#39;)</span>
        <span class="n">change_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceBackSlashes</span><span class="p">(</span><span class="n">change_text</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">w2</span> <span class="ow">in</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s_ctrl</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="n">end</span><span class="p">:</span> <span class="n">w2</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
            <span class="n">w2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">change_text</span><span class="p">)</span>
            <span class="n">w2</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">start</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">change_text</span><span class="p">)))</span>

        <span class="c"># Update the selection for the next match.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">start</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">change_text</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="c"># No redraws here: they would destroy the headline selection.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mark_changes</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">setMarked</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">onHeadChanged</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;Change&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">onBodyChanged</span><span class="p">(</span><span class="s">&#39;Change&#39;</span><span class="p">,</span><span class="n">oldSel</span><span class="o">=</span><span class="n">oldSel</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">drawIcon</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># redraw only the icon.</span>

        <span class="k">return</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20060526201951: *5* makeRegexSubs</span></div>
<div class="viewcode-block" id="leoFind.makeRegexSubs"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.makeRegexSubs">[docs]</a>    <span class="k">def</span> <span class="nf">makeRegexSubs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">groups</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Carefully substitute group[i-1] for \i strings in s.</span>
<span class="sd">        The group strings may contain \i strings: they are *not* substituted.&#39;&#39;&#39;</span>

        <span class="n">digits</span> <span class="o">=</span> <span class="s">&#39;123456789&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># s[i:j] is the text between \i markers.</span>
        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">digits</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">k</span><span class="p">])</span> <span class="c"># Append up to \i</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">gn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">gn</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">groups</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span> <span class="c"># Append groups[i-1]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ch</span><span class="p">)</span> <span class="c"># Append raw &#39;\i&#39;</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3071: *4* changeThenFind (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.changeThenFind"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.changeThenFind">[docs]</a>    <span class="k">def</span> <span class="nf">changeThenFind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkArgs</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initInHeadline</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeSelection</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> <span class="c"># don&#39;t reinitialize</span>
    <span class="c">#@+node:ekr.20031218072017.2417: *4* doChange...Scrip (leoFind)t</span></div>
<div class="viewcode-block" id="leoFind.doChangeScript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.doChangeScript">[docs]</a>    <span class="k">def</span> <span class="nf">doChangeScript</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;change&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runChangeScript</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoFind.doChangeAllScript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.doChangeAllScript">[docs]</a>    <span class="k">def</span> <span class="nf">doChangeAllScript</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;The user has just pressed the Change All button with script-change box checked.</span>

<span class="sd">        N.B. Only this code is executed.&quot;&quot;&quot;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;changeAll&quot;</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runChangeScript</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;continue&quot;</span><span class="p">):</span>
                <span class="k">break</span>
</div>
<div class="viewcode-block" id="leoFind.runChangeScript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.runChangeScript">[docs]</a>    <span class="k">def</span> <span class="nf">runChangeScript</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_change</span><span class="p">)</span>
            <span class="k">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_text</span><span class="p">,{},{})</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception executing change script&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="p">[</span><span class="s">&quot;continue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># 2/1/04</span>
    <span class="c">#@+node:ekr.20031218072017.3072: *4* doFind...Script (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.doFindScript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.doFindScript">[docs]</a>    <span class="k">def</span> <span class="nf">doFindScript</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;find&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runFindScript</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoFind.doFindAllScript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.doFindAllScript">[docs]</a>    <span class="k">def</span> <span class="nf">doFindAllScript</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;The user has just pressed the Find All button with script-find radio button checked.</span>

<span class="sd">        N.B. Only this code is executed.&quot;&quot;&quot;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;findAll&quot;</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">runFindScript</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;continue&quot;</span><span class="p">):</span>
                <span class="k">break</span>
</div>
<div class="viewcode-block" id="leoFind.runFindScript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.runFindScript">[docs]</a>    <span class="k">def</span> <span class="nf">runFindScript</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">,{},{})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception executing find script&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">searchDict</span><span class="p">[</span><span class="s">&quot;continue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># 2/1/04</span>
    <span class="c">#@+node:ekr.20031218072017.3073: *4* findAll &amp; helper (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.findAll"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findAll">[docs]</a>    <span class="k">def</span> <span class="nf">findAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_ctrl</span> <span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">undoer</span>
        <span class="n">undoType</span> <span class="o">=</span> <span class="s">&#39;Clone Find All Flattened&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all_flattened</span> <span class="k">else</span> <span class="s">&#39;Clone Find All&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkArgs</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initInHeadline</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Restore will select the root position.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initBatchCommands</span><span class="p">()</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Nodes that should be skipped.</span>
            <span class="c"># Keys are vnodes, values not important.</span>
        <span class="n">count</span><span class="p">,</span><span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="bp">None</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all_flattened</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findNextMatch</span><span class="p">()</span> <span class="c"># sets self.p.</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">v</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
            <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getLine</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                    <span class="n">undoData</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">beforeInsertNode</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createCloneFindAllNode</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all_flattened</span><span class="p">:</span>
                    <span class="n">skip</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Don&#39;t look at the node or it&#39;s descendants.</span>
                    <span class="k">for</span> <span class="n">p2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">self_and_subtree</span><span class="p">():</span>
                        <span class="n">skip</span><span class="p">[</span><span class="n">p2</span><span class="o">.</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="c"># Create a clone of self.p under the find node.</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
                <span class="n">p2</span><span class="o">.</span><span class="n">moveToLastChildOf</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">allFlag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="ow">and</span> <span class="n">skip</span><span class="p">:</span>
            <span class="n">u</span><span class="o">.</span><span class="n">afterInsertNode</span><span class="p">(</span><span class="n">found</span><span class="p">,</span><span class="n">undoType</span><span class="p">,</span><span class="n">undoData</span><span class="p">,</span><span class="n">dirtyVnodeList</span><span class="o">=</span><span class="p">[])</span>
            <span class="n">c</span><span class="o">.</span><span class="n">selectPosition</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setChanged</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;found&quot;</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="s">&quot;matches&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20051113110735: *5* createCloneFindAllNode</span></div>
<div class="viewcode-block" id="leoFind.createCloneFindAllNode"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.createCloneFindAllNode">[docs]</a>    <span class="k">def</span> <span class="nf">createCloneFindAllNode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">oldRoot</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">oldRoot</span><span class="o">.</span><span class="n">insertAfter</span><span class="p">()</span>
        <span class="n">found</span><span class="o">.</span><span class="n">moveToRoot</span><span class="p">(</span><span class="n">oldRoot</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">setHeadString</span><span class="p">(</span><span class="n">found</span><span class="p">,</span><span class="s">&#39;Found: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>
    <span class="c">#@+node:ekr.20031218072017.3074: *4* findNext (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.findNext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findNext">[docs]</a>    <span class="k">def</span> <span class="nf">findNext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">initFlag</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="c"># c = self.c</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkArgs</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">initFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initInHeadline</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initInteractiveCommands</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">pos</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findNextMatch</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;end of wrapped search&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;not found&quot;</span><span class="p">,</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showSuccess</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3075: *4* findNextMatch (leoFind)</span>
    <span class="c"># Resumes the search where it left off.</span>
    <span class="c"># The caller must call set_first_incremental_search or set_first_batch_search.</span>
</div>
<div class="viewcode-block" id="leoFind.findNextMatch"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.findNextMatch">[docs]</a>    <span class="k">def</span> <span class="nf">findNextMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;entry&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
            <span class="s">&#39;search_headline&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span><span class="p">,</span>
            <span class="s">&#39;search_body&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">search_body</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_body</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;nothing to search&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no find text&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backwardAttempts</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># New in Leo 4.4.8: precompute the regexp for regexHelper.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern_match</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="c"># Precompile the regexp.</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_case</span><span class="p">:</span> <span class="n">flags</span> <span class="o">|=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span>
                <span class="c"># New in Leo 4.5: escape the search text.</span>
                <span class="n">b</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">b&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">whole_word</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="p">):</span> <span class="n">s</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">s</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">b</span><span class="p">):</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">b</span>
                <span class="c"># g.trace(self.whole_word,repr(s))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">re_obj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">flags</span><span class="p">)</span>
                <span class="c"># self.re_obj = re.compile(re.escape(self.find_text),flags)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;invalid regular expression:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># Abort the search.</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

        <span class="k">while</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;attempt&#39;</span><span class="p">,</span><span class="s">&#39;pos&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="s">&#39;in_headline&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mark_finds</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">setMarked</span><span class="p">()</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">drawIcon</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># redraw only the icon.</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;success&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">pos</span><span class="p">,</span> <span class="n">newpos</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;find errors&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c"># Abort the search.</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_only</span><span class="p">:</span>
                <span class="c"># Bug fix: 2009-5-31.</span>
                <span class="c"># Attempt to switch from headline to body.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">initNextText</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;fail: node only&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c"># We are only searching one node.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;failed attempt&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
                <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectNextPosition</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;attempts&#39;</span><span class="p">,</span><span class="n">attempts</span><span class="p">,</span><span class="s">&#39;backwardAttempts&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">backwardAttempts</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20031218072017.3076: *4* resetWrap (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.resetWrap"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.resetWrap">[docs]</a>    <span class="k">def</span> <span class="nf">resetWrap</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20031218072017.3077: *4* search &amp; helpers (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.search"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.search">[docs]</a>    <span class="k">def</span> <span class="nf">search</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Search s_ctrl for self.find_text under the control of the</span>
<span class="sd">        whole_word, ignore_case, and pattern_match ivars.</span>

<span class="sd">        Returns (pos, newpos) or (None,None).&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="c"># c = self.c</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_ctrl</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getInsertPoint</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span><span class="o">+</span><span class="mi">20</span><span class="p">]))</span>
        <span class="n">stopindex</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="c"># &#39;end&#39; doesn&#39;t work here.</span>
        <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">searchHelper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">stopindex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">,</span>
            <span class="n">backwards</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="n">nocase</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_case</span><span class="p">,</span>
            <span class="n">regexp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern_match</span><span class="p">,</span><span class="n">word</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">whole_word</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;pos,newpos&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;** pos is -1&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
        <span class="c">#@+&lt;&lt; fail if we are passed the wrap point &gt;&gt;</span>
        <span class="c">#@+node:ekr.20060526140328: *5* &lt;&lt; fail if we are passed the wrap point &gt;&gt;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;** reverse wrap done&quot;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="ow">and</span> <span class="n">newpos</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;** wrap done&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="c">#@-&lt;&lt; fail if we are passed the wrap point &gt;&gt;</span>
        <span class="n">insert</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">))</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="n">insert</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;** returns&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span>
    <span class="c">#@+node:ekr.20060526081931: *5* searchHelper &amp; allies</span></div>
<div class="viewcode-block" id="leoFind.searchHelper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.searchHelper">[docs]</a>    <span class="k">def</span> <span class="nf">searchHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">backwards</span><span class="p">,</span><span class="n">nocase</span><span class="p">,</span><span class="n">regexp</span><span class="p">,</span><span class="n">word</span><span class="p">,</span><span class="n">swapij</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span>

        <span class="k">if</span> <span class="n">swapij</span> <span class="ow">and</span> <span class="n">backwards</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;back,nocase,regexp,word,&#39;</span><span class="p">,</span>
            <span class="n">backwards</span><span class="p">,</span><span class="n">nocase</span><span class="p">,</span><span class="n">regexp</span><span class="p">,</span><span class="n">word</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">20</span><span class="p">]))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;empty&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s">&#39;len(s)&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s">&#39;pattern&#39;</span><span class="p">,</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">regexp</span><span class="p">:</span>
            <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regexHelper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">backwards</span><span class="p">,</span><span class="n">nocase</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">backwards</span><span class="p">:</span>
            <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backwardsHelper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">nocase</span><span class="p">,</span><span class="n">word</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plainHelper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">nocase</span><span class="p">,</span><span class="n">word</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;returns&#39;</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span>
    <span class="c">#@+node:ekr.20060526092203: *6* regexHelper</span></div>
<div class="viewcode-block" id="leoFind.regexHelper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.regexHelper">[docs]</a>    <span class="k">def</span> <span class="nf">regexHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">backwards</span><span class="p">,</span><span class="n">nocase</span><span class="p">):</span>

        <span class="n">re_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_obj</span> <span class="c"># Use the pre-compiled object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re_obj</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not happen: no re_obj&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">backwards</span><span class="p">:</span> <span class="c"># Scan to the last match.  We must use search here.</span>
            <span class="n">last_mo</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="n">mo</span> <span class="o">=</span> <span class="n">re_obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span> <span class="k">break</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">last_mo</span> <span class="o">=</span> <span class="n">mo</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="n">last_mo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mo</span> <span class="o">=</span> <span class="n">re_obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;j&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s">&#39;s[i:j]&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]),</span>
                <span class="s">&#39;mo.start&#39;</span><span class="p">,</span><span class="n">mo</span> <span class="ow">and</span> <span class="n">mo</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="s">&#39;mo.end&#39;</span><span class="p">,</span><span class="n">mo</span> <span class="ow">and</span> <span class="n">mo</span><span class="o">.</span><span class="n">end</span><span class="p">())</span>

        <span class="k">while</span> <span class="n">mo</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mo</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">==</span> <span class="n">mo</span><span class="o">.</span><span class="n">end</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">backwards</span><span class="p">:</span>
                    <span class="c"># Search backward using match instead of search.</span>
                    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                        <span class="n">mo</span> <span class="o">=</span> <span class="n">re_obj</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">mo</span><span class="p">:</span> <span class="k">break</span>
                        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">mo</span> <span class="o">=</span> <span class="n">re_obj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">match_obj</span> <span class="o">=</span> <span class="n">mo</span>
                <span class="k">return</span> <span class="n">mo</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">mo</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_obj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">#@+node:ekr.20060526140744: *6* backwardsHelper</span></div>
    <span class="n">debugIndices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">#@+at</span>
    <span class="c"># rfind(sub [,start [,end]])</span>
    <span class="c"># </span>
    <span class="c"># Return the highest index in the string where substring sub is found, such that</span>
    <span class="c"># sub is contained within s[start,end]. Optional arguments start and end are</span>
    <span class="c"># interpreted as in slice notation. Return -1 on failure.</span>
    <span class="c">#@@c</span>

<div class="viewcode-block" id="leoFind.backwardsHelper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.backwardsHelper">[docs]</a>    <span class="k">def</span> <span class="nf">backwardsHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">nocase</span><span class="p">,</span><span class="n">word</span><span class="p">):</span>

        <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">nocase</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">;</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c"># Bug fix: 10/5/06: At last the bug is found!</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceBackSlashes</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;bad index: i = </span><span class="si">%s</span><span class="s">, j = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;two zero indices&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">backwardAttempts</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># short circuit the search: helps debugging.</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debugCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debugCount</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s">&#39;len(s)&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;**word** </span><span class="si">%3s</span><span class="s"> </span><span class="si">%3s</span><span class="s"> </span><span class="si">%5s</span><span class="s"> -&gt; </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s">&#39;(end)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchWord</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">pattern</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">n</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%3s</span><span class="s"> </span><span class="si">%3s</span><span class="s"> </span><span class="si">%5s</span><span class="s"> -&gt; </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="s">&#39;(end)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="n">n</span>
    <span class="c">#@+node:ekr.20060526093531: *6* plainHelper</span></div>
<div class="viewcode-block" id="leoFind.plainHelper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.plainHelper">[docs]</a>    <span class="k">def</span> <span class="nf">plainHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">pattern</span><span class="p">,</span><span class="n">nocase</span><span class="p">,</span><span class="n">word</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span>

        <span class="c"># if trace: g.trace(i,j,repr(s[i:i+20]),&#39;pattern&#39;,repr(pattern),&#39;word&#39;,repr(word))</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">20</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">nocase</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">;</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceBackSlashes</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">word</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
                <span class="c"># g.trace(k,n)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no match word&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchWord</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">pattern</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;match word&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no match word&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;match&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span>
    <span class="c">#@+node:ekr.20060526140744.1: *6* matchWord</span></div>
<div class="viewcode-block" id="leoFind.matchWord"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.matchWord">[docs]</a>    <span class="k">def</span> <span class="nf">matchWord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">pattern</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceBackSlashes</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pattern</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">pattern</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;empty&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">pat1</span><span class="p">,</span><span class="n">pat2</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pattern</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># n = self.patternLen(pattern)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">ch1</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;.&#39;</span>
        <span class="n">ch2</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="o">+</span><span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;.&#39;</span>

        <span class="n">isWordPat1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">isWordChar</span><span class="p">(</span><span class="n">pat1</span><span class="p">)</span>
        <span class="n">isWordPat2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">isWordChar</span><span class="p">(</span><span class="n">pat2</span><span class="p">)</span>
        <span class="n">isWordCh1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">isWordChar</span><span class="p">(</span><span class="n">ch1</span><span class="p">)</span>
        <span class="n">isWordCh2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">isWordChar</span><span class="p">(</span><span class="n">ch2</span><span class="p">)</span>

        <span class="c"># g.trace(&#39;i&#39;,i,&#39;ch1,ch2,pat&#39;,repr(ch1),repr(ch2),repr(pattern))</span>

        <span class="n">inWord</span> <span class="o">=</span> <span class="n">isWordPat1</span> <span class="ow">and</span> <span class="n">isWordCh1</span> <span class="ow">or</span> <span class="n">isWordPat2</span> <span class="ow">and</span> <span class="n">isWordCh2</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;returns&#39;</span><span class="p">,</span><span class="ow">not</span> <span class="n">inWord</span><span class="p">)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">inWord</span>

    <span class="c">#@+node:ekr.20070105165924: *6* replaceBackSlashes</span></div>
<div class="viewcode-block" id="leoFind.replaceBackSlashes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.replaceBackSlashes">[docs]</a>    <span class="k">def</span> <span class="nf">replaceBackSlashes</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Carefully replace backslashes in a search pattern.&#39;&#39;&#39;</span>

        <span class="c"># This is NOT the same as s.replace(&#39;\\n&#39;,&#39;\n&#39;).replace(&#39;\\t&#39;,&#39;\t&#39;).replace(&#39;\\\\&#39;,&#39;\\&#39;)</span>
        <span class="c"># because there is no rescanning.</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="c"># replace \\ by \</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;n&#39;</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span> <span class="c"># replace the \n by a newline</span>
                <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;t&#39;</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span> <span class="c"># replace \t by a tab</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># Skip the escaped character.</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20031218072017.3081: *4* selectNextPosition (leoFind)</span>
    <span class="c"># Selects the next node to be searched.</span>
</div>
<div class="viewcode-block" id="leoFind.selectNextPosition"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.selectNextPosition">[docs]</a>    <span class="k">def</span> <span class="nf">selectNextPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="c"># Start suboutline only searches.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span><span class="p">:</span>
            <span class="c"># p.copy not needed because the find code never calls p.moveToX.</span>
            <span class="c"># Furthermore, p might be None, so p.copy() would be wrong!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="o">=</span> <span class="n">p</span> 

        <span class="c"># Start wrapped searches.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapPos</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span>
            <span class="c"># p.copy not needed because the find code never calls p.moveToX.</span>
            <span class="c"># Furthermore, p might be None, so p.copy() would be wrong!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">=</span> <span class="n">p</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_body</span><span class="p">:</span>
            <span class="c"># just switch to body pane.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initNextText</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;switching to body&#39;</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">p</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">threadBack</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">threadNext</span><span class="p">()</span>

        <span class="c"># if trace: g.trace(p and p.h or &#39;None&#39;)</span>

        <span class="c"># New in 4.3: restrict searches to hoisted area.</span>
        <span class="c"># End searches outside hoisted area.</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;wrap disabled in hoisted outlines&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">bunch</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bunch</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">isAncestorOf</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;found match outside of hoisted outline&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># Wrap if needed.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                <span class="c"># Set search_v to the last node of the tree.</span>
                <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lastNode</span><span class="p">()</span>

        <span class="c"># End wrapped searches.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;ending wrapped search&quot;</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetWrap</span><span class="p">()</span>

        <span class="c"># End suboutline only searches.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span><span class="o">.</span><span class="n">isAncestorOf</span><span class="p">(</span><span class="n">p</span><span class="p">))):</span>
            <span class="c"># g.trace(&quot;end outline-only&quot;)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">onlyPosition</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># p.copy not needed because the find code never calls p.moveToX.</span>
        <span class="c"># Furthermore, p might be None, so p.copy() would be wrong!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="c"># used in initNextText().</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span> <span class="c"># select p and set the search point within p.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initNextText</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">p</span>
    <span class="c">#@+node:ekr.20061212095134.1: *3* General utils (leoFind)</span>
    <span class="c">#@+node:ekr.20051020120306.26: *4* bringToFront (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.bringToFront"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.bringToFront">[docs]</a>    <span class="k">def</span> <span class="nf">bringToFront</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Bring the Find Tab to the front and select the entire find text.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span>

        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocusNow</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="c"># g.app.gui.selectAllText(w)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">selectAllText</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20061111084423.1: *4* oops (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.oops"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.oops">[docs]</a>    <span class="k">def</span> <span class="nf">oops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">((</span><span class="s">&quot;leoFind oops:&quot;</span><span class="p">,</span>
            <span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="s">&quot;should be overridden in subclass&quot;</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20051020120306.27: *4* selectAllFindText (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.selectAllFindText"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.selectAllFindText">[docs]</a>    <span class="k">def</span> <span class="nf">selectAllFindText</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># This is called only when the user presses ctrl-a in the find panel.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">focus_get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">isTextWidget</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">selectAllText</span><span class="p">()</span>

        <span class="k">return</span> <span class="c"># (for Tk) &quot;break&quot;</span>
    <span class="c">#@+node:ekr.20031218072017.3082: *3* Initing &amp; finalizing (leoFind)</span>
    <span class="c">#@+node:ekr.20031218072017.3083: *4* checkArgs</span></div>
<div class="viewcode-block" id="leoFind.checkArgs"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.checkArgs">[docs]</a>    <span class="k">def</span> <span class="nf">checkArgs</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_body</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;not searching headline or body&quot;</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;empty find patttern&quot;</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">val</span>
    <span class="c">#@+node:ekr.20031218072017.3084: *4* initBatchCommands</span>
    <span class="c"># Initializes for the Find All and Change All commands.</span>
</div>
<div class="viewcode-block" id="leoFind.initBatchCommands"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.initBatchCommands">[docs]</a>    <span class="k">def</span> <span class="nf">initBatchCommands</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span> <span class="c"># Search headlines first.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Select the first node.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_only</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lastNode</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>

        <span class="c"># Set the insert point.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initBatchText</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20031218072017.3085: *4* initBatchText, initNextText &amp; init_s_ctrl</span>
    <span class="c"># Returns s_ctrl with &quot;insert&quot; point set properly for batch searches.</span></div>
<div class="viewcode-block" id="leoFind.initBatchText"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.initBatchText">[docs]</a>    <span class="k">def</span> <span class="nf">initBatchText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ins</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Only interactive commands allow wrapping.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_s_ctrl</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ins</span><span class="p">)</span>

    <span class="c"># Call this routine when moving to the next node when a search fails.</span>
    <span class="c"># Same as above except we don&#39;t reset wrapping flag.</span></div>
<div class="viewcode-block" id="leoFind.initNextText"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.initNextText">[docs]</a>    <span class="k">def</span> <span class="nf">initNextText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ins</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">c</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span>
            <span class="k">if</span> <span class="n">tree</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;killEditing&#39;</span><span class="p">):</span>
                <span class="c"># g.trace(&#39;kill editing before find&#39;)</span>
                <span class="n">tree</span><span class="o">.</span><span class="n">killEditing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_s_ctrl</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ins</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoFind.init_s_ctrl"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.init_s_ctrl">[docs]</a>    <span class="k">def</span> <span class="nf">init_s_ctrl</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">ins</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_ctrl</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setAllText</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ins</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ins</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
            <span class="c"># print(g.choose(self.reverse,&#39;.&#39;,&#39;*&#39;),)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># g.trace(&#39;ins&#39;,ins)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3086: *4* initInHeadline</span>
    <span class="c"># Guesses which pane to start in for incremental searches and changes.</span>
    <span class="c"># This must not alter the current &quot;insert&quot; or &quot;sel&quot; marks.</span>
</div>
<div class="viewcode-block" id="leoFind.initInHeadline"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.initInHeadline">[docs]</a>    <span class="k">def</span> <span class="nf">initInHeadline</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="c"># Do not change this without careful thought and extensive testing!</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_body</span><span class="p">:</span>
            <span class="c"># A temporary expedient.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">editPosition</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">editPosition</span><span class="p">()</span>
                <span class="n">focus</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_focus</span><span class="p">()</span>
                <span class="c"># Search headline first.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">p</span> <span class="o">==</span> <span class="n">editPosition</span> <span class="ow">and</span>
                    <span class="n">focus</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
                    <span class="s">&#39;** p: </span><span class="si">%s</span><span class="s">, editPosition: </span><span class="si">%s</span><span class="s">, focus: </span><span class="si">%s</span><span class="s">, bodyCtrl: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">editPosition</span><span class="p">,</span><span class="n">focus</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span>
    <span class="c">#@+node:ekr.20031218072017.3087: *4* initInteractiveCommands</span></div>
<div class="viewcode-block" id="leoFind.initInteractiveCommands"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.initInteractiveCommands">[docs]</a>    <span class="k">def</span> <span class="nf">initInteractiveCommands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">bodyCtrl</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">bodyCtrl</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">bodyCtrl</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># We only use the insert point, *never* the selection range.</span>
        <span class="n">ins</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getInsertPoint</span><span class="p">()</span>
        <span class="c"># g.trace(&#39;ins&#39;,ins)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initNextText</span><span class="p">(</span><span class="n">ins</span><span class="o">=</span><span class="n">ins</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapPos</span> <span class="o">=</span> <span class="n">ins</span>
            <span class="c"># Do not set self.wrapPosition here: that must be done after the first search.</span>
    <span class="c">#@+node:ekr.20031218072017.3088: *4* printLine</span></div>
<div class="viewcode-block" id="leoFind.printLine"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.printLine">[docs]</a>    <span class="k">def</span> <span class="nf">printLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">allFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="n">both</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_body</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_headline</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="c"># &quot;batch&quot; now indicates context</span>

        <span class="k">if</span> <span class="n">allFlag</span> <span class="ow">and</span> <span class="n">both</span> <span class="ow">and</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="n">theType</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="s">&quot;head: &quot;</span><span class="p">,</span><span class="s">&quot;body: &quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">theType</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">allFlag</span> <span class="ow">and</span> <span class="n">context</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">isVisited</span><span class="p">():</span>
            <span class="c"># We only need to print the context once.</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">setVisited</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3089: *4* restore</span>
    <span class="c"># Restores the screen after a search fails</span>
</div>
<div class="viewcode-block" id="leoFind.restore"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.restore">[docs]</a>    <span class="k">def</span> <span class="nf">restore</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">in_headline</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">insert</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">bringToFront</span><span class="p">()</span> <span class="c"># Needed on the Mac</span>

        <span class="c"># Don&#39;t try to reedit headline.</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">selectPosition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">selectPosition</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">())</span> <span class="c"># New in Leo 4.5.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_headline</span><span class="p">:</span>
            <span class="c"># Looks good and provides clear indication of failure or termination.</span>
            <span class="n">t</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="n">insert</span><span class="p">,</span><span class="n">insert</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">seeInsertPoint</span><span class="p">()</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># I prefer always putting the focus in the body.</span>
            <span class="n">c</span><span class="o">.</span><span class="n">invalidateFocus</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3090: *4* save (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.save"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">insert</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getInsertPoint</span><span class="p">()</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">sel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">insert</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">insert</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20031218072017.3091: *4* showSuccess (leoFind)</span></div>
<div class="viewcode-block" id="leoFind.showSuccess"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.showSuccess">[docs]</a>    <span class="k">def</span> <span class="nf">showSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">,</span><span class="n">showState</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Display the result of a successful find operation.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not happen: self.p is None&#39;</span><span class="p">)</span>

        <span class="c"># Old code.  Not needed now that we always call c.selectPosition.</span>
        <span class="c"># Expand ancestors and set redraw if a redraw is needed.</span>
        <span class="c"># redraw1 = not p.isVisible(c)</span>
        <span class="c"># if c.sparse_find:</span>
            <span class="c"># # Show only the &#39;sparse&#39; tree when redrawing.</span>
            <span class="c"># for p2 in c.p.self_and_parents():</span>
                <span class="c"># if p2.isAncestorOf(p):</span>
                    <span class="c"># break</span>
                <span class="c"># # 2012/05/29: don&#39;t redraw unless we actually contract something.</span>
                <span class="c"># if p2.isExpanded():</span>
                    <span class="c"># p2.contract()</span>
                    <span class="c"># redraw1 = True # Important bug fix. Was redraw = True.</span>

        <span class="c"># redraw2 = c.expandAllAncestors(self.p)</span>
        <span class="c"># redraw = redraw1 or redraw2</span>

        <span class="c"># Set state vars.</span>
        <span class="c"># Ensure progress in backwards searches.</span>
        <span class="n">insert</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;in_headline&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_headline</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">endEditing</span><span class="p">()</span> <span class="c"># 2011/06/10: A major bug fix.</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">,</span><span class="n">insert</span>
            <span class="n">c</span><span class="o">.</span><span class="n">redrawAndEdit</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
                <span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">,</span>
                <span class="n">keepMinibuffer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>

            <span class="c"># Bug fix: 2012/11/26: *Always* do the full selection logic.</span>
            <span class="c"># This ensures that the body text is inited  and recolored.</span>
            <span class="n">c</span><span class="o">.</span><span class="n">selectPosition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

            <span class="c"># Old code: fails when setBodyTextAfterSelect does not call w.setAllText.</span>
            <span class="c"># if redraw:</span>
                <span class="c"># c.redraw(p)</span>
            <span class="c"># else:</span>
                <span class="c"># c.selectPosition(p)</span>
                <span class="c"># c.redraw_after_select(p)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">showState</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocusNow</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">newpos</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="n">insert</span><span class="p">)</span>
            <span class="c"># w.seeInsertPoint()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">w</span> <span class="c"># Support for isearch.</span>
    <span class="c">#@+node:ekr.20031218072017.1460: *4* update_ivars (leoFind)</span>
    <span class="c"># New in Leo 4.4.3: This is now gui-independent code.</span>
</div>
<div class="viewcode-block" id="leoFind.update_ivars"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.leoFind.update_ivars">[docs]</a>    <span class="k">def</span> <span class="nf">update_ivars</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Called just before doing a find to update ivars from the find panel.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">v</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="c"># if trace: g.trace(self.svarDict.get(key),val)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="c"># No more _flag hack.</span>

        <span class="c"># Set ivars from radio buttons. Convert these to 1 or 0.</span>
        <span class="n">search_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="c"># g.trace(&#39;radio-search-scope&#39;,search_scope)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suboutline_only</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">search_scope</span> <span class="o">==</span> <span class="s">&quot;suboutline-only&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_only</span>       <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">search_scope</span> <span class="o">==</span> <span class="s">&quot;node-only&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection</span>       <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">search_scope</span> <span class="o">==</span> <span class="s">&quot;selection-only&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># New in 4.3: The caller is responsible for removing most trailing cruft.</span>
        <span class="c"># Among other things, this allows Leo to search for a single trailing space.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toUnicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;find&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># 2011/06/13: clear wrap_pos if the find_text changes.</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_text</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;clearing self.wrap_pos&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapPosition</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_text</span> <span class="o">=</span> <span class="n">s</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toUnicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_text</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;change&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20051020120306.6: ** class findTab (leoFind)</span></div></div>
<div class="viewcode-block" id="findTab"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab">[docs]</a><span class="k">class</span> <span class="nc">findTab</span> <span class="p">(</span><span class="n">leoFind</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;An adapter class that implements Leo&#39;s Find tab.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20051020120306.11: *3* __init__ &amp; initGui</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;findTab&#39;,c)</span>

        <span class="c"># Init the base class...</span>
        <span class="n">leoFind</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Find Tab&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parentFrame</span> <span class="o">=</span> <span class="n">parentFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optionsOnly</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;show_only_find_tab_options&#39;</span><span class="p">)</span>

        <span class="c"># These are created later.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span> <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initGui</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createBindings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c"># New in 4.3: init only once.</span>
    <span class="c">#@+node:ekr.20060221074900: *3* Callbacks</span>
    <span class="c">#@+node:ekr.20060221074900.1: *4* findButtonCallback</span>
<div class="viewcode-block" id="findTab.findButtonCallback"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.findButtonCallback">[docs]</a>    <span class="k">def</span> <span class="nf">findButtonCallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">findButton</span><span class="p">()</span>
        <span class="k">return</span> <span class="c"># (for Tk) &#39;break&#39;</span>
    <span class="c">#@+node:ekr.20051020120306.25: *4* hideTab</span></div>
<div class="viewcode-block" id="findTab.hideTab"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.hideTab">[docs]</a>    <span class="k">def</span> <span class="nf">hideTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20051024192602: *3*  Top level</span>
    <span class="c">#@+node:ekr.20051024192642.3: *4* change/ThenFindCommand</span></div>
<div class="viewcode-block" id="findTab.changeCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.changeCommand">[docs]</a>    <span class="k">def</span> <span class="nf">changeCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.changeThenFindCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.changeThenFindCommand">[docs]</a>    <span class="k">def</span> <span class="nf">changeThenFindCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeThenFind</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20070105123638: *4* changeAllCommand</span></div>
<div class="viewcode-block" id="findTab.changeAllCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.changeAllCommand">[docs]</a>    <span class="k">def</span> <span class="nf">changeAllCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeAll</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20060128075225: *4* cloneFindAllCommand &amp; cloneFindAllFlattenedCommand</span></div>
<div class="viewcode-block" id="findTab.cloneFindAllCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.cloneFindAllCommand">[docs]</a>    <span class="k">def</span> <span class="nf">cloneFindAllCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="findTab.cloneFindAllFlattenedCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.cloneFindAllFlattenedCommand">[docs]</a>    <span class="k">def</span> <span class="nf">cloneFindAllFlattenedCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all_flattened</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clone_find_all_flattened</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20060204120158.1: *4* findAgainCommand</span></div>
<div class="viewcode-block" id="findTab.findAgainCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.findAgainCommand">[docs]</a>    <span class="k">def</span> <span class="nf">findAgainCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">!=</span> <span class="s">&#39;&lt;find pattern here&gt;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findNextCommand</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Tell the caller that to get the find args.</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20060209064832: *4* findAllCommand</span></div>
<div class="viewcode-block" id="findTab.findAllCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.findAllCommand">[docs]</a>    <span class="k">def</span> <span class="nf">findAllCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findAll</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20051024192642.2: *4* findNext/PrefCommand</span></div>
<div class="viewcode-block" id="findTab.findNextCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.findNextCommand">[docs]</a>    <span class="k">def</span> <span class="nf">findNextCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.findPrevCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.findPrevCommand">[docs]</a>    <span class="k">def</span> <span class="nf">findPrevCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_command</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findNext</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse</span>
    <span class="c">#@+node:ekr.20061212092124: *3* Defined in subclasses</span></div>
<div class="viewcode-block" id="findTab.createBindings"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.createBindings">[docs]</a>    <span class="k">def</span> <span class="nf">createBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.createFrame"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.getOption"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.getOption">[docs]</a>    <span class="k">def</span> <span class="nf">getOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.init"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.initGui"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.initGui">[docs]</a>    <span class="k">def</span> <span class="nf">initGui</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># Optional method.</span>
</div>
<div class="viewcode-block" id="findTab.setOption"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.setOption">[docs]</a>    <span class="k">def</span> <span class="nf">setOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="findTab.toggleOption"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.findTab.toggleOption">[docs]</a>    <span class="k">def</span> <span class="nf">toggleOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>

    <span class="c"># self.oops is defined in the leoFind class.</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20070302090616: ** class nullFindTab class (subclass of findTab)</span></div></div>
<div class="viewcode-block" id="nullFindTab"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab">[docs]</a><span class="k">class</span> <span class="nc">nullFindTab</span> <span class="p">(</span><span class="n">findTab</span><span class="p">):</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20070302090616.1: *3* Birth (nullFindTab)</span>
    <span class="c">#@+node:ekr.20070302090616.2: *4*  ctor (nullFindTab)</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Use the base class ctor.</span>

        <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

            <span class="n">findTab</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">)</span>
            <span class="c"># Init the base class.</span>
                <span class="c"># Calls initGui, createFrame, createBindings &amp; init(c), in that order.</span>
    <span class="c">#@+node:ekr.20070302090616.3: *4* initGui (nullFindTab)</span>
    <span class="c"># Called from findTab.ctor.</span>

<div class="viewcode-block" id="nullFindTab.initGui"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.initGui">[docs]</a>    <span class="k">def</span> <span class="nf">initGui</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Keys are ivar names, values are svar objects.</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svar</span><span class="p">()</span> <span class="c"># Was Tk.IntVar.</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">newStringKeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svar</span><span class="p">()</span> <span class="c"># Was Tk.StringVar.</span>

        <span class="c"># Bug fix: 2011/11/13: significant for external unit tests.</span>
        <span class="c"># Add the same hack as in the qtGui for the &#39;entire_outline&#39; radio button.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&#39;entire-outline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svar</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20070302090616.4: *4* init (nullFindTab)</span>
    <span class="c"># Called from findTab.ctor.</span>
</div>
<div class="viewcode-block" id="nullFindTab.init"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="c"># Separate c.ivars are much more convenient than a svarDict.</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="c"># Get ivars from @settings.</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">svar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">svar</span><span class="p">:</span> <span class="n">svar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c">#g.trace(key,val)</span>

        <span class="c">#@+&lt;&lt; set find/change widgets &gt;&gt;</span>
        <span class="c">#@+node:ekr.20070302090616.5: *5* &lt;&lt; set find/change widgets &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>

        <span class="c"># Get setting from @settings.</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">defaultText</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="p">,</span><span class="s">&quot;find_text&quot;</span><span class="p">,</span><span class="s">&#39;&lt;find pattern here&gt;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span><span class="p">,</span><span class="s">&quot;change_text&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">defaultText</span>
            <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; set find/change widgets &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; set radio buttons from ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20070302090616.6: *5* &lt;&lt; set radio buttons from ivars &gt;&gt;</span>
        <span class="c"># In Tk, setting the var also sets the widget.</span>
        <span class="c"># Here, we do so explicitly.</span>
        <span class="c"># d = self.widgetsDict</span>
        <span class="k">for</span> <span class="n">ivar</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;pattern_match&quot;</span><span class="p">,</span><span class="s">&quot;pattern-search&quot;</span><span class="p">),</span>
            <span class="c">#(&quot;script_search&quot;,&quot;script-search&quot;)</span>
        <span class="p">):</span>
            <span class="n">svar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">svar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-find-type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="c"># w = d.get(key)</span>
                <span class="c"># if w: w.set(True)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-find-type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;plain-search&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ivar</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;suboutline_only&quot;</span><span class="p">,</span><span class="s">&quot;suboutline-only&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;node_only&quot;</span><span class="p">,</span><span class="s">&quot;node-only&quot;</span><span class="p">),</span>
            <span class="c"># (&quot;selection_only&quot;,&quot;selection-only&quot;)</span>
        <span class="p">):</span>
            <span class="n">svar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">svar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">ivar</span> <span class="o">=</span> <span class="s">&#39;entire-outline&#39;</span>
            <span class="n">svar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">svar</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="c"># self.svarDict[&quot;radio-search-scope&quot;].set(key)</span>
            <span class="c"># w = self.widgetsDict.get(key)</span>
            <span class="c"># if w: w.set(True)</span>
        <span class="c">#@-&lt;&lt; set radio buttons from ivars &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; set checkboxes from ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20070302090616.7: *5* &lt;&lt; set checkboxes from ivars &gt;&gt;</span>
        <span class="k">for</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s">&#39;ignore_case&#39;</span><span class="p">,</span>
            <span class="s">&#39;mark_changes&#39;</span><span class="p">,</span>
            <span class="s">&#39;mark_finds&#39;</span><span class="p">,</span>
            <span class="s">&#39;pattern_match&#39;</span><span class="p">,</span>
            <span class="s">&#39;reverse&#39;</span><span class="p">,</span>
            <span class="s">&#39;search_body&#39;</span><span class="p">,</span>
            <span class="s">&#39;search_headline&#39;</span><span class="p">,</span>
            <span class="s">&#39;whole_word&#39;</span><span class="p">,</span>
            <span class="s">&#39;wrap&#39;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c"># Bug fix: 2011/11/13: significant for external unit tests.</span>
            <span class="n">svar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">svar</span><span class="p">:</span>
                <span class="n">svar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="c"># w = self.widgetsDict.get(ivar)</span>
                <span class="c"># if w: w.set(True)</span>
        <span class="c">#@-&lt;&lt; set checkboxes from ivars &gt;&gt;</span>
    <span class="c">#@+node:ekr.20070302090616.15: *4* createBindings (nullFindTab)</span></div>
<div class="viewcode-block" id="nullFindTab.createBindings"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.createBindings">[docs]</a>    <span class="k">def</span> <span class="nf">createBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="c">#@+node:ekr.20070302090616.9: *4* createFrame (nullFindTab)</span></div>
<div class="viewcode-block" id="nullFindTab.createFrame"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parentFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">parentFrame</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createFindChangeAreas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createBoxes</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20070302090616.10: *5* createFindChangeAreas</span></div>
<div class="viewcode-block" id="nullFindTab.createFindChangeAreas"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.createFindChangeAreas">[docs]</a>    <span class="k">def</span> <span class="nf">createFindChangeAreas</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># A plainTextWidget must be a stringTextWidget</span>
        <span class="n">plainTextWidget</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span>

        <span class="kn">import</span> <span class="nn">leo.core.leoFrame</span> <span class="kn">as</span> <span class="nn">leoFrame</span>
        <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">plainTextWidget</span><span class="p">,</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">stringTextWidget</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span>   <span class="o">=</span> <span class="n">plainTextWidget</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;find-text&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span> <span class="o">=</span> <span class="n">plainTextWidget</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;change-text&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20070302090616.12: *5* createBoxes</span></div>
<div class="viewcode-block" id="nullFindTab.createBoxes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.createBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">createBoxes</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create two columns of radio buttons &amp; check boxes.&#39;&#39;&#39;</span>

        <span class="c"># c = self.c</span>
        <span class="c"># f = self.parentFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgetsDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Keys are ivars, values are checkboxes or radio buttons.</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span> <span class="c"># Leading star denotes a radio button.</span>
            <span class="p">(</span><span class="s">&#39;Whole &amp;Word&#39;</span><span class="p">,</span> <span class="s">&#39;whole_word&#39;</span><span class="p">,),</span>
            <span class="p">(</span><span class="s">&#39;&amp;Ignore Case&#39;</span><span class="p">,</span><span class="s">&#39;ignore_case&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Wrap &amp;Around&#39;</span><span class="p">,</span><span class="s">&#39;wrap&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&amp;Reverse&#39;</span><span class="p">,</span>    <span class="s">&#39;reverse&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Rege&amp;xp&#39;</span><span class="p">,</span>     <span class="s">&#39;pattern_match&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Mark &amp;Finds&#39;</span><span class="p">,</span> <span class="s">&#39;mark_finds&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;*&amp;Entire Outline&quot;</span><span class="p">,</span><span class="s">&quot;entire-outline&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;*&amp;Suboutline Only&quot;</span><span class="p">,</span><span class="s">&quot;suboutline-only&quot;</span><span class="p">),</span>  
            <span class="p">(</span><span class="s">&quot;*&amp;Node Only&quot;</span><span class="p">,</span><span class="s">&quot;node-only&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Search &amp;Headline&#39;</span><span class="p">,</span><span class="s">&#39;search_headline&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Search &amp;Body&#39;</span><span class="p">,</span><span class="s">&#39;search_body&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Mark &amp;Changes&#39;</span><span class="p">,</span><span class="s">&#39;mark_changes&#39;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c"># Important: changing these controls merely changes entries in self.svarDict.</span>
        <span class="c"># First, leoFind.update_ivars sets the find ivars from self.svarDict.</span>
        <span class="c"># Second, self.init sets the values of widgets from the ivars.</span>
        <span class="c"># inGroup = False</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span><span class="n">ivar</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widgetsDict</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widgetsDict</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20070302090616.14: *5* createButtons (not used)</span></div>
<div class="viewcode-block" id="nullFindTab.createButtons"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.createButtons">[docs]</a>    <span class="k">def</span> <span class="nf">createButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create two columns of buttons.&#39;&#39;&#39;</span>
    <span class="c">#@+node:ekr.20070302090616.8: *3* class svar (nullFindTab)</span></div>
<div class="viewcode-block" id="nullFindTab.svar"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.svar">[docs]</a>    <span class="k">class</span> <span class="nc">svar</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;A class like Tk&#39;s IntVar and StringVar classes.&#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="bp">None</span>
<div class="viewcode-block" id="nullFindTab.svar.get"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.svar.get">[docs]</a>        <span class="k">def</span> <span class="nf">get</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span></div>
<div class="viewcode-block" id="nullFindTab.svar.set"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.svar.set">[docs]</a>        <span class="k">def</span> <span class="nf">set</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
</div>
        <span class="n">SetValue</span> <span class="o">=</span> <span class="nb">set</span> <span class="c"># SetValue is the wxWidgets spelling.</span>
    <span class="c">#@+node:ekr.20070302092907: *3* class buttonWidget (nullFindTab)</span></div>
<div class="viewcode-block" id="nullFindTab.buttonWidget"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.buttonWidget">[docs]</a>    <span class="k">class</span> <span class="nc">buttonWidget</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;A class to simulate a Tk.Button.&#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">def</span> <span class="nf">__repr</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;nullFindTab.buttonWidget: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

<div class="viewcode-block" id="nullFindTab.buttonWidget.get"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.buttonWidget.get">[docs]</a>        <span class="k">def</span> <span class="nf">get</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span>
</div>
<div class="viewcode-block" id="nullFindTab.buttonWidget.set"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.buttonWidget.set">[docs]</a>        <span class="k">def</span> <span class="nf">set</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
    <span class="c">#@+node:ekr.20070302090616.16: *3* Options</span>
    <span class="c"># This is the same as the Tk code because we simulate Tk svars.</span>
    <span class="c">#@+node:ekr.20070302090616.17: *4* getOption</span></div></div>
<div class="viewcode-block" id="nullFindTab.getOption"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.getOption">[docs]</a>    <span class="k">def</span> <span class="nf">getOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">):</span>

        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">var</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="c"># g.trace(&#39;%s = %s&#39; % (ivar,val))</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;bad ivar name: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ivar</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20070302090616.18: *4* setOption</span></div>
<div class="viewcode-block" id="nullFindTab.setOption"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.setOption">[docs]</a>    <span class="k">def</span> <span class="nf">setOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>

        <span class="k">if</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;nullFindTab: </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: bad find ivar </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ivar</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20070302090616.19: *4* toggleOption</span></div>
<div class="viewcode-block" id="nullFindTab.toggleOption"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoFind.nullFindTab.toggleOption">[docs]</a>    <span class="k">def</span> <span class="nf">toggleOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c"># g.trace(&#39;%s = %s&#39; % (ivar,val),var)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: bad find ivar </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ivar</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@-others</span>
<span class="c">#@-leo</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Ed K. Ream.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>