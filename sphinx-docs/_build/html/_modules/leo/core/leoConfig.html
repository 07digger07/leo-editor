<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>leo.core.leoConfig &mdash; Leo API 4.11dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.11dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Leo API 4.11dev documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for leo.core.leoConfig</h1><div class="highlight"><pre>
<span class="c">#@+leo-ver=5-thin</span>
<span class="c">#@+node:ekr.20041117062700: * @file leoConfig.py</span>
<span class="c">#@@language python</span>
<span class="c">#@@tabwidth -4</span>
<span class="c">#@@pagewidth 70</span>

<span class="c">#@+&lt;&lt; imports &gt;&gt;</span>
<span class="c">#@+node:ekr.20041227063801: ** &lt;&lt; imports &gt;&gt; (leoConfig)</span>
<span class="kn">import</span> <span class="nn">leo.core.leoGlobals</span> <span class="kn">as</span> <span class="nn">g</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="c">#@-&lt;&lt; imports &gt;&gt;</span>

<span class="c">#@+&lt;&lt; class ParserBaseClass &gt;&gt;</span>
<span class="c">#@+node:ekr.20041119203941.2: ** &lt;&lt; class ParserBaseClass &gt;&gt;</span>
<div class="viewcode-block" id="ParserBaseClass"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass">[docs]</a><span class="k">class</span> <span class="nc">ParserBaseClass</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;The base class for settings parsers.&quot;&quot;&quot;</span>

    <span class="c">#@+&lt;&lt; ParserBaseClass data &gt;&gt;</span>
    <span class="c">#@+node:ekr.20041121130043: *3* &lt;&lt; ParserBaseClass data &gt;&gt;</span>
    <span class="c"># These are the canonicalized names.  Case is ignored, as are &#39;_&#39; and &#39;-&#39; characters.</span>

    <span class="n">basic_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c"># Headlines have the form @kind name = var</span>
        <span class="s">&#39;bool&#39;</span><span class="p">,</span><span class="s">&#39;color&#39;</span><span class="p">,</span><span class="s">&#39;directory&#39;</span><span class="p">,</span><span class="s">&#39;int&#39;</span><span class="p">,</span><span class="s">&#39;ints&#39;</span><span class="p">,</span>
        <span class="s">&#39;float&#39;</span><span class="p">,</span><span class="s">&#39;path&#39;</span><span class="p">,</span><span class="s">&#39;ratio&#39;</span><span class="p">,</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">,</span><span class="s">&#39;strings&#39;</span><span class="p">]</span>

    <span class="n">control_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&#39;abbrev&#39;</span><span class="p">,</span><span class="s">&#39;buttons&#39;</span><span class="p">,</span><span class="s">&#39;commands&#39;</span><span class="p">,</span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="s">&#39;enabledplugins&#39;</span><span class="p">,</span><span class="s">&#39;font&#39;</span><span class="p">,</span>
        <span class="s">&#39;if&#39;</span><span class="p">,</span><span class="s">&#39;ifgui&#39;</span><span class="p">,</span><span class="s">&#39;ifhostname&#39;</span><span class="p">,</span><span class="s">&#39;ifplatform&#39;</span><span class="p">,</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span><span class="s">&#39;mode&#39;</span><span class="p">,</span>
        <span class="s">&#39;openwith&#39;</span><span class="p">,</span><span class="s">&#39;page&#39;</span><span class="p">,</span><span class="s">&#39;settings&#39;</span><span class="p">,</span><span class="s">&#39;shortcuts&#39;</span><span class="p">,</span>
        <span class="s">&#39;buttons&#39;</span><span class="p">,</span><span class="s">&#39;menus&#39;</span><span class="p">,</span> <span class="c"># New in Leo 4.4.4.</span>
        <span class="s">&#39;menuat&#39;</span><span class="p">,</span> <span class="s">&#39;popup&#39;</span><span class="p">,</span> <span class="c"># New in Leo 4.4.8.</span>
        <span class="p">]</span>

    <span class="c"># Keys are settings names, values are (type,value) tuples.</span>
    <span class="n">settingsDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c">#@-&lt;&lt; ParserBaseClass data &gt;&gt;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20041119204700: *3*  ctor (ParserBaseClass)</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">localFlag</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">localFlag</span> <span class="o">=</span> <span class="n">localFlag</span>
            <span class="c"># True if this is the .leo file being opened,</span>
            <span class="c"># as opposed to myLeoSettings.leo or leoSettings.leo.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDictOfLists</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39;parser.shortcutsDict&#39;</span><span class="p">,</span>
            <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;shortcutName&#39;</span><span class="p">),</span><span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ShortcutInfo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">openWithList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># A list of dicts containing &#39;name&#39;,&#39;shortcut&#39;,&#39;command&#39; keys.</span>

        <span class="c"># Keys are canonicalized names.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatchDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;abbrev&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">doAbbrev</span><span class="p">,</span> <span class="c"># New in 4.4.1 b2.</span>
            <span class="s">&#39;bool&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doBool</span><span class="p">,</span>
            <span class="s">&#39;buttons&#39;</span><span class="p">:</span>      <span class="bp">self</span><span class="o">.</span><span class="n">doButtons</span><span class="p">,</span> <span class="c"># New in 4.4.4</span>
            <span class="s">&#39;color&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">doColor</span><span class="p">,</span>
            <span class="s">&#39;commands&#39;</span><span class="p">:</span>     <span class="bp">self</span><span class="o">.</span><span class="n">doCommands</span><span class="p">,</span> <span class="c"># New in 4.4.8.</span>
            <span class="s">&#39;data&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doData</span><span class="p">,</span> <span class="c"># New in 4.4.6</span>
            <span class="s">&#39;directory&#39;</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">doDirectory</span><span class="p">,</span>
            <span class="s">&#39;enabledplugins&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">doEnabledPlugins</span><span class="p">,</span>
            <span class="s">&#39;font&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doFont</span><span class="p">,</span>
            <span class="s">&#39;if&#39;</span><span class="p">:</span>           <span class="bp">self</span><span class="o">.</span><span class="n">doIf</span><span class="p">,</span>
            <span class="c"># &#39;ifgui&#39;:        self.doIfGui,  # Removed in 4.4 b3.</span>
            <span class="s">&#39;ifhostname&#39;</span><span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">doIfHostname</span><span class="p">,</span>
            <span class="s">&#39;ifplatform&#39;</span><span class="p">:</span>   <span class="bp">self</span><span class="o">.</span><span class="n">doIfPlatform</span><span class="p">,</span>
            <span class="s">&#39;ignore&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">doIgnore</span><span class="p">,</span>
            <span class="s">&#39;int&#39;</span><span class="p">:</span>          <span class="bp">self</span><span class="o">.</span><span class="n">doInt</span><span class="p">,</span>
            <span class="s">&#39;ints&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doInts</span><span class="p">,</span>
            <span class="s">&#39;float&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">doFloat</span><span class="p">,</span>
            <span class="s">&#39;menus&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">doMenus</span><span class="p">,</span> <span class="c"># New in 4.4.4</span>
            <span class="s">&#39;menuat&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">doMenuat</span><span class="p">,</span>
            <span class="s">&#39;popup&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">doPopup</span><span class="p">,</span> <span class="c"># New in 4.4.8</span>
            <span class="s">&#39;mode&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doMode</span><span class="p">,</span> <span class="c"># New in 4.4b1.</span>
            <span class="s">&#39;openwith&#39;</span><span class="p">:</span>     <span class="bp">self</span><span class="o">.</span><span class="n">doOpenWith</span><span class="p">,</span> <span class="c"># New in 4.4.3 b1.</span>
            <span class="s">&#39;path&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doPath</span><span class="p">,</span>
            <span class="s">&#39;page&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">doPage</span><span class="p">,</span>
            <span class="s">&#39;ratio&#39;</span><span class="p">:</span>        <span class="bp">self</span><span class="o">.</span><span class="n">doRatio</span><span class="p">,</span>
            <span class="c"># &#39;shortcut&#39;:     self.doShortcut, # Removed in 4.4.1 b1.</span>
            <span class="s">&#39;shortcuts&#39;</span><span class="p">:</span>    <span class="bp">self</span><span class="o">.</span><span class="n">doShortcuts</span><span class="p">,</span>
            <span class="s">&#39;string&#39;</span><span class="p">:</span>       <span class="bp">self</span><span class="o">.</span><span class="n">doString</span><span class="p">,</span>
            <span class="s">&#39;strings&#39;</span><span class="p">:</span>      <span class="bp">self</span><span class="o">.</span><span class="n">doStrings</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">#@+node:ekr.20080514084054.4: *3* computeModeName (ParserBaseClass)</span>
<div class="viewcode-block" id="ParserBaseClass.computeModeName"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.computeModeName">[docs]</a>    <span class="k">def</span> <span class="nf">computeModeName</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c"># The actual mode name is everything up to the &quot;::&quot;</span>
            <span class="c"># The prompt is everything after the prompt.</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>

        <span class="n">modeName</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;-mode&#39;</span>
        <span class="k">return</span> <span class="n">modeName</span>
    <span class="c">#@+node:ekr.20060102103625: *3* createModeCommand (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.createModeCommand"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.createModeCommand">[docs]</a>    <span class="k">def</span> <span class="nf">createModeCommand</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">modeName</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">modeDict</span><span class="p">):</span>

        <span class="n">modeName</span> <span class="o">=</span> <span class="s">&#39;enter-&#39;</span> <span class="o">+</span> <span class="n">modeName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c"># The prompt is everything after the &#39;::&#39;</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">modeDict</span> <span class="p">[</span><span class="s">&#39;*command-prompt*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ShortcutInfo</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>

        <span class="c"># Save the info for k.finishCreate and k.makeAllBindings.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modeCommandsDict</span>

        <span class="c"># New in 4.4.1 b2: silently allow redefinitions of modes.</span>
        <span class="n">d</span> <span class="p">[</span><span class="n">modeName</span><span class="p">]</span> <span class="o">=</span> <span class="n">modeDict</span>

    <span class="c">#@+node:ekr.20041120103012: *3* error (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.error"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c"># Does not work at present because we are using a null Gui.</span>
        <span class="n">g</span><span class="o">.</span><span class="n">blue</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120094940: *3* kind handlers (ParserBaseClass)</span>
    <span class="c">#@+node:ekr.20060608221203: *4* doAbbrev</span></div>
<div class="viewcode-block" id="ParserBaseClass.doAbbrev"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doAbbrev">[docs]</a>    <span class="k">def</span> <span class="nf">doAbbrev</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseAbbrevLine</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="n">d</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;abbrev&#39;</span><span class="p">,</span><span class="s">&#39;abbrev&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120094940.1: *4* doBool</span></div>
<div class="viewcode-block" id="ParserBaseClass.doBool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doBool">[docs]</a>    <span class="k">def</span> <span class="nf">doBool</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span><span class="s">&#39;true&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;False&#39;</span><span class="p">,</span><span class="s">&#39;false&#39;</span><span class="p">,</span><span class="s">&#39;0&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20070925144337: *4* doButtons</span></div>
<div class="viewcode-block" id="ParserBaseClass.doButtons"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doButtons">[docs]</a>    <span class="k">def</span> <span class="nf">doButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle an @buttons tree.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&#39;@button&#39;</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">after</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">nodeAfterTree</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">after</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">isAtIgnoreNode</span><span class="p">():</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
                    <span class="c"># We can not assume that p will be valid when it is used.</span>
                    <span class="n">script</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getScript</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">,</span>
                        <span class="n">useSelectedText</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">forcePythonSentinels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">useSentinels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">script</span><span class="p">),)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>

        <span class="c"># This setting is handled differently from most other settings,</span>
        <span class="c"># because the last setting must be retrieved before any commander exists.</span>
        <span class="k">if</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atCommonButtonsList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>
                <span class="c"># Bug fix: 2011/11/24: Extend the list, don&#39;t replace it.</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">buttonsFileName</span> <span class="o">=</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;&lt;no settings file&gt;&#39;</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">),</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">())</span>

        <span class="n">d</span><span class="p">,</span><span class="n">key</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">unitTestDict</span><span class="p">,</span><span class="s">&#39;config.doButtons-file-names&#39;</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,[])</span>
        <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">())</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>
    <span class="c">#@+node:ekr.20041120094940.2: *4* doColor</span></div>
<div class="viewcode-block" id="ParserBaseClass.doColor"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doColor">[docs]</a>    <span class="k">def</span> <span class="nf">doColor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="c"># At present no checking is done.</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20080312071248.6: *4* doCommands</span></div>
<div class="viewcode-block" id="ParserBaseClass.doCommands"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doCommands">[docs]</a>    <span class="k">def</span> <span class="nf">doCommands</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle an @commands tree.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&#39;@command&#39;</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">after</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">nodeAfterTree</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">after</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">isAtIgnoreNode</span><span class="p">():</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
                    <span class="c"># We can not assume that p will be valid when it is used.</span>
                    <span class="n">script</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getScript</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">,</span>
                        <span class="n">useSelectedText</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">forcePythonSentinels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">useSentinels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">script</span><span class="p">),)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>

        <span class="c"># This setting is handled differently from most other settings,</span>
        <span class="c"># because the last setting must be retrieved before any commander exists.</span>
        <span class="k">if</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atCommonCommandsList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>
                <span class="c"># Bug fix: 2011/11/24: Extend the list, don&#39;t replace it.</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">),</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">())</span>

        <span class="n">d</span><span class="p">,</span><span class="n">key</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">unitTestDict</span><span class="p">,</span><span class="s">&#39;config.doCommands-file-names&#39;</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,[])</span>
        <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">())</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>
    <span class="c">#@+node:ekr.20071214140900: *4* doData</span></div>
<div class="viewcode-block" id="ParserBaseClass.doData"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doData">[docs]</a>    <span class="k">def</span> <span class="nf">doData</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">z</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120094940.3: *4* doDirectory &amp; doPath</span></div>
<div class="viewcode-block" id="ParserBaseClass.doDirectory"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doDirectory">[docs]</a>    <span class="k">def</span> <span class="nf">doDirectory</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="c"># At present no checking is done.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</div>
    <span class="n">doPath</span> <span class="o">=</span> <span class="n">doDirectory</span>
    <span class="c">#@+node:ekr.20070224075914: *4* doEnabledPlugins</span>
<div class="viewcode-block" id="ParserBaseClass.doEnabledPlugins"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doEnabledPlugins">[docs]</a>    <span class="k">def</span> <span class="nf">doEnabledPlugins</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>

        <span class="c"># This setting is handled differently from all other settings,</span>
        <span class="c"># because the last setting must be retrieved before any commander exists.</span>

        <span class="c"># 2011/09/04: Remove comments, comment lines and blank lines.</span>
        <span class="n">aList</span><span class="p">,</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[],</span><span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="c"># 2011/09/29: must add newline back in.</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>
        <span class="c"># g.trace(&#39;\n%s&#39; % s)</span>


        <span class="c"># Set the global config ivars.</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabledPluginsString</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabledPluginsFileName</span> <span class="o">=</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;&lt;no settings file&gt;&#39;</span>
    <span class="c">#@+node:ekr.20041120094940.6: *4* doFloat</span></div>
<div class="viewcode-block" id="ParserBaseClass.doFloat"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doFloat">[docs]</a>    <span class="k">def</span> <span class="nf">doFloat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120094940.4: *4* doFont</span></div>
<div class="viewcode-block" id="ParserBaseClass.doFont"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doFont">[docs]</a>    <span class="k">def</span> <span class="nf">doFont</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseFont</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c"># Set individual settings.</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;family&#39;</span><span class="p">,</span><span class="s">&#39;size&#39;</span><span class="p">,</span><span class="s">&#39;slant&#39;</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">setKind</span> <span class="o">=</span> <span class="n">key</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">setKind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">):</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120103933: *4* doIf</span></div>
<div class="viewcode-block" id="ParserBaseClass.doIf"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doIf">[docs]</a>    <span class="k">def</span> <span class="nf">doIf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;&#39;if&#39; not supported yet&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20041121125416: *4* doIfGui (can never work)</span>
    <span class="c">#@+at</span>
    <span class="c"># Alas, @if-gui can&#39;t be made to work. The problem is that plugins can</span>
    <span class="c"># set g.app.gui, but plugins need settings so the leoSettings.leo files</span>
    <span class="c"># must be parsed before g.app.gui.guiName() is known.</span>
    <span class="c">#@@c</span>
</div>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">doIfGui</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">guiName</span><span class="p">():</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;@if-gui has no effect: g.app.gui not defined yet&#39;</span>
                <span class="n">g</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;skip&quot;</span>
            <span class="k">elif</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">guiName</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;skip&quot;</span>
    <span class="c">#@+node:dan.20080410121257.2: *4* doIfHostname</span>
<div class="viewcode-block" id="ParserBaseClass.doIfHostname"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doIfHostname">[docs]</a>    <span class="k">def</span> <span class="nf">doIfHostname</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;headline: @ifhostname bob,!harry,joe</span>

<span class="sd">        Logical AND with the comma-separated list of host names, NO SPACES.</span>

<span class="sd">        descends this node iff:</span>
<span class="sd">            h = os.environ(&#39;HOSTNAME&#39;)</span>
<span class="sd">            h == &#39;bob&#39; and h != &#39;harry&#39; and h == &#39;joe&#39;&quot;&quot;&quot;</span>

        <span class="n">lm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadManager</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">computeMachineName</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;!&#39;</span> <span class="ow">and</span> <span class="n">h</span> <span class="o">==</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="n">n</span><span class="p">):</span>
                <span class="c"># g.trace(&#39;skipping&#39;, name)</span>
                <span class="k">return</span> <span class="s">&#39;skip&#39;</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="c">#@+node:ekr.20041120104215: *4* doIfPlatform</span></div>
<div class="viewcode-block" id="ParserBaseClass.doIfPlatform"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doIfPlatform">[docs]</a>    <span class="k">def</span> <span class="nf">doIfPlatform</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;skip&quot;</span>
    <span class="c">#@+node:ekr.20041120104215.1: *4* doIgnore</span></div>
<div class="viewcode-block" id="ParserBaseClass.doIgnore"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doIgnore">[docs]</a>    <span class="k">def</span> <span class="nf">doIgnore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&quot;skip&quot;</span>
    <span class="c">#@+node:ekr.20041120094940.5: *4* doInt</span></div>
<div class="viewcode-block" id="ParserBaseClass.doInt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doInt">[docs]</a>    <span class="k">def</span> <span class="nf">doInt</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041217132253: *4* doInts</span></div>
<div class="viewcode-block" id="ParserBaseClass.doInts"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doInts">[docs]</a>    <span class="k">def</span> <span class="nf">doInts</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;We expect either:</span>
<span class="sd">        @ints [val1,val2,...]aName=val</span>
<span class="sd">        @ints aName[val1,val2,...]=val&#39;&#39;&#39;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c"># The name indicates the valid values.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>

        <span class="c"># g.trace(kind,name,val)</span>

        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">name</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c"># g.trace(name,items)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;ints[]&#39;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="s">&quot;ints[</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&#39;int&#39;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> is not in </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="c"># g.trace(repr(kind),repr(name),val)</span>

            <span class="c"># At present no checking is done.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:tbrown.20080514112857.124: *4* doMenuat</span></div>
<div class="viewcode-block" id="ParserBaseClass.doMenuat"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doMenuat">[docs]</a>    <span class="k">def</span> <span class="nf">doMenuat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&quot;Patching menu tree: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

            <span class="c"># get the patch fragment</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="c"># self.doMenus(p.copy().firstChild(),kind,name,val,storeIn=patch)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">doItems</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">patch</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumpMenuTree</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

            <span class="c"># setup        </span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;subtree&#39;</span><span class="p">)</span>
            <span class="n">targetPath</span><span class="p">,</span><span class="n">mode</span><span class="p">,</span><span class="n">source</span> <span class="o">=</span> <span class="n">parts</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">targetPath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span> <span class="n">targetPath</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">targetPath</span>

            <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchMenuTree</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span><span class="p">,</span> <span class="n">targetPath</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ans</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&quot;Patching (&quot;</span><span class="o">+</span><span class="n">mode</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s">&quot;) at &quot;</span><span class="o">+</span><span class="n">targetPath</span><span class="p">)</span>

                <span class="n">list_</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">ans</span>

                <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;copy&#39;</span><span class="p">,</span> <span class="s">&#39;cut&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">source</span> <span class="o">!=</span> <span class="s">&#39;clipboard&#39;</span><span class="p">:</span>
                        <span class="n">use</span> <span class="o">=</span> <span class="n">patch</span> <span class="c"># [0][1]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clipBoard</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="n">use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clipBoard</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">use</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">clipBoard</span><span class="p">]</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">use</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;replace&#39;</span><span class="p">:</span>
                    <span class="n">list_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">use</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">list_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">use</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;before&#39;</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">use</span><span class="p">:</span>
                        <span class="n">list_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">use</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;after&#39;</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">use</span><span class="p">:</span>
                        <span class="n">list_</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">use</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;cut&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clipBoard</span> <span class="o">=</span> <span class="n">list_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">list_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;copy&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clipBoard</span> <span class="o">=</span> <span class="n">list_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clipBoard</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c"># append</span>
                    <span class="n">list_</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">use</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&quot;ERROR: didn&#39;t find menu path &quot;</span> <span class="o">+</span> <span class="n">targetPath</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&quot;ERROR: @menuat found but no menu tree to patch&quot;</span><span class="p">)</span>
    <span class="c">#@+node:tbrown.20080514180046.9: *5* getName (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.getName"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">val2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val2</span> <span class="ow">and</span> <span class="n">val2</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">val</span> <span class="o">=</span> <span class="n">val2</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="s">&quot;*.-&amp; </span><span class="se">\t\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c">#@+node:tbrown.20080514180046.2: *5* dumpMenuTree</span></div>
<div class="viewcode-block" id="ParserBaseClass.dumpMenuTree"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.dumpMenuTree">[docs]</a>    <span class="k">def</span> <span class="nf">dumpMenuTree</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">kind</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">val2</span> <span class="o">=</span> <span class="n">z</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;@item&#39;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">) [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;    &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">level</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span> <span class="n">val</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;@menu &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">... [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;    &#39;</span><span class="o">*</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="n">kind</span><span class="p">,</span> <span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumpMenuTree</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
    <span class="c">#@+node:tbrown.20080514180046.8: *5* patchMenuTree</span></div>
<div class="viewcode-block" id="ParserBaseClass.patchMenuTree"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.patchMenuTree">[docs]</a>    <span class="k">def</span> <span class="nf">patchMenuTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">targetPath</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orig</span><span class="p">):</span>
            <span class="n">kind</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">val2</span> <span class="o">=</span> <span class="n">z</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;@item&#39;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>
                <span class="n">curPath</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">curPath</span> <span class="o">==</span> <span class="n">targetPath</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;Found &#39;</span><span class="o">+</span><span class="n">targetPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">orig</span><span class="p">,</span> <span class="n">n</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;@menu &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curPath</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span>
                <span class="k">if</span> <span class="n">curPath</span> <span class="o">==</span> <span class="n">targetPath</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;Found &#39;</span><span class="o">+</span><span class="n">targetPath</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">orig</span><span class="p">,</span> <span class="n">n</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchMenuTree</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">targetPath</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ans</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ans</span>

        <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20070925144337.2: *4* doMenus &amp; helpers (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.doMenus"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doMenus">[docs]</a>    <span class="k">def</span> <span class="nf">doMenus</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">aList</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&#39;@menu&#39;</span> <span class="p">;</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">isPython3</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="p">;</span> <span class="n">after</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">nodeAfterTree</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;******&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="s">&#39;after&#39;</span><span class="p">,</span><span class="n">after</span> <span class="ow">and</span> <span class="n">after</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">after</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                        <span class="n">name2</span><span class="p">,</span><span class="n">junk</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="n">z</span>
                        <span class="k">if</span> <span class="n">name2</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Replacing previous @menu </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
                            <span class="k">break</span>
                    <span class="n">aList2</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">doItems</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">aList2</span><span class="p">)</span>
                    <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kind</span><span class="p">,</span><span class="n">aList2</span><span class="p">,</span><span class="bp">None</span><span class="p">),)</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># Prefer the legacy code now that the localFlag is set correctly.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">localFlag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;menus&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;menus&#39;</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">aList</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">silentMode</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;using menus from: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">blue</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span> <span class="o">=</span> <span class="n">aList</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="s">&#39;&lt;no settings file&gt;&#39;</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusFileName</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;menus&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;menus&#39;</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">aList</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span> <span class="o">=</span> <span class="n">aList</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="s">&#39;&lt;no settings file&gt;&#39;</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusFileName</span> <span class="o">=</span> <span class="n">name</span>
    <span class="c">#@+node:ekr.20070926141716: *5* doItems</span></div>
<div class="viewcode-block" id="ParserBaseClass.doItems"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doItems">[docs]</a>    <span class="k">def</span> <span class="nf">doItems</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">aList</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">isPython3</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">after</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">nodeAfterTree</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_count</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">,</span><span class="s">&#39;after&#39;</span><span class="p">,</span><span class="n">after</span> <span class="ow">and</span> <span class="n">after</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">after</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;@menu&#39;</span><span class="p">,</span><span class="s">&#39;@item&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
                    <span class="n">itemName</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">itemName</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;@menu&#39;</span><span class="p">:</span>
                            <span class="n">aList2</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">itemName</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">doItems</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">aList2</span><span class="p">)</span>
                            <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kind</span><span class="p">,</span><span class="n">aList2</span><span class="p">,</span><span class="bp">None</span><span class="p">),)</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">kind</span> <span class="o">=</span> <span class="n">tag</span>
                            <span class="n">head</span> <span class="o">=</span> <span class="n">itemName</span>
                            <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
                            <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kind</span><span class="p">,</span><span class="n">head</span><span class="p">,</span><span class="n">body</span><span class="p">),)</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
                            <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20070926142312: *5* dumpMenuList</span></div>
<div class="viewcode-block" id="ParserBaseClass.dumpMenuList"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.dumpMenuList">[docs]</a>    <span class="k">def</span> <span class="nf">dumpMenuList</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">kind</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">val2</span> <span class="o">=</span> <span class="n">z</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;@item&#39;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">val2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="s">&#39;...&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dumpMenuList</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20060102103625.1: *4* doMode (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.doMode"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doMode">[docs]</a>    <span class="k">def</span> <span class="nf">doMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Parse an @mode node and create the enter-&lt;name&gt;-mode command.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">new_modes</span><span class="p">:</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                    <span class="n">name2</span><span class="p">,</span><span class="n">si</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseShortcutLine</span><span class="p">(</span><span class="s">&#39;*mode-setting*&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name2</span><span class="p">,</span><span class="n">si</span><span class="p">),)</span>
            <span class="n">k</span><span class="o">.</span><span class="n">modeController</span><span class="o">.</span><span class="n">makeMode</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">aList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name1</span> <span class="o">=</span> <span class="n">name</span>

            <span class="c"># g.trace(&#39;%20s&#39; % (name),c.fileName())</span>
            <span class="n">modeName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeModeName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">d</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDictOfLists</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&#39;modeDict for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modeName</span><span class="p">),</span>
                <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;commandName&#39;</span><span class="p">),</span><span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ShortcutInfo</span><span class="p">)</span>

            <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                    <span class="n">name</span><span class="p">,</span><span class="n">si</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseShortcutLine</span><span class="p">(</span><span class="s">&#39;*mode-setting*&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isShortcutInfo</span><span class="p">(</span><span class="n">si</span><span class="p">),</span><span class="n">si</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
                        <span class="c"># An entry command: put it in the special *entry-commands* key.</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;*entry-commands*&#39;</span><span class="p">,</span><span class="n">si</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">si</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c"># A regular shortcut.</span>
                        <span class="n">si</span><span class="o">.</span><span class="n">pane</span> <span class="o">=</span> <span class="n">modeName</span>
                        <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[])</span>
                        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isShortcutInfo</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">z</span>
                        <span class="c"># Important: use previous bindings if possible.</span>
                        <span class="n">key2</span><span class="p">,</span><span class="n">aList2</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getShortcut</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList2</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isShortcutInfo</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">z</span>
                        <span class="n">aList3</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList2</span> <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">pane</span> <span class="o">!=</span> <span class="n">modeName</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">aList3</span><span class="p">:</span>
                            <span class="c"># g.trace(&#39;inheriting&#39;,[b.val for b in aList3])</span>
                            <span class="n">aList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">aList3</span><span class="p">)</span>
                        <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">aList</span><span class="p">)</span>

                        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#### Why would we want to do this????</span>
                            <span class="c">#### Old code: we have to save/restore self.shortcutsDict.</span>
                                <span class="c">#### self.set(p,&quot;shortcut&quot;,name,aList)</span>
                            <span class="c"># Set the entry directly.</span>
                            <span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span>
                            <span class="n">gs</span> <span class="o">=</span> <span class="n">d2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">gs</span><span class="p">:</span>
                                <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isGeneralSetting</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
                                <span class="n">path</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">path</span>
                                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">)</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;over-riding setting:&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="s">&quot;from&quot;</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>

                            <span class="c"># Important: we can&#39;t use c here: it may be destroyed!</span>
                            <span class="n">d2</span> <span class="p">[</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">(</span>
                                <span class="n">kind</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;setting&#39;</span><span class="p">)</span>

                <span class="c"># Restore the global shortcutsDict.</span>
                <span class="c">##### self.shortcutsDict = old_d</span>

                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span>

                <span class="c"># Create the command, but not any bindings to it.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createModeCommand</span><span class="p">(</span><span class="n">modeName</span><span class="p">,</span><span class="n">name1</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20070411101643.1: *4* doOpenWith (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.doOpenWith"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doOpenWith">[docs]</a>    <span class="k">def</span> <span class="nf">doOpenWith</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="c"># g.trace(self.c.shortFileName(),&#39;kind&#39;,kind,&#39;name&#39;,name,&#39;val&#39;,val)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseOpenWith</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">name</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;shortcut&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>
        <span class="c"># g.trace(&#39;command&#39;,d.get(&#39;command&#39;))</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;openwithtable&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openWithList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">openWithList</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120104215.2: *4* doPage</span></div>
<div class="viewcode-block" id="ParserBaseClass.doPage"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doPage">[docs]</a>    <span class="k">def</span> <span class="nf">doPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">pass</span> <span class="c"># Ignore @page this while parsing settings.</span>
    <span class="c">#@+node:bobjack.20080324141020.4: *4* doPopup &amp; helper</span></div>
<div class="viewcode-block" id="ParserBaseClass.doPopup"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doPopup">[docs]</a>    <span class="k">def</span> <span class="nf">doPopup</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle @popup menu items in @settings trees.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">popupName</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c"># popupType = val</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doPopupItems</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">aList</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s">&#39;context_menus&#39;</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">context_menus</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">context_menus</span><span class="p">[</span><span class="n">popupName</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>
    <span class="c">#@+node:bobjack.20080324141020.5: *5* doPopupItems</span></div>
<div class="viewcode-block" id="ParserBaseClass.doPopupItems"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doPopupItems">[docs]</a>    <span class="k">def</span> <span class="nf">doPopupItems</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">aList</span><span class="p">):</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="p">;</span> <span class="n">after</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">nodeAfterTree</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">after</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;@menu&#39;</span><span class="p">,</span><span class="s">&#39;@item&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>
                    <span class="n">itemName</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">itemName</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;@menu&#39;</span><span class="p">:</span>
                            <span class="n">aList2</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">itemName</span>
                            <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">doPopupItems</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">aList2</span><span class="p">)</span>
                            <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kind</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="p">,</span> <span class="n">aList2</span><span class="p">),)</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">kind</span> <span class="o">=</span> <span class="n">tag</span>
                            <span class="n">head</span> <span class="o">=</span> <span class="n">itemName</span>
                            <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
                            <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">head</span><span class="p">,</span><span class="n">body</span><span class="p">),)</span>
                            <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
                            <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># g.trace(&#39;***skipping***&#39;,p.h)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20041121125741: *4* doRatio</span></div>
<div class="viewcode-block" id="ParserBaseClass.doRatio"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doRatio">[docs]</a>    <span class="k">def</span> <span class="nf">doRatio</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120105609: *4* doShortcuts (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.doShortcuts"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doShortcuts">[docs]</a>    <span class="k">def</span> <span class="nf">doShortcuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">junk_name</span><span class="p">,</span><span class="n">junk_val</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle an @shortcut or @shortcuts node.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                <span class="n">commandName</span><span class="p">,</span><span class="n">si</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseShortcutLine</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isShortcutInfo</span><span class="p">(</span><span class="n">si</span><span class="p">),</span><span class="n">si</span>
                <span class="k">if</span> <span class="n">si</span> <span class="ow">and</span> <span class="n">si</span><span class="o">.</span><span class="n">stroke</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">doOneShortcut</span><span class="p">(</span><span class="n">si</span><span class="p">,</span><span class="n">commandName</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111020144401.9585: *5* doOneShortcut (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.doOneShortcut"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doOneShortcut">[docs]</a>    <span class="k">def</span> <span class="nf">doOneShortcut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">si</span><span class="p">,</span><span class="n">commandName</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle a regular shortcut.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">commandName</span><span class="p">,[])</span>
        <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
        <span class="n">d</span> <span class="p">[</span><span class="n">commandName</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">commandName</span><span class="p">,</span><span class="n">si</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041217132028: *4* doString</span></div>
<div class="viewcode-block" id="ParserBaseClass.doString"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doString">[docs]</a>    <span class="k">def</span> <span class="nf">doString</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="c"># At present no checking is done.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041120094940.8: *4* doStrings</span></div>
<div class="viewcode-block" id="ParserBaseClass.doStrings"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.doStrings">[docs]</a>    <span class="k">def</span> <span class="nf">doStrings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;We expect one of the following:</span>
<span class="sd">        @strings aName[val1,val2...]=val</span>
<span class="sd">        @strings [val1,val2,...]aName=val&#39;&#39;&#39;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">name</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="s">&quot;strings[</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
            <span class="c"># g.trace(repr(kind),repr(name),val)</span>

            <span class="c"># At present no checking is done.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041124063257: *3* munge (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.munge"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.munge">[docs]</a>    <span class="k">def</span> <span class="nf">munge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">canonicalizeSettingName</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041119204700.2: *3* oops (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.oops"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.oops">[docs]</a>    <span class="k">def</span> <span class="nf">oops</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;ParserBaseClass oops:&quot;</span><span class="p">,</span>
            <span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(),</span>
            <span class="s">&quot;must be overridden in subclass&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041213082558: *3* parsers (ParserBaseClass)</span>
    <span class="c">#@+node:ekr.20041213083651: *4* fontSettingNameToFontKind</span></div>
<div class="viewcode-block" id="ParserBaseClass.fontSettingNameToFontKind"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.fontSettingNameToFontKind">[docs]</a>    <span class="k">def</span> <span class="nf">fontSettingNameToFontKind</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;_family&#39;</span><span class="p">,</span><span class="s">&#39;_size&#39;</span><span class="p">,</span><span class="s">&#39;_slant&#39;</span><span class="p">,</span><span class="s">&#39;_weight&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20041213082558.1: *4* parseFont &amp; helper</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseFont"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseFont">[docs]</a>    <span class="k">def</span> <span class="nf">parseFont</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;comments&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">&#39;family&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;slant&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;weight&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">b</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseFontLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

        <span class="n">comments</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;comments&#39;</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>
    <span class="c">#@+node:ekr.20041213082558.2: *5* parseFontLine</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseFontLine"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseFontLine">[docs]</a>    <span class="k">def</span> <span class="nf">parseFontLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;comments&#39;</span><span class="p">)</span>
            <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comments</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># name is everything up to &#39;=&#39;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">s</span> <span class="p">;</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span>

            <span class="n">fontKind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontSettingNameToFontKind</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fontKind</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">fontKind</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="c"># Used only by doFont.</span>
    <span class="c">#@+node:ekr.20041119205148: *4* parseHeadline</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseHeadline"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseHeadline">[docs]</a>    <span class="k">def</span> <span class="nf">parseHeadline</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Parse a headline of the form @kind:name=val</span>
<span class="sd">        Return (kind,name,val).&quot;&quot;&quot;</span>

        <span class="n">kind</span> <span class="o">=</span> <span class="n">name</span> <span class="o">=</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;@&#39;</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">chars</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">kind</span><span class="p">:</span>
                <span class="c"># name is everything up to &#39;=&#39;</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c"># val is everything after the &#39;=&#39;</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># g.trace(&quot;%50s %10s %s&quot; %(name,kind,val))</span>
        <span class="k">return</span> <span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span>
    <span class="c">#@+node:ekr.20070411101643.2: *4* parseOpenWith &amp; helper</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseOpenWith"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseOpenWith">[docs]</a>    <span class="k">def</span> <span class="nf">parseOpenWith</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;command&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
            <span class="c"># Old: command is a tuple.</span>
            <span class="c"># New: d contains args, kind, etc tags.</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseOpenWithLine</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>
    <span class="c">#@+node:ekr.20070411101643.4: *5* parseOpenWithLine</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseOpenWithLine"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseOpenWithLine">[docs]</a>    <span class="k">def</span> <span class="nf">parseOpenWithLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c"># try:</span>
            <span class="c"># s = str(s)</span>
        <span class="c"># except UnicodeError:</span>
            <span class="c"># pass</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># new code</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_c_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;@openwith lines must start with a tag: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;:&#39;</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;colon must follow @openwith tag: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
                <span class="c"># An empty val is valid.</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;arg&#39;</span><span class="p">:</span>
                <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;args&#39;</span><span class="p">,[])</span>
                <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>
            <span class="k">elif</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;ignoring duplicate definition of </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20041120112043: *4* parseShortcutLine (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseShortcutLine"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseShortcutLine">[docs]</a>    <span class="k">def</span> <span class="nf">parseShortcutLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Parse a shortcut line.  Valid forms:</span>

<span class="sd">        --&gt; entry-command</span>
<span class="sd">        settingName = shortcut</span>
<span class="sd">        settingName ! paneName = shortcut</span>
<span class="sd">        command-name --&gt; mode-name = binding</span>
<span class="sd">        command-name --&gt; same = binding</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span> <span class="ow">and</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;*mode-setting*&#39;</span>
        <span class="n">c</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="k">assert</span> <span class="n">c</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">val</span> <span class="o">=</span> <span class="n">nextMode</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">;</span> <span class="n">nextMode</span> <span class="o">=</span> <span class="s">&#39;none&#39;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;--&gt;&#39;</span><span class="p">):</span> <span class="c"># New in 4.4.1 b1: allow mode-entry commands.</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">entryCommandName</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;--&gt;&#39;</span><span class="p">,</span><span class="n">entryCommandName</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">ShortcutInfo</span><span class="p">(</span><span class="s">&#39;*entry-command*&#39;</span><span class="p">,</span><span class="n">commandName</span><span class="o">=</span><span class="n">entryCommandName</span><span class="p">)</span>

        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="c"># New in 4.4: allow Emacs-style shortcut names.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no name&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

        <span class="c"># New in Leo 4.4b2.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;-&gt;&#39;</span><span class="p">):</span> <span class="c"># New in 4.4: allow pane-specific shortcuts.</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="n">nextMode</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;!&#39;</span><span class="p">):</span> <span class="c"># New in 4.4: allow pane-specific shortcuts.</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="n">pane</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pane</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="n">pane</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">pane</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>

        <span class="c"># New in 4.4: Allow comments after the shortcut.</span>
        <span class="c"># Comments must be preceded by whitespace.</span>
        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">stroke</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">strokeFromSetting</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isStrokeOrNone</span><span class="p">(</span><span class="n">stroke</span><span class="p">),</span><span class="n">stroke</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ShortcutInfo</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="n">nextMode</span><span class="o">=</span><span class="n">nextMode</span><span class="p">,</span><span class="n">pane</span><span class="o">=</span><span class="n">pane</span><span class="p">,</span><span class="n">stroke</span><span class="o">=</span><span class="n">stroke</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%25s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">si</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">,</span><span class="n">si</span>
    <span class="c">#@+node:ekr.20060608222828: *4* parseAbbrevLine (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.parseAbbrevLine"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.parseAbbrevLine">[docs]</a>    <span class="k">def</span> <span class="nf">parseAbbrevLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Parse an abbreviation line:</span>
<span class="sd">        command-name = abbreviation</span>
<span class="sd">        return (command-name,abbreviation)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_id</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="c"># New in 4.4: allow Emacs-style shortcut names.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;=&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">skip_ws</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c"># Ignore comments after the shortcut.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">val</span><span class="p">:</span> <span class="k">return</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>   <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20041120094940.9: *3* set (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.set"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Init the setting for name to val.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Note: when kind is &#39;shortcut&#39;, name is a command name.</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># if kind and kind.startswith(&#39;setting&#39;): g.trace(&quot;settingsParser %10s %15s %s&quot; %(kind,val,name))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">),</span><span class="n">gs</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">path</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">)</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;over-riding setting:&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="s">&quot;from&quot;</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>

        <span class="c"># Important: we can&#39;t use c here: it may be destroyed!</span>
        <span class="n">d</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;setting&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041119204700.1: *3* traverse (ParserBaseClass)</span></div>
<div class="viewcode-block" id="ParserBaseClass.traverse"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.traverse">[docs]</a>    <span class="k">def</span> <span class="nf">traverse</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span><span class="p">,</span><span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDict</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39;settingsDict for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()),</span>
            <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;settingName&#39;</span><span class="p">),</span><span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDictOfLists</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39;shortcutsDict for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()),</span>
            <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">),</span> <span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">ShortcutInfo</span><span class="p">)</span>

        <span class="c"># This must be called after the outline has been inited.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settingsRoot</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="c"># c.rootPosition() doesn&#39;t exist yet.</span>
            <span class="c"># This is not an error.</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;****************&#39;</span>
                    <span class="s">&#39;ParserBaseClass.traverse: no settings tree for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>

        <span class="n">after</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">nodeAfterTree</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">after</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visitNode</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s">&quot;skip&quot;</span><span class="p">:</span>
                <span class="c"># g.warning(&#39;skipping settings in&#39;,p.h)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToNodeAfterTree</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">moveToThreadNext</span><span class="p">()</span>

        <span class="c"># Return the raw dict, unmerged.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>
    <span class="c">#@+node:ekr.20041120094940.10: *3* valueError</span></div>
<div class="viewcode-block" id="ParserBaseClass.valueError"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.valueError">[docs]</a>    <span class="k">def</span> <span class="nf">valueError</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Give an error: val is not valid for kind.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not a valid </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20041119204700.3: *3* visitNode (must be overwritten in subclasses)</span></div>
<div class="viewcode-block" id="ParserBaseClass.visitNode"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.ParserBaseClass.visitNode">[docs]</a>    <span class="k">def</span> <span class="nf">visitNode</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">oops</span><span class="p">()</span>
    <span class="c">#@-others</span>
<span class="c">#@-&lt;&lt; class ParserBaseClass &gt;&gt;</span>

<span class="c">#@+others</span>
<span class="c">#@+node:ekr.20041119203941: ** class GlobalConfigManager</span></div></div>
<div class="viewcode-block" id="GlobalConfigManager"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager">[docs]</a><span class="k">class</span> <span class="nc">GlobalConfigManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class to manage configuration settings.&quot;&quot;&quot;</span>

    <span class="c">#@+&lt;&lt; GlobalConfigManager class data &gt;&gt;</span>
    <span class="c">#@+node:ekr.20041122094813: *3* &lt;&lt; GlobalConfigManager class data &gt;&gt;</span>
    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20041117062717.1: *4* defaultsDict (GCM class data)</span>
    <span class="c">#@+at This contains only the &quot;interesting&quot; defaults.</span>
    <span class="c"># Ints and bools default to 0, floats to 0.0 and strings to &quot;&quot;.</span>
    <span class="c">#@@c</span>

    <span class="n">defaultBodyFontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&quot;win32&quot;</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">defaultLogFontSize</span>  <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&quot;win32&quot;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">defaultMenuFontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&quot;win32&quot;</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">defaultTreeFontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s">&quot;win32&quot;</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">defaultsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s">&#39;g.app.config.defaultsDict&#39;</span><span class="p">,</span>
        <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">),</span><span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">)</span>

    <span class="n">defaultsData</span> <span class="o">=</span> <span class="p">(</span>
        <span class="c"># compare options...</span>
        <span class="p">(</span><span class="s">&quot;ignore_blank_lines&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;limit_count&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;print_mismatching_lines&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;print_trailing_lines&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="c"># find/change options...</span>
        <span class="p">(</span><span class="s">&quot;search_body&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;whole_word&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="c"># Prefs panel.</span>
        <span class="c"># (&quot;default_target_language&quot;,&quot;language&quot;,&quot;python&quot;),</span>
        <span class="p">(</span><span class="s">&quot;target_language&quot;</span><span class="p">,</span><span class="s">&quot;language&quot;</span><span class="p">,</span><span class="s">&quot;python&quot;</span><span class="p">),</span> <span class="c"># Bug fix: 6/20,2005.</span>
        <span class="p">(</span><span class="s">&quot;tab_width&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;page_width&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">132</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;output_doc_chunks&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;tangle_outputs_header&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="c"># Syntax coloring options...</span>
        <span class="c"># Defaults for colors are handled by leoColor.py.</span>
        <span class="p">(</span><span class="s">&quot;color_directives_in_plain_text&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;underline_undefined_section_names&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="c"># Window options...</span>
        <span class="p">(</span><span class="s">&quot;allow_clone_drags&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;body_pane_wraps&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;body_text_font_family&quot;</span><span class="p">,</span><span class="s">&quot;family&quot;</span><span class="p">,</span><span class="s">&quot;Courier&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;body_text_font_size&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="n">defaultBodyFontSize</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;body_text_font_slant&quot;</span><span class="p">,</span><span class="s">&quot;slant&quot;</span><span class="p">,</span><span class="s">&quot;roman&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;body_text_font_weight&quot;</span><span class="p">,</span><span class="s">&quot;weight&quot;</span><span class="p">,</span><span class="s">&quot;normal&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;enable_drag_messages&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;headline_text_font_family&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;headline_text_font_size&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="n">defaultLogFontSize</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;headline_text_font_slant&quot;</span><span class="p">,</span><span class="s">&quot;slant&quot;</span><span class="p">,</span><span class="s">&quot;roman&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;headline_text_font_weight&quot;</span><span class="p">,</span><span class="s">&quot;weight&quot;</span><span class="p">,</span><span class="s">&quot;normal&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;log_text_font_family&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;log_text_font_size&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="n">defaultLogFontSize</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;log_text_font_slant&quot;</span><span class="p">,</span><span class="s">&quot;slant&quot;</span><span class="p">,</span><span class="s">&quot;roman&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;log_text_font_weight&quot;</span><span class="p">,</span><span class="s">&quot;weight&quot;</span><span class="p">,</span><span class="s">&quot;normal&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_window_height&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">600</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_window_width&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">800</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_window_left&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_window_top&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_splitter_orientation&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;vertical&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_vertical_ratio&quot;</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_horizontal_ratio&quot;</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">,</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_horizontal_secondary_ratio&quot;</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;initial_vertical_secondary_ratio&quot;</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span>
        <span class="c"># (&quot;outline_pane_scrolls_horizontally&quot;,&quot;bool&quot;,False),</span>
        <span class="p">(</span><span class="s">&quot;split_bar_color&quot;</span><span class="p">,</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="s">&quot;LightSteelBlue2&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;split_bar_relief&quot;</span><span class="p">,</span><span class="s">&quot;relief&quot;</span><span class="p">,</span><span class="s">&quot;groove&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;split_bar_width&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c">#@+node:ekr.20041118062709: *4* define encodingIvarsDict (GCM class data)</span>
    <span class="n">encodingIvarsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s">&#39;g.app.config.encodingIvarsDict&#39;</span><span class="p">,</span>
        <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">),</span><span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">)</span>

    <span class="n">encodingIvarsData</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">&quot;default_at_auto_file_encoding&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;default_derived_file_encoding&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;new_leo_file_encoding&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;UTF-8&quot;</span><span class="p">),</span>
            <span class="c"># Upper case for compatibility with previous versions.</span>
        <span class="p">(</span><span class="s">&quot;defaultEncoding&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
            <span class="c"># Defaults to None so it doesn&#39;t override better defaults.</span>
    <span class="p">)</span>
    <span class="c">#@+node:ekr.20041117072055: *4* ivarsDict (GCM class data)</span>
    <span class="c"># Each of these settings sets the corresponding ivar.</span>
    <span class="c"># Also, the LocalConfigManager class inits the corresponding commander ivar.</span>

    <span class="n">ivarsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s">&#39;g.app.config.ivarsDict&#39;</span><span class="p">,</span>
        <span class="n">keyType</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">),</span><span class="n">valType</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">)</span>

    <span class="n">ivarsData</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">&quot;at_root_bodies_start_in_doc_mode&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
            <span class="c"># For compatibility with previous versions.</span>
        <span class="p">(</span><span class="s">&quot;create_nonexistent_directories&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;output_initial_comment&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">),</span>
            <span class="c"># &quot;&quot; for compatibility with previous versions.</span>
        <span class="p">(</span><span class="s">&quot;output_newline&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;nl&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;page_width&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="s">&quot;132&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;read_only&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
            <span class="c"># Make sure we don&#39;t alter an illegal leoConfig.txt file!</span>
        <span class="p">(</span><span class="s">&quot;redirect_execute_script_output_to_log_pane&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;relative_path_base_directory&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;!&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;remove_sentinels_extension&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;.txt&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;save_clears_undo_buffer&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;stylesheet&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;tab_width&quot;</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;target_language&quot;</span><span class="p">,</span><span class="s">&quot;language&quot;</span><span class="p">,</span><span class="s">&quot;python&quot;</span><span class="p">),</span>
            <span class="c"># Bug fix: added: 6/20/2005.</span>
        <span class="p">(</span><span class="s">&quot;trailing_body_newlines&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;asis&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;use_plugins&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),</span>
            <span class="c"># New in 4.3: use_plugins = True by default.</span>
        <span class="c"># (&quot;use_psyco&quot;,&quot;bool&quot;,False),</span>
            <span class="c"># use_pysco can not be set by config code:</span>
            <span class="c"># config processing happens too late.</span>
        <span class="p">(</span><span class="s">&quot;undo_granularity&quot;</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;word&quot;</span><span class="p">),</span>
            <span class="c"># &quot;char&quot;,&quot;word&quot;,&quot;line&quot;,&quot;node&quot;</span>
        <span class="p">(</span><span class="s">&quot;write_strips_blank_lines&quot;</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c">#@-others</span>
    <span class="c">#@-&lt;&lt; GlobalConfigManager class data &gt;&gt;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20041117083202: *3* gcm.Birth...</span>
    <span class="c">#@+node:ekr.20041117062717.2: *4* gcm.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">trace_startup</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;g.app.config.__init__&#39;</span><span class="p">)</span>

        <span class="c"># Set later.  To keep pylint happy.</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># No longer needed, now that setIvarsFromSettings always sets gcm ivars.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">at_root_bodies_start_in_doc_mode</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_derived_file_encoding</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_newline</span> <span class="o">=</span> <span class="s">&#39;nl&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect_execute_script_output_to_log_pane</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relative_path_base_directory</span> <span class="o">=</span> <span class="s">&#39;!&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_plugins</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Required to keep pylint happy.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_nonexistent_directories</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Required to keep pylint happy.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atCommonButtonsList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># List of info for common @buttons nodes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atCommonCommandsList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># List of info for common @commands nodes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atLocalButtonsList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># List of positions of @button nodes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atLocalCommandsList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># List of positions of @command nodes.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFileName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configsExist</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True when we successfully open a setting file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitTestDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># For unit testing: *not* the same as g.app.unitTestDict.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultFont</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Set in gui.getDefaultConfigFont.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultFontFamily</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Set in gui.getDefaultConfigFont.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabledPluginsFileName</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabledPluginsString</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">inited</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menusList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menusFileName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">new_modes</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># Use k.ModeController instead.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modeCommandsDict</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDict</span><span class="p">(</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;modeCommandsDict&#39;</span><span class="p">,</span>
                <span class="n">keyType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;commandName&#39;</span><span class="p">),</span><span class="n">valType</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">TypedDictOfLists</span><span class="p">)</span>

        <span class="c"># Inited later...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panes</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initDicts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initIvarsFromSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initRecentFiles</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20041227063801.2: *4* gcm.initDicts</span>
<div class="viewcode-block" id="GlobalConfigManager.initDicts"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.initDicts">[docs]</a>    <span class="k">def</span> <span class="nf">initDicts</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Only the settings parser needs to search all dicts.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultsDict</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultsData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultsDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">(</span>
                <span class="n">kind</span><span class="p">,</span><span class="n">setting</span><span class="o">=</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;defaults&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ivarsData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ivarsDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">(</span>
                <span class="n">kind</span><span class="p">,</span><span class="n">ivar</span><span class="o">=</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;ivars&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">encodingIvarsData</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encodingIvarsDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">(</span>
                <span class="n">kind</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">ivar</span><span class="o">=</span><span class="n">key</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;encoding&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041117065611.2: *4* gcm.initIvarsFromSettings &amp; helpers</span></div>
<div class="viewcode-block" id="GlobalConfigManager.initIvarsFromSettings"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.initIvarsFromSettings">[docs]</a>    <span class="k">def</span> <span class="nf">initIvarsFromSettings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encodingIvarsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initEncoding</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ivarsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initIvar</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041117065611.1: *5* initEncoding</span></div>
<div class="viewcode-block" id="GlobalConfigManager.initEncoding"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.initEncoding">[docs]</a>    <span class="k">def</span> <span class="nf">initEncoding</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Init g.app.config encoding ivars during initialization.&#39;&#39;&#39;</span>

        <span class="c"># Important: The key is munged.</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encodingIvarsDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">ivar</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>

        <span class="c"># g.trace(gs.ivar,gs.encoding)</span>

        <span class="k">if</span> <span class="n">gs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">isValidEncoding</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">encoding</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;g.app.config: bad encoding:&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">ivar</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20041117065611: *5* initIvar</span></div>
<div class="viewcode-block" id="GlobalConfigManager.initIvar"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.initIvar">[docs]</a>    <span class="k">def</span> <span class="nf">initIvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Init g.app.config ivars during initialization.</span>

<span class="sd">        This does NOT init the corresponding commander ivars.</span>

<span class="sd">        Such initing must be done in setIvarsFromSettings.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span> <span class="c"># and key == &#39;outputnewline&#39;</span>

        <span class="c"># Important: the key is munged.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ivarsDict</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;g.app.config&#39;</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">ivar</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
            <span class="c"># print(&#39;initIvar&#39;,self,gs.ivar,gs.val)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">ivar</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041117083202.2: *4* gcm.initRecentFiles</span></div>
<div class="viewcode-block" id="GlobalConfigManager.initRecentFiles"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.initRecentFiles">[docs]</a>    <span class="k">def</span> <span class="nf">initRecentFiles</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#@+node:ekr.20041228042224: *4* gcm.setIvarsFromSettings</span></div>
<div class="viewcode-block" id="GlobalConfigManager.setIvarsFromSettings"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.setIvarsFromSettings">[docs]</a>    <span class="k">def</span> <span class="nf">setIvarsFromSettings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Init g.app.config ivars or c&#39;s ivars from settings.</span>

<span class="sd">        - Called from readSettingsFiles with c = None to init g.app.config ivars.</span>
<span class="sd">        - Called from c.__init__ to init corresponding commmander ivars.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">inited</span><span class="p">:</span> <span class="k">return</span>

        <span class="c"># Ignore temporary commanders created by readSettingsFiles.</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
            <span class="s">&#39;inited&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">inited</span><span class="p">,</span><span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;&lt;no c&gt;&#39;</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ivarsDict</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gs</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">)</span>
                <span class="n">ivar</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">ivar</span> <span class="c"># The actual name of the ivar.</span>
                <span class="n">kind</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">kind</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span> <span class="c"># Don&#39;t use bunch.val!</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%20s</span><span class="s"> </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">),</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">True</span><span class="p">:</span> <span class="c"># Always set the global ivars.</span>
                    <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%20s</span><span class="s"> </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">&#39;g.app.config&#39;</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041117081009: *3* gcm.Getters...</span>
    <span class="c">#@+node:ekr.20041123070429: *4* gcm.canonicalizeSettingName (munge)</span></div>
<div class="viewcode-block" id="GlobalConfigManager.canonicalizeSettingName"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.canonicalizeSettingName">[docs]</a>    <span class="k">def</span> <span class="nf">canonicalizeSettingName</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
</div>
    <span class="n">munge</span> <span class="o">=</span> <span class="n">canonicalizeSettingName</span>
    <span class="c">#@+node:ekr.20051011105014: *4* gcm.exists</span>
<div class="viewcode-block" id="GlobalConfigManager.exists"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return true if a setting of the given kind exists, even if it is None.&#39;&#39;&#39;</span>

        <span class="n">lm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadManager</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">globalSettingsDict</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">junk</span><span class="p">,</span><span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValFromDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">found</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20041117083141: *4* gcm.get &amp; allies</span></div>
<div class="viewcode-block" id="GlobalConfigManager.get"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get the setting and make sure its type matches the expected type.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">lm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadManager</span>

        <span class="c"># It *is* valid to call this method: it returns the global settings.</span>
        <span class="c"># if c:</span>
            <span class="c"># print(&#39;g.app.config.get ***** call c.config.getX when c is available&#39;)</span>
            <span class="c"># print(&#39;g.app.config.get&#39;,setting,kind,g.callers())</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">globalSettingsDict</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDict</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="n">d</span>
            <span class="n">val</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValFromDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;g.app.config.get </span><span class="si">%30s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;g.app.config.get </span><span class="si">%30s</span><span class="s"> **no d, returning None&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">setting</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20041121143823: *5* gcm.getValFromDict</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getValFromDict"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getValFromDict">[docs]</a>    <span class="k">def</span> <span class="nf">getValFromDict</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">requestedType</span><span class="p">,</span><span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Look up the setting in d. If warn is True, warn if the requested type</span>
<span class="sd">        does not (loosely) match the actual type.</span>
<span class="sd">        returns (val,exists)&#39;&#39;&#39;</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">setting</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gs</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">False</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">)</span>

        <span class="c"># g.trace(setting,requestedType,gs.toString())</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">val</span>

        <span class="c"># 2011/10/24: test for an explicit None.</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">isPython3</span><span class="p">:</span>
            <span class="n">isNone</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c"># ,None)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isNone</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">),</span><span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">),</span><span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
                <span class="s">&#39;None&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c">#,None)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">typesMatch</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span><span class="n">requestedType</span><span class="p">):</span>
            <span class="c"># New in 4.4: make sure the types match.</span>
            <span class="c"># A serious warning: one setting may have destroyed another!</span>
            <span class="c"># Important: this is not a complete test of conflicting settings:</span>
            <span class="c"># The warning is given only if the code tries to access the setting.</span>
            <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;warning: ignoring&#39;</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="s">&#39;is not&#39;</span><span class="p">,</span><span class="n">requestedType</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;there may be conflicting settings!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span>
        <span class="c"># elif val in (u&#39;None&#39;,u&#39;none&#39;,&#39;None&#39;,&#39;none&#39;,&#39;&#39;,None):</span>
        <span class="k">elif</span> <span class="n">isNone</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">True</span>
                <span class="c"># 2011/10/24: Exists, a *user-defined* empty value.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># g.trace(setting,val)</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20051015093141: *5* gcm.typesMatch</span></div>
<div class="viewcode-block" id="GlobalConfigManager.typesMatch"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.typesMatch">[docs]</a>    <span class="k">def</span> <span class="nf">typesMatch</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">type1</span><span class="p">,</span><span class="n">type2</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if type1, the actual type, matches type2, the requeseted type.</span>

<span class="sd">        The following equivalences are allowed:</span>

<span class="sd">        - None matches anything.</span>
<span class="sd">        - An actual type of string or strings matches anything *except* shortcuts.</span>
<span class="sd">        - Shortcut matches shortcuts.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># The shortcuts logic no longer uses the get/set code.</span>
        <span class="n">shortcuts</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span><span class="s">&#39;shortcuts&#39;</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">type1</span> <span class="ow">in</span> <span class="n">shortcuts</span> <span class="ow">or</span> <span class="n">type2</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: type in shortcuts&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">type1</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">type2</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span>
            <span class="n">type1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;string&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">type2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shortcuts</span> <span class="ow">or</span>
            <span class="n">type1</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span> <span class="ow">and</span> <span class="n">type2</span> <span class="o">==</span> <span class="s">&#39;size&#39;</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">type1</span> <span class="ow">in</span> <span class="n">shortcuts</span> <span class="ow">and</span> <span class="n">type2</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">type1</span> <span class="o">==</span> <span class="n">type2</span>
        <span class="p">)</span>
    <span class="c">#@+node:ekr.20060608224112: *4* gcm.getAbbrevDict</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getAbbrevDict"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getAbbrevDict">[docs]</a>    <span class="k">def</span> <span class="nf">getAbbrevDict</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Search all dictionaries for the setting &amp; check it&#39;s type&quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;abbrev&#39;</span><span class="p">,</span><span class="s">&#39;abbrev&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c">#@+node:ekr.20041117081009.3: *4* gcm.getBool</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getBool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getBool">[docs]</a>    <span class="k">def</span> <span class="nf">getBool</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @bool setting, or the default if the setting is not found.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
    <span class="c">#@+node:ekr.20070926082018: *4* gcm.getButtons</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getButtons"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getButtons">[docs]</a>    <span class="k">def</span> <span class="nf">getButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of tuples (x,y) for common @button nodes.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atCommonButtonsList</span>
    <span class="c">#@+node:ekr.20041122070339: *4* gcm.getColor</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getColor"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getColor">[docs]</a>    <span class="k">def</span> <span class="nf">getColor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @color setting.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;color&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20080312071248.7: *4* gcm.getCommonCommands</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getCommonAtCommands"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getCommonAtCommands">[docs]</a>    <span class="k">def</span> <span class="nf">getCommonAtCommands</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the list of tuples (headline,script) for common @command nodes.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atCommonCommandsList</span>
    <span class="c">#@+node:ekr.20071214140900.1: *4* gcm.getData</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getData"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of non-comment strings in the body text of @data setting.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041117093009.1: *4* gcm.getDirectory</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getDirectory"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getDirectory">[docs]</a>    <span class="k">def</span> <span class="nf">getDirectory</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @directory setting, or None if the directory does not exist.&#39;&#39;&#39;</span>

        <span class="n">theDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">theDir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_isdir</span><span class="p">(</span><span class="n">theDir</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">theDir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20070224075914.1: *4* gcm.getEnabledPlugins</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getEnabledPlugins"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getEnabledPlugins">[docs]</a>    <span class="k">def</span> <span class="nf">getEnabledPlugins</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the body text of the @enabled-plugins node.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabledPluginsString</span>
    <span class="c">#@+node:ekr.20041117082135: *4* gcm.getFloat</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getFloat"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getFloat">[docs]</a>    <span class="k">def</span> <span class="nf">getFloat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @float setting.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20041117062717.13: *4* gcm.getFontFromParams</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getFontFromParams"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getFontFromParams">[docs]</a>    <span class="k">def</span> <span class="nf">getFontFromParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="n">defaultSize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Compute a font from font parameters.</span>

<span class="sd">        Arguments are the names of settings to be use.</span>
<span class="sd">        Default to size=12, slant=&quot;roman&quot;, weight=&quot;normal&quot;.</span>

<span class="sd">        Return None if there is no family setting so we can use system default fonts.&quot;&quot;&quot;</span>

        <span class="n">family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">family</span><span class="p">,</span><span class="s">&quot;family&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">family</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="n">family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFontFamily</span>

        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="n">size</span> <span class="o">=</span> <span class="n">defaultSize</span>

        <span class="n">slant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slant</span><span class="p">,</span><span class="s">&quot;slant&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slant</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">):</span> <span class="n">slant</span> <span class="o">=</span> <span class="s">&quot;roman&quot;</span>

        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span><span class="s">&quot;weight&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">):</span> <span class="n">weight</span> <span class="o">=</span> <span class="s">&quot;normal&quot;</span>

        <span class="c"># g.trace(g.callers(3),family,size,slant,weight)</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041117081513: *4* gcm.getInt</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getInt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getInt">[docs]</a>    <span class="k">def</span> <span class="nf">getInt</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @int setting.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20041117093009.2: *4* gcm.getLanguage</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getLanguage"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getLanguage">[docs]</a>    <span class="k">def</span> <span class="nf">getLanguage</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the setting whose value should be a language known to Leo.&#39;&#39;&#39;</span>

        <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">language</span>
    <span class="c">#@+node:ekr.20070926070412: *4* gcm.getMenusList</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getMenusList"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getMenusList">[docs]</a>    <span class="k">def</span> <span class="nf">getMenusList</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the list of entries for the @menus tree.&#39;&#39;&#39;</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;menus&#39;</span><span class="p">,</span><span class="s">&#39;menus&#39;</span><span class="p">)</span>
        <span class="c"># g.trace(aList and len(aList) or 0)</span>

        <span class="k">return</span> <span class="n">aList</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span>
    <span class="c">#@+node:ekr.20070411101643: *4* gcm.getOpenWith</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getOpenWith"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getOpenWith">[docs]</a>    <span class="k">def</span> <span class="nf">getOpenWith</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of dictionaries corresponding to @openwith nodes.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;openwithtable&#39;</span><span class="p">,</span><span class="s">&#39;openwithtable&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val</span>
    <span class="c">#@+node:ekr.20041122070752: *4* gcm.getRatio</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getRatio"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getRatio">[docs]</a>    <span class="k">def</span> <span class="nf">getRatio</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @float setting.</span>

<span class="sd">        Warn if the value is less than 0.0 or greater than 1.0.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20041117062717.11: *4* gcm.getRecentFiles</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getRecentFiles"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getRecentFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getRecentFiles</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the list of recently opened files.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recentFiles</span>
    <span class="c">#@+node:ekr.20041117081009.4: *4* gcm.getString</span></div>
<div class="viewcode-block" id="GlobalConfigManager.getString"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.getString">[docs]</a>    <span class="k">def</span> <span class="nf">getString</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @string setting.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120222103014.10314: *3* gcm.config_iter</span></div>
<div class="viewcode-block" id="GlobalConfigManager.config_iter"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.GlobalConfigManager.config_iter">[docs]</a>    <span class="k">def</span> <span class="nf">config_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Letters:</span>
<span class="sd">          leoSettings.leo</span>
<span class="sd">        D default settings</span>
<span class="sd">        F loaded .leo File</span>
<span class="sd">        M myLeoSettings.leo</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadManager</span>
        <span class="n">suppressKind</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span><span class="s">&#39;shortcuts&#39;</span><span class="p">,</span><span class="s">&#39;openwithtable&#39;</span><span class="p">)</span>
        <span class="n">suppressKeys</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;shortcut&#39;</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settingsDict</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">lm</span><span class="o">.</span><span class="n">globalSettingsDict</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suppressKeys</span><span class="p">:</span>
                <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isGeneralSetting</span><span class="p">(</span><span class="n">gs</span><span class="p">),</span><span class="n">gs</span>
                <span class="k">if</span> <span class="n">gs</span> <span class="ow">and</span> <span class="n">gs</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suppressKind</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">computeBindingLetter</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                    <span class="c"># g.trace(&#39;%3s %40s %s&#39; % (letter,key,gs.val))</span>
                    <span class="k">yield</span> <span class="n">key</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">val</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">letter</span>

        <span class="k">raise</span> <span class="ne">StopIteration</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20041118104831.1: ** class LocalConfigManager</span></div></div>
<div class="viewcode-block" id="LocalConfigManager"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager">[docs]</a><span class="k">class</span> <span class="nc">LocalConfigManager</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;A class to hold config settings for commanders.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20120215072959.12472: *3* c.config.Birth</span>
    <span class="c">#@+node:ekr.20041118104831.2: *4* c.config.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">previousSettings</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">trace_startup</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s">&#39;c.config.__init__ </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>

        <span class="c"># The shortcuts and settings dicts, set in c.__init__</span>
        <span class="c"># for local files.</span>
        <span class="k">if</span> <span class="n">previousSettings</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;(c.config.ctor)&#39;,previousSettings)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span> <span class="o">=</span> <span class="n">previousSettings</span><span class="o">.</span><span class="n">settingsDict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span> <span class="o">=</span> <span class="n">previousSettings</span><span class="o">.</span><span class="n">shortcutsDict</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDictOfLists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadManager</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>  <span class="o">=</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">globalSettingsDict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">globalShortcutsDict</span>
            <span class="k">assert</span> <span class="n">d1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDict</span><span class="p">(</span><span class="n">d1</span><span class="p">),</span><span class="n">d1</span>
            <span class="k">assert</span> <span class="n">d2</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDictOfLists</span><span class="p">(</span><span class="n">d2</span><span class="p">),</span><span class="n">d2</span>

        <span class="c"># Define these explicitly to eliminate a pylint warning.</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># No longer needed now that c.config.initIvar always sets</span>
            <span class="c"># both c and c.config ivars.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_derived_file_encoding</span> <span class="o">=</span>\
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">default_derived_file_encoding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect_execute_script_output_to_log_pane</span> <span class="o">=</span>\
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">redirect_execute_script_output_to_log_pane</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaultBodyFontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultBodyFontSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultLogFontSize</span>  <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultLogFontSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultMenuFontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultMenuFontSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultTreeFontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultTreeFontSize</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encodingIvarsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initEncoding</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ivarsDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initIvar</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041118104414: *4* c.config.initEncoding</span>
<div class="viewcode-block" id="LocalConfigManager.initEncoding"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.initEncoding">[docs]</a>    <span class="k">def</span> <span class="nf">initEncoding</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>

        <span class="c"># Important: the key is munged.</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encodingIvarsDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">encodingName</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">ivar</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">encodingName</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;string&#39;</span><span class="p">)</span>

        <span class="c"># Use the global setting as a last resort.</span>
        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;c.config&#39;,c.shortFileName(),encodingName,encoding)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encodingName</span><span class="p">,</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="n">encodingName</span><span class="p">)</span>
            <span class="c"># g.trace(&#39;g.app.config&#39;,c.shortFileName(),encodingName,encoding)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">encodingName</span><span class="p">,</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">isValidEncoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;bad&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">encodingName</span><span class="p">,</span><span class="n">encoding</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20041118104240: *4* c.config.initIvar</span></div>
<div class="viewcode-block" id="LocalConfigManager.initIvar"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.initIvar">[docs]</a>    <span class="k">def</span> <span class="nf">initIvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Important: the key is munged.</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ivarsDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">ivarName</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">ivar</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivarName</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivarName</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;c.config&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(),</span><span class="n">ivarName</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
            <span class="c"># Set *both* the commander ivar and the c.config ivar.</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivarName</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">ivarName</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120215072959.12471: *3* c.config.Getters</span>
    <span class="c">#@+node:ekr.20120215072959.12543: *4* c.config.Getters: redirect to g.app.config</span></div>
<div class="viewcode-block" id="LocalConfigManager.getButtons"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getButtons">[docs]</a>    <span class="k">def</span> <span class="nf">getButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a list of tuples (x,y) for common @button nodes.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atCommonButtonsList</span> <span class="c"># unusual.</span>
</div>
<div class="viewcode-block" id="LocalConfigManager.getCommands"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getCommands">[docs]</a>    <span class="k">def</span> <span class="nf">getCommands</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the list of tuples (headline,script) for common @command nodes.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">atCommonCommandsList</span> <span class="c"># unusual.</span>
</div>
<div class="viewcode-block" id="LocalConfigManager.getEnabledPlugins"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getEnabledPlugins">[docs]</a>    <span class="k">def</span> <span class="nf">getEnabledPlugins</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the body text of the @enabled-plugins node.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enabledPluginsString</span> <span class="c"># unusual.</span>
</div>
<div class="viewcode-block" id="LocalConfigManager.getRecentFiles"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getRecentFiles">[docs]</a>    <span class="k">def</span> <span class="nf">getRecentFiles</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the list of recently opened files.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getRecentFiles</span><span class="p">()</span> <span class="c"># unusual</span>
    <span class="c">#@+node:ekr.20120215072959.12515: *4* c.config.Getters</span>
    <span class="c">#@@nocolor-node</span>

    <span class="c">#@+at Only the following need to be defined.</span>
    <span class="c"># </span>
    <span class="c">#     get (self,setting,theType)</span>
    <span class="c">#     getAbbrevDict (self)</span>
    <span class="c">#     getBool (self,setting,default=None)</span>
    <span class="c">#     getButtons (self)</span>
    <span class="c">#     getColor (self,setting)</span>
    <span class="c">#     getData (self,setting)</span>
    <span class="c">#     getDirectory (self,setting)</span>
    <span class="c">#     getFloat (self,setting)</span>
    <span class="c">#     getFontFromParams (self,family,size,slant,weight,defaultSize=12)</span>
    <span class="c">#     getInt (self,setting)</span>
    <span class="c">#     getLanguage (self,setting)</span>
    <span class="c">#     getMenusList (self)</span>
    <span class="c">#     getOpenWith (self):</span>
    <span class="c">#     getRatio (self,setting)</span>
    <span class="c">#     getShortcut (self,commandName)</span>
    <span class="c">#     getString (self,setting)</span>
    <span class="c">#@+node:ekr.20120215072959.12519: *5* c.config.get &amp; allies</span></div>
<div class="viewcode-block" id="LocalConfigManager.get"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get the setting and make sure its type matches the expected type.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>
        <span class="n">lm</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadManager</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDict</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="n">d</span>
            <span class="n">val</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValFromDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># g.trace(&#39;%35s %20s %s&#39; % (setting,val,g.callers(3)))</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%40s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">lm</span><span class="o">.</span><span class="n">globalSettingsDict</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;ignore: </span><span class="si">%40s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">setting</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20120215072959.12520: *6* getValFromDict</span></div>
<div class="viewcode-block" id="LocalConfigManager.getValFromDict"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getValFromDict">[docs]</a>    <span class="k">def</span> <span class="nf">getValFromDict</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">requestedType</span><span class="p">,</span><span class="n">warn</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Look up the setting in d. If warn is True, warn if the requested type</span>
<span class="sd">        does not (loosely) match the actual type.</span>
<span class="sd">        returns (val,exists)&#39;&#39;&#39;</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">setting</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gs</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">False</span>
        <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isGeneralSetting</span><span class="p">(</span><span class="n">gs</span><span class="p">),</span><span class="n">gs</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">val</span>

        <span class="c"># 2011/10/24: test for an explicit None.</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">isPython3</span><span class="p">:</span>
            <span class="n">isNone</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c"># ,None)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isNone</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">),</span><span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">),</span><span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
                <span class="s">&#39;None&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c">#,None)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">typesMatch</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span><span class="n">requestedType</span><span class="p">):</span>
            <span class="c"># New in 4.4: make sure the types match.</span>
            <span class="c"># A serious warning: one setting may have destroyed another!</span>
            <span class="c"># Important: this is not a complete test of conflicting settings:</span>
            <span class="c"># The warning is given only if the code tries to access the setting.</span>
            <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;warning: ignoring&#39;</span><span class="p">,</span><span class="n">gs</span><span class="o">.</span><span class="n">kind</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="s">&#39;is not&#39;</span><span class="p">,</span><span class="n">requestedType</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;there may be conflicting settings!&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">isNone</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">True</span>
                <span class="c"># 2011/10/24: Exists, a *user-defined* empty value.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20120215072959.12521: *6* typesMatch</span></div>
<div class="viewcode-block" id="LocalConfigManager.typesMatch"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.typesMatch">[docs]</a>    <span class="k">def</span> <span class="nf">typesMatch</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">type1</span><span class="p">,</span><span class="n">type2</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return True if type1, the actual type, matches type2, the requeseted type.</span>

<span class="sd">        The following equivalences are allowed:</span>

<span class="sd">        - None matches anything.</span>
<span class="sd">        - An actual type of string or strings matches anything *except* shortcuts.</span>
<span class="sd">        - Shortcut matches shortcuts.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># The shortcuts logic no longer uses the get/set code.</span>
        <span class="n">shortcuts</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;shortcut&#39;</span><span class="p">,</span><span class="s">&#39;shortcuts&#39;</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">type1</span> <span class="ow">in</span> <span class="n">shortcuts</span> <span class="ow">or</span> <span class="n">type2</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: type in shortcuts&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">type1</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">type2</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span>
            <span class="n">type1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;string&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">type2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">shortcuts</span> <span class="ow">or</span>
            <span class="n">type1</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span> <span class="ow">and</span> <span class="n">type2</span> <span class="o">==</span> <span class="s">&#39;size&#39;</span> <span class="ow">or</span>
            <span class="p">(</span><span class="n">type1</span> <span class="ow">in</span> <span class="n">shortcuts</span> <span class="ow">and</span> <span class="n">type2</span> <span class="ow">in</span> <span class="n">shortcuts</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">type1</span> <span class="o">==</span> <span class="n">type2</span>
        <span class="p">)</span>
    <span class="c">#@+node:ekr.20120215072959.12522: *5* c.config.getAbbrevDict</span></div>
<div class="viewcode-block" id="LocalConfigManager.getAbbrevDict"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getAbbrevDict">[docs]</a>    <span class="k">def</span> <span class="nf">getAbbrevDict</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Search all dictionaries for the setting &amp; check it&#39;s type&quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;abbrev&#39;</span><span class="p">,</span><span class="s">&#39;abbrev&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c">#@+node:ekr.20120215072959.12523: *5* c.config.getBool</span></div>
<div class="viewcode-block" id="LocalConfigManager.getBool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getBool">[docs]</a>    <span class="k">def</span> <span class="nf">getBool</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @bool setting, or the default if the setting is not found.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;bool&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
    <span class="c">#@+node:ekr.20120215072959.12525: *5* c.config.getColor</span></div>
<div class="viewcode-block" id="LocalConfigManager.getColor"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getColor">[docs]</a>    <span class="k">def</span> <span class="nf">getColor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @color setting.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;color&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120215072959.12527: *5* c.config.getData</span></div>
<div class="viewcode-block" id="LocalConfigManager.getData"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of non-comment strings in the body text of @data setting.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120215072959.12528: *5* c.config.getDirectory</span></div>
<div class="viewcode-block" id="LocalConfigManager.getDirectory"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getDirectory">[docs]</a>    <span class="k">def</span> <span class="nf">getDirectory</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @directory setting, or None if the directory does not exist.&#39;&#39;&#39;</span>

        <span class="n">theDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">theDir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_isdir</span><span class="p">(</span><span class="n">theDir</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">theDir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20120215072959.12530: *5* c.config.getFloat</span></div>
<div class="viewcode-block" id="LocalConfigManager.getFloat"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getFloat">[docs]</a>    <span class="k">def</span> <span class="nf">getFloat</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @float setting.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20120215072959.12531: *5* c.config.getFontFromParams</span></div>
<div class="viewcode-block" id="LocalConfigManager.getFontFromParams"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getFontFromParams">[docs]</a>    <span class="k">def</span> <span class="nf">getFontFromParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="n">defaultSize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Compute a font from font parameters.</span>

<span class="sd">        Arguments are the names of settings to be use.</span>
<span class="sd">        Default to size=12, slant=&quot;roman&quot;, weight=&quot;normal&quot;.</span>

<span class="sd">        Return None if there is no family setting so we can use system default fonts.&quot;&quot;&quot;</span>

        <span class="n">family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">family</span><span class="p">,</span><span class="s">&quot;family&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">family</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">):</span> <span class="n">family</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultFontFamily</span>

        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="n">size</span> <span class="o">=</span> <span class="n">defaultSize</span>

        <span class="n">slant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slant</span><span class="p">,</span><span class="s">&quot;slant&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slant</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">):</span> <span class="n">slant</span> <span class="o">=</span> <span class="s">&quot;roman&quot;</span>

        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span><span class="s">&quot;weight&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">):</span> <span class="n">weight</span> <span class="o">=</span> <span class="s">&quot;normal&quot;</span>

        <span class="c"># g.trace(family,size,slant,weight,g.shortFileName(self.c.mFileName))</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120215072959.12532: *5* c.config.getInt</span></div>
<div class="viewcode-block" id="LocalConfigManager.getInt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getInt">[docs]</a>    <span class="k">def</span> <span class="nf">getInt</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @int setting.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;int&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20120215072959.12533: *5* c.config.getLanguage</span></div>
<div class="viewcode-block" id="LocalConfigManager.getLanguage"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getLanguage">[docs]</a>    <span class="k">def</span> <span class="nf">getLanguage</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the setting whose value should be a language known to Leo.&#39;&#39;&#39;</span>

        <span class="n">language</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
        <span class="c"># g.trace(setting,language)</span>

        <span class="k">return</span> <span class="n">language</span>
    <span class="c">#@+node:ekr.20120215072959.12534: *5* c.config.getMenusList</span></div>
<div class="viewcode-block" id="LocalConfigManager.getMenusList"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getMenusList">[docs]</a>    <span class="k">def</span> <span class="nf">getMenusList</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the list of entries for the @menus tree.&#39;&#39;&#39;</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;menus&#39;</span><span class="p">,</span><span class="s">&#39;menus&#39;</span><span class="p">)</span>
        <span class="c"># g.trace(aList and len(aList) or 0)</span>

        <span class="k">return</span> <span class="n">aList</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">menusList</span>
    <span class="c">#@+node:ekr.20120215072959.12535: *5* c.config.getOpenWith</span></div>
<div class="viewcode-block" id="LocalConfigManager.getOpenWith"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getOpenWith">[docs]</a>    <span class="k">def</span> <span class="nf">getOpenWith</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of dictionaries corresponding to @openwith nodes.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;openwithtable&#39;</span><span class="p">,</span><span class="s">&#39;openwithtable&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val</span>
    <span class="c">#@+node:ekr.20120215072959.12536: *5* c.config.getRatio</span></div>
<div class="viewcode-block" id="LocalConfigManager.getRatio"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getRatio">[docs]</a>    <span class="k">def</span> <span class="nf">getRatio</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @float setting.</span>

<span class="sd">        Warn if the value is less than 0.0 or greater than 1.0.&#39;&#39;&#39;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;ratio&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20120215072959.12538: *5* c.config.getSettingSource</span></div>
<div class="viewcode-block" id="LocalConfigManager.getSettingSource"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getSettingSource">[docs]</a>    <span class="k">def</span> <span class="nf">getSettingSource</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;return the name of the file responsible for setting.&#39;&#39;&#39;</span>

        <span class="n">c</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDict</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="n">d</span>
            <span class="n">si</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">si</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;unknown setting&#39;</span><span class="p">,</span><span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isShortcutInfo</span><span class="p">(</span><span class="n">si</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">si</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">si</span><span class="o">.</span><span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># lm.readGlobalSettingsFiles is opening a settings file.</span>
            <span class="c"># lm.readGlobalSettingsFiles has not yet set lm.globalSettingsDict.</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="ow">is</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20120215072959.12539: *5* c.config.getShortcut</span></div>
<div class="viewcode-block" id="LocalConfigManager.getShortcut"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getShortcut">[docs]</a>    <span class="k">def</span> <span class="nf">getShortcut</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">commandName</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return rawKey,accel for shortcutName&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortcutsDict</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no menu: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">commandName</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,[]</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDictOfLists</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="n">d</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">canonicalizeMenuName</span><span class="p">(</span><span class="n">commandName</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c"># Allow &#39;&amp;&#39; in names.</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">commandName</span><span class="p">,[])</span>
            <span class="k">if</span> <span class="n">aList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span> <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isShortcutInfo</span><span class="p">(</span><span class="n">si</span><span class="p">),</span><span class="n">si</span> 
                <span class="c"># It&#39;s very important to filter empty strokes here.</span>
                <span class="n">aList</span> <span class="o">=</span> <span class="p">[</span><span class="n">si</span> <span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="n">aList</span>
                    <span class="k">if</span> <span class="n">si</span><span class="o">.</span><span class="n">stroke</span> <span class="ow">and</span> <span class="n">si</span><span class="o">.</span><span class="n">stroke</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;none&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="n">aList</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">key</span><span class="p">,</span><span class="n">aList</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># lm.readGlobalSettingsFiles is opening a settings file.</span>
            <span class="c"># lm.readGlobalSettingsFiles has not yet set lm.globalSettingsDict.</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,[]</span>
    <span class="c">#@+node:ekr.20120215072959.12540: *5* c.config.getString</span></div>
<div class="viewcode-block" id="LocalConfigManager.getString"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.getString">[docs]</a>    <span class="k">def</span> <span class="nf">getString</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the value of @string setting.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span><span class="s">&quot;string&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120224140548.10528: *4* c.exists (new)</span></div>
<div class="viewcode-block" id="LocalConfigManager.exists"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return true if a setting of the given kind exists, even if it is None.&#39;&#39;&#39;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">junk</span><span class="p">,</span><span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getValFromDict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20041123092357: *4* c.config.findSettingsPosition &amp; helper</span>
    <span class="c"># This was not used prior to Leo 4.5.</span>
</div>
<div class="viewcode-block" id="LocalConfigManager.findSettingsPosition"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.findSettingsPosition">[docs]</a>    <span class="k">def</span> <span class="nf">findSettingsPosition</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setting</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Return the position for the setting in the @settings tree for c.&quot;&quot;&quot;</span>

        <span class="n">munge</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">munge</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settingsRoot</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">nullPosition</span><span class="p">()</span>

        <span class="n">setting</span> <span class="o">=</span> <span class="n">munge</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">subtree</span><span class="p">():</span>
            <span class="c">#BJ munge will return None if a headstring is empty</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">munge</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">setting</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">nullPosition</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20041120074536: *5* c.config.settingsRoot</span></div>
<div class="viewcode-block" id="LocalConfigManager.settingsRoot"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.settingsRoot">[docs]</a>    <span class="k">def</span> <span class="nf">settingsRoot</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the position of the @settings tree.&#39;&#39;&#39;</span>

        <span class="c"># g.trace(c,c.rootPosition())</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">all_unique_positions</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;@settings&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">nullPosition</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20070418073400: *3* c.config.printSettings</span></div>
<div class="viewcode-block" id="LocalConfigManager.printSettings"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.printSettings">[docs]</a>    <span class="k">def</span> <span class="nf">printSettings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Prints the value of every setting, except key bindings and commands and open-with tables.</span>
<span class="sd">        The following shows where the active setting came from:</span>

<span class="sd">        -     leoSettings.leo,</span>
<span class="sd">        - [D] default settings.</span>
<span class="sd">        - [F] indicates the file being loaded,</span>
<span class="sd">        - [M] myLeoSettings.leo,</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">    legend:</span>
<span class="s">        leoSettings.leo</span>
<span class="s">    [D] default settings</span>
<span class="s">    [F] loaded .leo File</span>
<span class="s">    [M] myLeoSettings.leo</span>
<span class="s">    &#39;&#39;&#39;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">adjustTripleString</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">tab_width</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">letter</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config_iter</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">letter</span><span class="o">==</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;   &#39;</span><span class="p">,</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">letter</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>

        <span class="c"># Use a single g.es statement.</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">legend</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># print(&#39;&#39;.join(result))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">),</span><span class="n">tabName</span><span class="o">=</span><span class="s">&#39;Settings&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120215072959.12475: *3* c.config.set</span></div>
<div class="viewcode-block" id="LocalConfigManager.set"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.LocalConfigManager.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Init the setting for name to val.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Note: when kind is &#39;shortcut&#39;, name is a command name.</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">munge</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># if kind and kind.startswith(&#39;setting&#39;): g.trace(&quot;c.config %10s %15s %s&quot; %(kind,val,name))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settingsDict</span>
        <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isTypedDict</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="n">d</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gs</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">g</span><span class="o">.</span><span class="n">isGeneralSetting</span><span class="p">(</span><span class="n">gs</span><span class="p">),</span><span class="n">gs</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">path</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">)</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;over-riding setting:&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="s">&quot;from&quot;</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>

        <span class="n">gs</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">GeneralSetting</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">mFileName</span><span class="p">,</span><span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;setting&#39;</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">gs</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20041119203941.3: ** class SettingsTreeParser (ParserBaseClass)</span></div></div>
<div class="viewcode-block" id="SettingsTreeParser"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.SettingsTreeParser">[docs]</a><span class="k">class</span> <span class="nc">SettingsTreeParser</span> <span class="p">(</span><span class="n">ParserBaseClass</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class that inits settings found in an @settings tree.</span>

<span class="sd">    Used by read settings logic.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20041119204103: *3* ctor (SettingsTreeParser)</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">localFlag</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">ParserBaseClass</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">localFlag</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20041119204714: *3* visitNode (SettingsTreeParser)</span>
<div class="viewcode-block" id="SettingsTreeParser.visitNode"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoConfig.SettingsTreeParser.visitNode">[docs]</a>    <span class="k">def</span> <span class="nf">visitNode</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Init any settings found in node p.&quot;&quot;&quot;</span>

        <span class="c"># g.trace(p.h)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c"># Bug fix 2011/11/24</span>
            <span class="c"># Ensure inner traversals don&#39;t change callers&#39;s p.</span>

        <span class="n">munge</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">munge</span>

        <span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseHeadline</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">munge</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">isPython3</span><span class="p">:</span>
            <span class="n">isNone</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isNone</span> <span class="o">=</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">),</span><span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">),</span><span class="nb">unicode</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
                <span class="s">&#39;None&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># Not an @x node. (New in Leo 4.4.4)</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&quot;settings&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># elif kind in self.basic_types and val in (u&#39;None&#39;,u&#39;none&#39;,&#39;None&#39;,&#39;none&#39;,&#39;&#39;,None):</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_types</span> <span class="ow">and</span> <span class="n">isNone</span><span class="p">:</span>
            <span class="c"># None is valid for all basic types.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_types</span> <span class="ow">or</span> <span class="n">kind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_types</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatchDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;*** no handler&quot;</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@-others</span>
<span class="c">#@-others</span>
<span class="c">#@-leo</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Ed K. Ream.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>