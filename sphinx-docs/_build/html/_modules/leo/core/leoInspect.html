<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>leo.core.leoInspect &mdash; Leo API 4.11dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.11dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Leo API 4.11dev documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for leo.core.leoInspect</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#@+leo-ver=5-thin</span>
<span class="c">#@+node:ekr.20111116103733.9817: * @file leoInspect.py</span>
<span class="c">#@@first</span>

<span class="sd">&#39;&#39;&#39;A scriptable framework for creating queries of Leo&#39;s object code.&#39;&#39;&#39;</span>

<span class="c">#@@language python</span>
<span class="c">#@@tabwidth -4</span>
<span class="c">#@@pagewidth 60</span>

<span class="c">#@+&lt;&lt; imports &gt;&gt;</span>
<span class="c">#@+node:ekr.20111116103733.10440: **  &lt;&lt; imports &gt;&gt; (leoInspect)</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">isPython3</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">leoStandAloneGlobals</span> <span class="kn">as</span> <span class="nn">g</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># Will fail later.</span>

<span class="c"># Used by ast-oriented code.</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">isPython3</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">__builtin__</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="c"># import sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">types</span>

<span class="k">if</span> <span class="n">isPython3</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">io</span>
    <span class="n">StringIO</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cStringIO</span>
    <span class="n">StringIO</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span>
<span class="c">#@-&lt;&lt; imports &gt;&gt;</span>

<span class="c"># print(&#39;leoInspect.py: %s&#39; % __file__)</span>

<span class="n">g_dumper</span> <span class="o">=</span> <span class="bp">None</span>     <span class="c"># Global, singleton instance of AstDumper.</span>
<span class="n">g_formatter</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Global, singleton instance of AstFormatter.</span>

<span class="c">#@+&lt;&lt; to do &gt;&gt;</span>
<span class="c">#@+node:ekr.20120609070048.11216: **  &lt;&lt; to do &gt;&gt; (leoInspect)</span>
<span class="c">#@@nocolor-node</span>
<span class="c">#@+at</span>
<span class="c"># </span>
<span class="c"># ** Improve cx.assignments_to.</span>
<span class="c"># </span>
<span class="c"># - Allow &quot;partial&quot; matches in calls_to,assignments_to.</span>
<span class="c">#     - Use regex searches?</span>
<span class="c"># </span>
<span class="c"># - Append *all* statements to statements list.</span>
<span class="c">#     Including def, class, if, while, pass, with etc.</span>
<span class="c"># </span>
<span class="c"># - Verify that all kinds of name expressions &amp; attributes are handled correctly.</span>
<span class="c"># </span>
<span class="c"># - Create global lists for calls, assignments.</span>
<span class="c"># </span>
<span class="c"># - Create global symbol dicts for names.</span>
<span class="c">#@-&lt;&lt; to do &gt;&gt;</span>
<span class="c">#@+&lt;&lt; naming conventions &gt;&gt;</span>
<span class="c">#@+node:ekr.20111116103733.10146: **  &lt;&lt; naming conventions &gt;&gt;</span>
<span class="c">#@@nocolor-node</span>
<span class="c">#@+at</span>
<span class="c"># </span>
<span class="c"># The following naming conventions are used throughout:</span>
<span class="c"># </span>
<span class="c"># a:    the AstTraverer class.</span>
<span class="c"># cx:   a context.</span>
<span class="c"># d:    a dict.</span>
<span class="c"># e:    a SymbolTableEntry object.</span>
<span class="c"># f:    the AstFormatter class.</span>
<span class="c"># fn:   a file name.</span>
<span class="c"># g:    the leo.core.leoGlobals module.</span>
<span class="c"># it:   the InspectTraverser class.</span>
<span class="c"># s:    a string.</span>
<span class="c"># sd:   an instance of the SemanticData class.</span>
<span class="c"># st:   a symbol table (for a particular context).</span>
<span class="c"># tree: an AST (Abstract Syntax Tree), aka a parse tree,</span>
<span class="c">#       ASTs are created by Python&#39;s ast module and modified by the AstTraverser.</span>
<span class="c"># z:    a local temp.</span>
<span class="c">#@-&lt;&lt; naming conventions &gt;&gt;</span>
<span class="c">#@+&lt;&lt; define class AstTraverser &gt;&gt;</span>
<span class="c">#@+node:ekr.20111116103733.10278: ** &lt;&lt; define class AstTraverser &gt;&gt;</span>
<div class="viewcode-block" id="AstTraverser"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser">[docs]</a><span class="k">class</span> <span class="nc">AstTraverser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;The base class for AST traversal helpers.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10279: *3*  a.Birth</span>
    <span class="c">#@+node:ekr.20111116103733.10280: *4* a.ctor (AstTraverser)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span> <span class="ow">or</span> <span class="s">&#39;&lt;AstTraverser&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># The indentation level (not the context level).</span>
            <span class="c"># The number of parents a node has.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_dispatch_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_tracing</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20111116103733.10281: *4* a.init_dispatch_table</span>
<div class="viewcode-block" id="AstTraverser.init_dispatch_table"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.init_dispatch_table">[docs]</a>    <span class="k">def</span> <span class="nf">init_dispatch_table</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">ast</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_table</span> <span class="o">=</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">int</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_int</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_str</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">alias</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_alias</span><span class="p">,</span>
            <span class="c"># a.arg: self.do_arg,</span>
                <span class="c"># Python 3.x only.</span>
            <span class="n">a</span><span class="o">.</span><span class="n">arguments</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_arguments</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">comprehension</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_comprehension</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">keyword</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Keyword</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Add</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Add</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">And</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_And</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Assert</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Assert</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Assign</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Assign</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Attribute</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Attribute</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">AugAssign</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_AugAssign</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">AugLoad</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_AugLoad</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">AugStore</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_AugStore</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">BinOp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_BinOp</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">BitAnd</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_BitAnd</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">BitOr</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_BitOr</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">BitXor</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_BitXor</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_BoolOp</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Break</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Break</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Call</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Call</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_ClassDef</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Compare</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Compare</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Continue</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Continue</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Del</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Del</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Delete</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Delete</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Dict</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Dict</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Div</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Div</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Ellipsis</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Ellipsis</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Eq</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Eq</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">ExceptHandler</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_ExceptHandler</span><span class="p">,</span>
            <span class="c"># a.Exec: self.do_Exec,</span>
                <span class="c"># Python 2.x only.</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Expr</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Expr</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Expression</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Expression</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">ExtSlice</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_ExtSlice</span> <span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">FloorDiv</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_FloorDiv</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">For</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_For</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_FunctionDef</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">GeneratorExp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_GeneratorExp</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Global</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Global</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Gt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Gt</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">GtE</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_GtE</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">If</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_If</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">IfExp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_IfExp</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Import</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Import</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">ImportFrom</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_ImportFrom</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">In</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_In</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Index</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Index</span> <span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Interactive</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Interactive</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Invert</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Invert</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Is</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Is</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">IsNot</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_IsNot</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">LShift</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_LShift</span> <span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Lambda</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">List</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_List</span> <span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">ListComp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_ListComp</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Load</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Load</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Lt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Lt</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">LtE</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_LtE</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Mod</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Mod</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Module</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Module</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Mult</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Mult</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Name</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Not</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Not</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">NotEq</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_NotEq</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">NotIn</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_NotIn</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Num</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Num</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Or</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Or</span> <span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Param</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Param</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Pass</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Pass</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Pow</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Pow</span><span class="p">,</span>
            <span class="c"># a.Print: self.do_Print,</span>
                <span class="c"># Python 2.x only.</span>
            <span class="n">a</span><span class="o">.</span><span class="n">RShift</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_RShift</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Raise</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Raise</span><span class="p">,</span>
            <span class="c"># a.Repr: self.do_Repr,</span>
                <span class="c"># Python 2.x only.</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Return</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Return</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Slice</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Slice</span> <span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Store</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Store</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Str</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Str</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Sub</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Sub</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Subscript</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Subscript</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Suite</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Suite</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">TryExcept</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_TryExcept</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">TryFinally</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_TryFinally</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Tuple</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Tuple</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">UAdd</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_UAdd</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">USub</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_USub</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_UnaryOp</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">While</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_While</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">With</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_With</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">Yield</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Yield</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">isPython3</span><span class="p">:</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">arg</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_arg</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Bytes</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Bytes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="p">[</span><span class="nb">bool</span><span class="p">]</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_bool</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Exec</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Exec</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Print</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Print</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">Repr</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_Repr</span>
    <span class="c">#@+node:ekr.20111116103733.10283: *3*  a.Do-nothings</span>
    <span class="c"># Don&#39;t delete these. They might be useful in a subclass.</span></div>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">do_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Add"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Add">[docs]</a>        <span class="k">def</span> <span class="nf">do_Add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_And"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_And">[docs]</a>        <span class="k">def</span> <span class="nf">do_And</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_AugAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_AugLoad"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_AugLoad">[docs]</a>        <span class="k">def</span> <span class="nf">do_AugLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_AugStore"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_AugStore">[docs]</a>        <span class="k">def</span> <span class="nf">do_AugStore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_BinOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_BitAnd"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_BitAnd">[docs]</a>        <span class="k">def</span> <span class="nf">do_BitAnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_BitOr"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_BitOr">[docs]</a>        <span class="k">def</span> <span class="nf">do_BitOr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_BitXor"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_BitXor">[docs]</a>        <span class="k">def</span> <span class="nf">do_BitXor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_BoolOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_ClassDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Continue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Del"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Del">[docs]</a>        <span class="k">def</span> <span class="nf">do_Del</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Div"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Div">[docs]</a>        <span class="k">def</span> <span class="nf">do_Div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Ellipsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Eq"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Eq">[docs]</a>        <span class="k">def</span> <span class="nf">do_Eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Exec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_ExtSlice</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_FloorDiv"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_FloorDiv">[docs]</a>        <span class="k">def</span> <span class="nf">do_FloorDiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_For</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_GeneratorExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Gt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Gt">[docs]</a>        <span class="k">def</span> <span class="nf">do_Gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_GtE"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_GtE">[docs]</a>        <span class="k">def</span> <span class="nf">do_GtE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_IfExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_ImportFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_In"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_In">[docs]</a>        <span class="k">def</span> <span class="nf">do_In</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Index</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Invert"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Invert">[docs]</a>        <span class="k">def</span> <span class="nf">do_Invert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_Is"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Is">[docs]</a>        <span class="k">def</span> <span class="nf">do_Is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_IsNot"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_IsNot">[docs]</a>        <span class="k">def</span> <span class="nf">do_IsNot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_LShift"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_LShift">[docs]</a>        <span class="k">def</span> <span class="nf">do_LShift</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Lambda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_List</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_ListComp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Load"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Load">[docs]</a>        <span class="k">def</span> <span class="nf">do_Load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_Lt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Lt">[docs]</a>        <span class="k">def</span> <span class="nf">do_Lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_LtE"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_LtE">[docs]</a>        <span class="k">def</span> <span class="nf">do_LtE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_Mod"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Mod">[docs]</a>        <span class="k">def</span> <span class="nf">do_Mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Mult"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Mult">[docs]</a>        <span class="k">def</span> <span class="nf">do_Mult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Not"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Not">[docs]</a>        <span class="k">def</span> <span class="nf">do_Not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_NotEq"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_NotEq">[docs]</a>        <span class="k">def</span> <span class="nf">do_NotEq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_NotIn"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_NotIn">[docs]</a>        <span class="k">def</span> <span class="nf">do_NotIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Or"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Or">[docs]</a>        <span class="k">def</span> <span class="nf">do_Or</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_Param"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Param">[docs]</a>        <span class="k">def</span> <span class="nf">do_Param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Pow"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Pow">[docs]</a>        <span class="k">def</span> <span class="nf">do_Pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="c">## def do_Print(self,tree,tag=&#39;&#39;): pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_RShift"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_RShift">[docs]</a>        <span class="k">def</span> <span class="nf">do_RShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="c">## def do_Repr(self,tree,tag=&#39;&#39;): pass</span>
        <span class="k">def</span> <span class="nf">do_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Slice</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Store"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Store">[docs]</a>        <span class="k">def</span> <span class="nf">do_Store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_Sub"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Sub">[docs]</a>        <span class="k">def</span> <span class="nf">do_Sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_Subscript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Suite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_TryExcept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_TryFinally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
<div class="viewcode-block" id="AstTraverser.do_UAdd"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_UAdd">[docs]</a>        <span class="k">def</span> <span class="nf">do_UAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="AstTraverser.do_USub"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_USub">[docs]</a>        <span class="k">def</span> <span class="nf">do_USub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span></div>
        <span class="k">def</span> <span class="nf">do_UnaryOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_While</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_With</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">do_Yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="k">pass</span>
    <span class="c">#@+node:ekr.20111128103520.10427: *3*  a.do_default</span>
<div class="viewcode-block" id="AstTraverser.do_default"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_default">[docs]</a>    <span class="k">def</span> <span class="nf">do_default</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;**** bad ast type&#39;</span><span class="p">,</span><span class="n">tree</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="c">#@+node:ekr.20111116103733.10284: *3*  a.error</span></div>
<div class="viewcode-block" id="AstTraverser.error"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;Error: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">message</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="c">#@+node:ekr.20111116103733.10285: *3*  a.get/push/pop_context</span></div>
<div class="viewcode-block" id="AstTraverser.get_context"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.get_context">[docs]</a>    <span class="k">def</span> <span class="nf">get_context</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="AstTraverser.push_context"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.push_context">[docs]</a>    <span class="k">def</span> <span class="nf">push_context</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">context</span><span class="p">):</span>

        <span class="k">assert</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.pop_context"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.pop_context">[docs]</a>    <span class="k">def</span> <span class="nf">pop_context</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20111116103733.10286: *3*  a.run</span></div>
<div class="viewcode-block" id="AstTraverser.run"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20111116103733.10287: *3*  a.visit</span></div>
<div class="viewcode-block" id="AstTraverser.visit"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.visit">[docs]</a>    <span class="k">def</span> <span class="nf">visit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Visit the ast tree node, dispatched by node type.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Return a value for use by subclases.</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">do_default</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c"># Never put a return instruction in a finally clause!</span>
        <span class="c"># It causes the exception to be lost!</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20111116103733.10288: *3* a.Dumps</span>
    <span class="c">#@+node:ekr.20111116103733.10289: *4* dump(AstTraverser)</span></div>
<div class="viewcode-block" id="AstTraverser.dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">asString</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">AstDumper</span><span class="p">(</span><span class="n">brief</span><span class="o">=</span><span class="n">brief</span><span class="p">)</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="n">outStream</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20111116103733.10291: *4* string_dump</span></div>
<div class="viewcode-block" id="AstTraverser.string_dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.string_dump">[docs]</a>    <span class="k">def</span> <span class="nf">string_dump</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;not an AST node&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="n">after</span> <span class="o">=</span> <span class="n">g_node_after_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>

        <span class="c"># Start with the first line.</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c"># 1-based line numbers.</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">col_offset</span><span class="p">:]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

        <span class="c"># Append the following lines up to the after node.</span>
        <span class="k">if</span> <span class="n">after</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">after</span><span class="o">.</span><span class="n">lineno</span> <span class="o">&gt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">lineno</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">lineno</span>
                <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">after</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c"># Append the first part of the last line.</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">after</span><span class="o">.</span><span class="n">lineno</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">after</span><span class="o">.</span><span class="n">col_offset</span><span class="p">]</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">lineno</span><span class="p">:])</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10292: *3* a.Expressions</span></div>
<div class="viewcode-block" id="AstTraverser.do_Expr"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Expr">[docs]</a>    <span class="k">def</span> <span class="nf">do_Expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Expression"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Expression">[docs]</a>    <span class="k">def</span> <span class="nf">do_Expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_GeneratorExp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_GeneratorExp">[docs]</a>    <span class="k">def</span> <span class="nf">do_GeneratorExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">elt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10293: *4* a.IfExp</span></div>
<div class="viewcode-block" id="AstTraverser.do_IfExp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_IfExp">[docs]</a>    <span class="k">def</span> <span class="nf">do_IfExp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10294: *4* a.Operands</span></div>
<div class="viewcode-block" id="AstTraverser.do_Attribute"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Attribute">[docs]</a>    <span class="k">def</span> <span class="nf">do_Attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>

    <span class="c"># Python 2.x only.</span></div>
<div class="viewcode-block" id="AstTraverser.do_bool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_bool">[docs]</a>    <span class="k">def</span> <span class="nf">do_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c"># Python 3.x only.</span></div>
<div class="viewcode-block" id="AstTraverser.do_Bytes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Bytes">[docs]</a>    <span class="k">def</span> <span class="nf">do_Bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Call"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Call">[docs]</a>    <span class="k">def</span> <span class="nf">do_Call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;starargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Name&#39;</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;** unknown starargs kind&#39;</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Name&#39;</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;** unknown kwargs kind&#39;</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_comprehension"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_comprehension">[docs]</a>    <span class="k">def</span> <span class="nf">do_comprehension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">ifs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Dict"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Dict">[docs]</a>    <span class="k">def</span> <span class="nf">do_Dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Ellipsis"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Ellipsis">[docs]</a>    <span class="k">def</span> <span class="nf">do_Ellipsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_ExtSlice"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_ExtSlice">[docs]</a>    <span class="k">def</span> <span class="nf">do_ExtSlice</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Index"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Index">[docs]</a>    <span class="k">def</span> <span class="nf">do_Index</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_int"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_int">[docs]</a>    <span class="k">def</span> <span class="nf">do_int</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Keyword"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Keyword">[docs]</a>    <span class="k">def</span> <span class="nf">do_Keyword</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_List"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_List">[docs]</a>    <span class="k">def</span> <span class="nf">do_List</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_ListComp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_ListComp">[docs]</a>    <span class="k">def</span> <span class="nf">do_ListComp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">elt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Name">[docs]</a>    <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="c"># tree.id is a string.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Num"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Num">[docs]</a>    <span class="k">def</span> <span class="nf">do_Num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Slice"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Slice">[docs]</a>    <span class="k">def</span> <span class="nf">do_Slice</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;lower&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;upper&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;step&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_str">[docs]</a>    <span class="k">def</span> <span class="nf">do_str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;str&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Str">[docs]</a>    <span class="k">def</span> <span class="nf">do_Str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;Str&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Subscript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Subscript">[docs]</a>    <span class="k">def</span> <span class="nf">do_Subscript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">slice</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Tuple"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Tuple">[docs]</a>    <span class="k">def</span> <span class="nf">do_Tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10295: *4* a.Operators</span>
    <span class="c"># arguments = (expr* args, identifier? vararg, identifier? kwarg, expr* defaults)</span>
    <span class="c"># -- keyword arguments supplied to call</span>
    <span class="c"># keyword = (identifier arg, expr value)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_arguments"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">do_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;arguments&#39;</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;vararg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">vararg</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="k">pass</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;kwarg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwarg</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_arg"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_arg">[docs]</a>    <span class="k">def</span> <span class="nf">do_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_BinOp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_BinOp">[docs]</a>    <span class="k">def</span> <span class="nf">do_BinOp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_BoolOp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_BoolOp">[docs]</a>    <span class="k">def</span> <span class="nf">do_BoolOp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Compare"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Compare">[docs]</a>    <span class="k">def</span> <span class="nf">do_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">ops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">comparators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_op"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_op">[docs]</a>    <span class="k">def</span> <span class="nf">do_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="c"># This does nothing but specify the op type.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>

    <span class="c"># operator = Add | BitAnd | BitOr | BitXor | Div</span>
    <span class="c"># FloorDiv | LShift | Mod | Mult | Pow | RShift | Sub | </span></div>
    <span class="n">do_Add</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_BitAnd</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_BitOr</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_BitXor</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Div</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_FloorDiv</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_LShift</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Mod</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Mult</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Pow</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_RShift</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Sub</span> <span class="o">=</span> <span class="n">do_op</span>

    <span class="c"># boolop = And | Or</span>
    <span class="n">do_And</span> <span class="o">=</span> <span class="n">do_op</span> 
    <span class="n">do_Or</span> <span class="o">=</span> <span class="n">do_op</span>

    <span class="c"># cmpop = Eq | Gt | GtE | In | Is | IsNot | Lt | LtE | NotEq | NotIn</span>
    <span class="n">do_Eq</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Gt</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_GtE</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_In</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Is</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_IsNot</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Lt</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_LtE</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_NotEq</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_NotIn</span> <span class="o">=</span> <span class="n">do_op</span>

    <span class="c"># def do_expression_context(self,tree,tag=&#39;&#39;):</span>
        <span class="c"># self.trace(tree,tag)</span>

    <span class="n">do_AugLoad</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_AugStore</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Del</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Load</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Param</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Store</span> <span class="o">=</span> <span class="n">do_op</span>

<div class="viewcode-block" id="AstTraverser.do_UnaryOp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_UnaryOp">[docs]</a>    <span class="k">def</span> <span class="nf">do_UnaryOp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>

    <span class="c"># unaryop = Invert | Not | UAdd | USub</span></div>
    <span class="n">do_Invert</span> <span class="o">=</span> <span class="n">do_UnaryOp</span>
    <span class="n">do_Not</span> <span class="o">=</span> <span class="n">do_UnaryOp</span>
    <span class="n">do_UAdd</span> <span class="o">=</span> <span class="n">do_UnaryOp</span>
    <span class="n">do_USub</span> <span class="o">=</span> <span class="n">do_UnaryOp</span>
    <span class="c">#@+node:ekr.20111116103733.10296: *3* a.Interactive &amp; Module &amp; Suite</span>
<div class="viewcode-block" id="AstTraverser.do_Interactive"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Interactive">[docs]</a>    <span class="k">def</span> <span class="nf">do_Interactive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Module"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Module">[docs]</a>    <span class="k">def</span> <span class="nf">do_Module</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Suite"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Suite">[docs]</a>    <span class="k">def</span> <span class="nf">do_Suite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10297: *3* a.Statements</span>
    <span class="c">#@+node:ekr.20111116103733.10298: *4* a.Statements (assignments)</span></div>
<div class="viewcode-block" id="AstTraverser.do_Assign"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Assign">[docs]</a>    <span class="k">def</span> <span class="nf">do_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_AugAssign"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_AugAssign">[docs]</a>    <span class="k">def</span> <span class="nf">do_AugAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10299: *4* a.Statements (classes &amp; functions)</span>
       <span class="c"># identifier name,</span>
        <span class="c"># expr* bases,</span>
        <span class="c"># stmt* body,</span>
        <span class="c"># expr *decorator_list)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_ClassDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_ClassDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_ClassDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_FunctionDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_FunctionDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_FunctionDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Lambda"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Lambda">[docs]</a>    <span class="k">def</span> <span class="nf">do_Lambda</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10300: *4* a.Statements (compound)</span></div>
<div class="viewcode-block" id="AstTraverser.do_For"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_For">[docs]</a>    <span class="k">def</span> <span class="nf">do_For</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_If"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_If">[docs]</a>    <span class="k">def</span> <span class="nf">do_If</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_With"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_With">[docs]</a>    <span class="k">def</span> <span class="nf">do_With</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;context_expression&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">context_expresssion</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;optional_vars&#39;</span><span class="p">):</span>
            <span class="k">pass</span> <span class="c">### tree.optional_vars may be a name.</span>
            <span class="c"># for z in tree.optional_vars:</span>
                <span class="c"># self.visit(z)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_While"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_While">[docs]</a>    <span class="k">def</span> <span class="nf">do_While</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10301: *4* a.Statements (exceptions)</span></div>
<div class="viewcode-block" id="AstTraverser.do_ExceptHandler"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_ExceptHandler">[docs]</a>    <span class="k">def</span> <span class="nf">do_ExceptHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Raise"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Raise">[docs]</a>    <span class="k">def</span> <span class="nf">do_Raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;inst&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">inst</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;tback&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">tback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">tback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_TryExcept"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_TryExcept">[docs]</a>    <span class="k">def</span> <span class="nf">do_TryExcept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_TryFinally"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_TryFinally">[docs]</a>    <span class="k">def</span> <span class="nf">do_TryFinally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">finalbody</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10302: *4* a.Statements (import) (AstTraverser)</span></div>
<div class="viewcode-block" id="AstTraverser.do_Import"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Import">[docs]</a>    <span class="k">def</span> <span class="nf">do_Import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_ImportFrom"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_ImportFrom">[docs]</a>    <span class="k">def</span> <span class="nf">do_ImportFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;level&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">level</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="c"># identifier name, identifier? asname)</span></div>
<div class="viewcode-block" id="AstTraverser.do_alias"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_alias">[docs]</a>    <span class="k">def</span> <span class="nf">do_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;asname&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">asname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">asname</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20111116103733.10303: *4* a.Statements (simple)</span></div>
<div class="viewcode-block" id="AstTraverser.do_Assert"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Assert">[docs]</a>    <span class="k">def</span> <span class="nf">do_Assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;msg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Break"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Break">[docs]</a>    <span class="k">def</span> <span class="nf">do_Break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Continue"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Continue">[docs]</a>    <span class="k">def</span> <span class="nf">do_Continue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Delete"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Delete">[docs]</a>    <span class="k">def</span> <span class="nf">do_Delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="c"># Python 2.x only</span></div>
<div class="viewcode-block" id="AstTraverser.do_Exec"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Exec">[docs]</a>    <span class="k">def</span> <span class="nf">do_Exec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;globals&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">globals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">globals</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;locals&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">locals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">locals</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Global"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Global">[docs]</a>    <span class="k">def</span> <span class="nf">do_Global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Pass"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Pass">[docs]</a>    <span class="k">def</span> <span class="nf">do_Pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>

    <span class="c"># Python 2.x only</span></div>
<div class="viewcode-block" id="AstTraverser.do_Print"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Print">[docs]</a>    <span class="k">def</span> <span class="nf">do_Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;dest&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">dest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>

    <span class="c"># Python 2.x only</span></div>
<div class="viewcode-block" id="AstTraverser.do_Repr"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Repr">[docs]</a>    <span class="k">def</span> <span class="nf">do_Repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Return"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Return">[docs]</a>    <span class="k">def</span> <span class="nf">do_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstTraverser.do_Yield"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.do_Yield">[docs]</a>    <span class="k">def</span> <span class="nf">do_Yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10304: *3* a.Tools</span>
    <span class="c">#@+at</span>
    <span class="c"># Useful tools for tree traversal and testing.</span>
    <span class="c"># </span>
    <span class="c"># Something is seriously wrong if we have to worry</span>
    <span class="c"># about the speed of these tools.</span>
    <span class="c">#@+node:ekr.20111116103733.10305: *4* a.isiterable</span></div>
<div class="viewcode-block" id="AstTraverser.isiterable"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.isiterable">[docs]</a>    <span class="k">def</span> <span class="nf">isiterable</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">anObject</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return True if a non-string is iterable.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">anObject</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10306: *4* a.op_spelling</span></div>
<div class="viewcode-block" id="AstTraverser.op_spelling"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.op_spelling">[docs]</a>    <span class="k">def</span> <span class="nf">op_spelling</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">op</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;Add&#39;</span><span class="p">:</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39;And&#39;</span><span class="p">:</span> <span class="s">&#39;and&#39;</span><span class="p">,</span>
            <span class="s">&#39;BitAnd&#39;</span><span class="p">:</span> <span class="s">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s">&#39;BitOr&#39;</span><span class="p">:</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;BitXor&#39;</span><span class="p">:</span> <span class="s">&#39;^&#39;</span><span class="p">,</span> <span class="s">&#39;Div&#39;</span><span class="p">:</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
            <span class="s">&#39;Eq&#39;</span><span class="p">:</span> <span class="s">&#39;==&#39;</span><span class="p">,</span> <span class="s">&#39;FloorDib&#39;</span><span class="p">:</span> <span class="s">&#39;//&#39;</span><span class="p">,</span><span class="s">&#39;Gt&#39;</span><span class="p">:</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;GtE&#39;</span><span class="p">:</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span>
            <span class="s">&#39;In&#39;</span><span class="p">:</span> <span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="s">&#39;Invert&#39;</span><span class="p">:</span> <span class="s">&#39;~&#39;</span><span class="p">,</span> <span class="s">&#39;Is&#39;</span><span class="p">:</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="s">&#39;IsNot&#39;</span><span class="p">:</span> <span class="s">&#39;is not&#39;</span><span class="p">,</span>
            <span class="s">&#39;LShift&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;Lt&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;LtE&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span>
            <span class="s">&#39;Mod&#39;</span><span class="p">:</span> <span class="s">&#39;%&#39;</span><span class="p">,</span> <span class="s">&#39;Mult&#39;</span><span class="p">:</span> <span class="s">&#39;*&#39;</span><span class="p">,</span>
            <span class="s">&#39;Not&#39;</span><span class="p">:</span> <span class="s">&#39;not&#39;</span><span class="p">,</span> <span class="s">&#39;NotEq&#39;</span><span class="p">:</span> <span class="s">&#39;!=&#39;</span><span class="p">,</span> <span class="s">&#39;NotIn&#39;</span><span class="p">:</span><span class="s">&#39;not in&#39;</span><span class="p">,</span>
            <span class="s">&#39;Or&#39;</span><span class="p">:</span> <span class="s">&#39;or&#39;</span><span class="p">,</span><span class="s">&#39;Pow&#39;</span><span class="p">:</span> <span class="s">&#39;**&#39;</span><span class="p">,</span> <span class="s">&#39;RShift&#39;</span><span class="p">:</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;Sub&#39;</span><span class="p">:</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;UAdd&#39;</span><span class="p">:</span> <span class="s">&#39;unary +&#39;</span><span class="p">,</span> <span class="s">&#39;USub&#39;</span><span class="p">:</span> <span class="s">&#39;unary -&#39;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="s">&#39;&lt;unknown op </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20111116103733.10307: *4* a.parents (not used)</span></div>
<div class="viewcode-block" id="AstTraverser.parents"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.parents">[docs]</a>    <span class="k">def</span> <span class="nf">parents</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;A generator yielding all the parents of a node.&#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="n">tree</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentsList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentsList</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="c"># Ignore tree.</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentsList</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="AstTraverser.self_and_parents"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.self_and_parents">[docs]</a>    <span class="k">def</span> <span class="nf">self_and_parents</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;A generator yielding tree and then all the parents of a node.&#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="n">tree</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentsList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parentsList</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentsList</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="c">#@+node:ekr.20111116103733.10308: *4* a.the_class, info &amp; kind</span></div>
<div class="viewcode-block" id="AstTraverser.the_class"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.the_class">[docs]</a>    <span class="k">def</span> <span class="nf">the_class</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span>
</div>
<div class="viewcode-block" id="AstTraverser.info"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%9s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="p">),</span><span class="nb">id</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AstTraverser.kind"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.kind">[docs]</a>    <span class="k">def</span> <span class="nf">kind</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

    <span class="c">#@+node:ekr.20111116103733.10309: *3* a.Tracing</span>
    <span class="c">#@+node:ekr.20111116103733.10310: *4* init_tracing (AstTraverser)</span></div>
<div class="viewcode-block" id="AstTraverser.init_tracing"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.init_tracing">[docs]</a>    <span class="k">def</span> <span class="nf">init_tracing</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;May be over-ridden in subclasses.&#39;&#39;&#39;</span>

        <span class="c"># May be over-ridden in subcalsses.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_flag</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Master switch.</span>

        <span class="c"># Names of AST Nodes to trace, or &#39;all&#39;.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_kinds</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Import&#39;</span><span class="p">,</span><span class="s">&#39;ImportFrom&#39;</span><span class="p">,</span><span class="s">&#39;alias&#39;</span><span class="p">,)</span> <span class="c"># &#39;all&#39;,</span>

        <span class="c"># Name of tags to trace.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_tags</span> <span class="o">=</span> <span class="p">()</span>

        <span class="c"># Disable tracing for these kinds of trees.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suppress_kinds</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Attribute&#39;</span><span class="p">,)</span>

        <span class="c"># Disable tracing for trees with these tags.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suppress_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name context&#39;</span><span class="p">,)</span>

        <span class="c"># Don&#39;t show these tags (but allow tracing if enabled).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quiet_tags</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">,</span><span class="s">&#39;module body&#39;</span><span class="p">,)</span>
    <span class="c">#@+node:ekr.20111116103733.10311: *4* trace (AstTraverser)</span></div>
<div class="viewcode-block" id="AstTraverser.trace"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstTraverser.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># These are set in init_tracing</span>
        <span class="n">trace_kinds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_kinds</span>
        <span class="n">trace_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_tags</span>
        <span class="n">suppress_kinds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_kinds</span>
        <span class="n">suppress_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_tags</span>
        <span class="n">quiet_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quiet_tags</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kind</span><span class="p">:</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

        <span class="n">doTrace</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">trace_kinds</span> <span class="ow">or</span> <span class="n">kind</span> <span class="ow">in</span> <span class="n">trace_kinds</span> <span class="ow">or</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">trace_tags</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span>
            <span class="p">(</span><span class="n">kind</span> <span class="ow">in</span> <span class="n">suppress_kinds</span> <span class="ow">or</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">suppress_tags</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_flag</span> <span class="ow">and</span> <span class="n">doTrace</span><span class="p">:</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span>
            <span class="k">if</span> <span class="s">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">quiet_tags</span> <span class="ow">or</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">quiet_tags</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">tag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">kind</span><span class="p">))</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span><span class="n">kind</span><span class="p">))</span>
    <span class="c">#@-others</span>
<span class="c">#@-&lt;&lt; define class AstTraverser &gt;&gt;</span>
<span class="c">#@+&lt;&lt; define class Context &gt;&gt;</span>
<span class="c">#@+node:ekr.20111116103733.10402: ** &lt;&lt; define class Context &gt;&gt; (includes getters)</span></div></div>
<div class="viewcode-block" id="Context"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context">[docs]</a><span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;The base class of all context-related semantic data.</span>

<span class="sd">    All types ultimately resolve to a context.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Context: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span><span class="p">)</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="c"># Name is defined below.</span>
    <span class="c"># def name(self):</span>
        <span class="c"># &#39;&#39;&#39;Should be overriden by subclasses.&#39;&#39;&#39;</span>
        <span class="c"># return &#39;Context at %s&#39; % id(self)</span>

    <span class="c"># def __cmp__ (self,other):</span>
        <span class="c"># if   self.name() &lt;  other.name(): return -1</span>
        <span class="c"># elif self.name() == other.name(): return 0</span>
        <span class="c"># else:                             return 1</span>

    <span class="c"># def __hash__ (self):</span>
        <span class="c"># return self.name()</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10403: *3* cx ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="n">kind</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_context</span> <span class="o">=</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;comprehension&#39;</span><span class="p">,</span><span class="s">&#39;for&#39;</span><span class="p">,</span><span class="s">&#39;lambda&#39;</span><span class="p">,</span><span class="s">&#39;with&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="c"># assert kind in (&#39;class&#39;,&#39;comprehension&#39;,&#39;def&#39;,&#39;for&#39;,&#39;lambda&#39;,&#39;module&#39;,&#39;with&#39;),kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">formatter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span> <span class="o">=</span> <span class="n">parent_context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">sd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span> <span class="o">=</span> <span class="n">SymbolTable</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">n_contexts</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># Public semantic data: accessed via getters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># All call statements defined in this context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Classes defined in this context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Functions defined in this context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># List of all statements in the context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span> <span class="o">=</span> <span class="n">tree</span>

        <span class="c"># Private semantic data: no getters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c"># Names that appear in a global statement in this context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_contexts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># List of inner &#39;comprehension&#39;,&#39;for&#39;,&#39;lambda&#39;,&#39;with&#39; contexts.</span>

        <span class="c"># Record the name.ctx contexts.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>      <span class="c"># Names with ctx == &#39;Del&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>     <span class="c"># Names with ctx == &#39;Load&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>    <span class="c"># Names with ctx == &#39;Param&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>    <span class="c"># Names with ctx == &#39;Store&#39;</span>

        <span class="c"># Data for the resolution algorithm.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_global_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c"># Global names in all parent contexts.</span>

        <span class="c"># Compute the class context.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span> <span class="o">==</span> <span class="s">&#39;module&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_context</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span> <span class="o">==</span> <span class="s">&#39;class&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_context</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_context</span> <span class="o">=</span> <span class="n">parent_context</span><span class="o">.</span><span class="n">class_context</span>

        <span class="c"># Compute the defining context.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_temp_context</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defining_context</span> <span class="o">=</span> <span class="n">parent_context</span><span class="o">.</span><span class="n">defining_context</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defining_context</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c"># Compute the module context.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span> <span class="o">==</span> <span class="s">&#39;module&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module_context</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module_context</span> <span class="o">=</span> <span class="n">parent_context</span><span class="o">.</span><span class="n">module_context</span>
    <span class="c">#@+node:ekr.20120612044943.10220: *3* cx.__getstate__</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the representation of the Context class for use by pickle.&#39;&#39;&#39;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;calls&#39;</span><span class="p">:</span>        <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls_list</span><span class="p">],</span>
            <span class="s">&#39;classes&#39;</span><span class="p">:</span>      <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">],</span>
            <span class="s">&#39;defs&#39;</span><span class="p">:</span>         <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">],</span>
            <span class="s">&#39;statements&#39;</span><span class="p">:</span>   <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_list</span><span class="p">],</span>
            <span class="s">&#39;tree&#39;</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c"># g.trace(&#39;(Context)&#39;,d)</span>
        <span class="k">return</span> <span class="n">d</span>
    <span class="c">#@+node:ekr.20120611094414.10891: *3* cx.utilities</span>
    <span class="c">#@+node:ekr.20111116103733.10405: *4* cx.description &amp; name</span>
<div class="viewcode-block" id="Context.description"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.description">[docs]</a>    <span class="k">def</span> <span class="nf">description</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a description of this context and all parent contexts.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">:</span>
            <span class="k">return</span>  <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">description</span><span class="p">(),</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c"># All subclasses override name.</span></div>
    <span class="n">name</span> <span class="o">=</span> <span class="n">description</span>
    <span class="c">#@+node:ekr.20111116103733.10407: *4* cx.dump</span>
<div class="viewcode-block" id="Context.dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># Just print the context</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">level</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_contexts</span><span class="p">:</span>
                <span class="n">z</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120611094414.10881: *4* cx.format</span></div>
<div class="viewcode-block" id="Context.format"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a string containing the human-readable version of the entire context.&#39;&#39;&#39;</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">format</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">format</span><span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">Context</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Unexpected</span>
            <span class="k">return</span> <span class="s">&#39;***cx.format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c"># format_tree = format</span>
    <span class="c">#@+node:ekr.20111116103733.10404: *4* cx.tree_kind</span></div>
<div class="viewcode-block" id="Context.tree_kind"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.tree_kind">[docs]</a>    <span class="k">def</span> <span class="nf">tree_kind</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the class name of the tree node.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="c">#@+node:ekr.20111116161118.10113: *3* cx.getters</span>
    <span class="c">#@+node:ekr.20111116161118.10114: *4* cx.assignments &amp; helper</span></div>
<div class="viewcode-block" id="Context.assignments"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.assignments">[docs]</a>    <span class="k">def</span> <span class="nf">assignments</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_assignments</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_assignments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Context.all_assignments"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_assignments">[docs]</a>    <span class="k">def</span> <span class="nf">all_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_assignments</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_assignments</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Context.filter_assignments"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.filter_assignments">[docs]</a>    <span class="k">def</span> <span class="nf">filter_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return all the assignments in aList.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span>
            <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">context_kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;assn&#39;</span><span class="p">,</span><span class="s">&#39;aug-assn&#39;</span><span class="p">)]</span>
    <span class="c">#@+node:ekr.20111116161118.10115: *4* cx.assignments_to</span></div>
<div class="viewcode-block" id="Context.assignments_to"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.assignments_to">[docs]</a>    <span class="k">def</span> <span class="nf">assignments_to</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">format</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">,[]</span>

        <span class="k">for</span> <span class="n">assn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignments</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="nb">all</span><span class="p">):</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">assn</span><span class="o">.</span><span class="n">tree</span><span class="p">()</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_kind</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;Assign&#39;</span><span class="p">:</span>
                <span class="c"># Return the *entire* assignment if *any* of the targets match.</span>
                <span class="c"># The caller will have to filter the result.</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_kind</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span><span class="s">&#39;Name&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">s</span><span class="p">:</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assn</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lhs</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">lhs</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assn</span><span class="p">)</span>
                            <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;AugAssign&#39;</span><span class="p">,</span><span class="n">kind</span>
                <span class="n">lhs</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lhs</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116161118.10116: *4* cx.assignments_using</span></div>
<div class="viewcode-block" id="Context.assignments_using"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.assignments_using">[docs]</a>    <span class="k">def</span> <span class="nf">assignments_using</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">format</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">,[]</span>

        <span class="k">for</span> <span class="n">assn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignments</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="nb">all</span><span class="p">):</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">assn</span><span class="o">.</span><span class="n">tree</span><span class="p">()</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_kind</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Assign&#39;</span><span class="p">,</span><span class="s">&#39;AugAssign&#39;</span><span class="p">),</span><span class="n">kind</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">while</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assn</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111126074312.10386: *4* cx.calls &amp; helpers</span></div>
<div class="viewcode-block" id="Context.calls"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.calls">[docs]</a>    <span class="k">def</span> <span class="nf">calls</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_calls</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_calls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calls_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Context.all_calls"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_calls">[docs]</a>    <span class="k">def</span> <span class="nf">all_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calls_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_calls</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Context.filter_calls"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.filter_calls">[docs]</a>    <span class="k">def</span> <span class="nf">filter_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return all the calls in aList.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span>
            <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">context_kind</span> <span class="o">==</span> <span class="s">&#39;call&#39;</span><span class="p">]</span>
    <span class="c">#@+node:ekr.20111126074312.10384: *4* cx.calls_to</span></div>
<div class="viewcode-block" id="Context.calls_to"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.calls_to">[docs]</a>    <span class="k">def</span> <span class="nf">calls_to</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">format</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">,[]</span>

        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="nb">all</span><span class="p">):</span>
            <span class="c"># g.trace(call.format())</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">tree</span><span class="p">()</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">func</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111126074312.10400: *4* cx.call_args_of</span></div>
<div class="viewcode-block" id="Context.call_args_of"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.call_args_of">[docs]</a>    <span class="k">def</span> <span class="nf">call_args_of</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">format</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">,[]</span>

        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="nb">all</span><span class="p">):</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">tree</span><span class="p">()</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">func</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116161118.10163: *4* cx.classes</span></div>
<div class="viewcode-block" id="Context.classes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.classes">[docs]</a>    <span class="k">def</span> <span class="nf">classes</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_classes</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span>
</div>
<div class="viewcode-block" id="Context.all_classes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_classes">[docs]</a>    <span class="k">def</span> <span class="nf">all_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_classes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20120626085227.11131: *4* cx.contexts (new)</span></div>
<div class="viewcode-block" id="Context.contexts"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.contexts">[docs]</a>    <span class="k">def</span> <span class="nf">contexts</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">include_temp</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;An iterator returning all contexts.&#39;&#39;&#39;</span>

        <span class="k">yield</span> <span class="bp">self</span>

        <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">cx</span><span class="o">.</span><span class="n">contexts</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">z</span>

        <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">cx</span><span class="o">.</span><span class="n">contexts</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">z</span>

        <span class="k">if</span> <span class="n">include_temp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_contexts</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">cx</span><span class="o">.</span><span class="n">contexts</span><span class="p">():</span>
                    <span class="k">yield</span> <span class="n">z</span>

    <span class="c">#@+node:ekr.20111116161118.10164: *4* cx.defs</span></div>
<div class="viewcode-block" id="Context.defs"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.defs">[docs]</a>    <span class="k">def</span> <span class="nf">defs</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_defs</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span>
</div>
<div class="viewcode-block" id="Context.all_defs"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_defs">[docs]</a>    <span class="k">def</span> <span class="nf">all_defs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_defs</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116161118.10152: *4* cx.functions &amp; helpers</span></div>
<div class="viewcode-block" id="Context.functions"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.functions">[docs]</a>    <span class="k">def</span> <span class="nf">functions</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_functions</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Context.all_functions"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_functions">[docs]</a>    <span class="k">def</span> <span class="nf">all_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_functions</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116161118.10223: *5* cx.filter_functions &amp; is_function</span></div>
<div class="viewcode-block" id="Context.filter_functions"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.filter_functions">[docs]</a>    <span class="k">def</span> <span class="nf">filter_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_function</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Context.is_function"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.is_function">[docs]</a>    <span class="k">def</span> <span class="nf">is_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return True if f is a function, not a method.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20111126074312.10449: *4* cx.line_number</span></div>
<div class="viewcode-block" id="Context.line_number"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.line_number">[docs]</a>    <span class="k">def</span> <span class="nf">line_number</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">lineno</span>
    <span class="c">#@+node:ekr.20111116161118.10153: *4* cx.methods &amp; helpers</span></div>
<div class="viewcode-block" id="Context.methods"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.methods">[docs]</a>    <span class="k">def</span> <span class="nf">methods</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_methods</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_methods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Context.all_methods"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_methods">[docs]</a>    <span class="k">def</span> <span class="nf">all_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_methods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_methods</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116161118.10225: *5* cx.filter_functions &amp; is_function</span></div>
<div class="viewcode-block" id="Context.filter_methods"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.filter_methods">[docs]</a>    <span class="k">def</span> <span class="nf">filter_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_method</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Context.is_method"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.is_method">[docs]</a>    <span class="k">def</span> <span class="nf">is_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return True if f is a method, not a function.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20120626085227.11134: *4* cx.parent_contexts (new)</span></div>
<div class="viewcode-block" id="Context.parent_contexts"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.parent_contexts">[docs]</a>    <span class="k">def</span> <span class="nf">parent_contexts</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">cx</span><span class="o">.</span><span class="n">parent_context</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">parent_context</span><span class="p">)</span>
            <span class="n">cx</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">parent_context</span>

        <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116161118.10165: *4* cx.statements</span></div>
<div class="viewcode-block" id="Context.statements"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.statements">[docs]</a>    <span class="k">def</span> <span class="nf">statements</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_statements</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_list</span>
</div>
<div class="viewcode-block" id="Context.all_statements"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.all_statements">[docs]</a>    <span class="k">def</span> <span class="nf">all_statements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">result</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statements_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aList</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_list</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">all_statements</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111128103520.10259: *4* cx.token_range</span></div>
<div class="viewcode-block" id="Context.token_range"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.token_range">[docs]</a>    <span class="k">def</span> <span class="nf">token_range</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span>

        <span class="c"># return (</span>
            <span class="c"># g.toUnicode(self.byte_array[:tree.col_offset]),</span>
            <span class="c"># g.toUnicode(self.byte_array[:tree_end_col_offset]),</span>
        <span class="c"># )</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;col_offset&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;end_col_offset&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span><span class="n">tree</span><span class="o">.</span><span class="n">col_offset</span><span class="p">,</span><span class="n">tree</span><span class="o">.</span><span class="n">end_lineno</span><span class="p">,</span><span class="n">tree</span><span class="o">.</span><span class="n">end_col_offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116161118.10166: *4* cx.tree</span></div>
<div class="viewcode-block" id="Context.tree"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Context.tree">[docs]</a>    <span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the AST (Abstract Syntax Tree) associated with this query object</span>
<span class="sd">        (Context Class).  This tree can be passed to the format method for printing.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span>
    <span class="c">#@-others</span>
<span class="c">#@-&lt;&lt; define class Context &gt;&gt;</span>

<span class="c">#@+others</span>
<span class="c">#@+node:ekr.20111116103733.10540: **  inspect.module (Entry point)</span></div></div>
<div class="viewcode-block" id="module"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.module">[docs]</a><span class="k">def</span> <span class="nf">module</span> <span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">print_stats</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">print_times</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="s">&#39;&lt;string file&gt;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># s = LeoCoreFiles().get_source(fn)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">g_get_source</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;file not found: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fn</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sd</span><span class="p">:</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">SemanticData</span><span class="p">(</span><span class="n">controller</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">InspectTraverser</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">sd</span><span class="p">)</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">modules_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="n">sd</span><span class="o">.</span><span class="n">total_time</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t1</span>

    <span class="k">if</span> <span class="n">print_times</span><span class="p">:</span> <span class="n">sd</span><span class="o">.</span><span class="n">print_times</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">print_stats</span><span class="p">:</span> <span class="n">sd</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">module</span>
<span class="c">#@+node:ekr.20111116103733.10539: **  Top-level utilities</span>
<span class="c">#@+node:ekr.20111116103733.10337: *3* g_chain_base</span>
<span class="c"># This global function exists avoid duplicate code</span>
<span class="c"># in the Chain and SymbolTable classes.</span>
</div>
<div class="viewcode-block" id="g_chain_base"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_chain_base">[docs]</a><span class="k">def</span> <span class="nf">g_chain_base</span> <span class="p">(</span><span class="n">s</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Return the base of the id chain s, a plain string.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c"># The chain is empty.</span>
        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not happen: empty base&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;()&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c"># g.trace(base,s)</span>
        <span class="k">return</span> <span class="n">base</span>
<span class="c">#@+node:ekr.20120609070048.10397: *3* g_dump</span></div>
<div class="viewcode-block" id="g_dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_dump">[docs]</a><span class="k">def</span> <span class="nf">g_dump</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>

    <span class="k">global</span> <span class="n">g_dumper</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">g_dumper</span><span class="p">:</span>
        <span class="n">g_dumper</span> <span class="o">=</span> <span class="n">AstDumper</span><span class="p">()</span>

    <span class="n">dump</span> <span class="o">=</span> <span class="n">g_dumper</span><span class="o">.</span><span class="n">dumpTreeAsString</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">Context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Unexpected.</span>
        <span class="k">return</span> <span class="s">&#39;***g_dump: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="c">#@+node:ekr.20120625075849.10256: *3* g_files_in_dir</span></div>
<div class="viewcode-block" id="g_files_in_dir"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_files_in_dir">[docs]</a><span class="k">def</span> <span class="nf">g_files_in_dir</span> <span class="p">(</span><span class="n">theDir</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">extList</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">excludeDirs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Return a list of all Python files in the directory.</span>

<span class="sd">    Include all descendants if recursiveFlag is True.</span>

<span class="sd">    Include all file types if extList is None.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># if extList is None: extList = [&#39;.py&#39;]</span>
    <span class="k">if</span> <span class="n">excludeDirs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">excludeDirs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">theDir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize_join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
                <span class="n">junk</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_splitext</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">extList</span> <span class="ow">or</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extList</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">excludeDirs</span> <span class="ow">and</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">excludeDirs</span><span class="p">:</span>
                        <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extList</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">theDir</span><span class="p">,</span><span class="s">&#39;*</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ext</span><span class="p">)))</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
<span class="c">#@+node:ekr.20120611094414.10582: *3* g_find_function_call</span></div>
<div class="viewcode-block" id="g_find_function_call"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_find_function_call">[docs]</a><span class="k">def</span> <span class="nf">g_find_function_call</span> <span class="p">(</span><span class="n">tree</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Return the static name of the function being called.</span>

<span class="sd">    tree is the tree.func part of the Call node.&#39;&#39;&#39;</span>

    <span class="n">kind</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;str&#39;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;Name&#39;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;Attribute&#39;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">g_find_function_call</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># This is not an error.  Example:  (g())()</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;**unknown kind: </span><span class="si">%s</span><span class="s">**: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="n">g_format</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">s</span>
<span class="c">#@+node:ekr.20120609070048.10871: *3* g_format</span></div>
<div class="viewcode-block" id="g_format"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_format">[docs]</a><span class="k">def</span> <span class="nf">g_format</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Return a string containing the human-readable version of tree.&#39;&#39;&#39;</span>

    <span class="k">global</span> <span class="n">g_formatter</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">g_formatter</span><span class="p">:</span>
        <span class="n">g_formatter</span> <span class="o">=</span> <span class="n">AstFormatter</span><span class="p">()</span>

    <span class="n">format</span> <span class="o">=</span> <span class="n">g_formatter</span><span class="o">.</span><span class="n">format</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">Context</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">tree_ptr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Unexpected.</span>
        <span class="k">return</span> <span class="s">&#39;***g_format: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="c">#@+node:ekr.20120625092120.10573: *3* g_get_files_by_project_name</span></div>
<div class="viewcode-block" id="g_get_files_by_project_name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_get_files_by_project_name">[docs]</a><span class="k">def</span> <span class="nf">g_get_files_by_project_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>

    <span class="n">leo_path</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span> <span class="c"># Change these paths as required for your system.</span>
        <span class="s">&#39;coverage&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">r&#39;C:\Python26\Lib\site-packages\coverage-3.5b1-py2.6-win32.egg\coverage&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;.py&#39;</span><span class="p">],[</span><span class="s">&#39;.bzr&#39;</span><span class="p">,</span><span class="s">&#39;htmlfiles&#39;</span><span class="p">]),</span>
        <span class="s">&#39;leo&#39;</span><span class="p">:(</span>
            <span class="c"># r&#39;C:\leo.repo\trunk\leo\core&#39;,</span>
            <span class="n">leo_path</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;.py&#39;</span><span class="p">],[</span><span class="s">&#39;.bzr&#39;</span><span class="p">]),</span>
        <span class="s">&#39;lib2to3&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">r&#39;C:\Python26\Lib\lib2to3&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;.py&#39;</span><span class="p">],[</span><span class="s">&#39;tests&#39;</span><span class="p">]),</span>
        <span class="s">&#39;pylint&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">r&#39;C:\Python26\Lib\site-packages\pylint-0.25.1-py2.6.egg\pylint&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;.py&#39;</span><span class="p">],[</span><span class="s">&#39;.bzr&#39;</span><span class="p">,</span><span class="s">&#39;test&#39;</span><span class="p">]),</span>
        <span class="s">&#39;rope&#39;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s">r&#39;C:\Python26\Lib\site-packages\rope&#39;</span><span class="p">,[</span><span class="s">&#39;.py&#39;</span><span class="p">],[</span><span class="s">&#39;.bzr&#39;</span><span class="p">]),</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;bad project name: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">theDir</span><span class="p">,</span><span class="n">extList</span><span class="p">,</span><span class="n">excludeDirs</span><span class="o">=</span><span class="n">data</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">g_files_in_dir</span><span class="p">(</span><span class="n">theDir</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">extList</span><span class="o">=</span><span class="n">extList</span><span class="p">,</span><span class="n">excludeDirs</span><span class="o">=</span><span class="n">excludeDirs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;leo&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">exclude</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;__init__.py&#39;</span><span class="p">,</span><span class="s">&#39;format-code.py&#39;</span><span class="p">]:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">z</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">exclude</span><span class="p">)]</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">theDir</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;plugins&#39;</span><span class="p">,</span><span class="s">&#39;qtGui.py&#39;</span><span class="p">)</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">files</span>
<span class="c">#@+node:ekr.20120626085227.11133: *3* g_get_source (new)</span></div>
<div class="viewcode-block" id="g_get_source"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_get_source">[docs]</a><span class="k">def</span> <span class="nf">g_get_source</span> <span class="p">(</span><span class="n">fn</span><span class="p">):</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span> <span class="c"># Caller gives error message.</span>
<span class="c">#@+node:ekr.20120609070048.11466: *3* g_kind</span></div>
<div class="viewcode-block" id="g_kind"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_kind">[docs]</a><span class="k">def</span> <span class="nf">g_kind</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;None&#39;</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="s">&#39;__class__&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># unexpected:</span>
        <span class="k">return</span> <span class="s">&#39;***g_kind: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="c">#@+node:ekr.20111116103733.10290: *3* g_node_after_tree</span>
<span class="c"># The _parent must have been injected into all parent nodes for this to work.</span>
<span class="c"># This will be so, because of the way in which visit traverses the tree.</span>
</div>
<div class="viewcode-block" id="g_node_after_tree"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.g_node_after_tree">[docs]</a><span class="k">def</span> <span class="nf">g_node_after_tree</span> <span class="p">(</span><span class="n">tree</span><span class="p">):</span>

    <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">tree1</span> <span class="o">=</span> <span class="n">tree</span> <span class="c"># For tracing</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">iter_child_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;_parent&#39;</span><span class="p">):</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;***no _parent: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;_parent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">_parent</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="n">sibs</span> <span class="o">=</span> <span class="n">children</span><span class="p">(</span><span class="n">parent</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">sibs</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">sibs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sibs</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">sibs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">while</span> <span class="n">tree</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="c"># A bug found by stc.ScopeBinder!</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">,</span><span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree1</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;node: </span><span class="si">%22s</span><span class="s">, parent: </span><span class="si">%22s</span><span class="s">, after: </span><span class="si">%22s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">info</span><span class="p">(</span><span class="n">tree1</span><span class="p">),</span><span class="n">info</span><span class="p">(</span><span class="n">parent</span><span class="p">(</span><span class="n">tree1</span><span class="p">)),</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">result</span>
<span class="c">#@+node:ekr.20111116103733.10257: ** class AstDumper</span></div>
<div class="viewcode-block" id="AstDumper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper">[docs]</a><span class="k">class</span> <span class="nc">AstDumper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class that dumps ast trees in various formats.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;=&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brief</span> <span class="o">=</span> <span class="n">brief</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setOptions</span><span class="p">()</span>

        <span class="c"># Set by string_dump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10258: *3* setOptions</span>
<div class="viewcode-block" id="AstDumper.setOptions"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.setOptions">[docs]</a>    <span class="k">def</span> <span class="nf">setOptions</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">annotate_fields</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="c"># True: include attribute names.</span>
        <span class="n">include_attributes</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
            <span class="c"># True: include lineno and col_offset attributes.</span>
        <span class="n">stripBody</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
        <span class="n">outStream</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="p">):</span>

       <span class="bp">self</span><span class="o">.</span><span class="n">annotate_fields</span> <span class="o">=</span> <span class="n">annotate_fields</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">include_attributes</span> <span class="o">=</span> <span class="n">include_attributes</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">stripBody</span> <span class="o">=</span> <span class="n">stripBody</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">outStream</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20111116103733.10259: *3* Top level (AstDumper)</span>
    <span class="c">#@+node:ekr.20111116103733.10260: *4* dumpFileAsNodes/String</span></div>
<div class="viewcode-block" id="AstDumper.dumpFileAsNodes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.dumpFileAsNodes">[docs]</a>    <span class="k">def</span> <span class="nf">dumpFileAsNodes</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Write the node representation of the closed file</span>
<span class="sd">        whose name is fn to outStream.&#39;&#39;&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_input_file</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumpStringAsNodes</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="n">brief</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="n">outStream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="AstDumper.dumpFileAsString"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.dumpFileAsString">[docs]</a>    <span class="k">def</span> <span class="nf">dumpFileAsString</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Write the string representation of the close file</span>
<span class="sd">        whose name is fn to outStream.&#39;&#39;&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_input_file</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumpStringAsString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="n">brief</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="n">outStream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111116103733.10261: *4* dumpStringAsNodes/String</span></div>
<div class="viewcode-block" id="AstDumper.dumpStringAsNodes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.dumpStringAsNodes">[docs]</a>    <span class="k">def</span> <span class="nf">dumpStringAsNodes</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Write the node representation string s to outStream.&#39;&#39;&#39;</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brief</span> <span class="o">=</span> <span class="n">brief</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpTreeAsNodes</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outStream</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeAndClose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">outStream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="AstDumper.dumpStringAsString"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.dumpStringAsString">[docs]</a>    <span class="k">def</span> <span class="nf">dumpStringAsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Write the node representation string s to outStream.&#39;&#39;&#39;</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brief</span> <span class="o">=</span> <span class="n">brief</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpTreeAsString</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outStream</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeAndClose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">outStream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111116103733.10262: *4* dumpTreeAsNodes/String</span></div>
<div class="viewcode-block" id="AstDumper.dumpTreeAsNodes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.dumpTreeAsNodes">[docs]</a>    <span class="k">def</span> <span class="nf">dumpTreeAsNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Write the node representation the ast tree to outStream.&#39;&#39;&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpTreeAsNodes</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="n">brief</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outStream</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeAndClose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">outStream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="AstDumper.dumpTreeAsString"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.dumpTreeAsString">[docs]</a>    <span class="k">def</span> <span class="nf">dumpTreeAsString</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Write the string representation the ast tree to outStream.&#39;&#39;&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dumpTreeAsString</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="n">brief</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">outStream</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeAndClose</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">outStream</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111116103733.10263: *3* Helpers</span>
    <span class="c">#@+node:ekr.20111116103733.10264: *4* _dumpAstNode</span></div>
    <span class="k">def</span> <span class="nf">_dumpAstNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">fieldname</span><span class="p">):</span>

        <span class="c"># Visit the node.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_put</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
        <span class="c"># put(node.__class__.__name__,&#39;name&#39;) # valid</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">iter_fields</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,(),[],{})]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_putList</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="c"># ,&#39;_fields&#39;)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">_attributes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;lineno&#39;</span><span class="p">,</span><span class="s">&#39;col_offset&#39;</span><span class="p">,)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_putList</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span><span class="s">&#39;_attrs&#39;</span><span class="p">)</span>

        <span class="c"># Visit the children</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># The number of spaces for each indentation.</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">iter_child_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="n">delta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dumpAstNode</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="s">&#39;child&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="n">delta</span>
    <span class="c">#@+node:ekr.20111116103733.10265: *4* _dumpTreeAsNodes</span>
    <span class="k">def</span> <span class="nf">_dumpTreeAsNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="c"># annotate_fields=True,include_attributes=False):</span>
        <span class="c"># self.annotate_fields = annotate_fields</span>
        <span class="c"># self.include_attributes = include_attributes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brief</span> <span class="o">=</span> <span class="n">brief</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpAstNode</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">fieldname</span><span class="o">=</span><span class="s">&#39;root&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10266: *4* _dumpTreeAsString (AstDumper) &amp; helpers</span>
    <span class="k">def</span> <span class="nf">_dumpTreeAsString</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">brief</span> <span class="o">=</span> <span class="n">brief</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span>
            <span class="n">annotate_fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotate_fields</span><span class="p">,</span>
            <span class="n">include_attributes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">include_attributes</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stripBody</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stripBody</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">brief</span><span class="p">:</span>
            <span class="n">put_brackets</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">put_brackets</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">put_brackets</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compress</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="c"># Not needed if we don&#39;t print brackets.</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_cruft</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">put_brackets</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compact</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111116103733.10267: *5* _compress (used only if putting brackets)</span>
    <span class="k">def</span> <span class="nf">_compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Compress needlessly indented lines.&#39;&#39;&#39;</span>

        <span class="n">i</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,[]</span>
        <span class="n">in_bracket</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># inside bracket or paren.</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># start of bracket or paren.</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ch2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_bracket</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;([&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ch2</span> <span class="ow">in</span> <span class="s">&#39;)]&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_bracket</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Accumulate only one level of bracket or paren.</span>
                    <span class="k">if</span> <span class="n">in_bracket</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">in_bracket</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;)]&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">in_bracket</span><span class="p">:</span>
                    <span class="n">in_bracket</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">in_bracket</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">progress</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="n">in_bracket</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10268: *5* _compact</span>
    <span class="k">def</span> <span class="nf">_compact</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Move closing brackets appearing on a separate line</span>
<span class="sd">        at the end of the previous line.&#39;&#39;&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;)&#39;</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">+</span><span class="n">ch</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10269: *5* _skip_block</span>
    <span class="k">def</span> <span class="nf">_skip_block</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

        <span class="n">delim1</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">tags</span><span class="p">,</span><span class="n">tags2</span> <span class="o">=</span> <span class="s">&#39;([{&#39;</span><span class="p">,</span><span class="s">&#39;)]}&#39;</span>
        <span class="k">assert</span> <span class="n">delim1</span> <span class="ow">in</span> <span class="n">tags</span>
        <span class="n">delim2</span> <span class="o">=</span> <span class="n">tags2</span><span class="p">[</span><span class="n">tags</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">delim1</span><span class="p">)]</span>
        <span class="c"># g.trace(i,delim1,delim2)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&quot;&#39;&quot;</span><span class="p">,):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">delim1</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">delim2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="n">progress</span> <span class="o">&lt;</span> <span class="n">i</span>

        <span class="k">return</span> <span class="n">i</span>
    <span class="c">#@+node:ekr.20111116103733.10270: *5* _indent</span>
    <span class="k">def</span> <span class="nf">_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">put_brackets</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Pretty print the output of ast.dump.&#39;&#39;&#39;</span>
        <span class="n">i</span><span class="p">,</span><span class="n">result</span><span class="p">,</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,[],</span><span class="n">level</span><span class="o">*</span><span class="mi">4</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ch2</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="n">ch3</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Str(&#39;</span><span class="p">:</span>
                <span class="c"># Special case string: keep the string on the same line.</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Str(&#39;</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="n">indent</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;[...]&#39;</span><span class="p">:</span>
                <span class="c"># Special case for the elision created by stripBody.</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;([{&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ch2</span> <span class="ow">in</span> <span class="s">&#39;)]}&#39;</span><span class="p">:</span> <span class="c"># Assume the brackets match.</span>
                    <span class="k">if</span> <span class="bp">True</span><span class="p">:</span> <span class="c"># put_brackets:</span>
                        <span class="c"># Put them in soe remove_cruft can take them out.</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch2</span><span class="p">)</span> <span class="c"># Bug fix: 2011/04/04</span>
                    <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;[...&#39;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">indent</span> <span class="o">+=</span> <span class="mi">4</span>
                    <span class="k">if</span> <span class="n">put_brackets</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">...</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;)]}&#39;</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">-=</span> <span class="mi">4</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c"># 2011/04/05: Put closing paren on new line.</span>
                <span class="c"># _remove_cruft will clean things up later.</span>
                <span class="k">if</span> <span class="n">put_brackets</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span><span class="p">,</span><span class="n">ch</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">indent</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;,&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ch2</span> <span class="ow">in</span> <span class="s">&#39;)]}&#39;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># Skip the comma.</span>
                    <span class="k">if</span> <span class="n">ch3</span> <span class="o">==</span> <span class="s">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># Skip the blank</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="s">&#39; &#39;</span> <span class="o">*</span><span class="n">indent</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">ch2</span> <span class="o">==</span> <span class="s">&#39; &#39;</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span> <span class="c"># Skip the comma and the blank.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c"># Skip the comma.</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39; &#39;</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">progress</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10271: *5* _remove_cruft</span>
    <span class="k">def</span> <span class="nf">_remove_cruft</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">remove_empty_fields</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;ctx=Store()&#39;</span><span class="p">,</span><span class="s">&#39;ctx=Store&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;ctx=Load()&#39;</span><span class="p">,</span><span class="s">&#39;ctx=Load&#39;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;ctx=Param()&#39;</span><span class="p">,</span><span class="s">&#39;ctx=Param&#39;</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c"># &#39;ctx=Store&#39;,</span>
            <span class="c"># &#39;ctx=Load&#39;,</span>
            <span class="c"># &#39;ctx=Param&#39;,</span>
            <span class="s">&#39;args=[]&#39;</span><span class="p">,</span>
            <span class="s">&#39;bases=[]&#39;</span><span class="p">,</span>
            <span class="s">&#39;decorator_list=[]&#39;</span><span class="p">,</span>
            <span class="s">&#39;defaults=[]&#39;</span><span class="p">,</span>
            <span class="s">&#39;keywords=[]&#39;</span><span class="p">,</span>
            <span class="s">&#39;kwarg=None&#39;</span><span class="p">,</span>
            <span class="s">&#39;kwargs=None&#39;</span><span class="p">,</span>
            <span class="s">&#39;starargs=None&#39;</span><span class="p">,</span>
            <span class="s">&#39;vararg=None&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">remove_empty_fields</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">splitLines</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">s2</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s2</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">s2</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="n">s2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="n">s2</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c"># Removing trailing commas helps _compact a lot.</span>
        <span class="c"># Should be safe: strings do not cross lines.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="c">#@+node:ekr.20111116103733.10272: *5* _stripBody</span>
    <span class="k">def</span> <span class="nf">_stripBody</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Abbreviate the top-level body list.&#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;ClassDef&#39;</span><span class="p">,</span><span class="s">&#39;FunctionDef&#39;</span><span class="p">,</span><span class="s">&#39;Module&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;body=[&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;body=[...])&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111116103733.10273: *4* _put &amp; _putList</span>
    <span class="k">def</span> <span class="nf">_put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">ws</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span>
        <span class="k">if</span> <span class="n">tag</span><span class="p">:</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_putList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_put</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10274: *4* _skipString</span>
    <span class="k">def</span> <span class="nf">_skipString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Scan forward to the end of a string.&#39;&#39;&#39;</span>

        <span class="n">delim</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">delim</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&quot;&#39;&quot;</span><span class="p">,)</span>

        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="n">delim</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10275: *4* _writeAndClose</span>
    <span class="k">def</span> <span class="nf">_writeAndClose</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">outStream</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toUnicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outStream</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;writing&#39;</span><span class="p">,</span><span class="n">outStream</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">outStream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">outStream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10276: *4* error (AstDumper)</span>
<div class="viewcode-block" id="AstDumper.error"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10277: *4* read_input_file</span></div>
<div class="viewcode-block" id="AstDumper.read_input_file"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstDumper.read_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_input_file</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;can not open </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20111117031039.10133: ** class AstFormatter (AstTraverser)</span></div></div>
<div class="viewcode-block" id="AstFormatter"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter">[docs]</a><span class="k">class</span> <span class="nc">AstFormatter</span><span class="p">(</span><span class="n">AstTraverser</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to recreate source code from an AST.</span>

<span class="sd">    This does not have to be perfect, but it should be close.</span>

<span class="sd">    Also supports optional annotations such as line numbers, file names, etc.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111125131712.10297: *3*  f.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">AstTraverser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>
            <span class="c"># Init the base class.</span>
            <span class="c"># Sets the dispatch table.</span>
            <span class="c"># Calls init_tracing.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Indentation level.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c">#@+node:ekr.20111117031039.10260: *3* f.format</span>
<div class="viewcode-block" id="AstFormatter.format"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10093: *3* f.indent</span></div>
<div class="viewcode-block" id="AstFormatter.indent"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.indent">[docs]</a>    <span class="k">def</span> <span class="nf">indent</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10395: *3* f.visit</span></div>
    <span class="n">bad_names</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="AstFormatter.visit"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.visit">[docs]</a>    <span class="k">def</span> <span class="nf">visit</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Visit the ast tree node, dispatched by node type.&#39;&#39;&#39;</span>

        <span class="n">kind</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">__class__</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_table</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="c"># val = f(tree)</span>
            <span class="c"># if val is None and f.__name__ not in self.bad_names:</span>
                <span class="c"># g.trace(&#39;returns None: %s&#39;,f.__name__)</span>
                <span class="c"># self.bad_names.append(f.__name__)</span>
                <span class="c"># val = &#39;*** None&#39;</span>
            <span class="c"># return val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&lt;bad ast type: </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">kind</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;**** </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111117031039.10193: *3* f.Contexts</span>
    <span class="c">#@+node:ekr.20111117031039.10194: *4* f.ClassDef</span>
    <span class="c"># ClassDef(identifier name, expr* bases, stmt* body, expr* decorator_list)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_ClassDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_ClassDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_ClassDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">bases</span><span class="p">]</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">bases</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">bases</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;class </span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">):</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bases</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;class </span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10195: *4* f.FunctionDef</span>
    <span class="c"># FunctionDef(identifier name, arguments args, stmt* body, expr* decorator_list)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_FunctionDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_FunctionDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_FunctionDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">decorator_list</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;@</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;def </span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">):</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">args</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10197: *4* f.Module</span></div>
<div class="viewcode-block" id="AstFormatter.do_Module"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Module">[docs]</a>    <span class="k">def</span> <span class="nf">do_Module</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span>  <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">])</span>
    <span class="c">#@+node:ekr.20120614011356.10107: *3* f.Exceptions</span>
    <span class="c">#@+node:ekr.20120614011356.10091: *4* f.ExceptHandler</span></div>
<div class="viewcode-block" id="AstFormatter.do_ExceptHandler"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_ExceptHandler">[docs]</a>    <span class="k">def</span> <span class="nf">do_ExceptHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;except&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; as </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10092: *4* f.TryExcept</span></div>
<div class="viewcode-block" id="AstFormatter.do_TryExcept"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_TryExcept">[docs]</a>    <span class="k">def</span> <span class="nf">do_TryExcept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;try:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="n">tree</span><span class="o">.</span><span class="n">handlers</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10089: *4* f.TryFinally</span></div>
<div class="viewcode-block" id="AstFormatter.do_TryFinally"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_TryFinally">[docs]</a>    <span class="k">def</span> <span class="nf">do_TryFinally</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;try:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;finally:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">finalbody</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10198: *3* f.Operands</span>
    <span class="c">#@+node:ekr.20120614011356.10103: *4* f.Expr &amp; Expression</span></div>
<div class="viewcode-block" id="AstFormatter.do_Expr"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Expr">[docs]</a>    <span class="k">def</span> <span class="nf">do_Expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;An outer expression: must be indented.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Expression"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Expression">[docs]</a>    <span class="k">def</span> <span class="nf">do_Expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;An inner expression: do not indent.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10696: *4* f.arg</span></div>
<div class="viewcode-block" id="AstFormatter.do_arg"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_arg">[docs]</a>    <span class="k">def</span> <span class="nf">do_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10683: *4* f.arguments</span>
    <span class="c"># arguments = (expr* args, identifier? vararg, identifier? kwarg, expr* defaults)</span>
    <span class="c"># -- keyword arguments supplied to call</span>
    <span class="c"># keyword = (identifier arg, expr value)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_arguments"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">do_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;arguments&#39;</span><span class="p">,</span><span class="n">kind</span>

        <span class="n">args</span>     <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">defaults</span><span class="p">]</span>

        <span class="c"># Assign default values to the last args.</span>
        <span class="n">args2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_plain</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_plain</span><span class="p">:</span>
                <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">defaults</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">n_plain</span><span class="p">]))</span>

        <span class="c"># Now add the vararg and kwarg args.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;vararg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">vararg</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;kwarg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwarg</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span> <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;**&#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10199: *4* f.Attribute &amp; helper</span>
    <span class="c"># Attribute(expr value, identifier attr, expr_context ctx)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Attribute"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Attribute">[docs]</a>    <span class="k">def</span> <span class="nf">do_Attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">attr</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20111117031039.10208: *4* f.Call</span></div>
<div class="viewcode-block" id="AstFormatter.do_Call"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Call">[docs]</a>    <span class="k">def</span> <span class="nf">do_Call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;starargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;*</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;**</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)))</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20111117031039.10558: *4* f.Dict</span></div>
<div class="viewcode-block" id="AstFormatter.do_Dict"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Dict">[docs]</a>    <span class="k">def</span> <span class="nf">do_Dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span>   <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keys</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">keys</span> <span class="k">else</span> <span class="s">&#39;{&#39;</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  </span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;,</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">}&#39;</span> <span class="k">if</span> <span class="n">keys</span> <span class="k">else</span> <span class="s">&#39;}&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*** Error *** keys: </span><span class="si">%s</span><span class="s"> values: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10572: *4* f.ExtSlice</span></div>
<div class="viewcode-block" id="AstFormatter.do_ExtSlice"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_ExtSlice">[docs]</a>    <span class="k">def</span> <span class="nf">do_ExtSlice</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">dims</span><span class="p">])</span>
    <span class="c">#@+node:ekr.20120614011356.10104: *4* f.Generator</span></div>
<div class="viewcode-block" id="AstFormatter.do_GeneratorExp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_GeneratorExp">[docs]</a>    <span class="k">def</span> <span class="nf">do_GeneratorExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">elt</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">elt</span><span class="p">)</span>

        <span class="n">gens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">generators</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">&#39;&lt;gen </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elt</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gens</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20111117031039.10571: *4* f.Index</span></div>
<div class="viewcode-block" id="AstFormatter.do_Index"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Index">[docs]</a>    <span class="k">def</span> <span class="nf">do_Index</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10354: *4* f.Keyword</span>
    <span class="c"># keyword = (identifier arg, expr value)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Keyword"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Keyword">[docs]</a>    <span class="k">def</span> <span class="nf">do_Keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="c"># tree.arg is a string.</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="c"># This is a keyword *arg*, not a Python keyword!</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10567: *4* f.List</span></div>
<div class="viewcode-block" id="AstFormatter.do_List"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_List">[docs]</a>    <span class="k">def</span> <span class="nf">do_List</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="c"># Not used: list context.</span>
        <span class="c"># self.visit(tree.ctx)</span>

        <span class="n">elts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">elts</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elts</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10204: *4* f.ListComp &amp; Comprehension</span></div>
<div class="viewcode-block" id="AstFormatter.do_ListComp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_ListComp">[docs]</a>    <span class="k">def</span> <span class="nf">do_ListComp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">elt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">elt</span><span class="p">)</span>

        <span class="n">gens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">generators</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">elt</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gens</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_comprehension"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_comprehension">[docs]</a>    <span class="k">def</span> <span class="nf">do_comprehension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="c"># A name.</span>
        <span class="n">it</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span> <span class="c"># An attribute.</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">it</span><span class="p">))</span>

        <span class="n">ifs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">ifs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ifs</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39; if </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ifs</span><span class="p">)))</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10203: *4* f.Name</span></div>
<div class="viewcode-block" id="AstFormatter.do_Name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Name">[docs]</a>    <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span>
    <span class="c">#@+node:ekr.20120614011356.10080: *4* f.Repr</span>
    <span class="c"># Python 2.x only</span></div>
<div class="viewcode-block" id="AstFormatter.do_Repr"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Repr">[docs]</a>    <span class="k">def</span> <span class="nf">do_Repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;repr(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10573: *4* f.Slice</span></div>
<div class="viewcode-block" id="AstFormatter.do_Slice"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Slice">[docs]</a>    <span class="k">def</span> <span class="nf">do_Slice</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">,</span><span class="n">step</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;lower&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;upper&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;step&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10455: *4* f.Str &amp; str</span></div>
<div class="viewcode-block" id="AstFormatter.do_str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_str">[docs]</a>    <span class="k">def</span> <span class="nf">do_str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">s</span> <span class="c"># Not repr(s)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Str">[docs]</a>    <span class="k">def</span> <span class="nf">do_Str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20111117031039.10574: *4* f.Subscript</span>
    <span class="c"># Subscript(expr value, slice slice, expr_context ctx)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Subscript"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Subscript">[docs]</a>    <span class="k">def</span> <span class="nf">do_Subscript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">the_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">slice</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">the_slice</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10560: *4* f.Tuple</span></div>
<div class="viewcode-block" id="AstFormatter.do_Tuple"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Tuple">[docs]</a>    <span class="k">def</span> <span class="nf">do_Tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">elts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">elts</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">&#39;(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elts</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10557: *4* formatter:simple operands</span>
    <span class="c"># Python 2.x only.</span></div>
<div class="viewcode-block" id="AstFormatter.do_bool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_bool">[docs]</a>    <span class="k">def</span> <span class="nf">do_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span> <span class="c">###</span>

    <span class="c"># Python 3.x only.</span></div>
<div class="viewcode-block" id="AstFormatter.do_Bytes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Bytes">[docs]</a>    <span class="k">def</span> <span class="nf">do_Bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">isPython3</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Ellipsis"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Ellipsis">[docs]</a>    <span class="k">def</span> <span class="nf">do_Ellipsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;...&#39;</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_int"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_int">[docs]</a>    <span class="k">def</span> <span class="nf">do_int</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Num"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Num">[docs]</a>    <span class="k">def</span> <span class="nf">do_Num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10421: *3* f.Operators</span>
    <span class="c">#@+node:ekr.20111117031039.10487: *4* f.BinOp</span></div>
<div class="viewcode-block" id="AstFormatter.do_BinOp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_BinOp">[docs]</a>    <span class="k">def</span> <span class="nf">do_BinOp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">left</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>

    <span class="c">#@+node:ekr.20111117031039.10488: *4* f.BoolOp</span></div>
<div class="viewcode-block" id="AstFormatter.do_BoolOp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_BoolOp">[docs]</a>    <span class="k">def</span> <span class="nf">do_BoolOp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20111117031039.10489: *4* f.Compare</span></div>
<div class="viewcode-block" id="AstFormatter.do_Compare"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Compare">[docs]</a>    <span class="k">def</span> <span class="nf">do_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lt</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">ops</span>   <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">ops</span><span class="p">]</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">comparators</span><span class="p">]</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ops</span><span class="p">)):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">comps</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;ops&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">ops</span><span class="p">),</span><span class="s">&#39;comparators&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">comps</span><span class="p">))</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10495: *4* f.UnaryOp</span></div>
<div class="viewcode-block" id="AstFormatter.do_UnaryOp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_UnaryOp">[docs]</a>    <span class="k">def</span> <span class="nf">do_UnaryOp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10491: *4* f.arithmetic operators</span>
    <span class="c"># operator = Add | BitAnd | BitOr | BitXor | Div</span>
    <span class="c"># FloorDiv | LShift | Mod | Mult | Pow | RShift | Sub | </span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Add"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Add">[docs]</a>    <span class="k">def</span> <span class="nf">do_Add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>       <span class="k">return</span> <span class="s">&#39;+&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_BitAnd"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_BitAnd">[docs]</a>    <span class="k">def</span> <span class="nf">do_BitAnd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;&amp;&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_BitOr"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_BitOr">[docs]</a>    <span class="k">def</span> <span class="nf">do_BitOr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>     <span class="k">return</span> <span class="s">&#39;|&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_BitXor"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_BitXor">[docs]</a>    <span class="k">def</span> <span class="nf">do_BitXor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;^&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Div"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Div">[docs]</a>    <span class="k">def</span> <span class="nf">do_Div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>       <span class="k">return</span> <span class="s">&#39;/&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_FloorDiv"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_FloorDiv">[docs]</a>    <span class="k">def</span> <span class="nf">do_FloorDiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>  <span class="k">return</span> <span class="s">&#39;//&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_LShift"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_LShift">[docs]</a>    <span class="k">def</span> <span class="nf">do_LShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;&lt;&lt;&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Mod"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Mod">[docs]</a>    <span class="k">def</span> <span class="nf">do_Mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>       <span class="k">return</span> <span class="s">&#39;%&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Mult"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Mult">[docs]</a>    <span class="k">def</span> <span class="nf">do_Mult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>      <span class="k">return</span> <span class="s">&#39;*&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Pow"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Pow">[docs]</a>    <span class="k">def</span> <span class="nf">do_Pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>       <span class="k">return</span> <span class="s">&#39;**&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_RShift"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_RShift">[docs]</a>    <span class="k">def</span> <span class="nf">do_RShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;&gt;&gt;&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Sub"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Sub">[docs]</a>    <span class="k">def</span> <span class="nf">do_Sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>       <span class="k">return</span> <span class="s">&#39;-&#39;</span>
    <span class="c">#@+node:ekr.20111117031039.10490: *4* f.boolean operators</span>
    <span class="c"># boolop = And | Or</span></div>
<div class="viewcode-block" id="AstFormatter.do_And"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_And">[docs]</a>    <span class="k">def</span> <span class="nf">do_And</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>   <span class="k">return</span> <span class="s">&#39; and &#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Or"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Or">[docs]</a>    <span class="k">def</span> <span class="nf">do_Or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39; or &#39;</span>
    <span class="c">#@+node:ekr.20111117031039.10492: *4* f.comparison operators</span>
    <span class="c"># cmpop = Eq | Gt | GtE | In | Is | IsNot | Lt | LtE | NotEq | NotIn</span></div>
<div class="viewcode-block" id="AstFormatter.do_Eq"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Eq">[docs]</a>    <span class="k">def</span> <span class="nf">do_Eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;==&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Gt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Gt">[docs]</a>    <span class="k">def</span> <span class="nf">do_Gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;&gt;&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_GtE"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_GtE">[docs]</a>    <span class="k">def</span> <span class="nf">do_GtE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>   <span class="k">return</span> <span class="s">&#39;&gt;=&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_In"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_In">[docs]</a>    <span class="k">def</span> <span class="nf">do_In</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39; in &#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Is"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Is">[docs]</a>    <span class="k">def</span> <span class="nf">do_Is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39; is &#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_IsNot"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_IsNot">[docs]</a>    <span class="k">def</span> <span class="nf">do_IsNot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39; is not &#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Lt"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Lt">[docs]</a>    <span class="k">def</span> <span class="nf">do_Lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>    <span class="k">return</span> <span class="s">&#39;&lt;&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_LtE"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_LtE">[docs]</a>    <span class="k">def</span> <span class="nf">do_LtE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>   <span class="k">return</span> <span class="s">&#39;&lt;=&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_NotEq"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_NotEq">[docs]</a>    <span class="k">def</span> <span class="nf">do_NotEq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39;!=&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_NotIn"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_NotIn">[docs]</a>    <span class="k">def</span> <span class="nf">do_NotIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39; not in &#39;</span>
    <span class="c">#@+node:ekr.20120609070048.11084: *4* f.ternary op (ifExp)</span></div>
<div class="viewcode-block" id="AstFormatter.do_IfExp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_IfExp">[docs]</a>    <span class="k">def</span> <span class="nf">do_IfExp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> if </span><span class="si">%s</span><span class="s"> else </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20111117031039.10493: *4* f.expression operators</span></div>
<div class="viewcode-block" id="AstFormatter.do_op"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_op">[docs]</a>    <span class="k">def</span> <span class="nf">do_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
</div>
    <span class="n">do_AugLoad</span>  <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_AugStore</span> <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Del</span>      <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Load</span>     <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Param</span>    <span class="o">=</span> <span class="n">do_op</span>
    <span class="n">do_Store</span>    <span class="o">=</span> <span class="n">do_op</span>
    <span class="c">#@+node:ekr.20111117031039.10494: *4* f.unary opertors</span>
    <span class="c"># unaryop = Invert | Not | UAdd | USub</span>

<div class="viewcode-block" id="AstFormatter.do_Invert"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Invert">[docs]</a>    <span class="k">def</span> <span class="nf">do_Invert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>   <span class="k">return</span> <span class="s">&#39;~&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_Not"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Not">[docs]</a>    <span class="k">def</span> <span class="nf">do_Not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>      <span class="k">return</span> <span class="s">&#39; not &#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_UAdd"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_UAdd">[docs]</a>    <span class="k">def</span> <span class="nf">do_UAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>     <span class="k">return</span> <span class="s">&#39;+&#39;</span></div>
<div class="viewcode-block" id="AstFormatter.do_USub"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_USub">[docs]</a>    <span class="k">def</span> <span class="nf">do_USub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>     <span class="k">return</span> <span class="s">&#39;-&#39;</span>
    <span class="c">#@+node:ekr.20111117031039.10205: *3* f.Statements</span>
    <span class="c">#@+node:ekr.20120614011356.10084: *4* f.Assert</span></div>
<div class="viewcode-block" id="AstFormatter.do_Assert"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Assert">[docs]</a>    <span class="k">def</span> <span class="nf">do_Assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;msg&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;assert </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="n">message</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;assert </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">test</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10206: *4* f.Assign</span></div>
<div class="viewcode-block" id="AstFormatter.do_Assign"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Assign">[docs]</a>    <span class="k">def</span> <span class="nf">do_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">assns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">targets</span><span class="p">]</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">assns</span><span class="p">])</span>
    <span class="c">#@+node:ekr.20111117031039.10207: *4* f.AugAssign</span></div>
<div class="viewcode-block" id="AstFormatter.do_AugAssign"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_AugAssign">[docs]</a>    <span class="k">def</span> <span class="nf">do_AugAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">=</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
    <span class="c">#@+node:ekr.20120614011356.10083: *4* f.Break and f.Continue</span></div>
<div class="viewcode-block" id="AstFormatter.do_Break"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Break">[docs]</a>    <span class="k">def</span> <span class="nf">do_Break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;break</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AstFormatter.do_Continue"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Continue">[docs]</a>    <span class="k">def</span> <span class="nf">do_Continue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;continue</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10085: *4* f.Delete</span></div>
<div class="viewcode-block" id="AstFormatter.do_Delete"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Delete">[docs]</a>    <span class="k">def</span> <span class="nf">do_Delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">targets</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;del </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">targets</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20120614011356.10082: *4* f.Exec</span>
    <span class="c"># Python 2.x only</span></div>
<div class="viewcode-block" id="AstFormatter.do_Exec"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Exec">[docs]</a>    <span class="k">def</span> <span class="nf">do_Exec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Globals before locals.</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;globals&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">globals</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">globals</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;locals&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">locals</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">locals</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;exec </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">body</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;exec </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">body</span><span class="p">))</span>
    <span class="c">#@+node:ekr.20111117031039.10209: *4* f.For</span></div>
<div class="viewcode-block" id="AstFormatter.do_For"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_For">[docs]</a>    <span class="k">def</span> <span class="nf">do_For</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;for </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">iter</span><span class="p">))))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10210: *4* f.Global</span></div>
<div class="viewcode-block" id="AstFormatter.do_Global"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Global">[docs]</a>    <span class="k">def</span> <span class="nf">do_Global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;global </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">)))</span>
    <span class="c">#@+node:ekr.20120614011356.10077: *4* f.If</span></div>
<div class="viewcode-block" id="AstFormatter.do_If"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_If">[docs]</a>    <span class="k">def</span> <span class="nf">do_If</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;if </span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">))))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10211: *4* f.Import &amp; helper</span></div>
<div class="viewcode-block" id="AstFormatter.do_Import"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Import">[docs]</a>    <span class="k">def</span> <span class="nf">do_Import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span><span class="n">asname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_import_names</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">asname</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> as </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">asname</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;import </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
    <span class="c">#@+node:ekr.20111117031039.10212: *5* f.get_import_names</span></div>
<div class="viewcode-block" id="AstFormatter.get_import_names"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.get_import_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_import_names</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of the the full file names in the import statement.&#39;&#39;&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ast2</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">ast2</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;alias&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ast2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">ast2</span><span class="o">.</span><span class="n">asname</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;unsupported kind in Import.names list&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">ast2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111117031039.10214: *4* f.ImportFrom</span></div>
<div class="viewcode-block" id="AstFormatter.do_ImportFrom"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_ImportFrom">[docs]</a>    <span class="k">def</span> <span class="nf">do_ImportFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span><span class="n">asname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_import_names</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">asname</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> as </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">asname</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;from </span><span class="si">%s</span><span class="s"> import </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
            <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
    <span class="c">#@+node:ekr.20111117031039.10215: *4* f.Lambda &amp; helper</span></div>
<div class="viewcode-block" id="AstFormatter.do_Lambda"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Lambda">[docs]</a>    <span class="k">def</span> <span class="nf">do_Lambda</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;lambda </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)))</span>
    <span class="c">#@+node:ekr.20111117031039.10972: *4* f.Pass</span></div>
<div class="viewcode-block" id="AstFormatter.do_Pass"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Pass">[docs]</a>    <span class="k">def</span> <span class="nf">do_Pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;pass</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10081: *4* f.Print</span>
    <span class="c"># Python 2.x only</span></div>
<div class="viewcode-block" id="AstFormatter.do_Print"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Print">[docs]</a>    <span class="k">def</span> <span class="nf">do_Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
           <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;dest&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">dest</span><span class="p">:</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dest=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">dest</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;nl&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">nl</span><span class="p">:</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;nl=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">nl</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;print(</span><span class="si">%s</span><span class="s">)</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
    <span class="c">#@+node:ekr.20120614011356.10090: *4* f.Raise</span></div>
<div class="viewcode-block" id="AstFormatter.do_Raise"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Raise">[docs]</a>    <span class="k">def</span> <span class="nf">do_Raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;inst&#39;</span><span class="p">,</span><span class="s">&#39;tback&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">attr</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;raise </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;raise</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10087: *4* f.Return</span></div>
<div class="viewcode-block" id="AstFormatter.do_Return"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Return">[docs]</a>    <span class="k">def</span> <span class="nf">do_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;return </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;return</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10078: *4* f.While</span></div>
<div class="viewcode-block" id="AstFormatter.do_While"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_While">[docs]</a>    <span class="k">def</span> <span class="nf">do_While</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;while </span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">test</span><span class="p">))))</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;else:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111117031039.10217: *4* f.With (To do)</span></div>
<div class="viewcode-block" id="AstFormatter.do_With"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_With">[docs]</a>    <span class="k">def</span> <span class="nf">do_With</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;with &#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;context_expression&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">context_expresssion</span><span class="p">))</span>

        <span class="n">vars_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;optional_vars&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">optional_vars</span><span class="p">:</span>
                    <span class="n">vars_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c"># Not iterable.</span>
                <span class="n">vars_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">optional_vars</span><span class="p">))</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vars_list</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20120614011356.10086: *4* f.Yield</span></div>
<div class="viewcode-block" id="AstFormatter.do_Yield"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.AstFormatter.do_Yield">[docs]</a>    <span class="k">def</span> <span class="nf">do_Yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;yield </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="s">&#39;yield</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20120623165430.10175: ** class CallPrinter (AstFormatter)</span></div></div>
<div class="viewcode-block" id="CallPrinter"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter">[docs]</a><span class="k">class</span> <span class="nc">CallPrinter</span> <span class="p">(</span><span class="n">AstFormatter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Keys are def names; values are lists of calls.</span>

        <span class="n">AstFormatter</span><span class="o">.</span><span class="n">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
            <span class="c"># Init the base class.</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20120623165430.10411: *3* Call</span>
<div class="viewcode-block" id="CallPrinter.do_Call"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_Call">[docs]</a>    <span class="k">def</span> <span class="nf">do_Call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">func</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">aList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">func</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;starargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;*</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;**</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="c"># Shouldn&#39;t be necessary.</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,[])</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>

        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20120623165430.10755: *3* Constants &amp; Name</span>
    <span class="c"># Return generic markers allow better pattern matches.</span>
</div>
<div class="viewcode-block" id="CallPrinter.do_bool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_bool">[docs]</a>    <span class="k">def</span> <span class="nf">do_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="c"># Python 2.x only.</span>
        <span class="k">return</span> <span class="s">&#39;Bool&#39;</span> 
</div>
<div class="viewcode-block" id="CallPrinter.do_Bytes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_Bytes">[docs]</a>    <span class="k">def</span> <span class="nf">do_Bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="c"># Python 3.x only.</span>
        <span class="k">return</span> <span class="s">&#39;Bytes&#39;</span> <span class="c"># return str(tree.s)</span>
</div>
<div class="viewcode-block" id="CallPrinter.do_int"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_int">[docs]</a>    <span class="k">def</span> <span class="nf">do_int</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Int&#39;</span> <span class="c"># return s</span>
</div>
<div class="viewcode-block" id="CallPrinter.do_Name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_Name">[docs]</a>    <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Bool&#39;</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span><span class="s">&#39;False&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span>
</div>
<div class="viewcode-block" id="CallPrinter.do_Num"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_Num">[docs]</a>    <span class="k">def</span> <span class="nf">do_Num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Num&#39;</span> <span class="c"># return repr(tree.n)</span>
</div>
<div class="viewcode-block" id="CallPrinter.do_str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_str">[docs]</a>    <span class="k">def</span> <span class="nf">do_str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span> <span class="c"># Not repr(s)</span>
</div>
<div class="viewcode-block" id="CallPrinter.do_Str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.do_Str">[docs]</a>    <span class="k">def</span> <span class="nf">do_Str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Str&#39;</span> <span class="c"># return repr(tree.s)</span>
    <span class="c">#@+node:ekr.20120623165430.10179: *3* showCalls</span></div>
<div class="viewcode-block" id="CallPrinter.showCalls"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.CallPrinter.showCalls">[docs]</a>    <span class="k">def</span> <span class="nf">showCalls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">z</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20120622075651.10002: ** class ChainPrinter (AstFormatter)</span></div></div>
<div class="viewcode-block" id="ChainPrinter"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter">[docs]</a><span class="k">class</span> <span class="nc">ChainPrinter</span> <span class="p">(</span><span class="n">AstFormatter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_attribute</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">AstFormatter</span><span class="o">.</span><span class="n">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
            <span class="c"># Init the base class.</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20120622075651.10005: *3* Attribute</span>
    <span class="c"># Attribute(expr value, identifier attr, expr_context ctx)</span>

<div class="viewcode-block" id="ChainPrinter.do_Attribute"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_Attribute">[docs]</a>    <span class="k">def</span> <span class="nf">do_Attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_attribute</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_attribute</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">attr</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_attribute</span> <span class="o">=</span> <span class="n">top</span>

        <span class="k">if</span> <span class="n">top</span><span class="p">:</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span><span class="n">rest</span> <span class="o">=</span> <span class="n">aList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">aList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;self&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span>
                    <span class="n">name</span> <span class="o">!=</span> <span class="s">&#39;self&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">):</span>
                    <span class="n">aList2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[])</span>
                    <span class="k">if</span> <span class="n">rest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aList2</span><span class="p">:</span>
                        <span class="n">aList2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList2</span>

        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20120623165430.11467: *3* Constants &amp; Name</span>
    <span class="c"># Return generic markers allow better pattern matches.</span>
</div>
<div class="viewcode-block" id="ChainPrinter.do_bool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_bool">[docs]</a>    <span class="k">def</span> <span class="nf">do_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="c"># Python 2.x only.</span>
        <span class="k">return</span> <span class="s">&#39;Bool&#39;</span> 
</div>
<div class="viewcode-block" id="ChainPrinter.do_Bytes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_Bytes">[docs]</a>    <span class="k">def</span> <span class="nf">do_Bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="c"># Python 3.x only.</span>
        <span class="k">return</span> <span class="s">&#39;Bytes&#39;</span> <span class="c"># return str(tree.s)</span>
</div>
<div class="viewcode-block" id="ChainPrinter.do_int"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_int">[docs]</a>    <span class="k">def</span> <span class="nf">do_int</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Int&#39;</span> <span class="c"># return s</span>
</div>
<div class="viewcode-block" id="ChainPrinter.do_Name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_Name">[docs]</a>    <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Bool&#39;</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span><span class="s">&#39;False&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span>
</div>
<div class="viewcode-block" id="ChainPrinter.do_Num"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_Num">[docs]</a>    <span class="k">def</span> <span class="nf">do_Num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Num&#39;</span> <span class="c"># return repr(tree.n)</span>
</div>
<div class="viewcode-block" id="ChainPrinter.do_str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_str">[docs]</a>    <span class="k">def</span> <span class="nf">do_str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span> <span class="c"># Not repr(s)</span>
</div>
<div class="viewcode-block" id="ChainPrinter.do_Str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.do_Str">[docs]</a>    <span class="k">def</span> <span class="nf">do_Str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Str&#39;</span> <span class="c"># return repr(tree.s)</span>
    <span class="c">#@+node:ekr.20120622075651.10006: *3* showChains</span></div>
<div class="viewcode-block" id="ChainPrinter.showChains"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ChainPrinter.showChains">[docs]</a>    <span class="k">def</span> <span class="nf">showChains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">d</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;{&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c"># print(&#39;%s.%s&#39; % (key,s))</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>
                    <span class="n">n2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">s</span><span class="p">))</span>
                    <span class="n">n1</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n1</span><span class="p">,</span><span class="n">n2</span>

    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20120622075651.10007: ** class ReturnPrinter (AstFormatter)</span></div></div>
<div class="viewcode-block" id="ReturnPrinter"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter">[docs]</a><span class="k">class</span> <span class="nc">ReturnPrinter</span> <span class="p">(</span><span class="n">AstFormatter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Keys are def names.</span>
            <span class="c"># values are lists of lists of return statements.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ret_stack</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">AstFormatter</span><span class="o">.</span><span class="n">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span>
            <span class="c"># Init the base class.</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20120623165430.11427: *3* Constants &amp; Name</span>
    <span class="c"># Return generic markers allow better pattern matches.</span>

<div class="viewcode-block" id="ReturnPrinter.do_bool"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_bool">[docs]</a>    <span class="k">def</span> <span class="nf">do_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="c"># Python 2.x only.</span>
        <span class="k">return</span> <span class="s">&#39;Bool&#39;</span> 
</div>
<div class="viewcode-block" id="ReturnPrinter.do_Bytes"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_Bytes">[docs]</a>    <span class="k">def</span> <span class="nf">do_Bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span> <span class="c"># Python 3.x only.</span>
        <span class="k">return</span> <span class="s">&#39;Bytes&#39;</span> <span class="c"># return str(tree.s)</span>
</div>
<div class="viewcode-block" id="ReturnPrinter.do_int"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_int">[docs]</a>    <span class="k">def</span> <span class="nf">do_int</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Int&#39;</span> <span class="c"># return s</span>
</div>
<div class="viewcode-block" id="ReturnPrinter.do_Name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_Name">[docs]</a>    <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Bool&#39;</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span><span class="s">&#39;False&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span>
</div>
<div class="viewcode-block" id="ReturnPrinter.do_Num"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_Num">[docs]</a>    <span class="k">def</span> <span class="nf">do_Num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Num&#39;</span> <span class="c"># return repr(tree.n)</span>
</div>
<div class="viewcode-block" id="ReturnPrinter.do_str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_str">[docs]</a>    <span class="k">def</span> <span class="nf">do_str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span> <span class="c"># Not repr(s)</span>
</div>
<div class="viewcode-block" id="ReturnPrinter.do_Str"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_Str">[docs]</a>    <span class="k">def</span> <span class="nf">do_Str</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;Str&#39;</span> <span class="c"># return repr(tree.s)</span>
    <span class="c">#@+node:ekr.20120623101052.10076: *3* FunctionDef</span>
    <span class="c"># FunctionDef(identifier name, arguments args, stmt* body, expr* decorator_list)</span>
</div>
<div class="viewcode-block" id="ReturnPrinter.do_FunctionDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_FunctionDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_FunctionDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ret_stack</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,[])</span>
        <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ret_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">aList</span>
        <span class="c"># g.trace(name,aList)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="c"># The following isn&#39;t needed, but doesn&#39;t hurt.</span>
        <span class="c"># result = []</span>

        <span class="c"># if tree.decorator_list:</span>
            <span class="c"># for z in tree.decorator_list:</span>
                <span class="c"># result.append(&#39;@%s\n&#39; % self.visit(z))</span>

        <span class="c"># name = self.visit(tree.name)</span>
        <span class="c"># args = self.visit(tree.args) if tree.args else &#39;&#39;</span>

        <span class="c"># result.append(self.indent(&#39;def %s(%s):\n&#39; % (name,args)))</span>

        <span class="c"># for z in tree.body:</span>
            <span class="c"># self.level += 1</span>
            <span class="c"># result.append(self.visit(z))</span>
            <span class="c"># self.level -= 1</span>

        <span class="c"># return &#39;&#39;.join(result)</span>
    <span class="c">#@+node:ekr.20120623101052.10078: *3* Return</span></div>
<div class="viewcode-block" id="ReturnPrinter.do_Return"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.do_Return">[docs]</a>    <span class="k">def</span> <span class="nf">do_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ret_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span><span class="s">&#39;False&#39;</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s">&#39;Bool&#39;</span>

        <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ret_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="c"># The following isn&#39;t needed, but doesn&#39;t hurt.</span>
        <span class="c"># if tree.value:</span>
            <span class="c"># return self.indent(&#39;return %s\n&#39; % (</span>
                <span class="c"># self.visit(tree.value)))</span>
        <span class="c"># else:</span>
            <span class="c"># return self.indent(&#39;return\n&#39;)</span>
    <span class="c">#@+node:ekr.20120623101052.10074: *3* showReturns</span></div>
<div class="viewcode-block" id="ReturnPrinter.showReturns"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ReturnPrinter.showReturns">[docs]</a>    <span class="k">def</span> <span class="nf">showReturns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>

        <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">put_list</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aList</span><span class="p">))):</span>
                    <span class="n">put</span><span class="p">(</span><span class="s">&#39;  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ret</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">put</span><span class="p">(</span><span class="s">&#39;  None (implicit)&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">aList</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">aList2</span> <span class="o">=</span> <span class="n">aList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList2</span> <span class="k">if</span> <span class="n">z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">)])</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">n2</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">put</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
                    <span class="c"># put(&#39;  one list&#39;)</span>
                    <span class="n">put_list</span><span class="p">(</span><span class="n">aList2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">equal</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">z</span> <span class="o">!=</span> <span class="n">aList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">equal</span><span class="p">:</span>
                    <span class="n">aList2</span> <span class="o">=</span> <span class="n">aList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList2</span> <span class="k">if</span> <span class="n">z</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">)])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">n2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">n2</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">put</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
                        <span class="n">put</span><span class="p">(</span><span class="s">&#39;  all lists equal&#39;</span><span class="p">)</span>
                        <span class="n">put_list</span><span class="p">(</span><span class="n">aList2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">put</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
                    <span class="n">put</span><span class="p">(</span><span class="s">&#39;  lists unequal&#39;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">aList2</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                        <span class="n">put_list</span><span class="p">(</span><span class="n">aList2</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">aList</span><span class="p">):</span>
                            <span class="n">put</span><span class="p">(</span><span class="s">&#39;  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">))</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20111116103733.10338: ** class Chain</span></div></div>
<div class="viewcode-block" id="Chain"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Chain">[docs]</a><span class="k">class</span> <span class="nc">Chain</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class representing an identifier chain a.b.c.d.</span>

<span class="sd">    &quot;a&quot; is the **base** of the chain.</span>
<span class="sd">    &quot;d&quot; is the **target** of the chain.</span>

<span class="sd">    The representation of the chain itelf is a string.</span>
<span class="sd">    This representtion changes as the chain gets resolved.</span>

<span class="sd">    Chains also contain a list of ast nodes representing</span>
<span class="sd">    identifiers to be patched when the chain is fully resolved.</span>

<span class="sd">    See Pass1.do_Attribute for the kinds of nodes that</span>
<span class="sd">    may be patched.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10339: *3*  ctor, repr (Chain)</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">e</span> <span class="c"># The symbol table entry for the base of the chain.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="c"># A string in a.b.c.d format, or &#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;Chain(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>

    <span class="c">#@+node:ekr.20111116103733.10340: *3*  hash, eq and ne</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># These methods allow Chain&#39;s to be members of sets.</span>

        <span class="k">def</span> <span class="nf">__eq__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">s</span>

        <span class="k">def</span> <span class="nf">__ne__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">s</span>

        <span class="c"># Valid and safe, but hurts performance:</span>
        <span class="c"># sets of Chains will perform much like lists of Chains.</span>
        <span class="c"># This will not likely matter much because</span>
        <span class="c"># sets of chains will usually have few members.</span>
        <span class="k">def</span> <span class="nf">__hash__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">return</span> <span class="mi">0</span>
    <span class="c">#@+node:ekr.20111116103733.10341: *3* chain.base</span>
<div class="viewcode-block" id="Chain.base"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Chain.base">[docs]</a>    <span class="k">def</span> <span class="nf">base</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the base of this Chain.&#39;&#39;&#39;</span>

        <span class="c"># Call the global function to ensure that</span>
        <span class="c"># Chain.base() matches the code in SymbolTable.add_chain().</span>

        <span class="k">return</span> <span class="n">g_chain_base</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10342: *3* chain.is_empty</span></div>
<div class="viewcode-block" id="Chain.is_empty"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Chain.is_empty">[docs]</a>    <span class="k">def</span> <span class="nf">is_empty</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return True if this chain is empty.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10343: *3* chain.defines_ivar &amp; get_ivar</span></div>
<div class="viewcode-block" id="Chain.defines_ivar"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Chain.defines_ivar">[docs]</a>    <span class="k">def</span> <span class="nf">defines_ivar</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;self&#39;</span>
</div>
<div class="viewcode-block" id="Chain.get_ivar"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Chain.get_ivar">[docs]</a>    <span class="k">def</span> <span class="nf">get_ivar</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;self&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20111116103733.10344: *3* chain.short_description</span></div>
<div class="viewcode-block" id="Chain.short_description"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Chain.short_description">[docs]</a>    <span class="k">def</span> <span class="nf">short_description</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;chain: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20111116103733.10345: ** class InspectTraverser (AstTraverser)</span></div></div>
<div class="viewcode-block" id="InspectTraverser"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser">[docs]</a><span class="k">class</span> <span class="nc">InspectTraverser</span> <span class="p">(</span><span class="n">AstTraverser</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to create inpect semantic data structures.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10346: *3*  it.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">AstTraverser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>
            <span class="c"># Creates dispatch dict.</span>
            <span class="c"># Calls init_tracing.</span>

        <span class="c"># Ivars...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span> <span class="o">=</span> <span class="n">sd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_flag</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Create an instance of AstFormatter.</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># A test of the overhead of string generation.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">nullObject</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">AstFormatter</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">trace_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_flag</span>
    <span class="c">#@+node:ekr.20111116103733.10354: *3* it.Contexts</span>
    <span class="c">#@+node:ekr.20111116103733.10355: *4* ClassDef</span>
    <span class="c"># ClassDef(identifier name, expr* bases, stmt* body, expr* decorator_list)</span>

<div class="viewcode-block" id="InspectTraverser.do_ClassDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_ClassDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_ClassDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create a context for a class, and</span>
<span class="sd">        define the class name in the present context.&#39;&#39;&#39;</span>

        <span class="c"># Create the new context.</span>
        <span class="n">old_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">new_cx</span> <span class="o">=</span> <span class="n">ClassContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">old_cx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="p">)</span>

        <span class="c"># Define the name in the old context.</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">old_cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">set_defined</span><span class="p">()</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">classes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_context</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_context</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10356: *4* FunctionDef</span>
    <span class="c"># FunctionDef(identifier name, arguments args, stmt* body, expr* decorator_list)</span>
</div>
<div class="viewcode-block" id="InspectTraverser.do_FunctionDef"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_FunctionDef">[docs]</a>    <span class="k">def</span> <span class="nf">do_FunctionDef</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># g.trace(self.dump(tree))</span>

        <span class="c"># Switch to the new context.</span>
        <span class="n">old_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">new_cx</span> <span class="o">=</span> <span class="n">DefContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">old_cx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="p">)</span>

        <span class="c"># Define the function/method name in the old context.</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">old_cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">set_defined</span><span class="p">()</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">defs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_context</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># Define the function arguments before visiting the body.</span>
        <span class="c"># These arguments, including &#39;self&#39;, are known in the body.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">def_args_helper</span><span class="p">(</span><span class="n">new_cx</span><span class="p">,</span><span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

        <span class="c"># Visit the body.</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_context</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_defs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10357: *5* def_args_helper</span>
    <span class="c"># arguments = (expr* args, identifier? vararg, identifier? kwarg, expr* defaults)</span>
    <span class="c"># -- keyword arguments supplied to call</span>
    <span class="c"># keyword = (identifier arg, expr value)</span>
</div>
<div class="viewcode-block" id="InspectTraverser.def_args_helper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.def_args_helper">[docs]</a>    <span class="k">def</span> <span class="nf">def_args_helper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;arguments&#39;</span>

        <span class="c"># Handle positional args.</span>
        <span class="c"># do_Name actually adds the args.</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vararg&#39;</span><span class="p">,</span><span class="s">&#39;kwarg&#39;</span><span class="p">,):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_param_names</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10358: *4* Module</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Module"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Module">[docs]</a>    <span class="k">def</span> <span class="nf">do_Module</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>

        <span class="c"># Get the module context from the global dict if possible.</span>
        <span class="n">new_cx</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">modules_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_cx</span><span class="p">:</span>
            <span class="n">new_cx</span> <span class="o">=</span> <span class="n">ModuleContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span><span class="n">sd</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">modules_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_context</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_context</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20111125131712.10256: *3* it.Operands</span>
    <span class="c"># Use the AstFormatter methods for all operands except do_Attribute and do_Name.</span>

    <span class="c"># Note:  self.formatter is a delegate object: it would be bad style</span>
    <span class="c"># to make InspectTraverser a subclass of AstFormatter.</span>
</div>
<div class="viewcode-block" id="InspectTraverser.format_tree"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.format_tree">[docs]</a>    <span class="k">def</span> <span class="nf">format_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="c"># if self.trace_flag: g.trace(tag,val)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="c"># do_Attribute</span></div>
    <span class="n">do_bool</span>         <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Bytes</span>        <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Call</span>         <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_comprehension</span><span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Dict</span>         <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Ellipsis</span>     <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_ExtSlice</span>     <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Index</span>        <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_int</span>          <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Keyword</span>      <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_List</span>         <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_ListComp</span>     <span class="o">=</span> <span class="n">format_tree</span>
    <span class="c"># do_Name</span>
    <span class="n">do_Num</span>          <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Slice</span>        <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_str</span>          <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Str</span>          <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Subscript</span>    <span class="o">=</span> <span class="n">format_tree</span>
    <span class="n">do_Tuple</span>        <span class="o">=</span> <span class="n">format_tree</span>
    <span class="c">#@+node:ekr.20111125131712.10277: *4* it.Attribute</span>
<div class="viewcode-block" id="InspectTraverser.do_Attribute"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Attribute">[docs]</a>    <span class="k">def</span> <span class="nf">do_Attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># assert self.kind(tree) == &#39;Attribute&#39;</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>    
        <span class="n">name</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">attr</span>

        <span class="c"># Use the *formatter* to traverse tree.value.</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_flag</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">chain</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_chain</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_attributes</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c">#### Huh?</span>
        <span class="c">#### self.formatter.append(s)</span>
            <span class="c"># For recursive calls.</span>
        <span class="k">return</span> <span class="n">s</span>


    <span class="c">#@+node:ekr.20111125131712.10278: *4* it.Name</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Name">[docs]</a>    <span class="k">def</span> <span class="nf">do_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">isPython3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">module_names</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__builtin__</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">module_names</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_flag</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>

        <span class="c"># Important: symbol tables represent only static context.</span>
        <span class="c"># The resolution algorithm computes what names &quot;really&quot; mean.</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ctx</span> <span class="o">==</span> <span class="s">&#39;Load&#39;</span><span class="p">:</span> <span class="c"># Most common.</span>
            <span class="n">cx</span><span class="o">.</span><span class="n">load_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">n_load_names</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">ctx</span> <span class="o">==</span> <span class="s">&#39;Store&#39;</span><span class="p">:</span> <span class="c"># Next most common.</span>
            <span class="n">cx</span><span class="o">.</span><span class="n">store_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">cx</span><span class="o">.</span><span class="n">load_names</span><span class="p">:</span>
                <span class="n">e</span><span class="o">.</span><span class="n">load_before_store_flag</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">n_store_names</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">ctx</span> <span class="o">==</span> <span class="s">&#39;Param&#39;</span><span class="p">:</span>
            <span class="n">cx</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">n_param_names</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">ctx</span> <span class="o">==</span> <span class="s">&#39;Del&#39;</span><span class="p">,</span><span class="n">ctx</span>
            <span class="n">cx</span><span class="o">.</span><span class="n">del_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">n_del_names</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20120613104401.10221: *4* it.ListComp</span></div>
<div class="viewcode-block" id="InspectTraverser.do_ListComp"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_ListComp">[docs]</a>    <span class="k">def</span> <span class="nf">do_ListComp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">elt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">generators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">n_list_comps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10368: *3* it.Statements</span>
    <span class="c">#@+node:ekr.20111116103733.10369: *4* it.Assign</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Assign"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Assign">[docs]</a>    <span class="k">def</span> <span class="nf">do_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatementContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;assn&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>    
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">n_assignments</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10370: *4* it.AugAssign</span></div>
<div class="viewcode-block" id="InspectTraverser.do_AugAssign"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_AugAssign">[docs]</a>    <span class="k">def</span> <span class="nf">do_AugAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatementContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;aug-assn&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="c"># The rhs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span> <span class="c"># The lhs.</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">n_assignments</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10365: *4* it.Call</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Call"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Call">[docs]</a>    <span class="k">def</span> <span class="nf">do_Call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>

        <span class="n">cx</span><span class="o">.</span><span class="n">calls_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatementContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;call&#39;</span><span class="p">))</span>

        <span class="n">sd</span><span class="o">.</span><span class="n">n_calls</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">keywords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;starargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">starargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10371: *4* it.For</span></div>
<div class="viewcode-block" id="InspectTraverser.do_For"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_For">[docs]</a>    <span class="k">def</span> <span class="nf">do_For</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># Define a namespace for the &#39;for&#39; target.</span>
        <span class="n">old_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">new_cx</span> <span class="o">=</span> <span class="n">ForContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">old_cx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="p">)</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">temp_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_context</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">iter</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_context</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_fors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10372: *4* it.Global</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Global"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Global">[docs]</a>    <span class="k">def</span> <span class="nf">do_Global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Enter the names in a &#39;global&#39; statement into the *module* symbol table.&#39;&#39;&#39;</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatementContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;global&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>

            <span class="c"># Add the name to the global_names set in *this* context.</span>
            <span class="n">cx</span><span class="o">.</span><span class="n">global_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="c"># Create a symbol table entry for the name in the *module* context.</span>
            <span class="n">cx</span><span class="o">.</span><span class="n">module_context</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>

            <span class="n">sd</span><span class="o">.</span><span class="n">n_globals</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10373: *4* it.Import &amp; helpers</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Import"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Import">[docs]</a>    <span class="k">def</span> <span class="nf">do_Import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Add the imported file to the sd.files_list if needed</span>
<span class="sd">        and create a context for the file.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatementContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;import&#39;</span><span class="p">))</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_import_names</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span><span class="n">asname</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">fn2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_import_name</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn2</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fn2</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">files_list</span><span class="p">:</span>
                    <span class="n">sd</span><span class="o">.</span><span class="n">files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn2</span><span class="p">)</span>
                <span class="n">mname</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">module_name</span><span class="p">(</span><span class="n">fn2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">module_names</span><span class="p">:</span>
                    <span class="n">sd</span><span class="o">.</span><span class="n">module_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> as </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mname</span><span class="p">,</span><span class="n">asname</span><span class="p">))</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">asname</span> <span class="ow">or</span> <span class="n">mname</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">set_defined</span><span class="p">()</span>
                <span class="n">sd</span><span class="o">.</span><span class="n">n_imports</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not resolve&#39;</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10374: *5* LLT.get_import_names</span></div>
<div class="viewcode-block" id="InspectTraverser.get_import_names"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.get_import_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_import_names</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a list of the the full file names in the import statement.&#39;&#39;&#39;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ast2</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">ast2</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;alias&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">ast2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">ast2</span><span class="o">.</span><span class="n">asname</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;unsupported kind in Import.names list&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">ast2</span><span class="p">))</span>

        <span class="c"># g.trace(result)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="c">#@+node:ekr.20111116103733.10375: *5* LLT.resolve_import_name</span></div>
<div class="viewcode-block" id="InspectTraverser.resolve_import_name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.resolve_import_name">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_import_name</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spec</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the full path name corresponding to the import spec.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c">### This may not work for leading dots.</span>
        <span class="n">aList</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">paths</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">),</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">description</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">paths</span><span class="p">)</span>
                <span class="c"># g.trace(&#39;name&#39;,name,&#39;path&#39;,repr(path),&#39;f&#39;,f)</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="c"># Important: imports can fail due to Python version.</span>
                <span class="c"># Thus, such errors are not necessarily searious.</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;failed&#39;</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="s">&#39;paths&#39;</span><span class="p">,</span><span class="n">paths</span><span class="p">,</span><span class="s">&#39;cx&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">())</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pyd&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path</span>
    <span class="c">#@+node:ekr.20111116103733.10376: *4* it.ImportFrom</span></div>
<div class="viewcode-block" id="InspectTraverser.do_ImportFrom"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_ImportFrom">[docs]</a>    <span class="k">def</span> <span class="nf">do_ImportFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Add the imported file to the sd.files_list if needed</span>
<span class="sd">        and add the imported symbols to the *present* context.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">;</span> <span class="n">dump</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">dump</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StatementContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;import from&#39;</span><span class="p">))</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_import_name</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">and</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">files_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;adding module&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">files_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_import_names</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span><span class="n">asname</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">fn2</span> <span class="o">=</span> <span class="n">asname</span> <span class="ow">or</span> <span class="n">fn</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">fn2</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">fn2</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">set_defined</span><span class="p">()</span>
            <span class="n">mname</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">module_name</span><span class="p">(</span><span class="n">fn2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">module_names</span><span class="p">:</span>
                <span class="n">sd</span><span class="o">.</span><span class="n">module_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mname</span><span class="p">)</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">n_imports</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10377: *4* it.Lambda &amp; helper</span></div>
<div class="viewcode-block" id="InspectTraverser.do_Lambda"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_Lambda">[docs]</a>    <span class="k">def</span> <span class="nf">do_Lambda</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># Define a namespace for the &#39;lambda&#39; variables.</span>
        <span class="n">old_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">new_cx</span> <span class="o">=</span> <span class="n">LambdaContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">old_cx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="p">)</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">temp_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_context</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="c"># Enter the target names in the &#39;lambda&#39; context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">def_lambda_args_helper</span><span class="p">(</span><span class="n">new_cx</span><span class="p">,</span><span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

        <span class="c"># Enter all other definitions in the defining_context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_context</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_lambdas</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c">#@+node:ekr.20111116103733.10378: *5* def_lambda_args_helper</span>
    <span class="c"># arguments = (expr* args, identifier? vararg, identifier? kwarg, expr* defaults)</span>
    <span class="c"># -- keyword arguments supplied to call</span>
    <span class="c"># keyword = (identifier arg, expr value)</span>
</div>
<div class="viewcode-block" id="InspectTraverser.def_lambda_args_helper"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.def_lambda_args_helper">[docs]</a>    <span class="k">def</span> <span class="nf">def_lambda_args_helper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;arguments&#39;</span>

        <span class="c"># Handle positional args.</span>
        <span class="c"># do_Name actually adds the args.</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;vararg&#39;</span><span class="p">,</span><span class="s">&#39;kwarg&#39;</span><span class="p">,):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">cx</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
                <span class="n">cx</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10379: *4* it.With</span></div>
<div class="viewcode-block" id="InspectTraverser.do_With"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.do_With">[docs]</a>    <span class="k">def</span> <span class="nf">do_With</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># Define a namespace for the &#39;with&#39; statement.</span>
        <span class="n">old_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_context</span><span class="p">()</span>
        <span class="n">new_cx</span> <span class="o">=</span> <span class="n">WithContext</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">old_cx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="p">)</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">statements_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>
        <span class="n">old_cx</span><span class="o">.</span><span class="n">temp_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_context</span><span class="p">(</span><span class="n">new_cx</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;context_expression&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">context_expresssion</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="s">&#39;optional_vars&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">optional_vars</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c"># Not iterable.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">optional_vars</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_context</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_withs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#@+node:ekr.20111116103733.10352: *3* it.traverse</span></div>
<div class="viewcode-block" id="InspectTraverser.traverse"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.InspectTraverser.traverse">[docs]</a>    <span class="k">def</span> <span class="nf">traverse</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Perform all checks on the source in s.&#39;&#39;&#39;</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sd</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;exec&#39;</span><span class="p">)</span>

        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">sd</span><span class="o">.</span><span class="n">parse_time</span> <span class="o">+=</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>

        <span class="n">t3</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">sd</span><span class="o">.</span><span class="n">pass1_time</span> <span class="o">+=</span> <span class="n">t3</span><span class="o">-</span><span class="n">t2</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20111116103733.10312: ** class LeoCoreFiles</span></div></div>
<div class="viewcode-block" id="LeoCoreFiles"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.LeoCoreFiles">[docs]</a><span class="k">class</span> <span class="nc">LeoCoreFiles</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class representing Leo&#39;s core files, including qtGui.py&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_core_list</span><span class="p">()</span>
            <span class="c"># The list of files in Leo&#39;s core.</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10313: *3* create_core_list</span>
<div class="viewcode-block" id="LeoCoreFiles.create_core_list"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.LeoCoreFiles.create_core_list">[docs]</a>    <span class="k">def</span> <span class="nf">create_core_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">skipList</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;format-code.py&#39;</span><span class="p">,</span>
            <span class="s">&#39;__init__.py&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize_join</span><span class="p">(</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&#39;*.py&#39;</span><span class="p">))</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">skipList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
                    <span class="c"># print(&#39;skipping %s&#39; % fn)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="n">aList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize_join</span><span class="p">(</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;plugins&#39;</span><span class="p">,</span><span class="s">&#39;qtGui.py&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">aList</span>
    <span class="c">#@+node:ekr.20111116103733.10314: *3* get_source</span></div>
<div class="viewcode-block" id="LeoCoreFiles.get_source"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.LeoCoreFiles.get_source">[docs]</a>    <span class="k">def</span> <span class="nf">get_source</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;plugins&#39;</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20120609070048.11214: ** class Program</span></div></div>
<div class="viewcode-block" id="Program"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.Program">[docs]</a><span class="k">class</span> <span class="nc">Program</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;A class representing all the files in the program.</span>

<span class="sd">    May be significant later when industrial-strength caching is in effect.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>
<span class="c">#@+node:ekr.20111116103733.10380: ** class SemanticData</span></div>
<div class="viewcode-block" id="SemanticData"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData">[docs]</a><span class="k">class</span> <span class="nc">SemanticData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class containing all global semantic data.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10381: *3*  sd.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">controller</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumper</span> <span class="o">=</span> <span class="n">AstDumper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">AstFormatter</span><span class="p">()</span>

        <span class="c"># Files...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_files</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Files handled by do_files.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_files</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Files that could not be opened.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Files given by user or by import statements.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_names</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Module names corresponding to file names.</span>

        <span class="c"># Contexts.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_list</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Keys are fully qualified context names; values are contexts.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Keys are full file names; values are ModuleContext&#39;s.</span>

        <span class="c"># The resolution algorithm.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">known_types</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Statistics...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_contexts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_modules</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_resolved_contexts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_errors</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Names...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_ivars</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_names</span> <span class="o">=</span> <span class="mi">0</span>        <span class="c"># Number of symbol table entries.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_del_names</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_load_names</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_param_names</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_store_names</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Statements...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_assignments</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_calls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_defs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_fors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_globals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_imports</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_lambdas</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_list_comps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_withs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Times...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pass1_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pass2_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c">#@+node:ekr.20111116103733.10382: *3* sd.all_contexts (generator) (not used)</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># This works, but is too clever by half.</span>

        <span class="k">def</span> <span class="nf">all_contexts</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aList</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

            <span class="sd">&#39;&#39;&#39;An iterator returning all contexts.&#39;&#39;&#39;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">aList</span><span class="p">:</span>
                <span class="n">aList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">cx</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cx</span>
                <span class="k">if</span> <span class="n">cx</span><span class="o">.</span><span class="n">classes_list</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_contexts</span><span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">classes_list</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">z</span>
                <span class="k">if</span> <span class="n">cx</span><span class="o">.</span><span class="n">defs_list</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_contexts</span><span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">defs_list</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">z</span>
                <span class="k">if</span> <span class="n">cx</span><span class="o">.</span><span class="n">temp_contexts</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_contexts</span><span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">temp_contexts</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">z</span>
    <span class="c">#@+node:ekr.20111116103733.10383: *3* sd.dump</span>
<div class="viewcode-block" id="SemanticData.dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">modules_dict</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Dump of modules...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20111116103733.10384: *3* sd.dump_ast</span></div>
<div class="viewcode-block" id="SemanticData.dump_ast"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.dump_ast">[docs]</a>    <span class="k">def</span> <span class="nf">dump_ast</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">brief</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the string, but don&#39;t write it.&#39;&#39;&#39;</span>

        <span class="n">dumper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dumper</span>
        <span class="n">dumper</span><span class="o">.</span><span class="n">brief</span> <span class="o">=</span> <span class="n">brief</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">dumper</span><span class="o">.</span><span class="n">_dumpTreeAsString</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20111116103733.10385: *3* sd.module_name</span></div>
<div class="viewcode-block" id="SemanticData.module_name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.module_name">[docs]</a>    <span class="k">def</span> <span class="nf">module_name</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fn</span><span class="p">):</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fn</span>
    <span class="c">#@+node:ekr.20111116103733.10386: *3* sd.print_failed_files</span></div>
<div class="viewcode-block" id="SemanticData.print_failed_files"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.print_failed_files">[docs]</a>    <span class="k">def</span> <span class="nf">print_failed_files</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">sd</span><span class="o">.</span><span class="n">failed_files</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;%s import failed&#39; % (len(sd.failed_files)))</span>
            <span class="n">sd</span><span class="o">.</span><span class="n">failed_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">failed_files</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10387: *3* sd.print_stats</span></div>
<div class="viewcode-block" id="SemanticData.print_stats"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.print_stats">[docs]</a>    <span class="k">def</span> <span class="nf">print_stats</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="s">&#39;errors&#39;</span><span class="p">,</span>

            <span class="s">&#39;*Contexts&#39;</span><span class="p">,</span>
            <span class="s">&#39;classes&#39;</span><span class="p">,</span><span class="s">&#39;contexts&#39;</span><span class="p">,</span><span class="s">&#39;defs&#39;</span><span class="p">,</span><span class="s">&#39;modules&#39;</span><span class="p">,</span>

            <span class="s">&#39;*Statements&#39;</span><span class="p">,</span>
            <span class="s">&#39;assignments&#39;</span><span class="p">,</span><span class="s">&#39;calls&#39;</span><span class="p">,</span><span class="s">&#39;fors&#39;</span><span class="p">,</span><span class="s">&#39;globals&#39;</span><span class="p">,</span><span class="s">&#39;imports&#39;</span><span class="p">,</span>
            <span class="s">&#39;lambdas&#39;</span><span class="p">,</span><span class="s">&#39;list_comps&#39;</span><span class="p">,</span><span class="s">&#39;withs&#39;</span><span class="p">,</span>

            <span class="s">&#39;*Names&#39;</span><span class="p">,</span>
            <span class="s">&#39;attributes&#39;</span><span class="p">,</span><span class="s">&#39;del_names&#39;</span><span class="p">,</span><span class="s">&#39;load_names&#39;</span><span class="p">,</span><span class="s">&#39;names&#39;</span><span class="p">,</span>
            <span class="s">&#39;param_names&#39;</span><span class="p">,</span><span class="s">&#39;store_names&#39;</span><span class="p">,</span>

            <span class="c"># &#39;ivars&#39;,</span>
            <span class="c"># &#39;resolved_contexts&#39;,</span>
        <span class="p">)</span>

        <span class="n">max_n</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">max_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_n</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Statistics...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="s">&#39;n_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">s</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span> <span class="c"># print(&#39;&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pad</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span><span class="n">var</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20111116103733.10508: *3* sd.print_times</span></div>
<div class="viewcode-block" id="SemanticData.print_times"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.print_times">[docs]</a>    <span class="k">def</span> <span class="nf">print_times</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">times</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;parse_time&#39;</span><span class="p">,</span>
            <span class="s">&#39;pass1_time&#39;</span><span class="p">,</span>
            <span class="c"># &#39;pass2_time&#39;, # the resolve_names pass is no longer used.</span>
            <span class="s">&#39;total_time&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">max_n</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">max_n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_n</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Scan times...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">: </span><span class="si">%2.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pad</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">getattr</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span><span class="n">s</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10388: *3* sd.resolve_types</span></div>
<div class="viewcode-block" id="SemanticData.resolve_types"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SemanticData.resolve_types">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_types</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;The new resolution algorithm.</span>

<span class="sd">        Remove symbols from all Dependency objects containing them,</span>
<span class="sd">        thereby possibly createing more known symbols.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">known_types</span><span class="p">))</span>

        <span class="c"># Important: len(sd.known_type) may change in this loop.</span>
        <span class="k">while</span> <span class="n">sd</span><span class="o">.</span><span class="n">known_types</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">known_types</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">e</span><span class="o">.</span><span class="n">become_known</span><span class="p">()</span>
    <span class="c">#@-others</span>

<span class="c">#@+node:ekr.20111116103733.10389: ** class SymbolTable</span></div></div>
<div class="viewcode-block" id="SymbolTable"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTable">[docs]</a><span class="k">class</span> <span class="nc">SymbolTable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A base class for all symbol table info.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10390: *3*  st.ctor and repr</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">context</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Keys are names, values are symbol table entries.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_name_length</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># Minimum field width for dumps.</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;SymbolTable for </span><span class="si">%s</span><span class="s">...</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">description</span><span class="p">()</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
    <span class="c">#@+node:ekr.20111116103733.10391: *3* st.add_chain</span>
<div class="viewcode-block" id="SymbolTable.add_chain"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTable.add_chain">[docs]</a>    <span class="k">def</span> <span class="nf">add_chain</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Add the chain described by (tree,s) to the symbol table</span>
<span class="sd">        for the base of s, a plain string.</span>

<span class="sd">        Return the perhaps-newly-created Chain object for (tree,s).&#39;&#39;&#39;</span>

        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c"># if s.find(&#39;.&#39;) == -1: g.trace(s,g.callers())</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">g_chain_base</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">add_name</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">add_chain</span><span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chain</span>

    <span class="c">#@+node:ekr.20111116103733.10392: *3* st.add_name</span></div>
<div class="viewcode-block" id="SymbolTable.add_name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTable.add_name">[docs]</a>    <span class="k">def</span> <span class="nf">add_name</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Add name to the symbol table.  Return the symbol table entry.&#39;&#39;&#39;</span>

        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">SymbolTableEntry</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">st</span><span class="p">,</span><span class="n">tree</span><span class="p">)</span>
            <span class="n">st</span><span class="o">.</span><span class="n">d</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
            <span class="n">st</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">sd</span><span class="o">.</span><span class="n">n_names</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c"># if name == &#39;self&#39; and st.context.kind == &#39;class&#39;:</span>
                <span class="c"># g.trace(&#39;st: %s name: %s&#39; % (self,name),g.callers())</span>

        <span class="k">return</span> <span class="n">e</span>
    <span class="c">#@+node:ekr.20111116103733.10393: *3* st.dump</span></div>
<div class="viewcode-block" id="SymbolTable.dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTable.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Print the table entries.</span>
        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="c"># Print non-empty ctx lists.</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">del_names</span><span class="p">,</span><span class="s">&#39;Del&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">load_names</span><span class="p">,</span><span class="s">&#39;Load&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">param_names</span><span class="p">,</span><span class="s">&#39;Param&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">store_names</span><span class="p">,</span><span class="s">&#39;Store&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">global_names</span><span class="p">,</span><span class="s">&#39;Globals&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">all_global_names</span><span class="p">,</span><span class="s">&#39;all_glob&#39;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">aSet</span><span class="p">,</span><span class="n">kind</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">aSet</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%8s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">aSet</span><span class="p">)))</span>

    <span class="c">#@+node:ekr.20111116103733.10394: *3* st.get_name</span></div>
<div class="viewcode-block" id="SymbolTable.get_name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTable.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the symbol table entry for name.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20111116103733.10395: ** class SymbolTableEntry</span></div></div>
<div class="viewcode-block" id="SymbolTableEntry"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry">[docs]</a><span class="k">class</span> <span class="nc">SymbolTableEntry</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20111116103733.10396: *3*  e.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">st</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Keys are bases, values dicts of Chains.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defined</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_before_store_flag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st</span> <span class="o">=</span> <span class="n">st</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>

        <span class="c"># Update the length field for dumps.</span>
        <span class="n">st</span><span class="o">.</span><span class="n">max_name_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">max_name_length</span><span class="p">,</span>
            <span class="n">name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10397: *3* e.add_chain</span>
<div class="viewcode-block" id="SymbolTableEntry.add_chain"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry.add_chain">[docs]</a>    <span class="k">def</span> <span class="nf">add_chain</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">base</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        If a Chain exists in e.chains[base], merge tree into its ast_list.</span>

<span class="sd">        Otherwise, create a new Chain object and add it to e.chains[base].</span>

<span class="sd">        This is the *only* place where chains are created.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base</span><span class="p">,{})</span>
        <span class="n">chain</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chain</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c"># chain.ast_list.append(tree)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">chains</span> <span class="p">[</span><span class="n">base</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
        <span class="k">return</span> <span class="n">chain</span>
    <span class="c">#@+node:ekr.20111116103733.10398: *3* e.repr and e.dump</span></div>
    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">max_name_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">*</span><span class="n">n</span>
            <span class="c"># unbound = g.choose(self.load_before_store_flag,&#39;: &lt;unbound&gt;&#39;,&#39;&#39;)</span>
            <span class="n">unbound</span> <span class="o">=</span> <span class="s">&#39;: &lt;unbound&gt;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_before_store_flag</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s"> defined: </span><span class="si">%5s%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">pad</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">,</span><span class="n">unbound</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">show_chains</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s"> defined: </span><span class="si">%5s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">pad</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defined</span><span class="p">,</span><span class="n">unbound</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&lt;ste: no name!&gt;&#39;</span>

<div class="viewcode-block" id="SymbolTableEntry.dump"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SymbolTableEntry.show_chains"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry.show_chains">[docs]</a>    <span class="k">def</span> <span class="nf">show_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># self.chains is a dict of dicts.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,{})</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20111116103733.10399: *3* e.is_defined &amp; set_defined</span></div>
<div class="viewcode-block" id="SymbolTableEntry.is_defined"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry.is_defined">[docs]</a>    <span class="k">def</span> <span class="nf">is_defined</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defined</span>
</div>
<div class="viewcode-block" id="SymbolTableEntry.set_defined"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry.set_defined">[docs]</a>    <span class="k">def</span> <span class="nf">set_defined</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defined</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20111116103733.10400: *3* e.short_description</span></div>
<div class="viewcode-block" id="SymbolTableEntry.short_description"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.SymbolTableEntry.short_description">[docs]</a>    <span class="k">def</span> <span class="nf">short_description</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;ste: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20120612044943.10201: ** class TestPickleClass</span></div></div>
<div class="viewcode-block" id="TestPickleClass"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.TestPickleClass">[docs]</a><span class="k">class</span> <span class="nc">TestPickleClass</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#@+node:ekr.20111116103733.10401: ** Context classes</span>
<span class="c">#@+node:ekr.20111116103733.10413: *3* class ClassContext</span></div>
<div class="viewcode-block" id="ClassContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ClassContext">[docs]</a><span class="k">class</span> <span class="nc">ClassContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to hold semantic data about a class.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;class&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;class(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="ClassContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ClassContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">name</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116103733.10414: *3* class ConprehensionContext</span></div>
<div class="viewcode-block" id="ComprehensionContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ComprehensionContext">[docs]</a><span class="k">class</span> <span class="nc">ComprehensionContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to represent the range of a list comprehension.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;comprehension&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;comprehension&#39;</span>

<div class="viewcode-block" id="ComprehensionContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ComprehensionContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;list comprehension context&#39;</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116103733.10415: *3* class DefContext</span></div>
<div class="viewcode-block" id="DefContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.DefContext">[docs]</a><span class="k">class</span> <span class="nc">DefContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to hold semantic data about a function/method.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;def&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;def(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="DefContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.DefContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="s">&#39;method&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_context</span> <span class="k">else</span> <span class="s">&#39;function&#39;</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">name</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116103733.10416: *3* class ForContext</span></div>
<div class="viewcode-block" id="ForContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ForContext">[docs]</a><span class="k">class</span> <span class="nc">ForContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to represent the range of a &#39;for&#39; statement.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;for&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_kind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;Name&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;for(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;Tuple&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;for(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">z</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_ptr</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">elts</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;for(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="p">)</span>

<div class="viewcode-block" id="ForContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ForContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&quot;for&quot; statement context&#39;</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116103733.10417: *3* class LambdaContext</span></div>
<div class="viewcode-block" id="LambdaContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.LambdaContext">[docs]</a><span class="k">class</span> <span class="nc">LambdaContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to represent the range of a &#39;lambda&#39; statement.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;lambda&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;lambda context&#39;</span>

<div class="viewcode-block" id="LambdaContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.LambdaContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;lambda statement context&#39;</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116103733.10418: *3* class ModuleContext</span></div>
<div class="viewcode-block" id="ModuleContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ModuleContext">[docs]</a><span class="k">class</span> <span class="nc">ModuleContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to hold semantic data about a module.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">parent_context</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span> <span class="c"># Do this first, so repr works.</span>
        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;module&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_context</span> <span class="o">==</span> <span class="bp">self</span>
        <span class="n">sd</span><span class="o">.</span><span class="n">n_modules</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;module(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">g</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>

<div class="viewcode-block" id="ModuleContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.ModuleContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">)</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116161118.10170: *3* class StatementContext</span></div>
<div class="viewcode-block" id="StatementContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.StatementContext">[docs]</a><span class="k">class</span> <span class="nc">StatementContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to hold semantic data about any statement.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="n">kind</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;statement(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span><span class="p">)</span>

<div class="viewcode-block" id="StatementContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.StatementContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; statement context&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context_kind</span><span class="p">)</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@+node:ekr.20111116103733.10419: *3* class WithContext</span></div>
<div class="viewcode-block" id="WithContext"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.WithContext">[docs]</a><span class="k">class</span> <span class="nc">WithContext</span> <span class="p">(</span><span class="n">Context</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to represent the range of a &#39;with&#39; statement.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">):</span>

        <span class="n">Context</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">parent_context</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="s">&#39;with&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;with()&#39;</span>

<div class="viewcode-block" id="WithContext.name"><a class="viewcode-back" href="../../../leo.core.html#leo.core.leoInspect.WithContext.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;with statement context&#39;</span>
</div>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span>
<span class="c">#@-others</span>
<span class="c">#@-leo</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Ed K. Ream.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>