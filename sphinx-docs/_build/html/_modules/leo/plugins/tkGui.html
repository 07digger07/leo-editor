<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>leo.plugins.tkGui &mdash; Leo API 4.11dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.11dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Leo API 4.11dev documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for leo.plugins.tkGui</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#@+leo-ver=5-thin</span>
<span class="c">#@+node:ekr.20081121110412.2: * @file tkGui.py</span>
<span class="c">#@@first</span>

<span class="sd">&#39;&#39;&#39;Leo&#39;s tkinter gui plugin.&#39;&#39;&#39;</span>

<span class="c">#@@language python</span>
<span class="c">#@@tabwidth -4</span>
<span class="c">#@@pagewidth 80</span>

<span class="c">#@+&lt;&lt; tkGui imports &gt;&gt;</span>
<span class="c">#@+node:ekr.20081121110412.3: ** &lt;&lt; tkGui imports &gt;&gt;</span>
<span class="kn">import</span> <span class="nn">leo.core.leoGlobals</span> <span class="kn">as</span> <span class="nn">g</span>

<span class="kn">import</span> <span class="nn">leo.core.leoChapters</span> <span class="kn">as</span> <span class="nn">leoChapters</span>
<span class="kn">import</span> <span class="nn">leo.core.leoColor</span> <span class="kn">as</span> <span class="nn">leoColor</span>
<span class="kn">import</span> <span class="nn">leo.core.leoCompare</span> <span class="kn">as</span> <span class="nn">leoCompare</span>
<span class="kn">import</span> <span class="nn">leo.core.leoFind</span> <span class="kn">as</span> <span class="nn">leoFind</span>
<span class="kn">import</span> <span class="nn">leo.core.leoFrame</span> <span class="kn">as</span> <span class="nn">leoFrame</span>
<span class="kn">import</span> <span class="nn">leo.core.leoGui</span> <span class="kn">as</span> <span class="nn">leoGui</span>
<span class="kn">import</span> <span class="nn">leo.core.leoKeys</span> <span class="kn">as</span> <span class="nn">leoKeys</span>
<span class="kn">import</span> <span class="nn">leo.core.leoMenu</span> <span class="kn">as</span> <span class="nn">leoMenu</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">isPython3</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;tkGui.py: requires Python 2.x&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tkFont</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;tkGui.py: can not import tkFont&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tkFileDialog</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;tkGui.py: can not import tkFileDialog&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">tkinter</span> <span class="kn">as</span> <span class="nn">Tk</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">Tkinter</span> <span class="kn">as</span> <span class="nn">Tk</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;tkGui.py: can not import tkinter or Tkinter&#39;</span><span class="p">)</span>

<span class="n">Pmw</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">importExtension</span><span class="p">(</span><span class="s">&#39;Pmw&#39;</span><span class="p">,</span><span class="n">pluginName</span><span class="o">=</span><span class="s">&#39;tkGui&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">tkColorChooser</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">importExtension</span><span class="p">(</span><span class="s">&#39;tkColorChooser&#39;</span><span class="p">,</span>
    <span class="n">pluginName</span><span class="o">=</span><span class="s">&#39;tkGui&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c">#@-&lt;&lt; tkGui imports &gt;&gt;</span>

<span class="c">#@+others</span>
<span class="c">#@+node:ekr.20081121110412.4: **  Module level</span>

<span class="c">#@+node:ekr.20081121110412.5: *3* init</span>
<div class="viewcode-block" id="init"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.init">[docs]</a><span class="k">def</span> <span class="nf">init</span><span class="p">():</span>

    <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="c"># Not Ok for unit testing!</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Tk</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Pmw</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;WARNING: Pmw is not available. Tk ui will not work. Install python-pmw to fix&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">guiName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;tkinter&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">tkinterGui</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">createRootWindow</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">finishCreate</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">plugin_signon</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
<span class="c">#@+node:ekr.20081121110412.353: ** class tkinterGui (leoGui)</span></div>
<div class="viewcode-block" id="tkinterGui"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui">[docs]</a><span class="k">class</span> <span class="nc">tkinterGui</span><span class="p">(</span><span class="n">leoGui</span><span class="o">.</span><span class="n">leoGui</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class encapulating all calls to tkinter.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.355: *3* tkGui birth &amp; death</span>
    <span class="c">#@+node:ekr.20081121110412.356: *4*  tkGui.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Initialize the base class.</span>
        <span class="n">leoGui</span><span class="o">.</span><span class="n">leoGui</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;tkinter&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win32clipboard</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultFont</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultFontFamily</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyTextWidget</span> <span class="o">=</span>  <span class="n">leoTkTextWidget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plainTextWidget</span> <span class="o">=</span> <span class="n">leoTkTextWidget</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># This seems both dangerous and non-functional.</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">win32clipboard</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">win32clipboard</span> <span class="o">=</span> <span class="n">win32clipboard</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.357: *4* createKeyHandlerClass (tkGui)</span>
<div class="viewcode-block" id="tkinterGui.createKeyHandlerClass"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createKeyHandlerClass">[docs]</a>    <span class="k">def</span> <span class="nf">createKeyHandlerClass</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">useGlobalKillbuffer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">useGlobalRegisters</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">tkinterKeyHandlerClass</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">useGlobalKillbuffer</span><span class="p">,</span><span class="n">useGlobalRegisters</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.358: *4* createRootWindow &amp; allies</span></div>
<div class="viewcode-block" id="tkinterGui.createRootWindow"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createRootWindow">[docs]</a>    <span class="k">def</span> <span class="nf">createRootWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a hidden Tk root window.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Use Tix.</span>
            <span class="kn">import</span> <span class="nn">Tix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="o">=</span> <span class="n">Tix</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
            <span class="c">#@+&lt;&lt; fix problems with menus (XP) &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.359: *5* &lt;&lt; fix problems with menus (XP) &gt;&gt;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">WmDefault</span>
                <span class="n">WmDefault</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;activebackground&#39;</span><span class="p">:</span><span class="s">&#39;DarkBlue&#39;</span><span class="p">,</span><span class="s">&#39;activeforeground&#39;</span><span class="p">:</span><span class="s">&#39;white&#39;</span><span class="p">}</span> <span class="c"># works</span>
                <span class="c"># d = {&#39;activebackground&#39;:&#39;&#39;,&#39;activeforeground&#39;:&#39;&#39;} # doesn&#39;t work</span>
                <span class="n">WmDefault</span><span class="o">.</span><span class="n">addoptions</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;can not import WMDefault&quot;</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; fix problems with menus (XP) &gt;&gt;</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># Use Tkinter.</span>
            <span class="c"># g.trace(&#39;Pmw.init&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
            <span class="n">Pmw</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>

        <span class="n">root</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Leo Main Window&quot;</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultIcon</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultConfigFont</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">root</span>
    <span class="c">#@+node:ekr.20081121110412.360: *5* setDefaultIcon</span></div>
<div class="viewcode-block" id="tkinterGui.setDefaultIcon"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.setDefaultIcon">[docs]</a>    <span class="k">def</span> <span class="nf">setDefaultIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Set the icon to be used in all Leo windows.</span>

<span class="sd">        This code does nothing for Tk versions before 8.4.3.&quot;&quot;&quot;</span>

        <span class="n">gui</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="s">&quot;tk_patchLevel&quot;</span><span class="p">)</span>
            <span class="c"># g.trace(repr(version),g.CheckVersion(version,&quot;8.4.3&quot;))</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">CheckVersion</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="s">&quot;8.4.3&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>

                <span class="c"># tk 8.4.3 or greater: load a 16 by 16 icon.</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&quot;..&quot;</span><span class="p">,</span><span class="s">&quot;Icons&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="n">theFile</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&quot;LeoApp16.ico&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">BitmapImage</span><span class="p">(</span><span class="n">theFile</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;LeoApp16.ico&#39;</span><span class="p">,</span><span class="s">&#39;not in&#39;</span><span class="p">,</span><span class="s">&#39;Icons&#39;</span><span class="p">,</span><span class="s">&#39;directory&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Icons&#39;</span><span class="p">,</span><span class="s">&#39;directory not found:&#39;</span><span class="p">,</span><span class="n">path</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;exception setting bitmap&quot;</span><span class="p">)</span>
            <span class="kn">import</span> <span class="nn">traceback</span> <span class="p">;</span> <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.361: *5* tkGui.getDefaultConfigFont</span></div>
<div class="viewcode-block" id="tkinterGui.getDefaultConfigFont"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.getDefaultConfigFont">[docs]</a>    <span class="k">def</span> <span class="nf">getDefaultConfigFont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Get the default font from a new text widget.&quot;&quot;&quot;</span>

        <span class="c"># g.trace(g.callers())</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFontFamily</span><span class="p">:</span>
            <span class="c"># WARNING: retain NO references to widgets or fonts here!</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">()</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;font&quot;</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">fn</span><span class="p">)</span> 
            <span class="n">family</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;family&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultFontFamily</span> <span class="o">=</span> <span class="n">family</span><span class="p">[:]</span>
            <span class="c"># g.pr(&#39;***** getDefaultConfigFont&#39;,repr(family))</span>

        <span class="n">config</span><span class="o">.</span><span class="n">defaultFont</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">config</span><span class="o">.</span><span class="n">defaultFontFamily</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFontFamily</span>
    <span class="c">#@+node:ekr.20081121110412.362: *4* destroySelf</span></div>
<div class="viewcode-block" id="tkinterGui.destroySelf"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.destroySelf">[docs]</a>    <span class="k">def</span> <span class="nf">destroySelf</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Works in Python 2.1 and 2.2.  Leaves Python window open.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span> <span class="c"># Works in Python 2.3.  Closes Python window.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.363: *4* killGui</span></div>
<div class="viewcode-block" id="tkinterGui.killGui"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.killGui">[docs]</a>    <span class="k">def</span> <span class="nf">killGui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exitFlag</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Destroy a gui and terminate Leo if exitFlag is True.&quot;&quot;&quot;</span>

        <span class="k">pass</span> <span class="c"># No need to do anything.</span>
    <span class="c">#@+node:ekr.20081121110412.364: *4* recreateRootWindow</span></div>
<div class="viewcode-block" id="tkinterGui.recreateRootWindow"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.recreateRootWindow">[docs]</a>    <span class="k">def</span> <span class="nf">recreateRootWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A do-nothing base class to create the hidden root window of a gui</span>

<span class="sd">        after a previous gui has terminated with killGui(False).&quot;&quot;&quot;</span>

        <span class="k">pass</span> <span class="c"># No need to do anything.</span>
    <span class="c">#@+node:ekr.20081121110412.365: *4* runMainLoop (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.runMainLoop"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runMainLoop">[docs]</a>    <span class="k">def</span> <span class="nf">runMainLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Run tkinter&#39;s main loop.&quot;&quot;&quot;</span>

        <span class="c"># Avoid an erroneous pylint complaint.</span>
        <span class="c"># script = self.script</span>
        <span class="n">script</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;script&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">script</span><span class="p">:</span>
            <span class="n">log</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">log</span>
            <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;Start of batch script...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">executeScript</span><span class="p">(</span><span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;End of batch script&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;no log, no commander for executeScript in tkInterGui.runMainLoop&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="c"># g.trace(&quot;tkinterGui&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.366: *3* tkGui dialogs &amp; panels</span></div>
<div class="viewcode-block" id="tkinterGui.runAboutLeoDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAboutLeoDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAboutLeoDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">theCopyright</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">email</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run a Tkinter About Leo dialog.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAboutLeo</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">theCopyright</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">email</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runAskLeoIDDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAskLeoIDDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAskLeoIDDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run a dialog to get g.app.LeoID.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAskLeoID</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runAskOkDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAskOkDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAskOkDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Ok&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run a Tkinter an askOK dialog .&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAskOk</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runAskOkCancelNumberDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAskOkCancelNumberDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAskOkCancelNumberDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run askOkCancelNumber dialog .&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAskOkCancelNumber</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runAskOkCancelStringDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAskOkCancelStringDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAskOkCancelStringDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run askOkCancelString dialog .&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAskOkCancelString</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runAskYesNoDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAskYesNoDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAskYesNoDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run an askYesNo dialog.&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAskYesNo</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runAskYesNoCancelDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runAskYesNoCancelDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runAskYesNoCancelDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yesMessage</span><span class="o">=</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span><span class="n">noMessage</span><span class="o">=</span><span class="s">&quot;No&quot;</span><span class="p">,</span><span class="n">defaultButton</span><span class="o">=</span><span class="s">&quot;Yes&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create and run an askYesNoCancel dialog .&quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">tkinterAskYesNoCancel</span><span class="p">(</span>
            <span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">,</span><span class="n">yesMessage</span><span class="p">,</span><span class="n">noMessage</span><span class="p">,</span><span class="n">defaultButton</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">modal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.runPropertiesDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runPropertiesDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runPropertiesDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s">&#39;Properties&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dispay a modal TkPropertiesDialog&quot;&quot;&quot;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">TkPropertiesDialog</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">buttons</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dialog</span><span class="o">.</span><span class="n">result</span> 
    <span class="c">#@+node:ekr.20081122170423.2: *4* tkGui.alert</span></div>
<div class="viewcode-block" id="tkinterGui.alert"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.alert">[docs]</a>    <span class="k">def</span> <span class="nf">alert</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="kn">import</span> <span class="nn">tkMessageBox</span>

        <span class="n">tkMessageBox</span><span class="o">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s">&quot;Alert&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.367: *4* tkGui.createSpellTab</span></div>
<div class="viewcode-block" id="tkinterGui.createSpellTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createSpellTab">[docs]</a>    <span class="k">def</span> <span class="nf">createSpellTab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">spellHandler</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">tkSpellTab</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">spellHandler</span><span class="p">,</span><span class="n">tabName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.368: *4* tkGui file dialogs</span>
    <span class="c"># We no longer specify default extensions so that we can open and save files without extensions.</span>
    <span class="c">#@+node:ekr.20101111103251.3822: *5* runOpenDirectoryDialog (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.runOpenDirectoryDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runOpenDirectoryDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runOpenDirectoryDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">startdir</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create and run a Tk open directory dialog .&quot;&quot;&quot;</span>

        <span class="n">dirName</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askdirectory</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">initialdir</span><span class="o">=</span><span class="n">startdir</span><span class="p">,</span><span class="n">mustexist</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dirName</span>
    <span class="c">#@+node:ekr.20081121110412.369: *5* runOpenFileDialog (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.runOpenFileDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runOpenFileDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runOpenFileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">filetypes</span><span class="p">,</span><span class="n">defaultextension</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create and run an Tkinter open file dialog .&quot;&quot;&quot;</span>

        <span class="n">initialdir</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">globalOpenDir</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="c"># askopenfilenames requires Python 2.3 and Tk 8.4.</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">g</span><span class="o">.</span><span class="n">CheckVersion</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="s">&quot;2.3&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">g</span><span class="o">.</span><span class="n">CheckVersion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="s">&quot;tk_patchLevel&quot;</span><span class="p">),</span><span class="s">&quot;8.4&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilenames</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">filetypes</span><span class="o">=</span><span class="n">filetypes</span><span class="p">,</span><span class="n">initialdir</span><span class="o">=</span><span class="n">initialdir</span><span class="p">)</span>
                <span class="c"># g.trace(files)</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Get one file and return it as a list.</span>
                <span class="n">theFile</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">filetypes</span><span class="o">=</span><span class="n">filetypes</span><span class="p">,</span><span class="n">initialdir</span><span class="o">=</span><span class="n">initialdir</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">theFile</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Return a single file name as a string.</span>
            <span class="k">return</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">filetypes</span><span class="o">=</span><span class="n">filetypes</span><span class="p">,</span><span class="n">initialdir</span><span class="o">=</span><span class="n">initialdir</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.370: *5* runSaveFileDialog</span></div>
<div class="viewcode-block" id="tkinterGui.runSaveFileDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.runSaveFileDialog">[docs]</a>    <span class="k">def</span> <span class="nf">runSaveFileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">initialfile</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">filetypes</span><span class="p">,</span><span class="n">defaultextension</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create and run an Tkinter save file dialog .&quot;&quot;&quot;</span>

        <span class="n">initialdir</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">globalOpenDir</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">(</span>
            <span class="n">initialdir</span><span class="o">=</span><span class="n">initialdir</span><span class="p">,</span><span class="n">initialfile</span><span class="o">=</span><span class="n">initialfile</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">filetypes</span><span class="o">=</span><span class="n">filetypes</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.371: *4* tkGui panels</span></div>
<div class="viewcode-block" id="tkinterGui.createComparePanel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createComparePanel">[docs]</a>    <span class="k">def</span> <span class="nf">createComparePanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Tkinter color picker panel.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">leoTkinterComparePanel</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.createFindTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createFindTab">[docs]</a>    <span class="k">def</span> <span class="nf">createFindTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Tkinter find tab in the indicated frame.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">tkFindTab</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.createLeoFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createLeoFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createLeoFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new Leo frame.&quot;&quot;&quot;</span>
        <span class="c"># g.pr(&#39;tkGui.createLeoFrame&#39;)</span>
        <span class="n">gui</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">leoTkinterFrame</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">gui</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.372: *3* tkGui utils</span>
    <span class="c">#@+node:ekr.20081121110412.373: *4* Clipboard (tkGui)</span>
    <span class="c">#@+node:ekr.20081121110412.374: *5* replaceClipboardWith</span></div>
<div class="viewcode-block" id="tkinterGui.replaceClipboardWith"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.replaceClipboardWith">[docs]</a>    <span class="k">def</span> <span class="nf">replaceClipboardWith</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="c"># g.app.gui.win32clipboard is always None.</span>
        <span class="n">wcb</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">win32clipboard</span>

        <span class="k">if</span> <span class="n">wcb</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wcb</span><span class="o">.</span><span class="n">OpenClipboard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">wcb</span><span class="o">.</span><span class="n">EmptyClipboard</span><span class="p">()</span>
                <span class="n">wcb</span><span class="o">.</span><span class="n">SetClipboardText</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">wcb</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">clipboard_clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">clipboard_append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.375: *5* getTextFromClipboard</span></div>
<div class="viewcode-block" id="tkinterGui.getTextFromClipboard"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.getTextFromClipboard">[docs]</a>    <span class="k">def</span> <span class="nf">getTextFromClipboard</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># g.app.gui.win32clipboard is always None.</span>
        <span class="n">wcb</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">win32clipboard</span>

        <span class="k">if</span> <span class="n">wcb</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wcb</span><span class="o">.</span><span class="n">OpenClipboard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">wcb</span><span class="o">.</span><span class="n">GetClipboardData</span><span class="p">()</span>
                <span class="n">wcb</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span>
                <span class="c"># g.trace(data)</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c"># g.trace(None)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">selection_get</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s">&quot;CLIPBOARD&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">s</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.376: *4* color</span>
    <span class="c"># g.es calls gui.color to do the translation,</span>
    <span class="c"># so most code in Leo&#39;s core can simply use Tk color names.</span>
</div>
<div class="viewcode-block" id="tkinterGui.color"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.color">[docs]</a>    <span class="k">def</span> <span class="nf">color</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">color</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the gui-specific color corresponding to the Tk color name.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">color</span>

    <span class="c">#@+node:ekr.20081121110412.377: *4* Dialog</span>
    <span class="c">#@+node:ekr.20081121110412.378: *5* get_window_info</span>
    <span class="c"># WARNING: Call this routine _after_ creating a dialog.</span>
    <span class="c"># (This routine inhibits the grid and pack geometry managers.)</span>
</div>
<div class="viewcode-block" id="tkinterGui.get_window_info"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.get_window_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_window_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">top</span><span class="p">):</span>

        <span class="n">top</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span> <span class="c"># Required to get proper info.</span>

        <span class="c"># Get the information about top and the screen.</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span> <span class="c"># geom = &quot;WidthxHeight+XOffset+YOffset&quot;</span>
        <span class="n">dim</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
    <span class="c">#@+node:ekr.20081121110412.379: *5* center_dialog</span></div>
<div class="viewcode-block" id="tkinterGui.center_dialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.center_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">center_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">top</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Center the dialog on the screen.</span>

<span class="sd">        WARNING: Call this routine _after_ creating a dialog.</span>
<span class="sd">        (This routine inhibits the grid and pack geometry managers.)&quot;&quot;&quot;</span>

        <span class="n">sw</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_screenwidth</span><span class="p">()</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_screenheight</span><span class="p">()</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_window_info</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

        <span class="c"># Set the new window coordinates, leaving w and h unchanged.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">sw</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">sh</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">x</span><span class="si">%d%+d%+d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
    <span class="c">#@+node:ekr.20081121110412.380: *5* create_labeled_frame</span>
    <span class="c"># Returns frames w and f.</span>
    <span class="c"># Typically the caller would pack w into other frames, and pack content into f.</span>
</div>
<div class="viewcode-block" id="tkinterGui.create_labeled_frame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.create_labeled_frame">[docs]</a>    <span class="k">def</span> <span class="nf">create_labeled_frame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">caption</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="c"># Create w, the master frame.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">sticky</span><span class="o">=</span><span class="s">&quot;news&quot;</span><span class="p">)</span>

        <span class="c"># Configure w as a grid with 5 rows and columns.</span>
        <span class="c"># The middle of this grid will contain f, the expandable content area.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">padx</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">padx</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>

        <span class="n">w</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">pady</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">pady</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">minsize</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>

        <span class="c"># Create the border spanning all rows and columns.</span>
        <span class="n">border</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="n">bd</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="n">relief</span><span class="p">)</span> <span class="c"># padx=padx,pady=pady)</span>
        <span class="n">border</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">columnspan</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">sticky</span><span class="o">=</span><span class="s">&quot;news&quot;</span><span class="p">)</span>

        <span class="c"># Create the content frame, f, in the center of the grid.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="n">bd</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">sticky</span><span class="o">=</span><span class="s">&quot;news&quot;</span><span class="p">)</span>

        <span class="c"># Add the caption.</span>
        <span class="k">if</span> <span class="n">caption</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">caption</span><span class="p">,</span><span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">caption</span><span class="o">.</span><span class="n">tkraise</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">caption</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">in_</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">columnspan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">sticky</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">w</span><span class="p">,</span><span class="n">f</span>
    <span class="c">#@+node:ekr.20081121110412.381: *4* Events (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.event_generate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.event_generate">[docs]</a>    <span class="k">def</span> <span class="nf">event_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generate an event.&#39;&#39;&#39;</span>
        <span class="c"># g.trace(&#39;tkGui&#39;,&#39;kind&#39;,kind,&#39;w&#39;,w,&#39;args,keys&#39;,*args,**keys)</span>
        <span class="c"># g.trace(g.callers())</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterGui.eventChar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.eventChar">[docs]</a>    <span class="k">def</span> <span class="nf">eventChar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the char field of an event.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">event</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="tkinterGui.eventKeysym"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.eventKeysym">[docs]</a>    <span class="k">def</span> <span class="nf">eventKeysym</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the keysym value of an event.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">event</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span>
</div>
<div class="viewcode-block" id="tkinterGui.eventWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.eventWidget">[docs]</a>    <span class="k">def</span> <span class="nf">eventWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the widget field of an event.&#39;&#39;&#39;</span>   
        <span class="k">return</span> <span class="n">event</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span>
</div>
<div class="viewcode-block" id="tkinterGui.eventXY"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.eventXY">[docs]</a>    <span class="k">def</span> <span class="nf">eventXY</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
    <span class="c">#@+node:ekr.20081121110412.382: *4* Focus</span>
    <span class="c">#@+node:ekr.20081121110412.383: *5* tkGui.get_focus</span></div>
<div class="viewcode-block" id="tkinterGui.get_focus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.get_focus">[docs]</a>    <span class="k">def</span> <span class="nf">get_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Returns the widget that has focus, or body if None.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">focus_displayof</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.384: *5* tk.Gui.set_focus</span></div>
    <span class="n">set_focus_count</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="tkinterGui.set_focus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.set_focus">[docs]</a>    <span class="k">def</span> <span class="nf">set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Put the focus on the widget.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_g.app.gui.set_focus&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_focus_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c"># Do not call trace here: that might affect focus!</span>
            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;gui.set_focus: </span><span class="si">%4d</span><span class="s"> </span><span class="si">%10s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_focus_count</span><span class="p">,</span><span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">shortFileName</span><span class="p">(),</span>
                <span class="n">c</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">widget_name</span><span class="p">(</span><span class="n">w</span><span class="p">)),</span> <span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># No longer needed.</span>
                    <span class="c"># A call to findTab.bringToFront caused</span>
                    <span class="c"># the focus problems with Pmw.Notebook.</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

                <span class="c"># It&#39;s possible that the widget doesn&#39;t exist now.</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;tkGui&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
                <span class="n">w</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
                    <span class="c"># This forces the focus immediately.</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

                <span class="c"># This often fails.  The focus will be delayed until later...</span>
                <span class="c"># if not w != w.focus_get():</span>
                    <span class="c"># g.trace(&#39;*** can not happen:&#39;,repr(w),repr(w.focus_get()))</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.385: *4* Font</span>
    <span class="c">#@+node:ekr.20081121110412.386: *5* tkGui.getFontFromParams</span></div>
<div class="viewcode-block" id="tkinterGui.getFontFromParams"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.getFontFromParams">[docs]</a>    <span class="k">def</span> <span class="nf">getFontFromParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="p">,</span><span class="n">defaultSize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>

        <span class="n">family_name</span> <span class="o">=</span> <span class="n">family</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;tkGui&#39;,&#39;family&#39;,family,&#39;size&#39;,size,&#39;defaultSize&#39;,defaultSize)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span> <span class="ow">or</span> <span class="n">defaultSize</span><span class="p">,</span><span class="n">slant</span><span class="o">=</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">font</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting font from&quot;</span><span class="p">,</span><span class="n">family_name</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;family,size,slant,weight:&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">family</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
            <span class="c"># g.es_exception() # This just confuses people.</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultFont</span>
    <span class="c">#@+node:ekr.20081121110412.387: *4* getFullVersion (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.getFullVersion"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.getFullVersion">[docs]</a>    <span class="k">def</span> <span class="nf">getFullVersion</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pmwver</span> <span class="o">=</span> <span class="n">Pmw</span> <span class="ow">and</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">version</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&quot;UNAVAILABLE&quot;</span>
        <span class="k">return</span> <span class="s">&#39;Tk </span><span class="si">%s</span><span class="s">, Pmw </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Tk</span><span class="o">.</span><span class="n">TkVersion</span><span class="p">,</span><span class="n">pmwver</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.388: *4* Icons</span>
    <span class="c">#@+node:ekr.20081121110412.389: *5* attachLeoIcon &amp; createLeoIcon</span></div>
<div class="viewcode-block" id="tkinterGui.attachLeoIcon"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.attachLeoIcon">[docs]</a>    <span class="k">def</span> <span class="nf">attachLeoIcon</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Try to attach a Leo icon to the Leo Window.</span>

<span class="sd">        Use tk&#39;s wm_iconbitmap function if available (tk 8.3.4 or greater).</span>
<span class="sd">        Otherwise, try to use the Python Imaging Library and the tkIcon package.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># We don&#39;t need PIL or tkicon: this is tk 8.3.4 or greater.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">wm_iconbitmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c">#@+&lt;&lt; try to use the PIL and tkIcon packages to draw the icon &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.390: *6* &lt;&lt; try to use the PIL and tkIcon packages to draw the icon &gt;&gt;</span>
                <span class="c">#@+at This code requires Fredrik Lundh&#39;s PIL and tkIcon packages:</span>
                <span class="c"># </span>
                <span class="c"># Download PIL    from http://www.pythonware.com/downloads/index.htm#pil</span>
                <span class="c"># Download tkIcon from http://www.effbot.org/downloads/#tkIcon</span>
                <span class="c"># </span>
                <span class="c"># Many thanks to Jonathan M. Gilligan for suggesting this code.</span>
                <span class="c">#@@c</span>

                <span class="kn">import</span> <span class="nn">Image</span>
                <span class="kn">import</span> <span class="nn">tkIcon</span> <span class="c"># pychecker complains, but this *is* used.</span>

                <span class="c"># Wait until the window has been drawn once before attaching the icon in OnVisiblity.</span>
                <span class="k">def</span> <span class="nf">visibilityCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">leoIcon</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">winfo_id</span><span class="p">())</span>
                    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

                <span class="c"># No commander is available here, and we don&#39;t need to call c.outerUpdate.</span>
                <span class="n">w</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;&lt;Visibility&gt;&quot;</span><span class="p">,</span><span class="n">visibilityCallback</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">leoIcon</span><span class="p">:</span>
                    <span class="c"># Load a 16 by 16 gif.  Using .gif rather than an .ico allows us to specify transparency.</span>
                    <span class="n">icon_file_name</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&#39;..&#39;</span><span class="p">,</span><span class="s">&#39;Icons&#39;</span><span class="p">,</span><span class="s">&#39;LeoWin.gif&#39;</span><span class="p">)</span>
                    <span class="n">icon_file_name</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_normpath</span><span class="p">(</span><span class="n">icon_file_name</span><span class="p">)</span>
                    <span class="n">icon_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">icon_file_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># Doesn&#39;t resize.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">leoIcon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createLeoIcon</span><span class="p">(</span><span class="n">icon_image</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c"># Assumes 64x64</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">leoIcon</span> <span class="o">=</span> <span class="n">tkIcon</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">icon_image</span><span class="p">)</span>
                <span class="c">#@-&lt;&lt; try to use the PIL and tkIcon packages to draw the icon &gt;&gt;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c"># import traceback ; traceback.print_exc()</span>
                <span class="c"># g.es_exception()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leoIcon</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.391: *6* createLeoIcon</span>
    <span class="c"># This code is adapted from tkIcon.__init__</span>
    <span class="c"># Unlike the tkIcon code, this code does _not_ resize the icon file.</span>
</div>
<div class="viewcode-block" id="tkinterGui.createLeoIcon"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.createLeoIcon">[docs]</a>    <span class="k">def</span> <span class="nf">createLeoIcon</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">icon</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">Image</span><span class="o">,</span><span class="nn">_tkicon</span>

            <span class="n">i</span> <span class="o">=</span> <span class="n">icon</span> <span class="p">;</span> <span class="n">m</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="c"># create transparency mask</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;P&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s">&quot;transparency&quot;</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">:</span> <span class="n">i</span><span class="o">==</span><span class="n">t</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;RGBA&quot;</span><span class="p">:</span>
                <span class="c"># get transparency layer</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c"># opaque</span>
            <span class="c"># clear unused parts of the original image</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&quot;RGB&quot;</span><span class="p">)</span>
            <span class="n">i</span><span class="o">.</span><span class="n">paste</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">m</span><span class="p">)</span>
            <span class="c"># create icon</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="s">&quot;raw&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="s">&quot;raw&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;BGRX&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_tkicon</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081123003126.1: *5* getTreeImage</span></div>
<div class="viewcode-block" id="tkinterGui.getTreeImage"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.getTreeImage">[docs]</a>    <span class="k">def</span> <span class="nf">getTreeImage</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">Image</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;can not import Image module from PIL&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageTk</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">ImageTk</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="n">ImageTk</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;can not import ImageTk module&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Image</span> <span class="ow">and</span> <span class="n">ImageTk</span><span class="p">:</span>
                <span class="n">image1</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">Tkinter</span> <span class="kn">as</span> <span class="nn">Tk</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image</span><span class="p">,</span><span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.392: *4* Idle Time</span>
    <span class="c">#@+node:ekr.20081121110412.393: *5* tkinterGui.setIdleTimeHook</span></div>
<div class="viewcode-block" id="tkinterGui.setIdleTimeHook"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.setIdleTimeHook">[docs]</a>    <span class="k">def</span> <span class="nf">setIdleTimeHook</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">idleTimeHookHandler</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">after_idle</span><span class="p">(</span><span class="n">idleTimeHookHandler</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.394: *5* setIdleTimeHookAfterDelay</span></div>
<div class="viewcode-block" id="tkinterGui.setIdleTimeHookAfterDelay"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.setIdleTimeHookAfterDelay">[docs]</a>    <span class="k">def</span> <span class="nf">setIdleTimeHookAfterDelay</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">idleTimeHookHandler</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">idleTimeDelay</span><span class="p">,</span><span class="n">idleTimeHookHandler</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.395: *4* isTextWidget</span></div>
<div class="viewcode-block" id="tkinterGui.isTextWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.isTextWidget">[docs]</a>    <span class="k">def</span> <span class="nf">isTextWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return True if w is a Text widget suitable for text-oriented commands.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">w</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.396: *4* makeScriptButton (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.makeScriptButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.makeScriptButton">[docs]</a>    <span class="k">def</span> <span class="nf">makeScriptButton</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c"># A node containing the script.</span>
        <span class="n">script</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c"># The script itself.</span>
        <span class="n">buttonText</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">balloonText</span><span class="o">=</span><span class="s">&#39;Script Button&#39;</span><span class="p">,</span>
        <span class="n">shortcut</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;LightSteelBlue1&#39;</span><span class="p">,</span>
        <span class="n">define_g</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">define_name</span><span class="o">=</span><span class="s">&#39;__main__&#39;</span><span class="p">,</span><span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="c"># Passed on to c.executeScript.</span>
    <span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create a script button for the script in node p.</span>
<span class="sd">        The button&#39;s text defaults to p.headString&#39;&#39;&#39;</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">buttonText</span><span class="p">:</span> <span class="n">buttonText</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">buttonText</span><span class="p">:</span> <span class="n">buttonText</span> <span class="o">=</span> <span class="s">&#39;Unnamed Script Button&#39;</span>
        <span class="c">#@+&lt;&lt; create the button b &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.397: *5* &lt;&lt; create the button b &gt;&gt;</span>
        <span class="n">iconBar</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">getIconBarObject</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">iconBar</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">buttonText</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">balloonText</span> <span class="ow">and</span> <span class="n">balloonText</span> <span class="o">!=</span> <span class="n">buttonText</span><span class="p">:</span>
            <span class="n">Pmw</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">importExtension</span><span class="p">(</span><span class="s">&#39;Pmw&#39;</span><span class="p">,</span><span class="n">pluginName</span><span class="o">=</span><span class="s">&#39;gui.makeScriptButton&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Pmw</span><span class="p">:</span>
                <span class="n">balloon</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">Balloon</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">initwait</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">balloon</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">balloonText</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buttonText</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;verdana&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;bold&#39;</span><span class="p">),</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the button b &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; define the callbacks for b &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.398: *5* &lt;&lt; define the callbacks for b &gt;&gt;</span>
        <span class="k">def</span> <span class="nf">deleteButtonCallback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">executeScriptCallback</span> <span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">buttonText</span><span class="o">=</span><span class="n">buttonText</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">disableCommandsMessage</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">disableCommandsMessage</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scriptDict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">c</span><span class="o">.</span><span class="n">executeScript</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
                <span class="n">define_g</span><span class="o">=</span> <span class="n">define_g</span><span class="p">,</span><span class="n">define_name</span><span class="o">=</span><span class="n">define_name</span><span class="p">,</span><span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">)</span>
                <span class="c"># Remove the button if the script asks to be removed.</span>
                <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">scriptDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;removeMe&#39;</span><span class="p">):</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;removing&quot;</span><span class="p">,</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">buttonText</span><span class="p">),</span><span class="s">&quot;button at its request&quot;</span><span class="p">)</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="c"># Do not assume the script will want to remain in this commander.</span>
        <span class="c">#@-&lt;&lt; define the callbacks for b &gt;&gt;</span>
        <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">executeScriptCallback</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span><span class="n">deleteButtonCallback</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shortcut</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; bind the shortcut to executeScriptCallback &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.399: *5* &lt;&lt; bind the shortcut to executeScriptCallback &gt;&gt;</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">executeScriptCallback</span>
            <span class="n">shortcut</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">canonicalizeShortcut</span><span class="p">(</span><span class="n">shortcut</span><span class="p">)</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">bindKey</span> <span class="p">(</span><span class="s">&#39;button&#39;</span><span class="p">,</span> <span class="n">shortcut</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">buttonText</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;bound @button&#39;</span><span class="p">,</span><span class="n">buttonText</span><span class="p">,</span><span class="s">&#39;to&#39;</span><span class="p">,</span><span class="n">shortcut</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; bind the shortcut to executeScriptCallback &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create press-buttonText-button command &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.400: *5* &lt;&lt; create press-buttonText-button command &gt;&gt;</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">isalnum</span><span class="p">(),</span><span class="n">ch</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">buttonText</span><span class="p">]</span>

        <span class="n">buttonCommandName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>
        <span class="n">buttonCommandName</span> <span class="o">=</span> <span class="n">buttonCommandName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">buttonCommandName</span> <span class="o">=</span> <span class="s">&#39;press-</span><span class="si">%s</span><span class="s">-button&#39;</span> <span class="o">%</span> <span class="n">buttonCommandName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c"># This will use any shortcut defined in an @shortcuts node.</span>
        <span class="n">k</span><span class="o">.</span><span class="n">registerCommand</span><span class="p">(</span><span class="n">buttonCommandName</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="n">executeScriptCallback</span><span class="p">,</span><span class="n">pane</span><span class="o">=</span><span class="s">&#39;button&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create press-buttonText-button command &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.401: *4* killPopupMenu</span></div>
<div class="viewcode-block" id="tkinterGui.killPopupMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.killPopupMenu">[docs]</a>    <span class="k">def</span> <span class="nf">killPopupMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If there is a popup menu, destroy it.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;focusout&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastPopupMenu</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">unpost</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>


    <span class="c">#@+node:ekr.20081121110412.402: *4* postPopupMenu</span></div>
<div class="viewcode-block" id="tkinterGui.postPopupMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.postPopupMenu">[docs]</a>    <span class="k">def</span> <span class="nf">postPopupMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Post a popup menu after killing any previous menu.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">killPopupMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastPopupMenu</span> <span class="o">=</span> <span class="n">m</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c">#@+node:ekr.20081121110412.403: *3* class leoTkKeyEvent (tkGui)</span></div>
<div class="viewcode-block" id="tkinterGui.leoTkKeyEvent"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterGui.leoTkKeyEvent">[docs]</a>    <span class="k">class</span> <span class="nc">leoTkKeyEvent</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;A wrapper for Tk key events events.&#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">stroke</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;(leoTkKeyEvent) (tkGui)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actualEvent</span> <span class="o">=</span> <span class="n">event</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span>      <span class="o">=</span> <span class="n">c</span> <span class="c"># Required to access c.k tables.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">char</span>   <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;char&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keysym</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;keysym&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span>  <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;state&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">state</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span>      <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;widget&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span> <span class="ow">or</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span>      <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;x&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span>      <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="c"># Support for fastGotoNode plugin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_root</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;x_root&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">x_root</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_root</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s">&#39;y_root&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span> <span class="ow">or</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keysym</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="p">:</span>
                <span class="c"># Translate keysyms for ascii characters to the character itself.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keysym</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">guiBindNamesInverseDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysym</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">keysym</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stroke</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">stroke</span><span class="p">,</span><span class="n">stroke</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">keysym</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>

        <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">return</span> <span class="s">&#39;tkGui.leoKeyEvent: char: </span><span class="si">%s</span><span class="s">, keysym: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">char</span><span class="p">),</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysym</span><span class="p">))</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20101028132547.3760: ** class TkPropertiesDialog</span>
<span class="c"># This class is also defined in the plugins_menu.py plugin.</span></div></div>
<div class="viewcode-block" id="TkPropertiesDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.TkPropertiesDialog">[docs]</a><span class="k">class</span> <span class="nc">TkPropertiesDialog</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;A class to create and run a Properties dialog&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20101028132547.3761: *3* __init__</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c">#@+&lt;&lt; docstring &gt;&gt;</span>
        <span class="c">#@+node:ekr.20101028132547.3762: *4* &lt;&lt; docstring &gt;&gt;</span>
        <span class="sd">&quot;&quot;&quot; Initialize and show a Properties dialog.</span>

<span class="sd">            &#39;buttons&#39; should be a list of names for buttons.</span>

<span class="sd">            &#39;callback&#39; should be None or a function of the form:</span>

<span class="sd">                def cb(name, data)</span>
<span class="sd">                    ...</span>
<span class="sd">                    return &#39;close&#39; # or anything other than &#39;close&#39;</span>

<span class="sd">            where name is the name of the button clicked and data is</span>
<span class="sd">            a data structure representing the current state of the dialog.</span>

<span class="sd">            If a callback is provided then when a button (other than</span>
<span class="sd">            &#39;OK&#39; or &#39;Cancel&#39;) is clicked then the callback will be called</span>
<span class="sd">            with name and data as parameters.</span>

<span class="sd">                If the literal string &#39;close&#39; is returned from the callback</span>
<span class="sd">                the dialog will be closed and self.result will be set to a</span>
<span class="sd">                tuple (button, data).</span>

<span class="sd">                If anything other than the literal string &#39;close&#39; is returned</span>
<span class="sd">                from the callback, the dialog will continue to be displayed.</span>

<span class="sd">            If no callback is provided then when a button is clicked the</span>
<span class="sd">            dialog will be closed and self.result set to  (button, data).</span>

<span class="sd">            The &#39;ok&#39; and &#39;cancel&#39; buttons (which are always provided) behave as</span>
<span class="sd">            if no callback was supplied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#@-&lt;&lt; docstring &gt;&gt;</span>

        <span class="k">if</span> <span class="n">buttons</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c">#@+&lt;&lt; create the frame from the configuration data &gt;&gt;</span>
        <span class="c">#@+node:ekr.20101028132547.3763: *4* &lt;&lt; Create the frame from the configuration data &gt;&gt;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span>

        <span class="c">#@+&lt;&lt; Create the top level and the main frame &gt;&gt;</span>
        <span class="c">#@+node:ekr.20101028132547.3764: *5* &lt;&lt; Create the top level and the main frame &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">attachLeoIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="c">#top.title(&quot;Properties of &quot;+ plugin.name)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">top</span><span class="o">.</span><span class="n">resizable</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c"># neither height or width is resizable.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the top level and the main frame &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create widgets for each section and option &gt;&gt;</span>
        <span class="c">#@+node:ekr.20101028132547.3765: *5* &lt;&lt; Create widgets for each section and option &gt;&gt;</span>
        <span class="c"># Create all the entry boxes on the screen to allow the user to edit the properties</span>

        <span class="n">sections</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>

            <span class="c"># Create a frame for the section.</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span>

            <span class="c"># Create an inner frame for the options.</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">options</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">options</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># Create a Tk.Label and Tk.Entry for each option.</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">option</span><span class="p">])</span>
                <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">option</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s">&quot;ew&quot;</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="c">#@-&lt;&lt; Create widgets for each section and option &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create the buttons &gt;&gt;</span>
        <span class="c">#@+node:ekr.20101028132547.3766: *5* &lt;&lt; Create the buttons &gt;&gt;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">)</span>

        <span class="n">buttons</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">buttons</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">box</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">onButton</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c">#@-&lt;&lt; Create the buttons &gt;&gt;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">center_dialog</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="c"># Do this after packing.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">grab_set</span><span class="p">()</span> <span class="c"># Make the dialog a modal dialog.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">focus_force</span><span class="p">()</span> <span class="c"># Get all keystrokes.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Cancel&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">root</span><span class="o">.</span><span class="n">wait_window</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the frame from the configuration data &gt;&gt;</span>
    <span class="c">#@+node:ekr.20101028132547.3767: *3* Event Handlers</span>

<div class="viewcode-block" id="TkPropertiesDialog.onButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.TkPropertiesDialog.onButton">[docs]</a>    <span class="k">def</span> <span class="nf">onButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Event handler for all button clicks.&quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">,</span> <span class="s">&#39;Cancel&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="s">&#39;close&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Cancel&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


    <span class="c">#@+node:ekr.20101028132547.3768: *3* getData</span></div>
<div class="viewcode-block" id="TkPropertiesDialog.getData"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.TkPropertiesDialog.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the modified configuration.&quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toEncodedString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span><span class="n">reportErrors</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Config params had better be ascii.</span>
            <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="k">return</span> <span class="n">data</span>


    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.404: ** class tkinterKeyHandlerClass</span></div></div>
<div class="viewcode-block" id="tkinterKeyHandlerClass"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterKeyHandlerClass">[docs]</a><span class="k">class</span> <span class="nc">tkinterKeyHandlerClass</span> <span class="p">(</span><span class="n">leoKeys</span><span class="o">.</span><span class="n">keyHandlerClass</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Tkinter overrides of base keyHandlerClass.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.405: *3* tkKeys.ctor</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">useGlobalKillbuffer</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">useGlobalRegisters</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">leoKeys</span><span class="o">.</span><span class="n">keyHandlerClass</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">useGlobalKillbuffer</span><span class="p">,</span><span class="n">useGlobalRegisters</span><span class="p">)</span>

        <span class="c"># Create</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createTkIvars</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.406: *3* createTkIvars</span>
<div class="viewcode-block" id="tkinterKeyHandlerClass.createTkIvars"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterKeyHandlerClass.createTkIvars">[docs]</a>    <span class="k">def</span> <span class="nf">createTkIvars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">pass</span>
    <span class="c">#@+node:ekr.20081121110412.407: *3* tkKeys.propagateKeyEvent</span></div>
<div class="viewcode-block" id="tkinterKeyHandlerClass.propagateKeyEvent"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterKeyHandlerClass.propagateKeyEvent">[docs]</a>    <span class="k">def</span> <span class="nf">propagateKeyEvent</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;continue&#39;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.28: ** dialog classes</span>
<span class="c">#@+node:ekr.20081121110412.29: *3*  class leoTkinterDialog</span></div></div>
<div class="viewcode-block" id="leoTkinterDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterDialog</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;The base class for all Leo Tkinter dialogs&quot;&quot;&quot;</span>
    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.30: *4* __init__ (tkDialog)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">canClose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Constructor for the leoTkinterDialog class.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Value returned from run()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="c"># For use by delayed focus methods in c.frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizeable</span> <span class="o">=</span> <span class="n">resizeable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFrame</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Frame to hold typical dialog buttons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultButtonCommand</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Command to call when user closes the window by clicking the close box.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The outermost frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># g.app.root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showFlag</span> <span class="o">=</span> <span class="n">show</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The toplevel Tk widget.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># The widget to get the first focus.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canClose</span> <span class="o">=</span> <span class="n">canClose</span>
    <span class="c">#@+node:ekr.20081121110412.31: *4* cancelButton, noButton, okButton, yesButton</span>
<div class="viewcode-block" id="leoTkinterDialog.cancelButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.cancelButton">[docs]</a>    <span class="k">def</span> <span class="nf">cancelButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Do default click action in cancel button.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="s">&quot;cancel&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterDialog.noButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.noButton">[docs]</a>    <span class="k">def</span> <span class="nf">noButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Do default click action in no button.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="s">&quot;no&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterDialog.okButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.okButton">[docs]</a>    <span class="k">def</span> <span class="nf">okButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Do default click action in ok button.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="s">&quot;ok&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterDialog.yesButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.yesButton">[docs]</a>    <span class="k">def</span> <span class="nf">yesButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Do default click action in yes button.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="s">&quot;yes&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.32: *4* center</span></div>
<div class="viewcode-block" id="leoTkinterDialog.center"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.center">[docs]</a>    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Center any leoTkinterDialog.&quot;&quot;&quot;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">center_dialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.33: *4* createButtons</span></div>
<div class="viewcode-block" id="leoTkinterDialog.createButtons"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.createButtons">[docs]</a>    <span class="k">def</span> <span class="nf">createButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">buttons</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a row of buttons.</span>

<span class="sd">        buttons is a list of dictionaries containing the properties of each button.&quot;&quot;&quot;</span>

        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFrame</span> <span class="o">=</span> <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="c"># Buttons is a list of dictionaries, with an empty dictionary at the end if there is only one entry.</span>
        <span class="n">buttonList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">buttons</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="s">&quot;&lt;missing button name&gt;&quot;</span><span class="p">)</span>
            <span class="n">isDefault</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;default&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">underline</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;underline&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;command&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
            <span class="n">bd</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">isDefault</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="n">bd</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">underline</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">buttonList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">isDefault</span> <span class="ow">and</span> <span class="n">command</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defaultButtonCommand</span> <span class="o">=</span> <span class="n">command</span>

        <span class="k">return</span> <span class="n">buttonList</span>
    <span class="c">#@+node:ekr.20081121110412.34: *4* createMessageFrame</span></div>
<div class="viewcode-block" id="leoTkinterDialog.createMessageFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.createMessageFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createMessageFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a frame containing a Tk.Label widget.&quot;&quot;&quot;</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.35: *4* createTopFrame</span></div>
<div class="viewcode-block" id="leoTkinterDialog.createTopFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.createTopFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createTopFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the Tk.Toplevel widget for a leoTkinterDialog.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span>
        <span class="c"># g.trace(&quot;leoTkinterDialog&quot;,&#39;root&#39;,self.root)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">resizeable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">resizable</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c"># neither height or width is resizable.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canClose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="c"># Do this at idle time.</span>
            <span class="k">def</span> <span class="nf">attachIconCallback</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">attachLeoIcon</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">after_idle</span><span class="p">(</span><span class="n">attachIconCallback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.36: *4* onClose</span></div>
<div class="viewcode-block" id="leoTkinterDialog.onClose"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.onClose">[docs]</a>    <span class="k">def</span> <span class="nf">onClose</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Disable all attempts to close this frame with the close box.&quot;&quot;&quot;</span>

        <span class="k">pass</span>
    <span class="c">#@+node:ekr.20081121110412.37: *4* run (tkDialog)</span></div>
<div class="viewcode-block" id="leoTkinterDialog.run"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterDialog.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">modal</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Run a leoTkinterDialog.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal</span> <span class="o">=</span> <span class="n">modal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">()</span> <span class="c"># Do this after all packing complete.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>

        <span class="c"># Get all keystrokes.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">grab_set</span><span class="p">()</span> <span class="c"># Make the dialog a modal dialog.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>

        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">wait_window</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20090722094828.3643: *3* class leoTkinterPropertiesDialog</span></div></div>
<div class="viewcode-block" id="leoTkinterPropertiesDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterPropertiesDialog">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterPropertiesDialog</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;A class to create and run a Properties dialog&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20090722094828.3644: *4* __init__</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c">#@+&lt;&lt; docstring &gt;&gt;</span>
        <span class="c">#@+node:ekr.20090722094828.3645: *5* &lt;&lt; docstring &gt;&gt;</span>
        <span class="sd">&quot;&quot;&quot; Initialize and show a Properties dialog.</span>

<span class="sd">            &#39;buttons&#39; should be a list of names for buttons.</span>

<span class="sd">            &#39;callback&#39; should be None or a function of the form:</span>

<span class="sd">                def cb(name, data)</span>
<span class="sd">                    ...</span>
<span class="sd">                    return &#39;close&#39; # or anything other than &#39;close&#39;</span>

<span class="sd">            where name is the name of the button clicked and data is</span>
<span class="sd">            a data structure representing the current state of the dialog.</span>

<span class="sd">            If a callback is provided then when a button (other than</span>
<span class="sd">            &#39;OK&#39; or &#39;Cancel&#39;) is clicked then the callback will be called</span>
<span class="sd">            with name and data as parameters.</span>

<span class="sd">                If the literal string &#39;close&#39; is returned from the callback</span>
<span class="sd">                the dialog will be closed and self.result will be set to a</span>
<span class="sd">                tuple (button, data).</span>

<span class="sd">                If anything other than the literal string &#39;close&#39; is returned</span>
<span class="sd">                from the callback, the dialog will continue to be displayed.</span>

<span class="sd">            If no callback is provided then when a button is clicked the</span>
<span class="sd">            dialog will be closed and self.result set to  (button, data).</span>

<span class="sd">            The &#39;ok&#39; and &#39;cancel&#39; buttons (which are always provided) behave as</span>
<span class="sd">            if no callback was supplied.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#@-&lt;&lt; docstring &gt;&gt;</span>

        <span class="k">if</span> <span class="n">buttons</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">buttons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c">#@+&lt;&lt; create the frame from the configuration data &gt;&gt;</span>
        <span class="c">#@+node:ekr.20090722094828.3646: *5* &lt;&lt; Create the frame from the configuration data &gt;&gt;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span>

        <span class="c">#@+&lt;&lt; Create the top level and the main frame &gt;&gt;</span>
        <span class="c">#@+node:ekr.20090722094828.3647: *6* &lt;&lt; Create the top level and the main frame &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">attachLeoIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="c">#top.title(&quot;Properties of &quot;+ plugin.name)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">top</span><span class="o">.</span><span class="n">resizable</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c"># neither height or width is resizable.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the top level and the main frame &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create widgets for each section and option &gt;&gt;</span>
        <span class="c">#@+node:ekr.20090722094828.3648: *6* &lt;&lt; Create widgets for each section and option &gt;&gt;</span>
        <span class="c"># Create all the entry boxes on the screen to allow the user to edit the properties</span>

        <span class="n">sections</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">sections</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>

            <span class="c"># Create a frame for the section.</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">section</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">)</span>

            <span class="c"># Create an inner frame for the options.</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">options</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">options</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># Create a Tk.Label and Tk.Entry for each option.</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">option</span><span class="p">])</span>
                <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">option</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s">&quot;ew&quot;</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="c">#@-&lt;&lt; Create widgets for each section and option &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create the buttons &gt;&gt;</span>
        <span class="c">#@+node:ekr.20090722094828.3649: *6* &lt;&lt; Create the buttons &gt;&gt;</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">)</span>

        <span class="n">buttons</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="s">&quot;OK&quot;</span><span class="p">,</span> <span class="s">&quot;Cancel&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">buttons</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">box</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">onButton</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c">#@-&lt;&lt; Create the buttons &gt;&gt;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">center_dialog</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="c"># Do this after packing.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">grab_set</span><span class="p">()</span> <span class="c"># Make the dialog a modal dialog.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">focus_force</span><span class="p">()</span> <span class="c"># Get all keystrokes.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Cancel&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">root</span><span class="o">.</span><span class="n">wait_window</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the frame from the configuration data &gt;&gt;</span>
    <span class="c">#@+node:ekr.20090722094828.3650: *4* Event Handlers</span>

<div class="viewcode-block" id="leoTkinterPropertiesDialog.onButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterPropertiesDialog.onButton">[docs]</a>    <span class="k">def</span> <span class="nf">onButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Event handler for all button clicks.&quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">,</span> <span class="s">&#39;Cancel&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retval</span> <span class="o">==</span> <span class="s">&#39;close&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Cancel&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


    <span class="c">#@+node:ekr.20090722094828.3651: *4* getData</span></div>
<div class="viewcode-block" id="leoTkinterPropertiesDialog.getData"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterPropertiesDialog.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the modified configuration.&quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">section</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">section</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toEncodedString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;ascii&quot;</span><span class="p">,</span><span class="n">reportErrors</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Config params had better be ascii.</span>
            <span class="n">data</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

        <span class="k">return</span> <span class="n">data</span>


    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.8: *3* class leoTkinterComparePanel</span></div></div>
<div class="viewcode-block" id="leoTkinterComparePanel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterComparePanel</span> <span class="p">(</span><span class="n">leoCompare</span><span class="o">.</span><span class="n">leoCompare</span><span class="p">,</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that creates Leo&#39;s compare panel.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.9: *4* Birth...</span>
    <span class="c">#@+node:ekr.20081121110412.10: *5*  tkinterComparePanel.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">leoCompare</span><span class="o">.</span><span class="n">leoCompare</span><span class="o">.</span><span class="n">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span>
            <span class="s">&quot;Compare files and directories&quot;</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>

        <span class="c">#@+&lt;&lt; init tkinter compare ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.11: *6* &lt;&lt; init tkinter compare ivars &gt;&gt;</span>
        <span class="c"># Ivars pointing to Tk elements.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extensionEntry</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">countEntry</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printButtons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># No corresponding ivar in the leoCompare class.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useOutputFileVar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>

        <span class="c"># These all correspond to ivars in leoCompare</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appendOutputVar</span>             <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreBlankLinesVar</span>         <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine1Var</span>         <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine2Var</span>         <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreInteriorWhitespaceVar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreLeadingWhitespaceVar</span>  <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreSentinelLinesVar</span>      <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtensionVar</span>         <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeWhitespaceVisibleVar</span>    <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printBothMatchesVar</span>         <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printMatchesVar</span>             <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printMismatchesVar</span>          <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printTrailingMismatchesVar</span>  <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopAfterMismatchVar</span>        <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>
        <span class="c">#@-&lt;&lt; init tkinter compare ivars &gt;&gt;</span>

        <span class="c"># These ivars are set from Entry widgets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limitCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtension</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># The default file name in the &quot;output file name&quot; browsers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultOutputFileName</span> <span class="o">=</span> <span class="s">&quot;CompareResults.txt&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.12: *5* finishCreate (tkComparePanel)</span>
    <span class="c"># Initialize ivars from config parameters.</span>

<div class="viewcode-block" id="leoTkinterComparePanel.finishCreate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.finishCreate">[docs]</a>    <span class="k">def</span> <span class="nf">finishCreate</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># File names.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">option</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;compare_file_1&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;compare_file_2&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;output_file&quot;</span><span class="p">)</span> <span class="p">):</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
                <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="s">&quot;output_file&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">name</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useOutputFileVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="c"># File options.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;ignore_first_line_of_file_1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine1Var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;ignore_first_line_of_file_2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine2Var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;append_output_to_output_file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appendOutputVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="s">&quot;limit_directory_search_extension&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ext</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">b</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtensionVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extensionEntry</span>
            <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ext</span><span class="p">)</span>

        <span class="c"># Print options.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;print_both_lines_for_matches&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printBothMatchesVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;print_matching_lines&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printMatchesVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;print_mismatching_lines&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printMismatchesVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;print_trailing_lines&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printTrailingMismatchesVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;limit_count&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">b</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopAfterMismatchVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">countEntry</span>
            <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

        <span class="c"># bool options...</span>
        <span class="k">for</span> <span class="n">option</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">default</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="c"># Whitespace options.</span>
            <span class="p">(</span><span class="s">&quot;ignore_blank_lines&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreBlankLinesVar</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ignore_interior_whitespace&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreInteriorWhitespaceVar</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ignore_leading_whitespace&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreLeadingWhitespaceVar</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;ignore_sentinel_lines&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreSentinelLinesVar</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;make_whitespace_visible&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeWhitespaceVisibleVar</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="n">default</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># old code</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;ignore_blank_lines&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># unusual default.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ignoreBlankLinesVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;ignore_interior_whitespace&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ignoreInteriorWhitespaceVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;ignore_leading_whitespace&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ignoreLeadingWhitespaceVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;ignore_sentinel_lines&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ignoreSentinelLinesVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;make_whitespace_visible&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">makeWhitespaceVisibleVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.13: *5* createFrame (tkComparePanel)</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">gui</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span> <span class="p">;</span> <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>

        <span class="c">#@+&lt;&lt; create the organizer frames &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.14: *6* &lt;&lt; create the organizer frames &gt;&gt;</span>
        <span class="n">outer</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">row1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">row1</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">row2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">row2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">row3</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">row3</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">row4</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">row4</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span> <span class="c"># for left justification.</span>

        <span class="n">options</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">ws</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">pr</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="n">pr</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">lower</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">lower</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the organizer frames &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the browser rows &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.15: *6* &lt;&lt; create the browser rows &gt;&gt;</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">text2</span><span class="p">,</span><span class="n">command</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">row1</span><span class="p">,</span><span class="s">&quot;Compare path 1:&quot;</span><span class="p">,</span><span class="s">&quot;Ignore first line&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onBrowse1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine1Var</span><span class="p">),</span>
            <span class="p">(</span><span class="n">row2</span><span class="p">,</span><span class="s">&quot;Compare path 2:&quot;</span><span class="p">,</span><span class="s">&quot;Ignore first line&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onBrowse2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine2Var</span><span class="p">),</span>
            <span class="p">(</span><span class="n">row3</span><span class="p">,</span><span class="s">&quot;Output file:&quot;</span><span class="p">,</span>   <span class="s">&quot;Use output file&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">onBrowse3</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">useOutputFileVar</span><span class="p">)</span> <span class="p">):</span>

            <span class="n">lab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
            <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="n">e</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;browse...&quot;</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text2</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the browser rows &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the extension row &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.16: *6* &lt;&lt; create the extension row &gt;&gt;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">row4</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limitToExtensionVar</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&quot;Limit directory compares to type:&quot;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extensionEntry</span> <span class="o">=</span> <span class="n">e</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">row4</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">row4</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">appendOutputVar</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&quot;Append output to output file&quot;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the extension row &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the whitespace options frame &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.17: *6* &lt;&lt; create the whitespace options frame &gt;&gt;</span>
        <span class="n">w</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">create_labeled_frame</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s">&quot;Whitespace options&quot;</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">text</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;Ignore Leo sentinel lines&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreSentinelLinesVar</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Ignore blank lines&quot;</span><span class="p">,</span>        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreBlankLinesVar</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Ignore leading whitespace&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreLeadingWhitespaceVar</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Ignore interior whitespace&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignoreInteriorWhitespaceVar</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Make whitespace visible&quot;</span><span class="p">,</span>   <span class="bp">self</span><span class="o">.</span><span class="n">makeWhitespaceVisibleVar</span><span class="p">)</span> <span class="p">):</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span>

        <span class="n">spacer</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="s">&quot;1i&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the whitespace options frame &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the print options frame &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.18: *6* &lt;&lt; create the print options frame &gt;&gt;</span>
        <span class="n">w</span><span class="p">,</span><span class="n">f</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">create_labeled_frame</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s">&quot;Print options&quot;</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">)</span>

        <span class="n">row</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">row</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Stop after&quot;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stopAfterMismatchVar</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">countEntry</span> <span class="o">=</span> <span class="n">e</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">)</span>

        <span class="n">lab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;mismatches&quot;</span><span class="p">)</span>
        <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">padx</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="p">(</span>    
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="s">&quot;Print matched lines&quot;</span><span class="p">,</span>           <span class="bp">self</span><span class="o">.</span><span class="n">printMatchesVar</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s">&quot;Show both matching lines&quot;</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">printBothMatchesVar</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="s">&quot;Print mismatched lines&quot;</span><span class="p">,</span>        <span class="bp">self</span><span class="o">.</span><span class="n">printMismatchesVar</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span>  <span class="s">&quot;Print unmatched trailing lines&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">printTrailingMismatchesVar</span><span class="p">)</span> <span class="p">):</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="n">padx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printButtons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="c"># To enable or disable the &quot;Print both matching lines&quot; button.</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printButtons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onPrintMatchedLines</span><span class="p">)</span>

        <span class="n">spacer</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">spacer</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="s">&quot;1i&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the print options frame &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the compare buttons &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.19: *6* &lt;&lt; create the compare buttons &gt;&gt;</span>
        <span class="k">for</span> <span class="n">text</span><span class="p">,</span><span class="n">command</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;Compare files&quot;</span><span class="p">,</span>      <span class="bp">self</span><span class="o">.</span><span class="n">onCompareFiles</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Compare directories&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onCompareDirectories</span><span class="p">)</span> <span class="p">):</span>

            <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the compare buttons &gt;&gt;</span>

        <span class="n">gui</span><span class="o">.</span><span class="n">center_dialog</span><span class="p">(</span><span class="n">top</span><span class="p">)</span> <span class="c"># Do this _after_ building the dialog!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finishCreate</span><span class="p">()</span>
        <span class="n">top</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClose</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.20: *5* setIvarsFromWidgets</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.setIvarsFromWidgets"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.setIvarsFromWidgets">[docs]</a>    <span class="k">def</span> <span class="nf">setIvarsFromWidgets</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># File paths: checks for valid file name.</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName1</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileName2</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c"># Ignore first line settings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine1Var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreFirstLine2Var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c"># Output file: checks for valid file name.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useOutputFileVar</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputFileName</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputFileName</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Extension settings.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtensionVar</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extensionEntry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limitToExtension</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtension</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limitToExtension</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">appendOutput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appendOutputVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c"># Whitespace options.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreBlankLines</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreBlankLinesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreInteriorWhitespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreInteriorWhitespaceVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreLeadingWhitespace</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreLeadingWhitespaceVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreSentinelLines</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignoreSentinelLinesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeWhitespaceVisible</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeWhitespaceVisibleVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c"># Print options.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printMatches</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printMatchesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printMismatches</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printMismatchesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printTrailingMismatches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printTrailingMismatchesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">printMatches</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printBothMatches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printBothMatchesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printBothMatches</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopAfterMismatchVar</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">countEntry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">limitCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">limitCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limitCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">#@+node:ekr.20081121110412.21: *4* bringToFront</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.bringToFront"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.bringToFront">[docs]</a>    <span class="k">def</span> <span class="nf">bringToFront</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.22: *4* browser</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.browser"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.browser">[docs]</a>    <span class="k">def</span> <span class="nf">browser</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>

        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;C/C++ files&quot;</span><span class="p">,</span><span class="s">&quot;*.c&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;C/C++ files&quot;</span><span class="p">,</span><span class="s">&quot;*.cpp&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;C/C++ files&quot;</span><span class="p">,</span><span class="s">&quot;*.h&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;C/C++ files&quot;</span><span class="p">,</span><span class="s">&quot;*.hpp&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Java files&quot;</span><span class="p">,</span><span class="s">&quot;*.java&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Lua files&quot;</span><span class="p">,</span> <span class="s">&quot;*.lua&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Pascal files&quot;</span><span class="p">,</span><span class="s">&quot;*.pas&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Python files&quot;</span><span class="p">,</span><span class="s">&quot;*.py&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Text files&quot;</span><span class="p">,</span><span class="s">&quot;*.txt&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;All files&quot;</span><span class="p">,</span><span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="p">]</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&quot;Choose compare file&quot;</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span>
            <span class="n">filetypes</span><span class="o">=</span><span class="n">types</span><span class="p">,</span>
            <span class="n">defaultextension</span><span class="o">=</span><span class="s">&quot;.txt&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># The dialog also warns about this, so this may never happen.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&quot;not found: &quot;</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">)</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">fileName</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">fileName</span>
    <span class="c">#@+node:ekr.20081121110412.23: *4* Event handlers...</span>
    <span class="c">#@+node:ekr.20081121110412.24: *5* onBrowse...</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.onBrowse1"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onBrowse1">[docs]</a>    <span class="k">def</span> <span class="nf">onBrowse1</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterComparePanel.onBrowse2"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onBrowse2">[docs]</a>    <span class="k">def</span> <span class="nf">onBrowse2</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browser</span><span class="p">(</span><span class="s">&quot;2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterComparePanel.onBrowse3"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onBrowse3">[docs]</a>    <span class="k">def</span> <span class="nf">onBrowse3</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># Get the name of the output file.</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">(</span>
            <span class="n">initialfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultOutputFileName</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&quot;Set output file&quot;</span><span class="p">,</span>
            <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;Text files&quot;</span><span class="p">,</span> <span class="s">&quot;*.txt&quot;</span><span class="p">)],</span>
            <span class="n">defaultextension</span><span class="o">=</span><span class="s">&quot;.txt&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultOutputFileName</span> <span class="o">=</span> <span class="n">fileName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">useOutputFileVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># The user will expect this.</span>
            <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browseEntries</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="n">e</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">fileName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.25: *5* onClose</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.onClose"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onClose">[docs]</a>    <span class="k">def</span> <span class="nf">onClose</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.26: *5* onCompare...</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.onCompareDirectories"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onCompareDirectories">[docs]</a>    <span class="k">def</span> <span class="nf">onCompareDirectories</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setIvarsFromWidgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare_directories</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterComparePanel.onCompareFiles"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onCompareFiles">[docs]</a>    <span class="k">def</span> <span class="nf">onCompareFiles</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setIvarsFromWidgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileName2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.27: *5* onPrintMatchedLines</span></div>
<div class="viewcode-block" id="leoTkinterComparePanel.onPrintMatchedLines"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterComparePanel.onPrintMatchedLines">[docs]</a>    <span class="k">def</span> <span class="nf">onPrintMatchedLines</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printMatchesVar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">printButtons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.38: *3* class tkinterAboutLeo</span></div></div>
<div class="viewcode-block" id="tkinterAboutLeo"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAboutLeo">[docs]</a><span class="k">class</span> <span class="nc">tkinterAboutLeo</span> <span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that creates the Tkinter About Leo dialog.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.39: *4* tkinterAboutLeo.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">theCopyright</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">email</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a Tkinter About Leo dialog.&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="s">&quot;About Leo&quot;</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copyright</span> <span class="o">=</span> <span class="n">theCopyright</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>

        <span class="n">c</span><span class="o">.</span><span class="n">inCommand</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Allow the app to close immediately.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.40: *4* tkinterAboutLeo.createFrame</span>
<div class="viewcode-block" id="tkinterAboutLeo.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAboutLeo.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the frame for an About Leo dialog.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>
        <span class="n">theCopyright</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyright</span> <span class="p">;</span> <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="p">;</span> <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>

        <span class="c"># Calculate the approximate height &amp; width. (There are bugs in Tk here.)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">theCopyright</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="c"># Add lines for version,url,email,spacing.</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
        <span class="n">width</span> <span class="o">+=</span> <span class="mi">10</span> <span class="c"># 9/9/02</span>

        <span class="n">frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">padx</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">))</span>
        <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">bitmap_name</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&quot;..&quot;</span><span class="p">,</span><span class="s">&quot;Icons&quot;</span><span class="p">,</span><span class="s">&quot;Leoapp.GIF&quot;</span><span class="p">)</span> <span class="c"># 5/12/03</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">bitmap_name</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">image_create</span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># This can sometimes happen for mysterious reasons.</span>

        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">version</span><span class="p">)</span> <span class="c">#,tag=&quot;version&quot;)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span><span class="s">&#39;end-</span><span class="si">%d</span><span class="s">c&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">version</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;end-1c&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">theCopyright</span><span class="p">)</span> <span class="c">#,tag=&quot;copyright&quot;)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;copyright&#39;</span><span class="p">,</span><span class="s">&#39;end-</span><span class="si">%d</span><span class="s">c&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theCopyright</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;end-1c&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">url</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">,</span><span class="s">&#39;end-</span><span class="si">%d</span><span class="s">c&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;end-1c&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">email</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">,</span><span class="s">&#39;end-</span><span class="si">%d</span><span class="s">c&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;end-1c&#39;</span><span class="p">)</span>

        <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s">&quot;center&quot;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="s">&quot;copyright&quot;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s">&quot;center&quot;</span><span class="p">,</span><span class="n">spacing1</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="s">&quot;url&quot;</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s">&quot;center&quot;</span><span class="p">,</span><span class="n">spacing1</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;url&quot;</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onAboutLeoUrl</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;url&quot;</span><span class="p">,</span><span class="s">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">setArrowCursor</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;url&quot;</span><span class="p">,</span><span class="s">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">setDefaultCursor</span><span class="p">)</span>

        <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s">&quot;center&quot;</span><span class="p">,</span><span class="n">spacing1</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;email&quot;</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onAboutLeoEmail</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;email&quot;</span><span class="p">,</span><span class="s">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">setArrowCursor</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;email&quot;</span><span class="p">,</span><span class="s">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">setDefaultCursor</span><span class="p">)</span>

        <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.41: *4* tkinterAboutLeo.onAboutLeoEmail</span></div>
<div class="viewcode-block" id="tkinterAboutLeo.onAboutLeoEmail"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAboutLeo.onAboutLeoEmail">[docs]</a>    <span class="k">def</span> <span class="nf">onAboutLeoEmail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the email link in an About Leo dialog.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">webbrowser</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;mailto:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;not found:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.42: *4* tkinterAboutLeo.onAboutLeoUrl</span></div>
<div class="viewcode-block" id="tkinterAboutLeo.onAboutLeoUrl"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAboutLeo.onAboutLeoUrl">[docs]</a>    <span class="k">def</span> <span class="nf">onAboutLeoUrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the url link in an About Leo dialog.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">webbrowser</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;not found:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.43: *4* tkinterAboutLeo: setArrowCursor, setDefaultCursor</span></div>
<div class="viewcode-block" id="tkinterAboutLeo.setArrowCursor"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAboutLeo.setArrowCursor">[docs]</a>    <span class="k">def</span> <span class="nf">setArrowCursor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Set the cursor to an arrow in an About Leo dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="s">&quot;arrow&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="tkinterAboutLeo.setDefaultCursor"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAboutLeo.setDefaultCursor">[docs]</a>    <span class="k">def</span> <span class="nf">setDefaultCursor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Set the cursor to the default cursor in an About Leo dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="s">&quot;xterm&quot;</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.44: *3* class tkinterAskLeoID</span></div></div>
<div class="viewcode-block" id="tkinterAskLeoID"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskLeoID">[docs]</a><span class="k">class</span> <span class="nc">tkinterAskLeoID</span> <span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that creates the Tkinter About Leo dialog.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.45: *4* tkinterAskLeoID.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the Leo Id dialog.&quot;&quot;&quot;</span>

        <span class="c"># Initialize the base class: prevent clicks in the close box from closing.</span>
        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="s">&quot;Enter unique id&quot;</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">canClose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id_entry</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;can not use c.bind&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;leoID.txt not found</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;Please enter an id that identifies you uniquely.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;Your cvs login name is a good choice.</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;Leo uses this id to uniquely identify nodes.</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;Your id must contain only letters and numbers</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;and must be at least 3 characters in length.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_entry</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;OK&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">onButton</span><span class="p">,</span><span class="s">&quot;default&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span> <span class="c"># Singleton tuple.</span>
        <span class="n">buttonList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span> <span class="o">=</span> <span class="n">buttonList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.46: *4* tkinterAskLeoID.createFrame</span>
<div class="viewcode-block" id="tkinterAskLeoID.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskLeoID.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the frame for the Leo Id dialog.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id_entry</span> <span class="o">=</span> <span class="n">text</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.47: *4* tkinterAskLeoID.onButton</span></div>
<div class="viewcode-block" id="tkinterAskLeoID.onButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskLeoID.onButton">[docs]</a>    <span class="k">def</span> <span class="nf">onButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the Leo Id close button.&quot;&quot;&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>  <span class="c"># Require at least 3 characters in an id.</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">leoID</span> <span class="o">=</span> <span class="n">s</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span> <span class="c"># terminates wait_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.48: *4* tkinterAskLeoID.onKey</span></div>
<div class="viewcode-block" id="tkinterAskLeoID.onKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskLeoID.onKey">[docs]</a>    <span class="k">def</span> <span class="nf">onKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle keystrokes in the Leo Id dialog.&quot;&quot;&quot;</span>

        <span class="c">#@+&lt;&lt; eliminate invalid characters &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.49: *5* &lt;&lt; eliminate invalid characters &gt;&gt;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_entry</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">ok</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ch</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
                <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">ok</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span> <span class="k">return</span>
        <span class="c">#@-&lt;&lt; eliminate invalid characters &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; enable the ok button if there are 3 or more valid characters &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.50: *5* &lt;&lt; enable the ok button if there are 3 or more valid characters &gt;&gt;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_entry</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; enable the ok button if there are 3 or more valid characters &gt;&gt;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onButton</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.51: *3* class tkinterAskOk</span></div></div>
<div class="viewcode-block" id="tkinterAskOk"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOk">[docs]</a><span class="k">class</span> <span class="nc">tkinterAskOk</span><span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that creates a Tkinter dialog with a single OK button.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.52: *4* class tkinterAskOk.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Ok&quot;</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a dialog with one button&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">resizeable</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createMessageFrame</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="n">text</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">okButton</span><span class="p">,</span><span class="s">&quot;default&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span> <span class="c"># Singleton tuple.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.53: *4* class tkinterAskOk.onKey</span>
<div class="viewcode-block" id="tkinterAskOk.onKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOk.onKey">[docs]</a>    <span class="k">def</span> <span class="nf">onKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle Key events in askOk dialogs.&quot;&quot;&quot;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">okButton</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.54: *3* class tkinterAskOkCancelNumber</span></div></div>
<div class="viewcode-block" id="tkinterAskOkCancelNumber"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelNumber">[docs]</a><span class="k">class</span>  <span class="nc">tkinterAskOkCancelNumber</span> <span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Create and run a modal Tkinter dialog to get a number.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.55: *4* tkinterAskOKCancelNumber.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a number dialog&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;Ok&quot;</span><span class="p">,</span>    <span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">okButton</span><span class="p">,</span>     <span class="s">&quot;default&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span>
                <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">cancelButton</span><span class="p">}</span> <span class="p">)</span>
        <span class="n">buttonList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span> <span class="o">=</span> <span class="n">buttonList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Override the default kind of Ok button.</span>
    <span class="c">#@+node:ekr.20081121110412.56: *4* tkinterAskOKCancelNumber.createFrame</span>
<div class="viewcode-block" id="tkinterAskOkCancelNumber.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelNumber.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the frame for a number dialog.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">lab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.57: *4* tkinterAskOKCancelNumber.okButton, cancelButton</span></div>
<div class="viewcode-block" id="tkinterAskOkCancelNumber.okButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelNumber.okButton">[docs]</a>    <span class="k">def</span> <span class="nf">okButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the ok button of a number dialog.&quot;&quot;&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=-</span><span class="mi">1</span> <span class="c"># Cancel the operation.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="tkinterAskOkCancelNumber.cancelButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelNumber.cancelButton">[docs]</a>    <span class="k">def</span> <span class="nf">cancelButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the cancel button of a number dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.58: *4* tkinterAskOKCancelNumber.onKey</span></div>
<div class="viewcode-block" id="tkinterAskOkCancelNumber.onKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelNumber.onKey">[docs]</a>    <span class="k">def</span> <span class="nf">onKey</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="c">#@+&lt;&lt; eliminate non-numbers &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.59: *5* &lt;&lt; eliminate non-numbers &gt;&gt;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ch</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c">#@-&lt;&lt; eliminate non-numbers &gt;&gt;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">okButton</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;c&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancelButton</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.60: *3* class tkinterAskOkCancelString</span></div></div>
<div class="viewcode-block" id="tkinterAskOkCancelString"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelString">[docs]</a><span class="k">class</span>  <span class="nc">tkinterAskOkCancelString</span> <span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Create and run a modal Tkinter dialog to get a string.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.61: *4* tkinterAskOKCancelString.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a number dialog&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;Ok&quot;</span><span class="p">,</span>    <span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">okButton</span><span class="p">,</span>     <span class="s">&quot;default&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span>
                <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">cancelButton</span><span class="p">}</span> <span class="p">)</span>
        <span class="n">buttonList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span> <span class="o">=</span> <span class="n">buttonList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># Override the default kind of Ok button.</span>
    <span class="c">#@+node:ekr.20081121110412.62: *4* tkinterAskOkCancelString.createFrame</span>
<div class="viewcode-block" id="tkinterAskOkCancelString.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelString.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the frame for a number dialog.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">lab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
        <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.63: *4* tkinterAskOkCancelString.okButton, cancelButton</span></div>
<div class="viewcode-block" id="tkinterAskOkCancelString.okButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelString.okButton">[docs]</a>    <span class="k">def</span> <span class="nf">okButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the ok button of a string dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="tkinterAskOkCancelString.cancelButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelString.cancelButton">[docs]</a>    <span class="k">def</span> <span class="nf">cancelButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the cancel button of a string dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.64: *4* tkinterAskOkCancelString.onKey</span></div>
<div class="viewcode-block" id="tkinterAskOkCancelString.onKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskOkCancelString.onKey">[docs]</a>    <span class="k">def</span> <span class="nf">onKey</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">okButton</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.65: *3* class tkinterAskYesNo</span></div></div>
<div class="viewcode-block" id="tkinterAskYesNo"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskYesNo">[docs]</a><span class="k">class</span> <span class="nc">tkinterAskYesNo</span> <span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that creates a Tkinter dialog with two buttons: Yes and No.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.66: *4* tkinterAskYesNo.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a dialog having yes and no buttons.&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">resizeable</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createMessageFrame</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">yesButton</span><span class="p">,</span>  <span class="s">&quot;default&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span>
            <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;No&quot;</span><span class="p">,</span> <span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">noButton</span><span class="p">}</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.67: *4* tkinterAskYesNo.onKey</span>
<div class="viewcode-block" id="tkinterAskYesNo.onKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskYesNo.onKey">[docs]</a>    <span class="k">def</span> <span class="nf">onKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle keystroke events in dialogs having yes and no buttons.&quot;&quot;&quot;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yesButton</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noButton</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.68: *3* class tkinterAskYesNoCancel</span></div></div>
<div class="viewcode-block" id="tkinterAskYesNoCancel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskYesNoCancel">[docs]</a><span class="k">class</span> <span class="nc">tkinterAskYesNoCancel</span><span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class to create and run Tkinter dialogs having three buttons.</span>

<span class="sd">    By default, these buttons are labeled Yes, No and Cancel.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.69: *4* askYesNoCancel.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">yesMessage</span><span class="o">=</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span>
        <span class="n">noMessage</span><span class="o">=</span><span class="s">&quot;No&quot;</span><span class="p">,</span>
        <span class="n">defaultButton</span><span class="o">=</span><span class="s">&quot;Yes&quot;</span><span class="p">,</span>
        <span class="n">resizeable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create a dialog having three buttons.&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">resizeable</span><span class="p">,</span><span class="n">canClose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yesMessage</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">noMessage</span> <span class="o">=</span> <span class="n">yesMessage</span><span class="p">,</span><span class="n">noMessage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultButton</span> <span class="o">=</span> <span class="n">defaultButton</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Key&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onKey</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createMessageFrame</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">buttons</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="n">yesMessage</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">yesButton</span><span class="p">,</span>   <span class="s">&quot;default&quot;</span><span class="p">:</span><span class="n">yesMessage</span><span class="o">==</span><span class="n">defaultButton</span><span class="p">},</span>
            <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="n">noMessage</span><span class="p">,</span> <span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">noButton</span><span class="p">,</span>    <span class="s">&quot;default&quot;</span><span class="p">:</span><span class="n">noMessage</span><span class="o">==</span><span class="n">defaultButton</span><span class="p">},</span>
            <span class="p">{</span><span class="s">&quot;text&quot;</span><span class="p">:</span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span>  <span class="s">&quot;command&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">cancelButton</span><span class="p">,</span><span class="s">&quot;default&quot;</span><span class="p">:</span><span class="s">&quot;Cancel&quot;</span><span class="o">==</span><span class="n">defaultButton</span><span class="p">}</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createButtons</span><span class="p">(</span><span class="n">buttons</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.70: *4* askYesNoCancel.onKey</span>
<div class="viewcode-block" id="tkinterAskYesNoCancel.onKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskYesNoCancel.onKey">[docs]</a>    <span class="k">def</span> <span class="nf">onKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle keystrokes in dialogs with three buttons.&quot;&quot;&quot;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultButton</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">yesMessage</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yesButton</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">noMessage</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noButton</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;c&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancelButton</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@+node:ekr.20081121110412.71: *4* askYesNoCancel.noButton &amp; yesButton</span></div>
<div class="viewcode-block" id="tkinterAskYesNoCancel.noButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskYesNoCancel.noButton">[docs]</a>    <span class="k">def</span> <span class="nf">noButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the &#39;no&#39; (second) button in a dialog with three buttons.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">noMessage</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="tkinterAskYesNoCancel.yesButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterAskYesNoCancel.yesButton">[docs]</a>    <span class="k">def</span> <span class="nf">yesButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the &#39;yes&#39; (first) button in a dialog with three buttons.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">answer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yesMessage</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.72: *3* class tkinterListboxDialog</span></div></div>
<div class="viewcode-block" id="tkinterListBoxDialog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog">[docs]</a><span class="k">class</span> <span class="nc">tkinterListBoxDialog</span> <span class="p">(</span><span class="n">leoTkinterDialog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A base class for Tkinter dialogs containing a Tk Listbox&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.73: *4* tkinterListboxDialog.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Constructor for the base listboxDialog class.&quot;&quot;&quot;</span>

        <span class="n">leoTkinterDialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">resizeable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Initialize the base class.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createTopFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">)</span>

        <span class="c"># Initialize common ivars.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positionList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonFrame</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Fill in the frame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fillbox</span><span class="p">()</span>

        <span class="c"># Make the common bindings after creating self.box.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="p">,</span><span class="s">&quot;&lt;Double-Button-1&gt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.74: *4* addStdButtons</span>
<div class="viewcode-block" id="tkinterListBoxDialog.addStdButtons"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog.addStdButtons">[docs]</a>    <span class="k">def</span> <span class="nf">addStdButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Add standard buttons to a listBox dialog.&quot;&quot;&quot;</span>

        <span class="c"># Create the ok and cancel buttons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Go&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">go</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hideButton</span> <span class="o">=</span> <span class="n">hide</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Hide&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">)</span>

        <span class="n">ok</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">hide</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.75: *4* createFrame</span></div>
<div class="viewcode-block" id="tkinterListBoxDialog.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Create the essentials of a listBoxDialog frame</span>

<span class="sd">        Subclasses will add buttons to self.buttonFrame&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span> <span class="o">=</span> <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">labf</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">labf</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">lab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">labf</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

        <span class="n">f2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">box</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Listbox</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="n">bar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>

        <span class="n">bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">box</span><span class="o">.</span><span class="n">yview</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">bar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.76: *4* destroy</span></div>
<div class="viewcode-block" id="tkinterListBoxDialog.destroy"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Hide, do not destroy, a listboxDialog window</span>

<span class="sd">        subclasses may override to really destroy the window&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span> <span class="c"># Don&#39;t allow this window to be destroyed.</span>
    <span class="c">#@+node:ekr.20081121110412.77: *4* hide</span></div>
<div class="viewcode-block" id="tkinterListBoxDialog.hide"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog.hide">[docs]</a>    <span class="k">def</span> <span class="nf">hide</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Hide a list box dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.78: *4* fillbox</span></div>
<div class="viewcode-block" id="tkinterListBoxDialog.fillbox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog.fillbox">[docs]</a>    <span class="k">def</span> <span class="nf">fillbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Fill a listbox from information.</span>

<span class="sd">        Overridden by subclasses&quot;&quot;&quot;</span>

        <span class="k">pass</span>
    <span class="c">#@+node:ekr.20081121110412.79: *4* go</span></div>
<div class="viewcode-block" id="tkinterListBoxDialog.go"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkinterListBoxDialog.go">[docs]</a>    <span class="k">def</span> <span class="nf">go</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle clicks in the &quot;go&quot; button in a list box dialog.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box</span>

        <span class="c"># Work around an old Python bug.  Convert strings to ints.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">curselection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionList</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">c</span><span class="o">.</span><span class="n">expandAllAncestors</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">selectPosition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.80: ** find/spell classes</span>
<span class="c">#@+node:ekr.20081121110412.81: *3* class underlinedTkButton</span></div></div>
<div class="viewcode-block" id="underlinedTkButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.underlinedTkButton">[docs]</a><span class="k">class</span> <span class="nc">underlinedTkButton</span><span class="p">:</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.82: *4* __init__</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">buttonType</span><span class="p">,</span><span class="n">parent_widget</span><span class="p">,</span><span class="o">**</span><span class="n">keywords</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buttonType</span> <span class="o">=</span> <span class="n">buttonType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_widget</span> <span class="o">=</span> <span class="n">parent_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hotKey</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">keywords</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span>

        <span class="c">#@+&lt;&lt; set self.hotKey if &#39;&amp;&#39; is in the string &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.83: *5* &lt;&lt; set self.hotKey if &#39;&amp;&#39; is in the string &gt;&gt;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&amp;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c"># The word ends in an ampersand.  Ignore it; there is no hot key.</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hotKey</span> <span class="o">=</span> <span class="n">text</span> <span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c">#@-&lt;&lt; set self.hotKey if &#39;&amp;&#39; is in the string &gt;&gt;</span>

        <span class="c"># Create the button...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hotKey</span><span class="p">:</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">keywords</span><span class="p">[</span><span class="s">&#39;underline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>

        <span class="k">if</span> <span class="n">buttonType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;button&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">parent_widget</span><span class="p">,</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">buttonType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;check&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">parent_widget</span><span class="p">,</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">buttonType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;radio&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Radiobutton</span><span class="p">(</span><span class="n">parent_widget</span><span class="p">,</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;bad buttonType&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="c"># for traces</span>
    <span class="c">#@+node:ekr.20081121110412.84: *4* bindHotKey</span>
<div class="viewcode-block" id="underlinedTkButton.bindHotKey"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.underlinedTkButton.bindHotKey">[docs]</a>    <span class="k">def</span> <span class="nf">bindHotKey</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">widget</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hotKey</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hotKey</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">hotKey</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;&lt;Alt-</span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonCallback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.85: *4* buttonCallback</span>
    <span class="c"># The hot key has been hit.  Call the button&#39;s command.</span>
</div>
<div class="viewcode-block" id="underlinedTkButton.buttonCallback"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.underlinedTkButton.buttonCallback">[docs]</a>    <span class="k">def</span> <span class="nf">buttonCallback</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># g.trace(self.text)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">invoke</span> <span class="p">()</span>

        <span class="c"># See if this helps.</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.86: *3* class tkFindTab (findTab)</span></div></div>
<div class="viewcode-block" id="tkFindTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab">[docs]</a><span class="k">class</span> <span class="nc">tkFindTab</span> <span class="p">(</span><span class="n">leoFind</span><span class="o">.</span><span class="n">findTab</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A subclass of the findTab class containing all Tk code.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.87: *4*  Birth</span>
    <span class="c">#@+node:ekr.20081121110412.88: *5*  ctor (tkFindTab)</span>
    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Use the base class ctor.</span>

        <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

            <span class="n">leoFind</span><span class="o">.</span><span class="n">findTab</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">)</span>
                <span class="c"># Init the base class.</span>
                <span class="c"># Calls initGui, createFrame, createBindings &amp; init(c), in that order.</span>

    <span class="c">#@+node:ekr.20081121110412.89: *5* initGui</span>
<div class="viewcode-block" id="tkFindTab.initGui"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.initGui">[docs]</a>    <span class="k">def</span> <span class="nf">initGui</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">newStringKeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">()</span>

    <span class="c">#@+node:ekr.20081121110412.90: *5* createFrame (tkFindTab)</span></div>
<div class="viewcode-block" id="tkFindTab.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># g.trace(&#39;findTab&#39;)</span>

        <span class="c">#@+&lt;&lt; Create the outer frames &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.91: *6* &lt;&lt; Create the outer frames &gt;&gt;</span>
        <span class="n">configName</span> <span class="o">=</span> <span class="s">&#39;log_pane_Find_tab_background_color&#39;</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">configName</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;MistyRose1&#39;</span>

        <span class="n">parentFrame</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="c"># Don&#39;t expand, so the frame goes to the top.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">ScrolledFrame</span><span class="p">(</span>
            <span class="n">parentFrame</span><span class="p">,</span><span class="n">usehullsize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span> <span class="o">=</span> <span class="n">outer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;borderframe&#39;</span><span class="p">,</span><span class="s">&#39;clipper&#39;</span><span class="p">,</span><span class="s">&#39;frame&#39;</span><span class="p">,</span><span class="s">&#39;hull&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="s">&#39;flat&#39;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the outer frames &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create the Find and Change panes &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.92: *6* &lt;&lt; Create the Find and Change panes &gt;&gt;</span>
        <span class="n">fc</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="s">&quot;1m&quot;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">fc</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># Removed unused height/width params: using fractions causes problems in some locales!</span>
        <span class="n">fpane</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">cpane</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>

        <span class="n">fpane</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">cpane</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>

        <span class="c"># Create the labels and text fields...</span>
        <span class="n">flab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">fpane</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Find:&quot;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">clab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">cpane</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Change:&quot;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optionsOnly</span><span class="p">:</span>
            <span class="c"># Use one-line boxes.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span> <span class="o">=</span> <span class="n">ftxt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
                <span class="n">fpane</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;find-text&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span> <span class="o">=</span> <span class="n">ctxt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
                <span class="n">cpane</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;change-text&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Use bigger boxes for scripts.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span> <span class="o">=</span> <span class="n">ftxt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
                <span class="n">fpane</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;find-text&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span> <span class="o">=</span> <span class="n">ctxt</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
                <span class="n">cpane</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;change-text&#39;</span><span class="p">)</span>
        <span class="c">#@+&lt;&lt; Bind Tab and control-tab &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.93: *7* &lt;&lt; Bind Tab and control-tab &gt;&gt;</span>
        <span class="k">def</span> <span class="nf">setFocus</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
            <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocusNow</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;break&quot;</span>

        <span class="k">def</span> <span class="nf">toFind</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">ftxt</span><span class="p">):</span> <span class="k">return</span> <span class="n">setFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">toChange</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">ctxt</span><span class="p">):</span> <span class="k">return</span> <span class="n">setFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">insertTab</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">start</span> <span class="o">=</span> <span class="n">end</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getInsertPoint</span><span class="p">()</span>
            <span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&quot;break&quot;</span>

        <span class="k">def</span> <span class="nf">insertFindTab</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">ftxt</span><span class="p">):</span> <span class="k">return</span> <span class="n">insertTab</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">insertChangeTab</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">ctxt</span><span class="p">):</span> <span class="k">return</span> <span class="n">insertTab</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ftxt</span><span class="p">,</span><span class="s">&quot;&lt;Tab&gt;&quot;</span><span class="p">,</span><span class="n">toChange</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ctxt</span><span class="p">,</span><span class="s">&quot;&lt;Tab&gt;&quot;</span><span class="p">,</span><span class="n">toFind</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ftxt</span><span class="p">,</span><span class="s">&quot;&lt;Control-Tab&gt;&quot;</span><span class="p">,</span><span class="n">insertFindTab</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ctxt</span><span class="p">,</span><span class="s">&quot;&lt;Control-Tab&gt;&quot;</span><span class="p">,</span><span class="n">insertChangeTab</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Bind Tab and control-tab &gt;&gt;</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Add scrollbars.</span>
            <span class="n">fBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">fpane</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;findBar&#39;</span><span class="p">)</span>
            <span class="n">cBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">cpane</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;changeBar&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">bar</span><span class="p">,</span><span class="n">txt</span> <span class="ow">in</span> <span class="p">((</span><span class="n">fBar</span><span class="p">,</span><span class="n">ftxt</span><span class="p">),(</span><span class="n">cBar</span><span class="p">,</span><span class="n">ctxt</span><span class="p">)):</span>
                <span class="n">txt</span><span class="p">[</span><span class="s">&#39;yscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">set</span>
                <span class="n">bar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">yview</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optionsOnly</span><span class="p">:</span>
            <span class="n">flab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">ftxt</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">clab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">ctxt</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">ftxt</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">clab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">ctxt</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the Find and Change panes &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create two columns of radio and checkboxes &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.94: *6* &lt;&lt; Create two columns of radio and checkboxes &gt;&gt;</span>
        <span class="n">columnsFrame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>

        <span class="n">columnsFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="s">&quot;7p&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="s">&quot;2p&quot;</span><span class="p">)</span>

        <span class="n">numberOfColumns</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># Number of columns</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">radioLists</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">checkLists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfColumns</span><span class="p">):</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">columnsFrame</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">radioLists</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="n">checkLists</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfColumns</span><span class="p">):</span>
            <span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="s">&quot;1p&quot;</span><span class="p">)</span> <span class="c"># fill=&quot;y&quot; Aligns to top. padx expands columns.</span>

        <span class="n">radioLists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">checkLists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c"># (&quot;Scrip&amp;t Change&quot;,self.svarDict[&quot;script_change&quot;]),</span>
            <span class="p">(</span><span class="s">&quot;Whole &amp;Word&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;whole_word&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Ignore Case&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;ignore_case&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&quot;Wrap &amp;Around&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;wrap&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Reverse&quot;</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;reverse&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&#39;Rege&amp;xp&#39;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&#39;pattern_match&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&quot;Mark &amp;Finds&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;mark_finds&quot;</span><span class="p">]),</span>
        <span class="p">]</span>

        <span class="n">radioLists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">],</span><span class="s">&quot;&amp;Entire Outline&quot;</span><span class="p">,</span><span class="s">&quot;entire-outline&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">],</span><span class="s">&quot;&amp;Suboutline Only&quot;</span><span class="p">,</span><span class="s">&quot;suboutline-only&quot;</span><span class="p">),</span>  
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">],</span><span class="s">&quot;&amp;Node Only&quot;</span><span class="p">,</span><span class="s">&quot;node-only&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">checkLists</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&quot;Search &amp;Headline&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;search_headline&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&quot;Search &amp;Body&quot;</span><span class="p">,</span>     <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;search_body&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s">&quot;Mark &amp;Changes&quot;</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;mark_changes&quot;</span><span class="p">]),</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfColumns</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">radioLists</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">underlinedTkButton</span><span class="p">(</span>
                    <span class="s">&quot;radio&quot;</span><span class="p">,</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">button</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetWrap</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">bindHotKey</span><span class="p">(</span><span class="n">ftxt</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">bindHotKey</span><span class="p">(</span><span class="n">ctxt</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="n">checkLists</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">underlinedTkButton</span><span class="p">(</span>
                    <span class="s">&quot;check&quot;</span><span class="p">,</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">button</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resetWrap</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">bindHotKey</span><span class="p">(</span><span class="n">ftxt</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">bindHotKey</span><span class="p">(</span><span class="n">ctxt</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">box</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create two columns of radio and checkboxes &gt;&gt;</span>

        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">optionsOnly</span><span class="p">:</span>
            <span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; Create two columns of buttons &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.95: *6* &lt;&lt; Create two columns of buttons &gt;&gt;</span>
            <span class="c"># Create the alignment panes.</span>
            <span class="n">buttons</span>  <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="n">buttons1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">buttons</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="n">buttons2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">buttons</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="n">buttons</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">buttons1</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">buttons2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">)</span>

            <span class="n">width</span> <span class="o">=</span> <span class="mi">15</span> <span class="p">;</span> <span class="n">defaultText</span> <span class="o">=</span> <span class="s">&#39;Find&#39;</span> <span class="p">;</span> <span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">text</span><span class="p">,</span><span class="n">boxKind</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">callback</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="c"># Column 1...</span>
                <span class="p">(</span><span class="s">&#39;Find&#39;</span><span class="p">,</span><span class="s">&#39;button&#39;</span><span class="p">,</span><span class="n">buttons1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">findButtonCallback</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Find All&#39;</span><span class="p">,</span><span class="s">&#39;button&#39;</span><span class="p">,</span><span class="n">buttons1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">findAllButton</span><span class="p">),</span>
                <span class="c"># Column 2...</span>
                <span class="p">(</span><span class="s">&#39;Change&#39;</span><span class="p">,</span><span class="s">&#39;button&#39;</span><span class="p">,</span><span class="n">buttons2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">changeButton</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Change, Then Find&#39;</span><span class="p">,</span><span class="s">&#39;button&#39;</span><span class="p">,</span><span class="n">buttons2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">changeThenFindButton</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Change All&#39;</span><span class="p">,</span><span class="s">&#39;button&#39;</span><span class="p">,</span><span class="n">buttons2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">changeAllButton</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">underlinedTkButton</span><span class="p">(</span><span class="n">boxKind</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
                <span class="n">buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="n">defaultText</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">boxKind</span> <span class="o">!=</span> <span class="s">&#39;check&#39;</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; Create two columns of buttons &gt;&gt;</span>

        <span class="c"># Pack this last so buttons don&#39;t get squashed when frame is resized.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.96: *5* createBindings (tkFindTab)</span></div>
<div class="viewcode-block" id="tkFindTab.createBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.createBindings">[docs]</a>    <span class="k">def</span> <span class="nf">createBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="k">def</span> <span class="nf">resetWrapCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resetWrap</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">findButtonBindingCallback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">findButton</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
            <span class="k">return</span> <span class="s">&#39;break&#39;</span>

        <span class="k">def</span> <span class="nf">rightClickCallback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">masterClick3Handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onRightClick</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">val</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-1&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>  <span class="n">rightClickCallback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-3&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span>       <span class="n">resetWrapCallback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Return&gt;&#39;</span><span class="p">,</span>    <span class="n">findButtonBindingCallback</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&lt;Escape&gt;&quot;</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">hideTab</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.97: *5* onRightClick</span></div>
<div class="viewcode-block" id="tkFindTab.onRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.onRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onRightClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="n">context_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">widget_name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&#39;rclick-popup&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">context_menu</span><span class="o">=</span><span class="n">context_menu</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.98: *5* tkFindTab.init</span></div>
<div class="viewcode-block" id="tkFindTab.init"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;tkFindTab&#39;,g.callers())</span>

        <span class="c"># N.B.: separate c.ivars are much more convenient than a dict.</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="c"># New in 4.3: get ivars from @settings.</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c"># Work around major Tk problem.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c"># g.trace(key,val)</span>

        <span class="c">#@+&lt;&lt; set find/change widgets &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.99: *6* &lt;&lt; set find/change widgets &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>

        <span class="c"># New in 4.3: Get setting from @settings.</span>
        <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">setting</span><span class="p">,</span><span class="n">defaultText</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_ctrl</span><span class="p">,</span><span class="s">&quot;find_text&quot;</span><span class="p">,</span><span class="s">&#39;&lt;find pattern here&gt;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_ctrl</span><span class="p">,</span><span class="s">&quot;change_text&quot;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">defaultText</span>
            <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; set find/change widgets &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; set radio buttons from ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.100: *6* &lt;&lt; set radio buttons from ivars &gt;&gt;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">setting</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;pattern_match&quot;</span><span class="p">,</span><span class="s">&quot;pattern-search&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;script_search&quot;</span><span class="p">,</span><span class="s">&quot;script-search&quot;</span><span class="p">)):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-find-type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">;</span> <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-find-type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;plain-search&quot;</span><span class="p">)</span>

        <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">setting</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;suboutline_only&quot;</span><span class="p">,</span><span class="s">&quot;suboutline-only&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;node_only&quot;</span><span class="p">,</span><span class="s">&quot;node-only&quot;</span><span class="p">),</span>
            <span class="c"># (&quot;selection_only&quot;,&quot;selection-only&quot;),</span>
        <span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
                <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">;</span> <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="p">[</span><span class="s">&quot;radio-search-scope&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;entire-outline&quot;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; set radio buttons from ivars &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.101: *4* Support for minibufferFind class (tkFindTab)</span>
    <span class="c">#@+node:ekr.20081121110412.102: *5* getOption</span></div>
<div class="viewcode-block" id="tkFindTab.getOption"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.getOption">[docs]</a>    <span class="k">def</span> <span class="nf">getOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">):</span>

        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">var</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="c"># g.trace(&#39;%s = %s&#39; % (ivar,val))</span>
            <span class="k">return</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;bad ivar name: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ivar</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.103: *5* setOption</span></div>
<div class="viewcode-block" id="tkFindTab.setOption"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.setOption">[docs]</a>    <span class="k">def</span> <span class="nf">setOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
                <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="c"># g.trace(&#39;%s = %s&#39; % (ivar,val))</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: bad find ivar </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ivar</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.104: *5* toggleOption</span></div>
<div class="viewcode-block" id="tkFindTab.toggleOption"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkFindTab.toggleOption">[docs]</a>    <span class="k">def</span> <span class="nf">toggleOption</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ivar</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ivar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">intKeys</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svarDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="c"># g.trace(&#39;%s = %s&#39; % (ivar,val),var)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: bad find ivar </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ivar</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.105: *3* class tkSpellTab</span></div></div>
<div class="viewcode-block" id="tkSpellTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab">[docs]</a><span class="k">class</span> <span class="nc">tkSpellTab</span><span class="p">:</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.106: *4* tkSpellTab.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">handler</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabName</span> <span class="o">=</span> <span class="n">tabName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createBindings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fillbox</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positionList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#@+node:ekr.20081121110412.107: *4* createBindings</span>
<div class="viewcode-block" id="tkSpellTab.createBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.createBindings">[docs]</a>    <span class="k">def</span> <span class="nf">createBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>

            <span class="c"># Bind shortcuts for the following commands...</span>
            <span class="k">for</span> <span class="n">commandName</span><span class="p">,</span><span class="n">func</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s">&#39;full-command&#39;</span><span class="p">,</span>            <span class="n">k</span><span class="o">.</span><span class="n">fullCommand</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;hide-spell-tab&#39;</span><span class="p">,</span>          <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">hide</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;spell-add&#39;</span><span class="p">,</span>               <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">add</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;spell-find&#39;</span><span class="p">,</span>              <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">find</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;spell-ignore&#39;</span><span class="p">,</span>            <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">ignore</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;spell-change-then-find&#39;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">changeThenFind</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="n">junk</span><span class="p">,</span> <span class="n">bunchList</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getShortcut</span><span class="p">(</span><span class="n">commandName</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">bunch</span> <span class="ow">in</span> <span class="n">bunchList</span><span class="p">:</span>
                    <span class="n">accel</span> <span class="o">=</span> <span class="n">bunch</span><span class="o">.</span><span class="n">val</span>
                    <span class="n">shortcut</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">shortcutFromSetting</span><span class="p">(</span><span class="n">accel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">shortcut</span><span class="p">:</span>
                        <span class="c"># g.trace(shortcut,commandName)</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">shortcut</span><span class="p">,</span><span class="n">func</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">binding</span><span class="p">,</span><span class="n">func</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;&lt;Double-1&gt;&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">onChangeThenFindButton</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">onSelectListBox</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&lt;Map&gt;&quot;</span><span class="p">,</span>       <span class="bp">self</span><span class="o">.</span><span class="n">onMap</span><span class="p">),</span>
            <span class="c"># These never get called because focus is always in the body pane!</span>
            <span class="c"># (&quot;&lt;Up&gt;&quot;,        self.up),</span>
            <span class="c"># (&quot;&lt;Down&gt;&quot;,      self.down),</span>
        <span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="p">,</span><span class="n">binding</span><span class="p">,</span><span class="n">func</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.108: *4* createFrame</span></div>
<div class="viewcode-block" id="tkSpellTab.createFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.createFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">log</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">log</span> <span class="p">;</span> <span class="n">tabName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabName</span>
        <span class="n">setFont</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">parentFrame</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">textDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>

        <span class="c"># Set the common background color.</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&#39;log_pane_Spell_tab_background_color&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;LightSteelBlue2&#39;</span>

        <span class="k">if</span> <span class="n">setFont</span><span class="p">:</span>
            <span class="n">fontSize</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">),</span><span class="mi">9</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>

        <span class="c">#@+&lt;&lt; Create the outer frames &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.109: *5* &lt;&lt; Create the outer frames &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">ScrolledFrame</span><span class="p">(</span>
            <span class="n">parentFrame</span><span class="p">,</span><span class="n">usehullsize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span> <span class="o">=</span> <span class="n">outer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;borderframe&#39;</span><span class="p">,</span><span class="s">&#39;clipper&#39;</span><span class="p">,</span><span class="s">&#39;frame&#39;</span><span class="p">,</span><span class="s">&#39;hull&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
                <span class="n">relief</span><span class="o">=</span><span class="s">&#39;flat&#39;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the outer frames &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create the text and suggestion panes &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.110: *5* &lt;&lt; Create the text and suggestion panes &gt;&gt;</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">f2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wordLabel</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Suggestions for:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wordLabel</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">setFont</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wordLabel</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;verdana&#39;</span><span class="p">,</span><span class="n">fontSize</span><span class="p">,</span><span class="s">&#39;bold&#39;</span><span class="p">))</span>

        <span class="n">fpane</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fpane</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Listbox</span><span class="p">(</span><span class="n">fpane</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">selectmode</span><span class="o">=</span><span class="s">&quot;single&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">setFont</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;verdana&#39;</span><span class="p">,</span><span class="n">fontSize</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">))</span>

        <span class="n">listBoxBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">fpane</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;listBoxBar&#39;</span><span class="p">)</span>

        <span class="n">bar</span><span class="p">,</span> <span class="n">txt</span> <span class="o">=</span> <span class="n">listBoxBar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span>
        <span class="n">txt</span> <span class="p">[</span><span class="s">&#39;yscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">set</span>
        <span class="n">bar</span> <span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">yview</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the text and suggestion panes &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; Create the spelling buttons &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.111: *5* &lt;&lt; Create the spelling buttons &gt;&gt;</span>
        <span class="c"># Create the alignment panes</span>
        <span class="n">buttons1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">buttons2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">buttons3</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="n">buttons1</span><span class="p">,</span><span class="n">buttons2</span><span class="p">,</span><span class="n">buttons3</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>

        <span class="n">buttonList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">setFont</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;verdana&#39;</span><span class="p">,</span><span class="n">fontSize</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">command</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">buttons1</span><span class="p">,</span><span class="s">&quot;Find&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onFindButton</span><span class="p">),</span>
            <span class="p">(</span><span class="n">buttons1</span><span class="p">,</span><span class="s">&quot;Add&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onAddButton</span><span class="p">),</span>
            <span class="p">(</span><span class="n">buttons2</span><span class="p">,</span><span class="s">&quot;Change&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onChangeButton</span><span class="p">),</span>
            <span class="p">(</span><span class="n">buttons2</span><span class="p">,</span><span class="s">&quot;Change, Find&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onChangeThenFindButton</span><span class="p">),</span>
            <span class="p">(</span><span class="n">buttons3</span><span class="p">,</span><span class="s">&quot;Ignore&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onIgnoreButton</span><span class="p">),</span>
            <span class="p">(</span><span class="n">buttons3</span><span class="p">,</span><span class="s">&quot;Hide&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onHideButton</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">setFont</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">buttonList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="c"># Used to enable or disable buttons.</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">findButton</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">addButton</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">changeButton</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeFindButton</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">ignoreButton</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hideButton</span><span class="p">)</span> <span class="o">=</span> <span class="n">buttonList</span>
        <span class="c">#@-&lt;&lt; Create the spelling buttons &gt;&gt;</span>

        <span class="c"># Pack last so buttons don&#39;t get squished.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerScrolledFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.112: *4* Event handlers</span>
    <span class="c">#@+node:ekr.20081121110412.113: *5* onAddButton</span></div>
<div class="viewcode-block" id="tkSpellTab.onAddButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onAddButton">[docs]</a>    <span class="k">def</span> <span class="nf">onAddButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle a click in the Add button in the Check Spelling dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.114: *5* onChangeButton &amp; onChangeThenFindButton</span></div>
<div class="viewcode-block" id="tkSpellTab.onChangeButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onChangeButton">[docs]</a>    <span class="k">def</span> <span class="nf">onChangeButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a click in the Change button in the Spell tab.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">change</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateButtons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>

</div>
<div class="viewcode-block" id="tkSpellTab.onChangeThenFindButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onChangeThenFindButton">[docs]</a>    <span class="k">def</span> <span class="nf">onChangeThenFindButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a click in the &quot;Change, Find&quot; button in the Spell tab.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">change</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateButtons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.115: *5* onFindButton</span></div>
<div class="viewcode-block" id="tkSpellTab.onFindButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onFindButton">[docs]</a>    <span class="k">def</span> <span class="nf">onFindButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a click in the Find button in the Spell tab.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateButtons</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">invalidateFocus</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.116: *5* onHideButton</span></div>
<div class="viewcode-block" id="tkSpellTab.onHideButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onHideButton">[docs]</a>    <span class="k">def</span> <span class="nf">onHideButton</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a click in the Hide button in the Spell tab.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.117: *5* onIgnoreButton</span></div>
<div class="viewcode-block" id="tkSpellTab.onIgnoreButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onIgnoreButton">[docs]</a>    <span class="k">def</span> <span class="nf">onIgnoreButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a click in the Ignore button in the Check Spelling dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.118: *5* onMap</span></div>
<div class="viewcode-block" id="tkSpellTab.onMap"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onMap">[docs]</a>    <span class="k">def</span> <span class="nf">onMap</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Respond to a Tk &lt;Map&gt; event.&quot;&quot;&quot;</span>

        <span class="c"># self.update(show= False, fill= False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateButtons</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.119: *5* onSelectListBox</span></div>
<div class="viewcode-block" id="tkSpellTab.onSelectListBox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.onSelectListBox">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectListBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Respond to a click in the selection listBox.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># A bad hack to get around the fact that only one selection</span>
            <span class="c"># exists at any one time on Linux.</span>
            <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>
            <span class="c"># g.trace(&#39;setting&#39;,i,j)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">change_j</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateButtons</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&#39;continue&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.120: *5* down/up</span></div>
<div class="viewcode-block" id="tkSpellTab.down"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.down">[docs]</a>    <span class="k">def</span> <span class="nf">down</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="c"># Work around an old Python bug.  Convert strings to ints.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span> <span class="p">;</span> <span class="n">items</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">curselection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">items</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positionList</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">selection_clear</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">selection_set</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">selection_set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">focus_force</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>

</div>
<div class="viewcode-block" id="tkSpellTab.up"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.up">[docs]</a>    <span class="k">def</span> <span class="nf">up</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="c"># Work around an old Python bug.  Convert strings to ints.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span> <span class="p">;</span> <span class="n">items</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">curselection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">items</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="n">items</span><span class="p">:</span> <span class="n">n</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>     <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">w</span><span class="o">.</span><span class="n">selection_clear</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">selection_set</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">w</span><span class="o">.</span><span class="n">focus_force</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.121: *4* Helpers</span>
    <span class="c">#@+node:ekr.20081121110412.122: *5* bringToFront</span></div>
<div class="viewcode-block" id="tkSpellTab.bringToFront"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.bringToFront">[docs]</a>    <span class="k">def</span> <span class="nf">bringToFront</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;tkSpellTab&#39;,g.callers())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Spell&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.123: *5* fillbox</span></div>
<div class="viewcode-block" id="tkSpellTab.fillbox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.fillbox">[docs]</a>    <span class="k">def</span> <span class="nf">fillbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alts</span><span class="p">,</span> <span class="n">word</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the suggestions listBox in the Check Spelling dialog.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span> <span class="o">=</span> <span class="n">alts</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">word</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wordLabel</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span> <span class="s">&quot;Suggestions for: &quot;</span> <span class="o">+</span> <span class="n">word</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c"># This doesn&#39;t show up because we don&#39;t have focus.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="o">.</span><span class="n">select_set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.124: *5* getSuggestion</span></div>
<div class="viewcode-block" id="tkSpellTab.getSuggestion"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.getSuggestion">[docs]</a>    <span class="k">def</span> <span class="nf">getSuggestion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the selected suggestion from the listBox.&quot;&quot;&quot;</span>

        <span class="c"># Work around an old Python bug.  Convert strings to ints.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listBox</span><span class="o">.</span><span class="n">curselection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">pass</span>

        <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">suggestion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">suggestion</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.125: *5* updateButtons (spellTab)</span></div>
<div class="viewcode-block" id="tkSpellTab.updateButtons"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.tkSpellTab.updateButtons">[docs]</a>    <span class="k">def</span> <span class="nf">updateButtons</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Enable or disable buttons in the Check Spelling dialog.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>

        <span class="c"># Bug fix: enable buttons when start = 0.</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggestions</span> <span class="ow">and</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">changeButton</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeFindButton</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addButton</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignoreButton</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.126: ** frame classes</span>
<span class="c">#@+node:ekr.20081121110412.128: *3* class leoTkinterBody</span></div></div>
<div class="viewcode-block" id="leoTkinterBody"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterBody</span> <span class="p">(</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">leoBody</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that represents the body pane of a Tkinter window.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.129: *4*  Birth &amp; death</span>
    <span class="c">#@+node:ekr.20081121110412.130: *5* tkBody. __init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="c"># g.trace(&quot;leoTkinterBody&quot;)</span>

        <span class="c"># Call the base class constructor.</span>
        <span class="n">leoFrame</span><span class="o">.</span><span class="n">leoBody</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_v</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trace_onBodyChanged</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_onBodyChanged&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createControl</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorizer</span> <span class="o">=</span> <span class="n">leoColor</span><span class="o">.</span><span class="n">colorizer</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.131: *5* tkBody.createBindings</span>
<div class="viewcode-block" id="leoTkinterBody.createBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.createBindings">[docs]</a>    <span class="k">def</span> <span class="nf">createBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;(tkBody) Create gui-dependent bindings.</span>
<span class="sd">        These are *not* made in nullBody instances.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">onFocusOut</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">):</span>
            <span class="c"># This interferes with inserting new nodes.</span>
                <span class="c"># c.k.setDefaultInputState()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEditorColors</span><span class="p">(</span>
                <span class="n">bg</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">unselected_body_bg_color</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">unselected_body_fg_color</span><span class="p">)</span>
            <span class="c"># This is required, for example, when typing Alt-Shift-anyArrow in insert mode.</span>
            <span class="c"># But we suppress coloring in the widget.</span>
            <span class="n">oldState</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">unboundKeyAction</span>
            <span class="n">k</span><span class="o">.</span><span class="n">unboundKeyAction</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">defaultUnboundKeyAction</span>
            <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_focus</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="n">k</span><span class="o">.</span><span class="n">unboundKeyAction</span> <span class="o">=</span> <span class="n">oldState</span>

        <span class="k">def</span> <span class="nf">onFocusIn</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">):</span>
            <span class="c"># g.trace(&#39;callback&#39;)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">setDefaultInputState</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">()</span>  <span class="c"># TNB - fix color when window manager returns focus to Leo</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;&lt;FocusOut&gt;&#39;</span><span class="p">,</span> <span class="n">onFocusOut</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;&lt;FocusIn&gt;&#39;</span><span class="p">,</span> <span class="n">onFocusIn</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span>  <span class="n">frame</span><span class="o">.</span><span class="n">OnBodyClick</span><span class="p">,</span>          <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>  <span class="n">frame</span><span class="o">.</span><span class="n">OnBodyRClick</span><span class="p">,</span>         <span class="n">k</span><span class="o">.</span><span class="n">masterClick3Handler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-1&gt;&#39;</span><span class="p">,</span>  <span class="n">frame</span><span class="o">.</span><span class="n">OnBodyDoubleClick</span><span class="p">,</span>    <span class="n">k</span><span class="o">.</span><span class="n">masterDoubleClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-3&gt;&#39;</span><span class="p">,</span>  <span class="bp">None</span><span class="p">,</span>                       <span class="n">k</span><span class="o">.</span><span class="n">masterDoubleClick3Handler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-2&gt;&#39;</span><span class="p">,</span>  <span class="n">frame</span><span class="o">.</span><span class="n">OnPaste</span><span class="p">,</span>              <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">table2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-2&gt;&#39;</span><span class="p">,</span>  <span class="n">frame</span><span class="o">.</span><span class="n">OnPaste</span><span class="p">,</span>              <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;allow_middle_button_paste&#39;</span><span class="p">):</span>
            <span class="n">table</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">kind</span><span class="p">,</span><span class="n">func</span><span class="p">,</span><span class="n">handler</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">bodyClickCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">handler</span><span class="o">=</span><span class="n">handler</span><span class="p">,</span><span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">func</span><span class="p">)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">bodyClickCallback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.132: *5* tkBody.createControl</span></div>
<div class="viewcode-block" id="leoTkinterBody.createControl"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.createControl">[docs]</a>    <span class="k">def</span> <span class="nf">createControl</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># New in 4.4.1: make the parent frame a Pmw.PanedWidget.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfEditors</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalNumberOfEditors</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">orient</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="s">&#39;editor_orientation&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;horizontal&#39;</span>
        <span class="k">if</span> <span class="n">orient</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span><span class="s">&#39;vertical&#39;</span><span class="p">):</span> <span class="n">orient</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pb</span> <span class="o">=</span> <span class="n">pb</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">PanedWidget</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="n">orient</span><span class="p">)</span>
        <span class="n">parentFrame</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">pb</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span> <span class="c"># Must be done after the first page created.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTextWidget</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editorWidgets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>

        <span class="k">return</span> <span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.133: *5* tkBody.createTextWidget</span></div>
<div class="viewcode-block" id="leoTkinterBody.createTextWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.createTextWidget">[docs]</a>    <span class="k">def</span> <span class="nf">createTextWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">parentFrame</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;LightSteelBlue1&#39;</span><span class="p">)</span>

        <span class="n">wrap</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;body_pane_wraps&#39;</span><span class="p">)</span>
        <span class="n">wrap</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">wrap</span><span class="p">,</span><span class="s">&quot;word&quot;</span><span class="p">,</span><span class="s">&quot;none&quot;</span><span class="p">)</span>

        <span class="c"># Setgrid=1 cause severe problems with the font panel.</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="n">leoTkTextWidget</span> <span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;body-pane&#39;</span><span class="p">,</span>
            <span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;flat&quot;</span><span class="p">,</span><span class="n">setgrid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="n">wrap</span><span class="p">)</span>

        <span class="n">bodyBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;bodyBar&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">yscrollCallback</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">bodyBar</span><span class="o">=</span><span class="n">bodyBar</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">):</span>
            <span class="c"># g.trace(x,y,g.callers())</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;leo_scrollBarSpot&#39;</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">leo_scrollBarSpot</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">bodyBar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

        <span class="n">body</span><span class="p">[</span><span class="s">&#39;yscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yscrollCallback</span> <span class="c"># bodyBar.set</span>

        <span class="n">bodyBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">body</span><span class="o">.</span><span class="n">yview</span>
        <span class="n">bodyBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>

        <span class="c"># Always create the horizontal bar.</span>
        <span class="n">bodyXBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span>
            <span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;bodyXBar&#39;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">)</span>
        <span class="n">body</span><span class="p">[</span><span class="s">&#39;xscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bodyXBar</span><span class="o">.</span><span class="n">set</span>
        <span class="n">bodyXBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">xview</span>

        <span class="k">if</span> <span class="n">wrap</span> <span class="o">==</span> <span class="s">&quot;none&quot;</span><span class="p">:</span>
            <span class="c"># g.trace(parentFrame)</span>
            <span class="n">bodyXBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>

        <span class="n">body</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wrapState</span> <span class="o">=</span> <span class="n">wrap</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Causes the cursor not to blink.</span>
            <span class="n">body</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">insertofftime</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># Inject ivars</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_p</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Will be set when the second editor is created.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">w</span><span class="o">.</span><span class="n">leo_active</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># New in Leo 4.4.4 final: inject the scrollbar items into the text widget.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_bodyBar</span> <span class="o">=</span> <span class="n">bodyBar</span> <span class="c"># 2007/10/31</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_bodyXBar</span> <span class="o">=</span> <span class="n">bodyXBar</span> <span class="c"># 2007/10/31</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_chapter</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_frame</span> <span class="o">=</span> <span class="n">parentFrame</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_label</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_label_s</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_scrollBarSpot</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_insertSpot</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_selection</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.134: *4* tkBody.setColorFromConfig</span></div>
<div class="viewcode-block" id="leoTkinterBody.setColorFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.setColorFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">setColorFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;body_text_background_color&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>
        <span class="c"># g.trace(id(w),bg)</span>

        <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting body text background color&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;body_text_foreground_color&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;black&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">fg</span><span class="o">=</span><span class="n">fg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting body textforeground color&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>

        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;body_insertion_cursor_color&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">insertbackground</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting body pane cursor color&quot;</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>

        <span class="n">sel_bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&#39;body_text_selection_background_color&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;Gray80&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">selectbackground</span><span class="o">=</span><span class="n">sel_bg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting body pane text selection background color&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>

        <span class="n">sel_fg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&#39;body_text_selection_foreground_color&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">selectforeground</span><span class="o">=</span><span class="n">sel_fg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting body pane text selection foreground color&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span> <span class="c"># Maybe a Windows bug.</span>
            <span class="n">fg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;body_cursor_foreground_color&quot;</span><span class="p">)</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;body_cursor_background_color&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fg</span> <span class="ow">and</span> <span class="n">bg</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">=</span><span class="s">&quot;xterm&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">fg</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">bg</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">traceback</span> <span class="p">;</span> <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.135: *4* tkBody.setFontFromConfig</span></div>
<div class="viewcode-block" id="leoTkinterBody.setFontFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.setFontFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">setFontFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="n">font</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span>
            <span class="s">&quot;body_text_font_family&quot;</span><span class="p">,</span> <span class="s">&quot;body_text_font_size&quot;</span><span class="p">,</span>
            <span class="s">&quot;body_text_font_slant&quot;</span><span class="p">,</span>  <span class="s">&quot;body_text_font_weight&quot;</span><span class="p">,</span>
            <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultBodyFontSize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fontRef</span> <span class="o">=</span> <span class="n">font</span> <span class="c"># ESSENTIAL: retain a link to font.</span>
        <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

        <span class="c"># g.trace(&quot;BODY&quot;,body.cget(&quot;font&quot;),font.cget(&quot;family&quot;),font.cget(&quot;weight&quot;))</span>
    <span class="c">#@+node:ekr.20081121110412.136: *4* Focus (tkBody)</span></div>
<div class="viewcode-block" id="leoTkinterBody.hasFocus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.hasFocus">[docs]</a>    <span class="k">def</span> <span class="nf">hasFocus</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">focus_displayof</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.setFocus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.setFocus">[docs]</a>    <span class="k">def</span> <span class="nf">setFocus</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.137: *4* Tk bindings (tkBody)</span>
    <span class="c">#@+node:ekr.20081121110412.138: *5* Color tags (Tk spelling) (tkBody)</span></div>
<div class="viewcode-block" id="leoTkinterBody.tag_add"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.tag_add">[docs]</a>    <span class="k">def</span> <span class="nf">tag_add</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">tagName</span><span class="p">,</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.tag_bind"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.tag_bind">[docs]</a>    <span class="k">def</span> <span class="nf">tag_bind</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.tag_configure"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.tag_configure">[docs]</a>    <span class="k">def</span> <span class="nf">tag_configure</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">colorName</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span><span class="n">colorName</span><span class="p">,</span><span class="n">keys</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.tag_delete"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.tag_delete">[docs]</a>    <span class="k">def</span> <span class="nf">tag_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">tag_delete</span><span class="p">(</span><span class="n">tagName</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.tag_names"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.tag_names">[docs]</a>    <span class="k">def</span> <span class="nf">tag_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="c"># New in Leo 4.4.1.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">tag_names</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.tag_remove"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.tag_remove">[docs]</a>    <span class="k">def</span> <span class="nf">tag_remove</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">tagName</span><span class="p">,</span><span class="n">index1</span><span class="p">,</span><span class="n">index2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.139: *5* Configuration (Tk spelling) (tkBody)</span></div>
<div class="viewcode-block" id="leoTkinterBody.cget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.cget">[docs]</a>    <span class="k">def</span> <span class="nf">cget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">args</span><span class="p">,</span><span class="n">keys</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="leoTkinterBody.configure"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="c"># g.trace(args,keys)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.140: *5* Height &amp; width</span>
    <span class="c"># def getBodyPaneHeight (self):</span>

        <span class="c"># return self.bodyCtrl.winfo_height()</span>

    <span class="c"># def getBodyPaneWidth (self):</span>

        <span class="c"># return self.bodyCtrl.winfo_width()</span>
    <span class="c">#@+node:ekr.20081121110412.141: *5* Idle time...</span></div>
<div class="viewcode-block" id="leoTkinterBody.scheduleIdleTimeRoutine"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.scheduleIdleTimeRoutine">[docs]</a>    <span class="k">def</span> <span class="nf">scheduleIdleTimeRoutine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">function</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">after_idle</span><span class="p">(</span><span class="n">function</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.142: *5* Menus (tkBody) (May cause problems)</span></div>
<div class="viewcode-block" id="leoTkinterBody.bind"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.143: *4* Editors (tkBody)</span>
    <span class="c">#@+node:ekr.20081121110412.144: *5* createEditorFrame</span></div>
<div class="viewcode-block" id="leoTkinterBody.createEditorFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.createEditorFrame">[docs]</a>    <span class="k">def</span> <span class="nf">createEditorFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pane</span><span class="p">):</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">pane</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="c">#@+node:ekr.20081121110412.145: *5* packEditorLabelWidget</span></div>
<div class="viewcode-block" id="leoTkinterBody.packEditorLabelWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.packEditorLabelWidget">[docs]</a>    <span class="k">def</span> <span class="nf">packEditorLabelWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create a Tk label widget.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;leo_label&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_label</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;w.leo_frame&#39;,id(w.leo_frame))</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_label</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">leo_frame</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.146: *5* setEditorColors</span></div>
<div class="viewcode-block" id="leoTkinterBody.setEditorColors"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterBody.setEditorColors">[docs]</a>    <span class="k">def</span> <span class="nf">setEditorColors</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bg</span><span class="p">,</span><span class="n">fg</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editorWidgets</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">w2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="c"># g.trace(id(w2),bg,fg)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">w2</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">fg</span><span class="o">=</span><span class="n">fg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.147: *3* class leoTkinterFrame</span></div></div>
<div class="viewcode-block" id="leoTkinterFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterFrame</span> <span class="p">(</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">leoFrame</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that represents a Leo window rendered in Tk/tkinter.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.148: *4*  Birth &amp; Death (tkFrame)</span>
    <span class="c">#@+node:ekr.20081121110412.149: *5* __init__ (tkFrame)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">gui</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">leoFrame</span><span class="o">.</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gui</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

        <span class="n">leoTkinterFrame</span><span class="o">.</span><span class="n">instances</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Set in finishCreate.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconBarClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tkIconBarClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLineClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tkStatusLineClass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconBar</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trace_status_line</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Set in finishCreate.</span>

        <span class="c">#@+&lt;&lt; set the leoTkinterFrame ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.150: *6* &lt;&lt; set the leoTkinterFrame ivars &gt;&gt; (removed frame.bodyCtrl ivar)</span>
        <span class="c"># &quot;Official ivars created in createLeoFrame and its allies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findPanel</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Inited when first opened.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconBarComponentName</span> <span class="o">=</span> <span class="s">&#39;iconBar&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconFrame</span> <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outerFrame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLineComponentName</span> <span class="o">=</span> <span class="s">&#39;statusLine&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusText</span> <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">statusLabel</span> <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># self.treeBar = None # Replaced by injected frame.canvas.leo_treeBar.</span>

        <span class="c"># Used by event handlers...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controlKeyIsDown</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># For control-drags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draggedItem</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isActive</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wantedWidget</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wantedCallbackScheduled</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scrollWay</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#@-&lt;&lt; set the leoTkinterFrame ivars &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.151: *5* __repr__ (tkFrame)</span>
    <span class="k">def</span> <span class="nf">__repr__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&quot;&lt;leoTkinterFrame: </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
    <span class="c">#@+node:ekr.20081121110412.152: *5* tkFrame.finishCreate &amp; helpers</span>
<div class="viewcode-block" id="leoTkinterFrame.finishCreate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.finishCreate">[docs]</a>    <span class="k">def</span> <span class="nf">finishCreate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="c"># g.trace(&#39;tkFrame&#39;,&#39;c&#39;,c,g.callers())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bigTree</span>           <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;big_outline_pane&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_status_line</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_status_line&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_chapters</span>      <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;use_chapters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_chapter_tabs</span>  <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;use_chapter_tabs&#39;</span><span class="p">)</span>

        <span class="c"># This must be done after creating the commander.</span>
        <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">secondary_ratio</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">initialRatios</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">createOuterFrames</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">createIconBar</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">createLeoSplitters</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">outerFrame</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">createSplitterComponents</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">createStatusLine</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">createFirstTreeNode</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">leoTkinterMenu</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="c"># c.finishCreate calls f.createMenuBar later.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">miniBufferWidget</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">createMiniBufferWidget</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>

        <span class="c"># f.enableTclTraces()</span>
    <span class="c">#@+node:ekr.20081121110412.153: *6* createOuterFrames</span></div>
<div class="viewcode-block" id="leoTkinterFrame.createOuterFrames"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createOuterFrames">[docs]</a>    <span class="k">def</span> <span class="nf">createOuterFrames</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>
        <span class="n">f</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">attachLeoIcon</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">minsize</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="c"># In grid units.</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">user_xresources_path</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">option_readfile</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">user_xresources_path</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span><span class="s">&quot;WM_DELETE_WINDOW&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">OnCloseLeoEvent</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">OnActivateLeoEvent</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Control-KeyPress&gt;&quot;</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">OnControlKeyDown</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="s">&quot;&lt;Control-KeyRelease&gt;&quot;</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">OnControlKeyUp</span><span class="p">)</span>

        <span class="c"># These don&#39;t work on Windows. Because of bugs in window managers,</span>
        <span class="c"># there is NO WAY to know which window is on top!</span>
        <span class="c"># c.bind(f.top,&quot;&lt;Activate&gt;&quot;,f.OnActivateLeoEvent)</span>
        <span class="c"># c.bind(f.top,&quot;&lt;Deactivate&gt;&quot;,f.OnDeactivateLeoEvent)</span>

        <span class="c"># Create the outer frame, the &#39;hull&#39; component.</span>
        <span class="n">f</span><span class="o">.</span><span class="n">outerFrame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">outerFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.154: *6* createSplitterComponents (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.createSplitterComponents"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createSplitterComponents">[docs]</a>    <span class="k">def</span> <span class="nf">createSplitterComponents</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Create the canvas, tree, log and body.</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">use_chapters</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">chapterController</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">=</span> <span class="n">leoChapters</span><span class="o">.</span><span class="n">chapterController</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c"># split1.pane1 is the secondary splitter.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bigTree</span><span class="p">:</span> <span class="c"># Put outline in the main splitter.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_chapters</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_chapter_tabs</span><span class="p">:</span>
                <span class="n">cc</span><span class="o">.</span><span class="n">tt</span> <span class="o">=</span> <span class="n">leoTkinterTreeTab</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">split1Pane2</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">createCanvas</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split1Pane1</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">tree</span>  <span class="o">=</span> <span class="n">leoTkinterTree</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">log</span>   <span class="o">=</span> <span class="n">leoTkinterLog</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">split2Pane2</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">body</span>  <span class="o">=</span> <span class="n">leoTkinterBody</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">split2Pane1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_chapters</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_chapter_tabs</span><span class="p">:</span>
                <span class="n">cc</span><span class="o">.</span><span class="n">tt</span> <span class="o">=</span> <span class="n">leoTkinterTreeTab</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">split2Pane1</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">createCanvas</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split2Pane1</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">tree</span>   <span class="o">=</span> <span class="n">leoTkinterTree</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">log</span>    <span class="o">=</span> <span class="n">leoTkinterLog</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">split2Pane2</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">body</span>   <span class="o">=</span> <span class="n">leoTkinterBody</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">split1Pane2</span><span class="p">)</span>

        <span class="c"># Configure.</span>
        <span class="n">f</span><span class="o">.</span><span class="n">setTabWidth</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tab_width</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">reconfigurePanes</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">setFontFromConfig</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">setColorFromConfig</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.155: *6* f.enableTclTraces</span></div>
<div class="viewcode-block" id="leoTkinterFrame.enableTclTraces"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.enableTclTraces">[docs]</a>    <span class="k">def</span> <span class="nf">enableTclTraces</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="c"># Put this in unit tests before the assert:</span>
        <span class="c"># c.frame.bar1.unbind_all(&quot;&lt;FocusIn&gt;&quot;)</span>
        <span class="c"># c.frame.bar1.unbind_all(&quot;&lt;FocusOut&gt;&quot;)</span>

        <span class="c"># Any widget would do:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">bar1</span>
        <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">focusIn</span> <span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;Focus in  </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_class</span><span class="p">()))</span>

            <span class="k">def</span> <span class="nf">focusOut</span> <span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;Focus out </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_class</span><span class="p">()))</span>

            <span class="n">w</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s">&quot;&lt;FocusIn&gt;&quot;</span><span class="p">,</span> <span class="n">focusIn</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s">&quot;&lt;FocusOut&gt;&quot;</span><span class="p">,</span> <span class="n">focusOut</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">tracewidget</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;enabling widget trace&#39;</span><span class="p">)</span>
                <span class="n">Pmw</span><span class="o">.</span><span class="n">tracetk</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">untracewidget</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;disabling widget trace&#39;</span><span class="p">)</span>
                <span class="n">Pmw</span><span class="o">.</span><span class="n">tracetk</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">widget</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">w</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s">&quot;&lt;Control-1&gt;&quot;</span><span class="p">,</span> <span class="n">tracewidget</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s">&quot;&lt;Control-Shift-1&gt;&quot;</span><span class="p">,</span> <span class="n">untracewidget</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.156: *5* tkFrame.createCanvas &amp; helpers</span></div>
<div class="viewcode-block" id="leoTkinterFrame.createCanvas"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createCanvas">[docs]</a>    <span class="k">def</span> <span class="nf">createCanvas</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">pack</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">scrolls</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;outline_pane_scrolls_horizontally&#39;</span><span class="p">)</span>
        <span class="n">scrolls</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">scrolls</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTkTreeCanvas</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">scrolls</span><span class="p">,</span><span class="n">pack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCanvasColorFromConfig</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">canvas</span>
    <span class="c">#@+node:ekr.20081121110412.157: *6* f.createTkTreeCanvas &amp; callbacks</span></div>
<div class="viewcode-block" id="leoTkinterFrame.createTkTreeCanvas"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createTkTreeCanvas">[docs]</a>    <span class="k">def</span> <span class="nf">createTkTreeCanvas</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">scrolls</span><span class="p">,</span><span class="n">pack</span><span class="p">):</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;canvas&quot;</span><span class="p">,</span>
            <span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;flat&quot;</span><span class="p">)</span>

        <span class="n">treeBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;treeBar&quot;</span><span class="p">)</span>

        <span class="c"># New in Leo 4.4.3 b1: inject the ivar into the canvas.</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">leo_treeBar</span> <span class="o">=</span> <span class="n">treeBar</span>

        <span class="c"># Bind mouse wheel event to canvas</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span> <span class="c"># Works on 98, crashes on XP.</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&quot;&lt;MouseWheel&gt;&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">OnMouseWheel</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># New in 4.3.</span>
                <span class="c">#@+&lt;&lt; workaround for mouse-wheel problems &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.158: *7* &lt;&lt; workaround for mouse-wheel problems &gt;&gt;</span>
                <span class="c"># Handle mapping of mouse-wheel to buttons 4 and 5.</span>

                <span class="k">def</span> <span class="nf">mapWheel</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="c"># Button 4</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="mi">120</span>
                        <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">OnMouseWheel</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="c"># Button 5</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">120</span>
                        <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">OnMouseWheel</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

                <span class="n">c</span><span class="o">.</span><span class="n">bind2</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&quot;&lt;ButtonPress&gt;&quot;</span><span class="p">,</span><span class="n">mapWheel</span><span class="p">,</span><span class="n">add</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c">#@-&lt;&lt; workaround for mouse-wheel problems &gt;&gt;</span>

        <span class="n">canvas</span><span class="p">[</span><span class="s">&#39;yscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setCallback</span>
        <span class="n">treeBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yviewCallback</span>
        <span class="n">treeBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scrolls</span><span class="p">:</span> 
            <span class="n">treeXBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span> 
                <span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;treeXBar&#39;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">)</span> 
            <span class="n">canvas</span><span class="p">[</span><span class="s">&#39;xscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">treeXBar</span><span class="o">.</span><span class="n">set</span> 
            <span class="n">treeXBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">xview</span> 
            <span class="n">treeXBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pack</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">OnActivateTree</span><span class="p">)</span>

        <span class="c"># Handle mouse wheel in the outline pane.</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;linux2&quot;</span><span class="p">:</span> <span class="c"># This crashes tcl83.dll</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&quot;&lt;MouseWheel&gt;&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">OnMouseWheel</span><span class="p">)</span>

        <span class="c"># g.print_bindings(&quot;canvas&quot;,canvas)</span>
        <span class="k">return</span> <span class="n">canvas</span>
    <span class="c">#@+node:ekr.20081121110412.159: *7* Scrolling callbacks (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setCallback"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setCallback">[docs]</a>    <span class="k">def</span> <span class="nf">setCallback</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Callback to adjust the scrollbar.</span>

<span class="sd">        Args is a tuple of two floats describing the fraction of the visible area.&quot;&quot;&quot;</span>

        <span class="c">#g.trace(self.tree.redrawCount,args,g.callers())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">leo_treeBar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">setVisibleArea</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.yviewCallback"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.yviewCallback">[docs]</a>    <span class="k">def</span> <span class="nf">yviewCallback</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Tell the canvas to scroll&quot;&quot;&quot;</span>

        <span class="c">#g.trace(vyiewCallback,args,keys,g.callers())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">allocateNodesBeforeScrolling</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.160: *6* f.setCanvasColorFromConfig</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setCanvasColorFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setCanvasColorFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">setCanvasColorFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">canvas</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;outline_pane_background_color&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting outline pane background color&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.161: *5* tkFrame.createLeoSplitters &amp; helpers</span>
    <span class="c">#@+at The key invariants used throughout this code:</span>
    <span class="c"># </span>
    <span class="c"># 1. self.splitVerticalFlag tells the alignment of the main splitter and</span>
    <span class="c"># 2. not self.splitVerticalFlag tells the alignment of the secondary splitter.</span>
    <span class="c"># </span>
    <span class="c"># Only the general-purpose divideAnySplitter routine doesn&#39;t know about these</span>
    <span class="c"># invariants. So most of this code is specialized for Leo&#39;s window. OTOH, creating</span>
    <span class="c"># a single splitter window would be much easier than this code.</span>
    <span class="c">#@@c</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.createLeoSplitters"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createLeoSplitters">[docs]</a>    <span class="k">def</span> <span class="nf">createLeoSplitters</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="c"># Splitter 1 is the main splitter.</span>
        <span class="n">f1</span><span class="p">,</span><span class="n">bar1</span><span class="p">,</span><span class="n">split1Pane1</span><span class="p">,</span><span class="n">split1Pane2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createLeoTkSplitter</span><span class="p">(</span>
            <span class="n">parentFrame</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="s">&#39;splitter1&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bar1</span> <span class="o">=</span> <span class="n">f1</span><span class="p">,</span><span class="n">bar1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split1Pane1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">split1Pane2</span> <span class="o">=</span> <span class="n">split1Pane1</span><span class="p">,</span><span class="n">split1Pane2</span>

        <span class="c"># ** new **</span>
        <span class="n">split2parent</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bigTree</span><span class="p">,</span><span class="n">split1Pane2</span><span class="p">,</span><span class="n">split1Pane1</span><span class="p">)</span>

        <span class="c"># Splitter 2 is the secondary splitter.</span>
        <span class="n">f2</span><span class="p">,</span><span class="n">bar2</span><span class="p">,</span><span class="n">split2Pane1</span><span class="p">,</span><span class="n">split2Pane2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createLeoTkSplitter</span><span class="p">(</span>
            <span class="c"># split1Pane1,not self.splitVerticalFlag,&#39;splitter2&#39;)</span>
            <span class="n">split2parent</span><span class="p">,</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="s">&#39;splitter2&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bar2</span> <span class="o">=</span> <span class="n">f2</span><span class="p">,</span><span class="n">bar2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split2Pane1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">split2Pane2</span> <span class="o">=</span> <span class="n">split2Pane1</span><span class="p">,</span><span class="n">split2Pane2</span>
    <span class="c">#@+node:ekr.20081121110412.162: *6* createLeoTkSplitter</span></div>
<div class="viewcode-block" id="leoTkinterFrame.createLeoTkSplitter"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createLeoTkSplitter">[docs]</a>    <span class="k">def</span> <span class="nf">createLeoTkSplitter</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">,</span><span class="n">componentName</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Create the frames.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;flat&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">f1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;raised&quot;</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;LightSteelBlue2&quot;</span><span class="p">)</span>

        <span class="c"># Configure and place the frames.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configureBar</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bindBar</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placeSplitter</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span>
    <span class="c">#@+node:ekr.20081121110412.163: *6* bindBar</span></div>
<div class="viewcode-block" id="leoTkinterFrame.bindBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.bindBar">[docs]</a>    <span class="k">def</span> <span class="nf">bindBar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="n">verticalFlag</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span><span class="s">&quot;&lt;B1-Motion&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onDragMainSplitBar</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span><span class="s">&quot;&lt;B1-Motion&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onDragSecondarySplitBar</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.164: *6* divideAnySplitter</span>
    <span class="c"># This is the general-purpose placer for splitters.</span>
    <span class="c"># It is the only general-purpose splitter code in Leo.</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.divideAnySplitter"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.divideAnySplitter">[docs]</a>    <span class="k">def</span> <span class="nf">divideAnySplitter</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">pane1</span><span class="p">,</span> <span class="n">pane2</span><span class="p">):</span>

        <span class="c"># if self.bigTree:</span>
            <span class="c"># pane1,pane2 = pane2,pane1</span>

        <span class="k">if</span> <span class="n">verticalFlag</span><span class="p">:</span>
            <span class="c"># Panes arranged vertically; horizontal splitter bar</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">rely</span><span class="o">=</span><span class="n">frac</span><span class="p">)</span>
            <span class="n">pane1</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relheight</span><span class="o">=</span><span class="n">frac</span><span class="p">)</span>
            <span class="n">pane2</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relheight</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">frac</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Panes arranged horizontally; vertical splitter bar</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relx</span><span class="o">=</span><span class="n">frac</span><span class="p">)</span>
            <span class="n">pane1</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relwidth</span><span class="o">=</span><span class="n">frac</span><span class="p">)</span>
            <span class="n">pane2</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relwidth</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">frac</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.165: *6* divideLeoSplitter</span>
    <span class="c"># Divides the main or secondary splitter, using the key invariant.</span></div>
<div class="viewcode-block" id="leoTkinterFrame.divideLeoSplitter"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.divideLeoSplitter">[docs]</a>    <span class="k">def</span> <span class="nf">divideLeoSplitter</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">,</span> <span class="n">frac</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span> <span class="o">==</span> <span class="n">verticalFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">divideLeoSplitter1</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="n">frac</span> <span class="c"># Ratio of body pane to tree pane.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">divideLeoSplitter2</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">secondary_ratio</span> <span class="o">=</span> <span class="n">frac</span> <span class="c"># Ratio of tree pane to log pane.</span>

    <span class="c"># Divides the main splitter.</span></div>
<div class="viewcode-block" id="leoTkinterFrame.divideLeoSplitter1"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.divideLeoSplitter1">[docs]</a>    <span class="k">def</span> <span class="nf">divideLeoSplitter1</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">divideAnySplitter</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bar1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split1Pane1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split1Pane2</span><span class="p">)</span>

    <span class="c"># Divides the secondary splitter.</span></div>
<div class="viewcode-block" id="leoTkinterFrame.divideLeoSplitter2"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.divideLeoSplitter2">[docs]</a>    <span class="k">def</span> <span class="nf">divideLeoSplitter2</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">divideAnySplitter</span> <span class="p">(</span><span class="n">frac</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bar2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split2Pane1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">split2Pane2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.166: *6* onDrag...</span></div>
<div class="viewcode-block" id="leoTkinterFrame.onDragMainSplitBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.onDragMainSplitBar">[docs]</a>    <span class="k">def</span> <span class="nf">onDragMainSplitBar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onDragSplitterBar</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.onDragSecondarySplitBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.onDragSecondarySplitBar">[docs]</a>    <span class="k">def</span> <span class="nf">onDragSecondarySplitBar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onDragSplitterBar</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.onDragSplitterBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.onDragSplitterBar">[docs]</a>    <span class="k">def</span> <span class="nf">onDragSplitterBar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">verticalFlag</span><span class="p">):</span>

        <span class="c"># x and y are the coordinates of the cursor relative to the bar, not the main window.</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">winfo_toplevel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">verticalFlag</span><span class="p">:</span>
            <span class="c"># Panes arranged vertically; horizontal splitter bar</span>
            <span class="n">wRoot</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()</span>
            <span class="n">barRoot</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()</span>
            <span class="n">wMax</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">barRoot</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="n">wRoot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Panes arranged horizontally; vertical splitter bar</span>
            <span class="n">wRoot</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">()</span>
            <span class="n">barRoot</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">()</span>
            <span class="n">wMax</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_width</span><span class="p">()</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">barRoot</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="n">wRoot</span>

        <span class="c"># Adjust the pixels, not the frac.</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="n">wMax</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">wMax</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="c"># Redraw the splitter as the drag is occuring.</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">wMax</span>
        <span class="c"># g.trace(frac)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">verticalFlag</span><span class="p">,</span> <span class="n">frac</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.167: *6* placeSplitter</span></div>
<div class="viewcode-block" id="leoTkinterFrame.placeSplitter"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.placeSplitter">[docs]</a>    <span class="k">def</span> <span class="nf">placeSplitter</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bar</span><span class="p">,</span><span class="n">pane1</span><span class="p">,</span><span class="n">pane2</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">):</span>

        <span class="c"># if self.bigTree:</span>
            <span class="c"># pane1,pane2 = pane2,pane1</span>

        <span class="k">if</span> <span class="n">verticalFlag</span><span class="p">:</span>
            <span class="c"># Panes arranged vertically; horizontal splitter bar</span>
            <span class="n">pane1</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relx</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rely</span> <span class="o">=</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="n">relwidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">relheight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">pane2</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">relx</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rely</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="n">relwidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">relheight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">place</span>  <span class="p">(</span><span class="n">relx</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rely</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="n">relwidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Panes arranged horizontally; vertical splitter bar</span>
            <span class="c"># adj gives tree pane more room when tiling vertically.</span>
            <span class="n">adj</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">verticalFlag</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">0.65</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">pane1</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">rely</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">relx</span> <span class="o">=</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">relheight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">relwidth</span><span class="o">=</span><span class="n">adj</span><span class="p">)</span>
            <span class="n">pane2</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">rely</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">relx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="n">relheight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">relwidth</span><span class="o">=</span><span class="mf">1.0</span><span class="o">-</span><span class="n">adj</span><span class="p">)</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">place</span>  <span class="p">(</span><span class="n">rely</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">relx</span> <span class="o">=</span> <span class="n">adj</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="n">relheight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.168: *5* Destroying the tkFrame</span>
    <span class="c">#@+node:ekr.20081121110412.169: *6* destroyAllObjects</span></div>
<div class="viewcode-block" id="leoTkinterFrame.destroyAllObjects"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.destroyAllObjects">[docs]</a>    <span class="k">def</span> <span class="nf">destroyAllObjects</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Clear all links to objects in a Leo window.&quot;&quot;&quot;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">tree</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">tree</span> <span class="p">;</span> <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>

        <span class="c"># g.printGcAll()</span>

        <span class="c"># Do this first.</span>
        <span class="c">#@+&lt;&lt; clear all vnodes and tnodes in the tree &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.170: *7* &lt;&lt; clear all vnodes and tnodes in the tree&gt;&gt;</span>
        <span class="c"># Using a dict here is essential for adequate speed.</span>
        <span class="n">vList</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">tDict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">all_unique_positions</span><span class="p">():</span>
            <span class="n">vList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tDict</span><span class="p">:</span>
                    <span class="n">tDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tDict</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">tDict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vList</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">vList</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">tDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Remove these references immediately.</span>
        <span class="c">#@-&lt;&lt; clear all vnodes and tnodes in the tree &gt;&gt;</span>

        <span class="c"># Destroy all ivars in subcommanders.</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">atFileCommands</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">chapterController</span><span class="p">:</span> <span class="c"># New in Leo 4.4.3 b1.</span>
            <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">chapterController</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">fileCommands</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">keyHandler</span><span class="p">)</span> <span class="c"># New in Leo 4.4.3 b1.</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">importCommands</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tangleCommands</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">undoer</span><span class="p">)</span>

        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">colorizer</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c"># This must be done last.</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">destroyAllPanels</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">clearAllIvars</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20081121110412.171: *6* destroyAllPanels</span></div>
<div class="viewcode-block" id="leoTkinterFrame.destroyAllPanels"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.destroyAllPanels">[docs]</a>    <span class="k">def</span> <span class="nf">destroyAllPanels</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Destroy all panels attached to this frame.&quot;&quot;&quot;</span>

        <span class="n">panels</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comparePanel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorPanel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPanel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontPanel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefsPanel</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">panel</span><span class="p">:</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.172: *6* destroySelf (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.destroySelf"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.destroySelf">[docs]</a>    <span class="k">def</span> <span class="nf">destroySelf</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># g.trace(self)</span>

        <span class="c"># Remember these: we are about to destroy all of our ivars!</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> 
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Indicate that the commander is no longer valid.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">exists</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># New in Leo 4.4.8: Finish all window tasks before killing the window.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c"># g.trace(self)</span>

        <span class="c"># Important: this destroys all the objects of the commander too.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroyAllObjects</span><span class="p">()</span>

        <span class="c"># New in Leo 4.4.8: Finish all window tasks before killing the window.</span>
        <span class="n">top</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">exists</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Make sure this one ivar has not been destroyed.</span>

        <span class="n">top</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.173: *4* class tkStatusLineClass (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass">[docs]</a>    <span class="k">class</span> <span class="nc">tkStatusLineClass</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;A class representing the status line.&#39;&#39;&#39;</span>

        <span class="c">#@+others</span>
        <span class="c">#@+node:ekr.20081121110412.174: *5* ctor</span>
        <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># list of color names used as tags.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastCol</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">log</span>
            <span class="c">#if &#39;black&#39; not in self.log.colorTags:</span>
            <span class="c">#    self.log.colorTags.append(&quot;black&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentFrame</span> <span class="o">=</span> <span class="n">parentFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;line 0, col 0, fcol 0&quot;</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelWidget</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelWidget</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">bodyTextWidget</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;status-line&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onActivate</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">statusFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span>
            <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">statusLabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelWidget</span>
            <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">statusText</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>
        <span class="c">#@+node:ekr.20081121110412.175: *5* clear</span>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.clear"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.clear">[docs]</a>        <span class="k">def</span> <span class="nf">clear</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="c">#@+node:ekr.20081121110412.176: *5* enable, disable &amp; isEnabled</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.disable"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.disable">[docs]</a>        <span class="k">def</span> <span class="nf">disable</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">background</span><span class="p">:</span>
                    <span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.enable"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.enable">[docs]</a>        <span class="k">def</span> <span class="nf">enable</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">):</span>

            <span class="c"># g.trace()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.isEnabled"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.isEnabled">[docs]</a>        <span class="k">def</span> <span class="nf">isEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span>
        <span class="c">#@+node:ekr.20081121110412.177: *5* get</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.get"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.get">[docs]</a>        <span class="k">def</span> <span class="nf">get</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="c">#@+node:ekr.20081121110412.178: *5* getFrame</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.getFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.getFrame">[docs]</a>        <span class="k">def</span> <span class="nf">getFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span>
        <span class="c">#@+node:ekr.20081121110412.179: *5* onActivate</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.onActivate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.onActivate">[docs]</a>        <span class="k">def</span> <span class="nf">onActivate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

            <span class="c"># Don&#39;t change background as the result of simple mouse clicks.</span>
            <span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">)</span>
        <span class="c">#@+node:ekr.20081121110412.180: *5* pack &amp; show</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.pack"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.pack">[docs]</a>        <span class="k">def</span> <span class="nf">pack</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div>
        <span class="n">show</span> <span class="o">=</span> <span class="n">pack</span>
        <span class="c">#@+node:ekr.20081121110412.181: *5* put (leoTkinterFrame:statusLineClass)</span>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.put"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.put">[docs]</a>        <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

            <span class="c"># g.trace(&#39;tkStatusLine&#39;,self.textWidget,s)</span>

            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;tkStatusLine&#39;</span><span class="p">,</span><span class="s">&#39;***** disabled&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="n">foreground</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="s">&quot;end-</span><span class="si">%d</span><span class="s">c&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&quot;end-1c&quot;</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">foreground</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>

            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="c">#@+node:ekr.20081121110412.182: *5* setBindings (tkStatusLine)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.setBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.setBindings">[docs]</a>        <span class="k">def</span> <span class="nf">setBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">keyHandler</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textWidget</span>

            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">)</span>

            <span class="n">k</span><span class="o">.</span><span class="n">completeAllBindingsForWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="c">#@+node:ekr.20081121110412.183: *5* unpack &amp; hide</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.unpack"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.unpack">[docs]</a>        <span class="k">def</span> <span class="nf">unpack</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statusFrame</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
</div>
        <span class="n">hide</span> <span class="o">=</span> <span class="n">unpack</span>
        <span class="c">#@+node:ekr.20081121110412.184: *5* update (statusLine)</span>
<div class="viewcode-block" id="leoTkinterFrame.tkStatusLineClass.update"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkStatusLineClass.update">[docs]</a>        <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">bodyCtrl</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>

            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">killed</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">s</span> <span class="o">=</span> <span class="n">bodyCtrl</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>    
            <span class="n">index</span> <span class="o">=</span> <span class="n">bodyCtrl</span><span class="o">.</span><span class="n">getInsertPoint</span><span class="p">()</span>
            <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">convertPythonIndexToRowCol</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="n">col</span><span class="p">:</span><span class="n">index</span><span class="p">]</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toUnicode</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">computeWidth</span> <span class="p">(</span><span class="n">s2</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">tab_width</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
            <span class="n">fcol</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">textOffset</span><span class="p">()</span>

            <span class="c"># Important: this does not change the focus because labels never get focus.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelWidget</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;line </span><span class="si">%d</span><span class="s">, col </span><span class="si">%d</span><span class="s">, fcol </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">fcol</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastRow</span> <span class="o">=</span> <span class="n">row</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastCol</span> <span class="o">=</span> <span class="n">col</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastFcol</span> <span class="o">=</span> <span class="n">fcol</span>
        <span class="c">#@-others</span>
    <span class="c">#@+node:ekr.20081121110412.185: *4* class tkIconBarClass</span></div></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass">[docs]</a>    <span class="k">class</span> <span class="nc">tkIconBarClass</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;A class representing the singleton Icon bar&#39;&#39;&#39;</span>

        <span class="c">#@+others</span>
        <span class="c">#@+node:ekr.20081121110412.186: *5*  ctor</span>
        <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c"># Create a parent frame that will never be unpacked.</span>
            <span class="c"># This allows us to pack and unpack the container frame without it moving.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iconFrameParentFrame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iconFrameParentFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c"># Create a container frame to hold individual row frames.</span>
            <span class="c"># We hide all icons by doing pack_forget on this one frame.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iconFrameContainerFrame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iconFrameParentFrame</span><span class="p">)</span>
                <span class="c"># Packed in self.show()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">addRow</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parentFrame</span> <span class="o">=</span> <span class="n">parentFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widgets_per_row</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&#39;icon_bar_widgets_per_row&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c"># pack the container frame.</span>
        <span class="c">#@+node:ekr.20081121110412.187: *5* add</span>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.add"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.add">[docs]</a>        <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Add a button containing text or a picture to the icon bar.</span>

<span class="sd">            Pictures take precedence over text&quot;&quot;&quot;</span>

            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
            <span class="n">imagefile</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;imagefile&#39;</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;command&#39;</span><span class="p">)</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;bg&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">imagefile</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">image</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span> <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">addRowIfNeeded</span><span class="p">()</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconFrame</span> <span class="c"># Bind this after possibly creating a new row.</span>

            <span class="k">if</span> <span class="n">command</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">commandCallBack</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">command</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">commandCallback</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span><span class="p">):</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;command for widget </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">command</span> <span class="o">=</span> <span class="n">commandCallback</span>

            <span class="k">if</span> <span class="n">imagefile</span> <span class="ow">or</span> <span class="n">image</span><span class="p">:</span>
                <span class="c">#@+&lt;&lt; create a picture &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.188: *6* &lt;&lt; create a picture &gt;&gt;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">imagefile</span><span class="p">:</span>
                        <span class="c"># Create the image.  Throws an exception if file not found</span>
                        <span class="n">imagefile</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="n">imagefile</span><span class="p">)</span>
                        <span class="n">imagefile</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_normpath</span><span class="p">(</span><span class="n">imagefile</span><span class="p">)</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">imagefile</span><span class="p">)</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">imagefile</span><span class="p">)</span>

                        <span class="c"># Must keep a reference to the image!</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">refs</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconImageRefs</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">refs</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconImageRefs</span> <span class="o">=</span> <span class="p">[]</span>

                        <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">imagefile</span><span class="p">,</span><span class="n">image</span><span class="p">),)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">bg</span><span class="p">:</span>
                        <span class="n">bg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;bg&quot;</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;flat&quot;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;image does not exist&#39;</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&#39;flat&#39;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">b</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="c">#@-&lt;&lt; create a picture &gt;&gt;</span>
            <span class="k">elif</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span>
                        <span class="s">&quot;button_text_font_family&quot;</span><span class="p">,</span> <span class="s">&quot;button_text_font_size&quot;</span><span class="p">,</span>
                        <span class="s">&quot;button_text_font_slant&quot;</span><span class="p">,</span>  <span class="s">&quot;button_text_font_weight&quot;</span><span class="p">,)</span>
                <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bg</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
                <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">b</span>

            <span class="k">return</span> <span class="bp">None</span>
        <span class="c">#@+node:ekr.20081121110412.189: *5* addRow</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.addRow"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.addRow">[docs]</a>        <span class="k">def</span> <span class="nf">addRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="s">&#39;5m&#39;</span>

            <span class="n">w</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iconFrameContainerFrame</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;groove&quot;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iconFrame</span> <span class="o">=</span> <span class="n">w</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">iconFrame</span> <span class="o">=</span> <span class="n">w</span>
            <span class="k">return</span> <span class="n">w</span>
        <span class="c">#@+node:ekr.20081121110412.190: *5* addRowIfNeeded</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.addRowIfNeeded"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.addRowIfNeeded">[docs]</a>        <span class="k">def</span> <span class="nf">addRowIfNeeded</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="sd">&#39;&#39;&#39;Add a new icon row if there are too many widgets.&#39;&#39;&#39;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets_per_row</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addRow</span><span class="p">()</span>

            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c">#@+node:ekr.20081121110412.191: *5* addWidget</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.addWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.addWidget">[docs]</a>        <span class="k">def</span> <span class="nf">addWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">addRowIfNeeded</span><span class="p">()</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span>


        <span class="c">#@+node:ekr.20081121110412.192: *5* clear</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.clear"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.clear">[docs]</a>        <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Destroy all the widgets in the icon bar&quot;&quot;&quot;</span>

            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconFrameContainerFrame</span>

            <span class="k">for</span> <span class="n">slave</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">pack_slaves</span><span class="p">():</span>
                <span class="n">slave</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="s">&#39;0m&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconImageRefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">#@+node:ekr.20081121110412.193: *5* deleteButton (new in Leo 4.4.3)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.deleteButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.deleteButton">[docs]</a>        <span class="k">def</span> <span class="nf">deleteButton</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

            <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
        <span class="c">#@+node:ekr.20081121110412.194: *5* getFrame &amp; getNewFrame</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.getFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.getFrame">[docs]</a>        <span class="k">def</span> <span class="nf">getFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconFrame</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.getNewFrame"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.getNewFrame">[docs]</a>        <span class="k">def</span> <span class="nf">getNewFrame</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="c"># Pre-check that there is room in the row, but don&#39;t bump the count.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addRowIfNeeded</span><span class="p">()</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">iconWidgetCount</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="c"># Allocate the frame in the possibly new row.</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iconFrame</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">frame</span>

        <span class="c">#@+node:ekr.20081121110412.195: *5* pack (show)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.pack"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.pack">[docs]</a>        <span class="k">def</span> <span class="nf">pack</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Show the icon bar by repacking it&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iconFrameContainerFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</div>
        <span class="n">show</span> <span class="o">=</span> <span class="n">pack</span>
        <span class="c">#@+node:ekr.20081121110412.196: *5* setCommandForButton (new in Leo 4.4.3)</span>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.setCommandForButton"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.setCommandForButton">[docs]</a>        <span class="k">def</span> <span class="nf">setCommandForButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">command</span><span class="p">):</span>

            <span class="n">b</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
        <span class="c">#@+node:ekr.20081121110412.197: *5* unpack (hide)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.tkIconBarClass.unpack"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.tkIconBarClass.unpack">[docs]</a>        <span class="k">def</span> <span class="nf">unpack</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="sd">&quot;&quot;&quot;Hide the icon bar by unpacking it.&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconFrameContainerFrame</span>
                <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
</div>
        <span class="n">hide</span> <span class="o">=</span> <span class="n">unpack</span>
        <span class="c">#@-others</span>
    <span class="c">#@+node:ekr.20081121110412.198: *4* Minibuffer methods (tkFrame)</span>
    <span class="c">#@+node:ekr.20081121110412.199: *5* showMinibuffer</span></div>
<div class="viewcode-block" id="leoTkinterFrame.showMinibuffer"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.showMinibuffer">[docs]</a>    <span class="k">def</span> <span class="nf">showMinibuffer</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Make the minibuffer visible.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">frame</span><span class="o">.</span><span class="n">minibufferVisible</span><span class="p">:</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">minibufferFrame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">minibufferVisible</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c">#@+node:ekr.20081121110412.200: *5* hideMinibuffer</span></div>
<div class="viewcode-block" id="leoTkinterFrame.hideMinibuffer"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.hideMinibuffer">[docs]</a>    <span class="k">def</span> <span class="nf">hideMinibuffer</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Hide the minibuffer.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">minibufferVisible</span><span class="p">:</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">minibufferFrame</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">minibufferVisible</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.201: *5* f.createMiniBufferWidget</span></div>
<div class="viewcode-block" id="leoTkinterFrame.createMiniBufferWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.createMiniBufferWidget">[docs]</a>    <span class="k">def</span> <span class="nf">createMiniBufferWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create the minbuffer below the status line.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>

        <span class="n">frame</span><span class="o">.</span><span class="n">minibufferFrame</span> <span class="o">=</span> <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">outerFrame</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&#39;flat&#39;</span><span class="p">,</span><span class="n">borderwidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">showMinibuffer</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>

        <span class="n">lab</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;mini-buffer&#39;</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&#39;nw&#39;</span><span class="p">,</span><span class="n">foreground</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">lab</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
            <span class="n">f</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&#39;groove&#39;</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="s">&#39;lightgrey&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;minibuffer&#39;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">frame</span><span class="o">.</span><span class="n">minibufferVisible</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">showMinibuffer</span>

        <span class="k">return</span> <span class="n">label</span>
    <span class="c">#@+node:ekr.20081121110412.202: *5* f.setMinibufferBindings</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setMinibufferBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setMinibufferBindings">[docs]</a>    <span class="k">def</span> <span class="nf">setMinibufferBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create bindings for the minibuffer..&#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">miniBufferWidget</span>

        <span class="c"># g.trace(g.callers(4))</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span>           <span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span>      <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>      <span class="n">k</span><span class="o">.</span><span class="n">masterClick3Handler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-1&gt;&#39;</span><span class="p">,</span>      <span class="n">k</span><span class="o">.</span><span class="n">masterDoubleClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-3&gt;&#39;</span><span class="p">,</span>      <span class="n">k</span><span class="o">.</span><span class="n">masterDoubleClick3Handler</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">table2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-2&gt;&#39;</span><span class="p">,</span>      <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;allow_middle_button_paste&#39;</span><span class="p">):</span>
            <span class="n">table</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">kind</span><span class="p">,</span><span class="n">callback</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
                <span class="c"># Support Linux middle-button paste easter egg.</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;&lt;Button-2&gt;&quot;</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">OnPaste</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.203: *4* Configuration (tkFrame)</span>
    <span class="c">#@+node:ekr.20081121110412.204: *5* configureBar (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.configureBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.configureBar">[docs]</a>    <span class="k">def</span> <span class="nf">configureBar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bar</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Get configuration settings.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;split_bar_width&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">or</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">relief</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;split_bar_relief&quot;</span><span class="p">,</span><span class="s">&quot;relief&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relief</span><span class="p">:</span> <span class="n">relief</span> <span class="o">=</span> <span class="s">&quot;flat&quot;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;split_bar_color&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span><span class="p">:</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;LightSteelBlue2&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verticalFlag</span><span class="p">:</span>
                <span class="c"># Panes arranged vertically; horizontal splitter bar</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="n">relief</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">cursor</span><span class="o">=</span><span class="s">&quot;sb_v_double_arrow&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Panes arranged horizontally; vertical splitter bar</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="n">relief</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">cursor</span><span class="o">=</span><span class="s">&quot;sb_h_double_arrow&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c"># Could be a user error. Use all defaults</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception in user configuration for splitbar&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">verticalFlag</span><span class="p">:</span>
                <span class="c"># Panes arranged vertically; horizontal splitter bar</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">cursor</span><span class="o">=</span><span class="s">&quot;sb_v_double_arrow&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Panes arranged horizontally; vertical splitter bar</span>
                <span class="n">bar</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">cursor</span><span class="o">=</span><span class="s">&quot;sb_h_double_arrow&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.205: *5* configureBarsFromConfig (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.configureBarsFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.configureBarsFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">configureBarsFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;split_bar_width&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">or</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="n">relief</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;split_bar_relief&quot;</span><span class="p">,</span><span class="s">&quot;relief&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relief</span> <span class="ow">or</span> <span class="n">relief</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span> <span class="n">relief</span> <span class="o">=</span> <span class="s">&quot;flat&quot;</span>

        <span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;split_bar_color&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">color</span> <span class="ow">or</span> <span class="n">color</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&quot;LightSteelBlue2&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">:</span>
            <span class="n">bar1</span><span class="p">,</span><span class="n">bar2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bar1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bar2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bar1</span><span class="p">,</span><span class="n">bar2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bar2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bar1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">bar1</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="n">relief</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">bar2</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">relief</span><span class="o">=</span><span class="n">relief</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="c"># Could be a user error.</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception in user configuration for splitbar&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.206: *5* reconfigureFromConfig (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.reconfigureFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.reconfigureFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">reconfigureFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>

        <span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">setFontFromConfig</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">configureBarsFromConfig</span><span class="p">()</span>

        <span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">setFontFromConfig</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">setColorFromConfig</span><span class="p">()</span>

        <span class="n">frame</span><span class="o">.</span><span class="n">setTabWidth</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">tab_width</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setFontFromConfig</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setColorFromConfig</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.207: *5* setInitialWindowGeometry (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setInitialWindowGeometry"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setInitialWindowGeometry">[docs]</a>    <span class="k">def</span> <span class="nf">setInitialWindowGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Set the position and size of the frame to config params.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;initial_window_height&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">500</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;initial_window_width&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">600</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;initial_window_left&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">10</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&quot;initial_window_top&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">10</span>

        <span class="k">if</span> <span class="n">h</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">y</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTopGeometry</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.208: *5* setTabWidth (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setTabWidth"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setTabWidth">[docs]</a>    <span class="k">def</span> <span class="nf">setTabWidth</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span> <span class="c"># This can fail when called from scripts</span>
            <span class="c"># Use the present font for computations.</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;font&quot;</span><span class="p">)</span> <span class="c"># 2007/10/27</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span> <span class="c"># 4/3/03: must specify root so idle window will work properly.</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
            <span class="n">tabw</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w</span><span class="p">))</span> <span class="c"># 7/2/02</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">tabs</span><span class="o">=</span><span class="n">tabw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span> <span class="o">=</span> <span class="n">w</span>
            <span class="c"># g.trace(w,tabw)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.209: *5* setWrap (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setWrap"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setWrap">[docs]</a>    <span class="k">def</span> <span class="nf">setWrap</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">theDict</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">scanAllDirectives</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">theDict</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">wrap</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;wrap&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">wrapState</span> <span class="o">==</span> <span class="n">wrap</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">wrapState</span> <span class="o">=</span> <span class="n">wrap</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>

        <span class="c"># g.trace(wrap)</span>
        <span class="k">if</span> <span class="n">wrap</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">wrap</span><span class="o">=</span><span class="s">&quot;word&quot;</span><span class="p">)</span> <span class="c"># 2007/10/25</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_bodyXBar</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span> <span class="c"># 2007/10/31</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">wrap</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span>
            <span class="c"># Bug fix: 3/10/05: We must unpack the text area to make the scrollbar visible.</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>  <span class="c"># 2007/10/25</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_bodyXBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span> <span class="c"># 2007/10/31</span>
            <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>  <span class="c"># 2007/10/25</span>
    <span class="c">#@+node:ekr.20081121110412.210: *5* setTopGeometry (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.setTopGeometry"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setTopGeometry">[docs]</a>    <span class="k">def</span> <span class="nf">setTopGeometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">adjustSize</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="c"># Put the top-left corner on the screen.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">adjustSize</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_screenwidth</span><span class="p">()</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_screenheight</span><span class="p">()</span>

            <span class="c"># Adjust the size so the whole window fits on the screen.</span>
            <span class="n">w</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sw</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sh</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>

            <span class="c"># Adjust position so the whole window fits on the screen.</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="n">sw</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">sh</span><span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">x</span><span class="si">%d%+d%+d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.211: *5* reconfigurePanes (use config bar_width) (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.reconfigurePanes"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.reconfigurePanes">[docs]</a>    <span class="k">def</span> <span class="nf">reconfigurePanes</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">border</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s">&#39;additional_body_text_border&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">border</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">border</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># The body pane needs a _much_ bigger border when tiling horizontally.</span>
        <span class="n">border</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mi">2</span><span class="o">+</span><span class="n">border</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="n">border</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bd</span><span class="o">=</span><span class="n">border</span><span class="p">)</span> <span class="c"># 2007/10/25</span>

        <span class="c"># The log pane needs a slightly bigger border when tiling vertically.</span>
        <span class="n">border</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">configureBorder</span><span class="p">(</span><span class="n">border</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.212: *5* resizePanesToRatio (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.resizePanesToRatio"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.resizePanesToRatio">[docs]</a>    <span class="k">def</span> <span class="nf">resizePanesToRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ratio</span><span class="p">,</span><span class="n">ratio2</span><span class="p">):</span>

        <span class="c"># g.trace(ratio,ratio2,g.callers())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">ratio2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.213: *4* Event handlers (tkFrame)</span>
    <span class="c">#@+node:ekr.20081121110412.214: *5* frame.OnCloseLeoEvent</span>
    <span class="c"># Called from quit logic and when user closes the window.</span>
    <span class="c"># Returns True if the close happened.</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.OnCloseLeoEvent"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnCloseLeoEvent">[docs]</a>    <span class="k">def</span> <span class="nf">OnCloseLeoEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">inCommand</span><span class="p">:</span>
            <span class="c"># g.trace(&#39;requesting window close&#39;)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">requestCloseWindow</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">closeLeoWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.215: *5* frame.OnControlKeyUp/Down</span></div>
<div class="viewcode-block" id="leoTkinterFrame.OnControlKeyDown"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnControlKeyDown">[docs]</a>    <span class="k">def</span> <span class="nf">OnControlKeyDown</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controlKeyIsDown</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.OnControlKeyUp"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnControlKeyUp">[docs]</a>    <span class="k">def</span> <span class="nf">OnControlKeyUp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controlKeyIsDown</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.216: *5* OnActivateBody (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.OnActivateBody"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnActivateBody">[docs]</a>    <span class="k">def</span> <span class="nf">OnActivateBody</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_focus</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">!=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">:</span>
                <span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">OnDeactivate</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;activate body&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.217: *5* OnActivateLeoEvent, OnDeactivateLeoEvent</span></div>
<div class="viewcode-block" id="leoTkinterFrame.OnActivateLeoEvent"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnActivateLeoEvent">[docs]</a>    <span class="k">def</span> <span class="nf">OnActivateLeoEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle a click anywhere in the Leo window.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.OnDeactivateLeoEvent"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnDeactivateLeoEvent">[docs]</a>    <span class="k">def</span> <span class="nf">OnDeactivateLeoEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">pass</span> <span class="c"># This causes problems on the Mac.</span>
    <span class="c">#@+node:ekr.20081121110412.218: *5* OnActivateTree</span></div>
<div class="viewcode-block" id="leoTkinterFrame.OnActivateTree"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnActivateTree">[docs]</a>    <span class="k">def</span> <span class="nf">OnActivateTree</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Do NOT do this here!</span>
                <span class="c"># OnActivateTree can get called when the tree gets DE-activated!!</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;activate tree&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.219: *5* OnBodyClick, OnBodyRClick (Events)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.OnBodyClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnBodyClick">[docs]</a>    <span class="k">def</span> <span class="nf">OnBodyClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;bodyclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnActivateBody</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;bodyclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;bodyclick&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.OnBodyRClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnBodyRClick">[docs]</a>    <span class="k">def</span> <span class="nf">OnBodyRClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;bodyrclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;bodyrclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;iconrclick&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.220: *5* OnBodyDoubleClick (Events)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.OnBodyDoubleClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnBodyDoubleClick">[docs]</a>    <span class="k">def</span> <span class="nf">OnBodyDoubleClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">event</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;bodydclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">editCommands</span><span class="o">.</span><span class="n">extendToWord</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="c"># Handles unicode properly.</span>
                <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;bodydclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;bodydclick&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span> <span class="c"># Restore this to handle proper double-click logic.</span>
    <span class="c">#@+node:ekr.20081121110412.221: *5* OnMouseWheel (Tomaz Ficko)</span>
    <span class="c"># Contributed by Tomaz Ficko.  This works on some systems.</span>
    <span class="c"># On XP it causes a crash in tcl83.dll.  Clearly a Tk bug.</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.OnMouseWheel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.OnMouseWheel">[docs]</a>    <span class="k">def</span> <span class="nf">OnMouseWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="n">Tk</span><span class="o">.</span><span class="n">SCROLL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Tk</span><span class="o">.</span><span class="n">UNITS</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="n">Tk</span><span class="o">.</span><span class="n">SCROLL</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Tk</span><span class="o">.</span><span class="n">UNITS</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;scroll wheel&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@+node:ekr.20081121110412.222: *4* Gui-dependent commands</span>
    <span class="c">#@+node:ekr.20081121110412.223: *5* Minibuffer commands... (tkFrame)</span>

    <span class="c">#@+node:ekr.20081121110412.224: *6* contractPane</span></div>
<div class="viewcode-block" id="leoTkinterFrame.contractPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.contractPane">[docs]</a>    <span class="k">def</span> <span class="nf">contractPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Contract the selected pane.&#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_requested_focus</span><span class="p">()</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_focus</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">wname</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">widget_name</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="c"># g.trace(wname)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">contractBodyPane</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">contractLogPane</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;head&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;canvas&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">contractOutlinePane</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.225: *6* expandPane</span></div>
<div class="viewcode-block" id="leoTkinterFrame.expandPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.expandPane">[docs]</a>    <span class="k">def</span> <span class="nf">expandPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Expand the selected pane.&#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_requested_focus</span><span class="p">()</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_focus</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">wname</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">widget_name</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="c"># g.trace(wname)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">expandBodyPane</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">expandLogPane</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;head&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;canvas&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">expandOutlinePane</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.226: *6* fullyExpandPane</span></div>
<div class="viewcode-block" id="leoTkinterFrame.fullyExpandPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.fullyExpandPane">[docs]</a>    <span class="k">def</span> <span class="nf">fullyExpandPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Fully expand the selected pane.&#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_requested_focus</span><span class="p">()</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_focus</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">wname</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">widget_name</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="c"># g.trace(wname)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">fullyExpandBodyPane</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">fullyExpandLogPane</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;head&#39;</span><span class="p">,</span><span class="s">&#39;canvas&#39;</span><span class="p">,</span><span class="s">&#39;tree&#39;</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">fullyExpandOutlinePane</span><span class="p">()</span>
                <span class="k">break</span>
    <span class="c">#@+node:ekr.20081121110412.227: *6* hidePane</span></div>
<div class="viewcode-block" id="leoTkinterFrame.hidePane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.hidePane">[docs]</a>    <span class="k">def</span> <span class="nf">hidePane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Completely contract the selected pane.&#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">c</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_requested_focus</span><span class="p">()</span> <span class="ow">or</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_focus</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">wname</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">widget_name</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">hideBodyPane</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">treeWantsFocus</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">wname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">hideLogPane</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;head&#39;</span><span class="p">,</span><span class="s">&#39;canvas&#39;</span><span class="p">,</span><span class="s">&#39;tree&#39;</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">hideOutlinePane</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
                <span class="k">break</span>
    <span class="c">#@+node:ekr.20081121110412.228: *6* expand/contract/hide...Pane</span>
    <span class="c">#@+at The first arg to divideLeoSplitter means the following:</span>
    <span class="c"># </span>
    <span class="c">#     f.splitVerticalFlag: use the primary   (tree/body) ratio.</span>
    <span class="c"># not f.splitVerticalFlag: use the secondary (tree/log) ratio.</span>
    <span class="c">#@@c</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.contractBodyPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.contractBodyPane">[docs]</a>    <span class="k">def</span> <span class="nf">contractBodyPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Contract the body pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">ratio</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.contractLogPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.contractLogPane">[docs]</a>    <span class="k">def</span> <span class="nf">contractLogPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Contract the log pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">secondary_ratio</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span> <span class="c"># 2010/02/23: was f.ratio</span>
        <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.contractOutlinePane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.contractOutlinePane">[docs]</a>    <span class="k">def</span> <span class="nf">contractOutlinePane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Contract the outline pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">ratio</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.expandBodyPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.expandBodyPane">[docs]</a>    <span class="k">def</span> <span class="nf">expandBodyPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Expand the body pane.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contractOutlinePane</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.expandLogPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.expandLogPane">[docs]</a>    <span class="k">def</span> <span class="nf">expandLogPane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Expand the log pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">secondary_ratio</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span> <span class="c"># 2010/02/23: was f.ratio</span>
        <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.expandOutlinePane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.expandOutlinePane">[docs]</a>    <span class="k">def</span> <span class="nf">expandOutlinePane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Expand the outline pane.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contractBodyPane</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.229: *6* fullyExpand/hide...Pane</span></div>
<div class="viewcode-block" id="leoTkinterFrame.fullyExpandBodyPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.fullyExpandBodyPane">[docs]</a>    <span class="k">def</span> <span class="nf">fullyExpandBodyPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fully expand the body pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.fullyExpandLogPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.fullyExpandLogPane">[docs]</a>    <span class="k">def</span> <span class="nf">fullyExpandLogPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fully expand the log pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.fullyExpandOutlinePane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.fullyExpandOutlinePane">[docs]</a>    <span class="k">def</span> <span class="nf">fullyExpandOutlinePane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fully expand the outline pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.hideBodyPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.hideBodyPane">[docs]</a>    <span class="k">def</span> <span class="nf">hideBodyPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Completely contract the body pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.hideLogPane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.hideLogPane">[docs]</a>    <span class="k">def</span> <span class="nf">hideLogPane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Completely contract the log pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.hideOutlinePane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.hideOutlinePane">[docs]</a>    <span class="k">def</span> <span class="nf">hideOutlinePane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Completely contract the outline pane.&#39;&#39;&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">divideLeoSplitter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.230: *5* Window Menu...</span>
    <span class="c">#@+node:ekr.20081121110412.231: *6* toggleActivePane (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.toggleActivePane"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.toggleActivePane">[docs]</a>    <span class="k">def</span> <span class="nf">toggleActivePane</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Toggle the focus between the outline and body panes.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">get_focus</span><span class="p">()</span> <span class="o">==</span> <span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span><span class="p">:</span> <span class="c"># 2007/10/25</span>
            <span class="n">c</span><span class="o">.</span><span class="n">treeWantsFocus</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">endEditing</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.232: *6* cascade</span></div>
<div class="viewcode-block" id="leoTkinterFrame.cascade"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.cascade">[docs]</a>    <span class="k">def</span> <span class="nf">cascade</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Cascade all Leo windows.&#39;&#39;&#39;</span>

        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">delta</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowList</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">top</span>

            <span class="c"># Compute w,h</span>
            <span class="n">top</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span> <span class="c"># Required to get proper info.</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span> <span class="c"># geom = &quot;WidthxHeight+XOffset+YOffset&quot;</span>
            <span class="n">dim</span><span class="p">,</span><span class="n">junkx</span><span class="p">,</span><span class="n">junky</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

            <span class="c"># Set new x,y and old w,h</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">setTopGeometry</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">adjustSize</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="c"># Compute the new offsets.</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="mi">30</span> <span class="p">;</span> <span class="n">y</span> <span class="o">+=</span> <span class="mi">30</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">delta</span> <span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="n">delta</span>
                <span class="n">delta</span> <span class="o">+=</span> <span class="mi">10</span>
    <span class="c">#@+node:ekr.20081121110412.233: *6* equalSizedPanes</span></div>
<div class="viewcode-block" id="leoTkinterFrame.equalSizedPanes"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.equalSizedPanes">[docs]</a>    <span class="k">def</span> <span class="nf">equalSizedPanes</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Make the outline and body panes have the same size.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">resizePanesToRatio</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">frame</span><span class="o">.</span><span class="n">secondary_ratio</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.234: *6* hideLogWindow</span></div>
<div class="viewcode-block" id="leoTkinterFrame.hideLogWindow"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.hideLogWindow">[docs]</a>    <span class="k">def</span> <span class="nf">hideLogWindow</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">divideLeoSplitter2</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="ow">not</span> <span class="n">frame</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.235: *6* minimizeAll</span></div>
<div class="viewcode-block" id="leoTkinterFrame.minimizeAll"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.minimizeAll">[docs]</a>    <span class="k">def</span> <span class="nf">minimizeAll</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Minimize all Leo&#39;s windows.&#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">pythonFrame</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.minimize"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.minimize">[docs]</a>    <span class="k">def</span> <span class="nf">minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">frame</span> <span class="ow">and</span> <span class="n">frame</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">state</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;normal&quot;</span><span class="p">:</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">iconify</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.236: *6* toggleSplitDirection (tkFrame)</span>
    <span class="c"># The key invariant: self.splitVerticalFlag tells the alignment of the main splitter.</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.toggleSplitDirection"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.toggleSplitDirection">[docs]</a>    <span class="k">def</span> <span class="nf">toggleSplitDirection</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Toggle the split direction in the present Leo window.&#39;&#39;&#39;</span>

        <span class="c"># Switch directions.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c"># The key invariant: self.splitVerticalFlag</span>
        <span class="c"># tells the alignment of the main splitter.</span>
        <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span>
        <span class="n">f</span><span class="o">.</span><span class="n">toggleTkSplitDirection</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">splitVerticalFlag</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.237: *7* toggleTkSplitDirection</span></div>
<div class="viewcode-block" id="leoTkinterFrame.toggleTkSplitDirection"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.toggleTkSplitDirection">[docs]</a>    <span class="k">def</span> <span class="nf">toggleTkSplitDirection</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">):</span>

        <span class="c"># Abbreviations.</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">bar1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar1</span> <span class="p">;</span> <span class="n">bar2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar2</span>
        <span class="n">split1Pane1</span><span class="p">,</span><span class="n">split1Pane2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split1Pane1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">split1Pane2</span>
        <span class="n">split2Pane1</span><span class="p">,</span><span class="n">split2Pane2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split2Pane1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">split2Pane2</span>
        <span class="c"># Reconfigure the bars.</span>
        <span class="n">bar1</span><span class="o">.</span><span class="n">place_forget</span><span class="p">()</span>
        <span class="n">bar2</span><span class="o">.</span><span class="n">place_forget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configureBar</span><span class="p">(</span><span class="n">bar1</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configureBar</span><span class="p">(</span><span class="n">bar2</span><span class="p">,</span><span class="ow">not</span> <span class="n">verticalFlag</span><span class="p">)</span>
        <span class="c"># Make the initial placements again.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placeSplitter</span><span class="p">(</span><span class="n">bar1</span><span class="p">,</span><span class="n">split1Pane1</span><span class="p">,</span><span class="n">split1Pane2</span><span class="p">,</span><span class="n">verticalFlag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placeSplitter</span><span class="p">(</span><span class="n">bar2</span><span class="p">,</span><span class="n">split2Pane1</span><span class="p">,</span><span class="n">split2Pane2</span><span class="p">,</span><span class="ow">not</span> <span class="n">verticalFlag</span><span class="p">)</span>
        <span class="c"># Adjust the log and body panes to give more room around the bars.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconfigurePanes</span><span class="p">()</span>
        <span class="c"># Redraw with an appropriate ratio.</span>
        <span class="n">vflag</span><span class="p">,</span><span class="n">ratio</span><span class="p">,</span><span class="n">secondary_ratio</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">initialRatios</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resizePanesToRatio</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span><span class="n">secondary_ratio</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.238: *6* resizeToScreen</span></div>
<div class="viewcode-block" id="leoTkinterFrame.resizeToScreen"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.resizeToScreen">[docs]</a>    <span class="k">def</span> <span class="nf">resizeToScreen</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Resize the Leo window so it fill the entire screen.&#39;&#39;&#39;</span>

        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_screenwidth</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_screenheight</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
            <span class="n">top</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="s">&#39;zoomed&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">:</span>
            <span class="c"># Must leave room to get at very small resizing area.</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">x</span><span class="si">%d%+d%+d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="n">h</span><span class="o">-</span><span class="mi">55</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
            <span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Fill almost the entire screen.</span>
            <span class="c"># Works on Windows. YMMV for other platforms.</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">x</span><span class="si">%d%+d%+d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="n">h</span><span class="o">-</span><span class="mi">46</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">top</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.239: *5* Help Menu...</span>
    <span class="c">#@+node:ekr.20081121110412.240: *6* leoHelp</span></div>
<div class="viewcode-block" id="leoTkinterFrame.leoHelp"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.leoHelp">[docs]</a>    <span class="k">def</span> <span class="nf">leoHelp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Open Leo&#39;s offline tutorial.&#39;&#39;&#39;</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>

        <span class="n">theFile</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&quot;..&quot;</span><span class="p">,</span><span class="s">&quot;doc&quot;</span><span class="p">,</span><span class="s">&quot;sbooks.chm&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_exists</span><span class="p">(</span><span class="n">theFile</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">theFile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">runAskYesNoDialog</span><span class="p">(</span><span class="n">c</span><span class="p">,</span>
                <span class="s">&quot;Download Tutorial?&quot;</span><span class="p">,</span>
                <span class="s">&quot;Download tutorial (sbooks.chm) from SourceForge?&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s">&quot;yes&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Download directly.  (showProgressBar needs a lot of work)</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://umn.dl.sourceforge.net/sourceforge/leo/sbooks.chm&quot;</span>
                        <span class="kn">import</span> <span class="nn">urllib</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">theFile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">showProgressBar</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://prdownloads.sourceforge.net/leo/sbooks.chm?download&quot;</span>
                        <span class="kn">import</span> <span class="nn">webbrowser</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">)</span>
                        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception downloading&quot;</span><span class="p">,</span><span class="s">&quot;sbooks.chm&quot;</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.241: *7* showProgressBar</span></div>
<div class="viewcode-block" id="leoTkinterFrame.showProgressBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.showProgressBar">[docs]</a>    <span class="k">def</span> <span class="nf">showProgressBar</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">total</span><span class="p">):</span>

        <span class="c"># g.trace(&quot;count,size,total:&quot;,count,size,total)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; create the scale widget &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.242: *8* &lt;&lt; create the scale widget &gt;&gt;</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">()</span>
            <span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Download progress&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">top</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">,</span><span class="n">from_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="n">total</span><span class="p">)</span>
            <span class="n">scale</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
            <span class="n">top</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
            <span class="c">#@-&lt;&lt; create the scale widget &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">count</span><span class="o">*</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.243: *4* Delayed Focus (tkFrame)</span>
    <span class="c">#@+at New in 4.3. The proper way to change focus is to call c.frame.xWantsFocus.</span>
    <span class="c"># </span>
    <span class="c"># Important: This code never calls select, so there can be no race condition here</span>
    <span class="c"># that alters text improperly.</span>
    <span class="c">#@+node:ekr.20081121110412.244: *4* Tk bindings... (tkFrame)</span></div>
<div class="viewcode-block" id="leoTkinterFrame.bringToFront"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.bringToFront">[docs]</a>    <span class="k">def</span> <span class="nf">bringToFront</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># g.trace(g.callers())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.getFocus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.getFocus">[docs]</a>    <span class="k">def</span> <span class="nf">getFocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the widget that has focus, or body if None.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># This method is unreliable while focus is changing.</span>
            <span class="c"># The call to update_idletasks may help.  Or not.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">focus_displayof</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span> <span class="c"># 2007/10/25</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.getTitle"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.getTitle">[docs]</a>    <span class="k">def</span> <span class="nf">getTitle</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.setTitle"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.setTitle">[docs]</a>    <span class="k">def</span> <span class="nf">setTitle</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.get_window_info"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.get_window_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_window_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">get_window_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.iconify"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.iconify">[docs]</a>    <span class="k">def</span> <span class="nf">iconify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">iconify</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.deiconify"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.deiconify">[docs]</a>    <span class="k">def</span> <span class="nf">deiconify</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">deiconify</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.lift"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.lift">[docs]</a>    <span class="k">def</span> <span class="nf">lift</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterFrame.update"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterFrame.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.245: *3* class leoTkinterLog</span></div></div>
<div class="viewcode-block" id="leoTkinterLog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterLog</span> <span class="p">(</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">leoLog</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;A class that represents the log pane of a Tkinter window.&quot;&quot;&quot;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.246: *4* tkLog Birth</span>
    <span class="c">#@+node:ekr.20081121110412.247: *5* tkLog.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="c"># g.trace(&quot;leoTkinterLog&quot;)</span>

        <span class="c"># Call the base class constructor and calls createControl.</span>
        <span class="n">leoFrame</span><span class="o">.</span><span class="n">leoLog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span> <span class="c"># Also set in the base constructor, but we need it here.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># The list of color names used as tags in present tab.</span>
            <span class="c"># This gest switched by selectTab.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;log_pane_wraps&#39;</span><span class="p">),</span><span class="s">&quot;word&quot;</span><span class="p">,</span><span class="s">&quot;none&quot;</span><span class="p">)</span>

        <span class="c"># New in 4.4a2: The log pane is a Pmw.Notebook...</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">=</span> <span class="bp">None</span>      <span class="c"># The Pmw.Notebook that holds all the tabs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorTagsDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Keys are page names.  Values are saved colorTags lists.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># A menu that pops up on right clicks in the hull or in tabs.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createControl</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFontFromConfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setColorFromConfig</span><span class="p">()</span>



    <span class="c">#@+node:ekr.20081121110412.248: *5* tkLog.createControl</span>
<div class="viewcode-block" id="leoTkinterLog.createControl"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createControl">[docs]</a>    <span class="k">def</span> <span class="nf">createControl</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">NoteBook</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span>
            <span class="n">borderwidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pagemargin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">raisecommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raiseTab</span><span class="p">,</span>
            <span class="n">lowercommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerTab</span><span class="p">,</span>
            <span class="n">arrownavigation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeTabMenu</span><span class="p">(</span><span class="n">tabName</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">hullMenuCallback</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onRightClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">menu</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span><span class="n">hullMenuCallback</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span> <span class="c"># Create and activate the default tabs.</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>
    <span class="c">#@+node:ekr.20081121110412.249: *5* tkLog.finishCreate</span></div>
<div class="viewcode-block" id="leoTkinterLog.finishCreate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.finishCreate">[docs]</a>    <span class="k">def</span> <span class="nf">finishCreate</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;tkLog&#39;)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">c</span><span class="o">.</span><span class="n">searchCommands</span><span class="o">.</span><span class="n">openFindTab</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">spellCommands</span><span class="o">.</span><span class="n">openSpellTab</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.250: *5* tkLog.createCanvasWidget</span></div>
<div class="viewcode-block" id="leoTkinterLog.createCanvasWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createCanvasWidget">[docs]</a>    <span class="k">def</span> <span class="nf">createCanvasWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logNumber</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">)</span>

        <span class="n">logBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;logBar&quot;</span><span class="p">)</span>
        <span class="n">w</span><span class="p">[</span><span class="s">&#39;yscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logBar</span><span class="o">.</span><span class="n">set</span>
        <span class="n">logBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">yview</span>
        <span class="n">logBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>

        <span class="n">logXBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;logXBar&#39;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">)</span> 
        <span class="n">w</span><span class="p">[</span><span class="s">&#39;xscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logXBar</span><span class="o">.</span><span class="n">set</span> 
        <span class="n">logXBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">xview</span> 
        <span class="n">logXBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>

        <span class="n">w</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="c"># Set the background color.</span>
        <span class="n">configName</span> <span class="o">=</span> <span class="s">&#39;log_canvas_pane_tab_background_color&#39;</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">configName</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;MistyRose1&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span> <span class="k">pass</span> <span class="c"># Could be a user error.</span>

        <span class="k">return</span> <span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.251: *5* tkLog.createTextWidget</span></div>
<div class="viewcode-block" id="leoTkinterLog.createTextWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createTextWidget">[docs]</a>    <span class="k">def</span> <span class="nf">createTextWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logNumber</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
            <span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;log-</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">logNumber</span><span class="p">,</span>
            <span class="n">setgrid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;flat&quot;</span><span class="p">)</span>

        <span class="n">logBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;logBar&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="p">[</span><span class="s">&#39;yscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logBar</span><span class="o">.</span><span class="n">set</span>
        <span class="n">logBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">yview</span>

        <span class="n">logBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
        <span class="c"># rr 8/14/02 added horizontal elevator </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap</span> <span class="o">==</span> <span class="s">&quot;none&quot;</span><span class="p">:</span> 
            <span class="n">logXBar</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span> 
                <span class="n">parentFrame</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;logXBar&#39;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">)</span> 
            <span class="n">log</span><span class="p">[</span><span class="s">&#39;xscrollcommand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logXBar</span><span class="o">.</span><span class="n">set</span> 
            <span class="n">logXBar</span><span class="p">[</span><span class="s">&#39;command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">xview</span> 
            <span class="n">logXBar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&quot;both&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">log</span>
    <span class="c">#@+node:ekr.20081121110412.252: *5* tkLog.makeTabMenu</span></div>
<div class="viewcode-block" id="leoTkinterLog.makeTabMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.makeTabMenu">[docs]</a>    <span class="k">def</span> <span class="nf">makeTabMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">allowRename</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create a tab popup menu.&#39;&#39;&#39;</span>

        <span class="c"># g.trace(tabName,g.callers())</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">hull</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s">&#39;hull&#39;</span><span class="p">)</span> <span class="c"># A Tk.Canvas.</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">hull</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;New Tab&#39;</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">newTabFromMenu</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;New CanvasTab&#39;</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">newCanvasTabFromMenu</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tabName</span><span class="p">:</span>
            <span class="c"># Important: tabName is the name when the tab is created.</span>
            <span class="c"># It is not affected by renaming, so we don&#39;t have to keep</span>
            <span class="c"># track of the correspondence between this name and what is in the label.</span>
            <span class="k">def</span> <span class="nf">deleteTabCallback</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

            <span class="n">label</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span>
                <span class="n">tabName</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Find&#39;</span><span class="p">,</span><span class="s">&#39;Spell&#39;</span><span class="p">),</span><span class="s">&#39;Hide This Tab&#39;</span><span class="p">,</span><span class="s">&#39;Delete This Tab&#39;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">deleteTabCallback</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">renameTabCallback</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renameTabFromMenu</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">allowRename</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Rename This Tab&#39;</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">renameTabCallback</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">menu</span>
    <span class="c">#@+node:ekr.20081121110412.253: *4* Config &amp; get/saveState</span>
    <span class="c">#@+node:ekr.20081121110412.254: *5* tkLog.configureBorder &amp; configureFont</span></div>
<div class="viewcode-block" id="leoTkinterLog.configureBorder"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.configureBorder">[docs]</a>    <span class="k">def</span> <span class="nf">configureBorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">border</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bd</span><span class="o">=</span><span class="n">border</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterLog.configureFont"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.configureFont">[docs]</a>    <span class="k">def</span> <span class="nf">configureFont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">font</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.255: *5* tkLog.getFontConfig</span></div>
<div class="viewcode-block" id="leoTkinterLog.getFontConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.getFontConfig">[docs]</a>    <span class="k">def</span> <span class="nf">getFontConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;font&quot;</span><span class="p">)</span>
        <span class="c"># g.trace(font)</span>
        <span class="k">return</span> <span class="n">font</span>
    <span class="c">#@+node:ekr.20081121110412.256: *5* tkLog.restoreAllState</span></div>
<div class="viewcode-block" id="leoTkinterLog.restoreAllState"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.restoreAllState">[docs]</a>    <span class="k">def</span> <span class="nf">restoreAllState</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Restore the log from a dict created by saveAllState.&#39;&#39;&#39;</span>

        <span class="n">logCtrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>

        <span class="c"># Restore the text.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">)</span>
        <span class="n">logCtrl</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>

        <span class="c"># Restore all colors.</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;colors&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                <span class="n">logCtrl</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="n">foreground</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
            <span class="k">while</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span><span class="n">stop</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">logCtrl</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.257: *5* tkLog.saveAllState</span></div>
<div class="viewcode-block" id="leoTkinterLog.saveAllState"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.saveAllState">[docs]</a>    <span class="k">def</span> <span class="nf">saveAllState</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return a dict containing all data needed to recreate the log in another widget.&#39;&#39;&#39;</span>

        <span class="n">logCtrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span> <span class="p">;</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Save the text</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">logCtrl</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>

        <span class="c"># Save color tags.</span>
        <span class="n">tag_names</span> <span class="o">=</span> <span class="n">logCtrl</span><span class="o">.</span><span class="n">tag_names</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tag_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="p">:</span>
                <span class="n">colors</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">logCtrl</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:</span><span class="n">text</span><span class="p">,</span><span class="s">&#39;colors&#39;</span><span class="p">:</span> <span class="n">colors</span><span class="p">}</span>
        <span class="c"># g.trace(&#39;\n&#39;,g.dictToString(d))</span>
        <span class="k">return</span> <span class="n">d</span>
    <span class="c">#@+node:ekr.20081121110412.258: *5* tkLog.setColorFromConfig</span></div>
<div class="viewcode-block" id="leoTkinterLog.setColorFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.setColorFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">setColorFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;log_pane_background_color&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting log pane background color&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.259: *5* tkLog.setFontFromConfig</span></div>
<div class="viewcode-block" id="leoTkinterLog.SetWidgetFontFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.SetWidgetFontFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">SetWidgetFontFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">logCtrl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">logCtrl</span><span class="p">:</span> <span class="n">logCtrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>

        <span class="n">font</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span>
            <span class="s">&quot;log_text_font_family&quot;</span><span class="p">,</span> <span class="s">&quot;log_text_font_size&quot;</span><span class="p">,</span>
            <span class="s">&quot;log_text_font_slant&quot;</span><span class="p">,</span> <span class="s">&quot;log_text_font_weight&quot;</span><span class="p">,</span>
            <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultLogFontSize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fontRef</span> <span class="o">=</span> <span class="n">font</span> <span class="c"># ESSENTIAL: retain a link to font.</span>
        <span class="n">logCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>

        <span class="c"># g.trace(&quot;LOG&quot;,logCtrl.cget(&quot;font&quot;),font.cget(&quot;family&quot;),font.cget(&quot;weight&quot;))</span>

        <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;log_text_background_color&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">logCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="s">&quot;log_text_foreground_color&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">logCtrl</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">fg</span><span class="o">=</span><span class="n">fg</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</div>
    <span class="n">setFontFromConfig</span> <span class="o">=</span> <span class="n">SetWidgetFontFromConfig</span> <span class="c"># Renaming supresses a pychecker warning.</span>
    <span class="c">#@+node:ekr.20081121110412.260: *4* Focus &amp; update (tkLog)</span>
    <span class="c">#@+node:ekr.20081121110412.261: *5* tkLog.onActivateLog</span>
<div class="viewcode-block" id="leoTkinterLog.onActivateLog"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.onActivateLog">[docs]</a>    <span class="k">def</span> <span class="nf">onActivateLog</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">OnDeactivate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">logWantsFocus</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;activate log&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.262: *5* tkLog.hasFocus</span></div>
<div class="viewcode-block" id="leoTkinterLog.hasFocus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.hasFocus">[docs]</a>    <span class="k">def</span> <span class="nf">hasFocus</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">get_focus</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>
    <span class="c">#@+node:ekr.20081121110412.263: *5* forceLogUpdate</span></div>
<div class="viewcode-block" id="leoTkinterLog.forceLogUpdate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.forceLogUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">forceLogUpdate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span><span class="p">:</span> <span class="c"># Does not work on MacOS X.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">newline</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># Don&#39;t add a newline.</span>
            <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
                <span class="c"># g.app may not be inited during scripts!</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">toEncodedString</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.264: *4* put &amp; putnl (tkLog)</span>
    <span class="c">#@+at Printing uses self.logCtrl, so this code need not concern itself</span>
    <span class="c"># with which tab is active.</span>
    <span class="c"># </span>
    <span class="c"># Also, selectTab switches the contents of colorTags, so that is not concern.</span>
    <span class="c"># It may be that Pmw will allow us to dispense with the colorTags logic...</span>
    <span class="c">#@+node:ekr.20081121110412.265: *5* put</span>
    <span class="c"># All output to the log stream eventually comes here.</span></div>
<div class="viewcode-block" id="leoTkinterLog.put"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="s">&#39;Log&#39;</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># g.pr(&#39;tkLog.put&#39;,s)</span>
        <span class="c"># g.pr(&#39;tkLog.put&#39;,len(s),g.callers())</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quitting</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">tabName</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="c"># Note: this must be done after the call to selectTab.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>
        <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; put s to log control &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.266: *6* &lt;&lt; put s to log control &gt;&gt;</span>
            <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="n">foreground</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="s">&quot;end-</span><span class="si">%d</span><span class="s">c&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&quot;end-1c&quot;</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

            <span class="n">w</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceLogUpdate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; put s to log control &gt;&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; put s to logWaiting and print s &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.267: *6* &lt;&lt; put s to logWaiting and print s &gt;&gt;</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">logWaiting</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span><span class="n">color</span><span class="p">),)</span>

            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;Null tkinter log&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">isUnicode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toEncodedString</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;ascii&quot;</span><span class="p">)</span>

            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; put s to logWaiting and print s &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.268: *5* putnl</span></div>
<div class="viewcode-block" id="leoTkinterLog.putnl"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.putnl">[docs]</a>    <span class="k">def</span> <span class="nf">putnl</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="s">&#39;Log&#39;</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quitting</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># g.pr(&#39;tkLog.putnl&#39; # ,g.callers())</span>

        <span class="k">if</span> <span class="n">tabName</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>

        <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceLogUpdate</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Put a newline to logWaiting and print newline</span>
            <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">logWaiting</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&quot;black&quot;</span><span class="p">),)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;Null tkinter log&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.269: *4* Tab (TkLog)</span>
    <span class="c">#@+node:ekr.20081121110412.270: *5* clearTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.clearTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.clearTab">[docs]</a>    <span class="k">def</span> <span class="nf">clearTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="n">wrap</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span>
        <span class="k">if</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.271: *5* createCanvas</span></div>
<div class="viewcode-block" id="leoTkinterLog.createCanvas"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createCanvas">[docs]</a>    <span class="k">def</span> <span class="nf">createCanvas</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logNumber</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">tabName</span> <span class="o">=</span> <span class="s">&#39;Canvas </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">logNumber</span>

        <span class="n">tabFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeTabMenu</span><span class="p">(</span><span class="n">tabName</span><span class="p">,</span><span class="n">allowRename</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createCanvasWidget</span><span class="p">(</span><span class="n">tabFrame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvasDict</span> <span class="p">[</span><span class="n">tabName</span> <span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabFrame</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCanvasTabBindings</span><span class="p">(</span><span class="n">tabName</span><span class="p">,</span><span class="n">menu</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.272: *5* createTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.createTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createTab">[docs]</a>    <span class="k">def</span> <span class="nf">createTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="n">createText</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">):</span>

        <span class="c"># g.trace(tabName,wrap)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="n">tabFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeTabMenu</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createText</span><span class="p">:</span>
            <span class="c">#@+&lt;&lt; Create the tab&#39;s text widget &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.273: *6* &lt;&lt; Create the tab&#39;s text widget &gt;&gt;</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTextWidget</span><span class="p">(</span><span class="n">tabFrame</span><span class="p">)</span>

            <span class="c"># Set the background color.</span>
            <span class="n">configName</span> <span class="o">=</span> <span class="s">&#39;log_pane_</span><span class="si">%s</span><span class="s">_tab_background_color&#39;</span> <span class="o">%</span> <span class="n">tabName</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">configName</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;MistyRose1&#39;</span>

            <span class="k">if</span> <span class="n">wrap</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;char&#39;</span><span class="p">,</span><span class="s">&#39;word&#39;</span><span class="p">):</span> <span class="n">wrap</span> <span class="o">=</span> <span class="s">&#39;none&#39;</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="n">wrap</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span> <span class="k">pass</span> <span class="c"># Could be a user error.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SetWidgetFontFromConfig</span><span class="p">(</span><span class="n">logCtrl</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">canvasDict</span> <span class="p">[</span><span class="n">tabName</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabFrame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>

            <span class="c"># Switch to a new colorTags list.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabName</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorTagsDict</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span> <span class="p">[:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;black&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorTagsDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span>
            <span class="c">#@-&lt;&lt; Create the tab&#39;s text widget &gt;&gt;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabFrame</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="o">!=</span> <span class="s">&#39;Log&#39;</span><span class="p">:</span>
            <span class="c"># c.k doesn&#39;t exist when the log pane is created.</span>
            <span class="c"># k.makeAllBindings will call setTabBindings(&#39;Log&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTabBindings</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.274: *5* cycleTabFocus</span></div>
<div class="viewcode-block" id="leoTkinterLog.cycleTabFocus"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.cycleTabFocus">[docs]</a>    <span class="k">def</span> <span class="nf">cycleTabFocus</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">stop_w</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Cycle keyboard focus between the tabs in the log pane.&#39;&#39;&#39;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span> <span class="c"># Keys are page names. Values are Tk.Frames.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabName</span><span class="p">)</span>
        <span class="c"># g.trace(self.tabName,w)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfVisibleTabs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tabName</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
            <span class="k">return</span> 
    <span class="c">#@+node:ekr.20081121110412.275: *5* deleteTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.deleteTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.deleteTab">[docs]</a>    <span class="k">def</span> <span class="nf">deleteTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="o">==</span> <span class="s">&#39;Log&#39;</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">tabName</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Find&#39;</span><span class="p">,</span><span class="s">&#39;Spell&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">tabName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">pagenames</span><span class="p">():</span>
            <span class="c"># g.trace(tabName,force)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorTagsDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasDict</span> <span class="p">[</span><span class="n">tabName</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span> <span class="p">[</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabName</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span>

        <span class="c"># New in Leo 4.4b1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">invalidateFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.276: *5* hideTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.hideTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.hideTab">[docs]</a>    <span class="k">def</span> <span class="nf">hideTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.277: *5* getSelectedTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.getSelectedTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.getSelectedTab">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectedTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabName</span>
    <span class="c">#@+node:ekr.20081121110412.278: *5* lower/raiseTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.lowerTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.lowerTab">[docs]</a>    <span class="k">def</span> <span class="nf">lowerTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">tabName</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span> <span class="c"># b is a Tk.Button.</span>
            <span class="n">b</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;grey80&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">invalidateFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="leoTkinterLog.raiseTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.raiseTab">[docs]</a>    <span class="k">def</span> <span class="nf">raiseTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">tabName</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span> <span class="c"># b is a Tk.Button.</span>
            <span class="n">b</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;LightSteelBlue1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">invalidateFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.279: *5* numberOfVisibleTabs</span></div>
<div class="viewcode-block" id="leoTkinterLog.numberOfVisibleTabs"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.numberOfVisibleTabs">[docs]</a>    <span class="k">def</span> <span class="nf">numberOfVisibleTabs</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">])</span>
    <span class="c">#@+node:ekr.20081121110412.280: *5* renameTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.renameTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.renameTab">[docs]</a>    <span class="k">def</span> <span class="nf">renameTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">oldName</span><span class="p">,</span><span class="n">newName</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;newName&#39;,newName)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">oldName</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">newName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.281: *5* selectTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.selectTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.selectTab">[docs]</a>    <span class="k">def</span> <span class="nf">selectTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="n">createText</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create the tab if necessary and make it active.&#39;&#39;&#39;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">tabFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">logCtrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tabFrame</span> <span class="ow">and</span> <span class="n">logCtrl</span><span class="p">:</span>
            <span class="c"># Switch to a new colorTags list.</span>
            <span class="n">newColorTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTagsDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorTagsDict</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tabName</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span> <span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorTags</span> <span class="o">=</span> <span class="n">newColorTags</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">tabFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">,</span><span class="n">createText</span><span class="o">=</span><span class="n">createText</span><span class="p">,</span><span class="n">wrap</span><span class="o">=</span><span class="n">wrap</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">selectpage</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="c"># Update the status vars.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabName</span> <span class="o">=</span> <span class="n">tabName</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">w</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabFrame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Absolutely do not do this here!  It is a cause of the &#39;sticky focus&#39; problem.</span>
            <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocusNow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logCtrl</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tabFrame</span>
    <span class="c">#@+node:ekr.20081121110412.282: *5* setTabBindings</span></div>
<div class="viewcode-block" id="leoTkinterLog.setTabBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.setTabBindings">[docs]</a>    <span class="k">def</span> <span class="nf">setTabBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">logTextRightClickCallback</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">masterClick3Handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onLogTextRightClick</span><span class="p">)</span>


        <span class="c"># Send all event in the text area to the master handlers.</span>
        <span class="k">for</span> <span class="n">kind</span><span class="p">,</span><span class="n">handler</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span>       <span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>  <span class="n">logTextRightClickCallback</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">handler</span><span class="p">)</span>

        <span class="c"># Clicks in the tab area are harmless: use the old code.</span>
        <span class="k">def</span> <span class="nf">tabMenuRightClickCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onRightClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">menu</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">tabMenuClickCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="n">tabName</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">tabName</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span><span class="n">tabMenuClickCallback</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span><span class="n">tabMenuRightClickCallback</span><span class="p">)</span>

        <span class="n">k</span><span class="o">.</span><span class="n">completeAllBindingsForWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.283: *5* onLogTextRightClick</span></div>
<div class="viewcode-block" id="leoTkinterLog.onLogTextRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.onLogTextRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onLogTextRightClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&#39;rclick-popup&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">context_menu</span><span class="o">=</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.284: *5* setCanvasTabBindings</span></div>
<div class="viewcode-block" id="leoTkinterLog.setCanvasTabBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.setCanvasTabBindings">[docs]</a>    <span class="k">def</span> <span class="nf">setCanvasTabBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="n">menu</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">tab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">tabMenuRightClickCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onRightClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">menu</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">tabMenuClickCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="n">tabName</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClick</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">tabName</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span><span class="n">tabMenuClickCallback</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span><span class="n">tabMenuRightClickCallback</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20081121110412.285: *5* Tab menu callbacks &amp; helpers</span>
    <span class="c">#@+node:ekr.20081121110412.286: *6* onRightClick &amp; onClick</span></div>
<div class="viewcode-block" id="leoTkinterLog.onRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.onRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onRightClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">menu</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="leoTkinterLog.onClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.onClick">[docs]</a>    <span class="k">def</span> <span class="nf">onClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.287: *6* newTabFromMenu &amp; newCanvasTabFromMenu</span></div>
<div class="viewcode-block" id="leoTkinterLog.newTabFromMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.newTabFromMenu">[docs]</a>    <span class="k">def</span> <span class="nf">newTabFromMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="o">=</span><span class="s">&#39;Log&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="c"># This is called by getTabName.</span>
        <span class="k">def</span> <span class="nf">selectTabCallback</span> <span class="p">(</span><span class="n">newName</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="n">newName</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">getTabName</span><span class="p">(</span><span class="n">selectTabCallback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterLog.newCanvasTabFromMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.newCanvasTabFromMenu">[docs]</a>    <span class="k">def</span> <span class="nf">newCanvasTabFromMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createCanvas</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.288: *6* renameTabFromMenu</span></div>
<div class="viewcode-block" id="leoTkinterLog.renameTabFromMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.renameTabFromMenu">[docs]</a>    <span class="k">def</span> <span class="nf">renameTabFromMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">,</span><span class="s">&#39;Completions&#39;</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;can not rename&#39;</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="s">&#39;tab&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">renameTabCallback</span> <span class="p">(</span><span class="n">newName</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">renameTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">,</span><span class="n">newName</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">getTabName</span><span class="p">(</span><span class="n">renameTabCallback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.289: *6* getTabName</span></div>
<div class="viewcode-block" id="leoTkinterLog.getTabName"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.getTabName">[docs]</a>    <span class="k">def</span> <span class="nf">getTabName</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exitCallback</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s">&#39;hull&#39;</span><span class="p">)</span>

        <span class="c"># Overlay what is there!</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">row1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">row1</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">row2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">row2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>

        <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">row1</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Tab name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">e</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">row1</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">e</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">getNameCallback</span> <span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">:</span> <span class="n">exitCallback</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">closeTabNameCallback</span> <span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">row2</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Ok&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">getNameCallback</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">row2</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Cancel&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">closeTabNameCallback</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">set_focus</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="s">&#39;&lt;Return&gt;&#39;</span><span class="p">,</span><span class="n">getNameCallback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.290: *4* tkLog color tab stuff</span></div>
<div class="viewcode-block" id="leoTkinterLog.createColorPicker"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createColorPicker">[docs]</a>    <span class="k">def</span> <span class="nf">createColorPicker</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c">#@+&lt;&lt; define colors &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.291: *5* &lt;&lt; define colors &gt;&gt;</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;gray60&quot;</span><span class="p">,</span> <span class="s">&quot;gray70&quot;</span><span class="p">,</span> <span class="s">&quot;gray80&quot;</span><span class="p">,</span> <span class="s">&quot;gray85&quot;</span><span class="p">,</span> <span class="s">&quot;gray90&quot;</span><span class="p">,</span> <span class="s">&quot;gray95&quot;</span><span class="p">,</span>
            <span class="s">&quot;snow1&quot;</span><span class="p">,</span> <span class="s">&quot;snow2&quot;</span><span class="p">,</span> <span class="s">&quot;snow3&quot;</span><span class="p">,</span> <span class="s">&quot;snow4&quot;</span><span class="p">,</span> <span class="s">&quot;seashell1&quot;</span><span class="p">,</span> <span class="s">&quot;seashell2&quot;</span><span class="p">,</span>
            <span class="s">&quot;seashell3&quot;</span><span class="p">,</span> <span class="s">&quot;seashell4&quot;</span><span class="p">,</span> <span class="s">&quot;AntiqueWhite1&quot;</span><span class="p">,</span> <span class="s">&quot;AntiqueWhite2&quot;</span><span class="p">,</span> <span class="s">&quot;AntiqueWhite3&quot;</span><span class="p">,</span>
            <span class="s">&quot;AntiqueWhite4&quot;</span><span class="p">,</span> <span class="s">&quot;bisque1&quot;</span><span class="p">,</span> <span class="s">&quot;bisque2&quot;</span><span class="p">,</span> <span class="s">&quot;bisque3&quot;</span><span class="p">,</span> <span class="s">&quot;bisque4&quot;</span><span class="p">,</span> <span class="s">&quot;PeachPuff1&quot;</span><span class="p">,</span>
            <span class="s">&quot;PeachPuff2&quot;</span><span class="p">,</span> <span class="s">&quot;PeachPuff3&quot;</span><span class="p">,</span> <span class="s">&quot;PeachPuff4&quot;</span><span class="p">,</span> <span class="s">&quot;NavajoWhite1&quot;</span><span class="p">,</span> <span class="s">&quot;NavajoWhite2&quot;</span><span class="p">,</span>
            <span class="s">&quot;NavajoWhite3&quot;</span><span class="p">,</span> <span class="s">&quot;NavajoWhite4&quot;</span><span class="p">,</span> <span class="s">&quot;LemonChiffon1&quot;</span><span class="p">,</span> <span class="s">&quot;LemonChiffon2&quot;</span><span class="p">,</span>
            <span class="s">&quot;LemonChiffon3&quot;</span><span class="p">,</span> <span class="s">&quot;LemonChiffon4&quot;</span><span class="p">,</span> <span class="s">&quot;cornsilk1&quot;</span><span class="p">,</span> <span class="s">&quot;cornsilk2&quot;</span><span class="p">,</span> <span class="s">&quot;cornsilk3&quot;</span><span class="p">,</span>
            <span class="s">&quot;cornsilk4&quot;</span><span class="p">,</span> <span class="s">&quot;ivory1&quot;</span><span class="p">,</span> <span class="s">&quot;ivory2&quot;</span><span class="p">,</span> <span class="s">&quot;ivory3&quot;</span><span class="p">,</span> <span class="s">&quot;ivory4&quot;</span><span class="p">,</span> <span class="s">&quot;honeydew1&quot;</span><span class="p">,</span> <span class="s">&quot;honeydew2&quot;</span><span class="p">,</span>
            <span class="s">&quot;honeydew3&quot;</span><span class="p">,</span> <span class="s">&quot;honeydew4&quot;</span><span class="p">,</span> <span class="s">&quot;LavenderBlush1&quot;</span><span class="p">,</span> <span class="s">&quot;LavenderBlush2&quot;</span><span class="p">,</span>
            <span class="s">&quot;LavenderBlush3&quot;</span><span class="p">,</span> <span class="s">&quot;LavenderBlush4&quot;</span><span class="p">,</span> <span class="s">&quot;MistyRose1&quot;</span><span class="p">,</span> <span class="s">&quot;MistyRose2&quot;</span><span class="p">,</span>
            <span class="s">&quot;MistyRose3&quot;</span><span class="p">,</span> <span class="s">&quot;MistyRose4&quot;</span><span class="p">,</span> <span class="s">&quot;azure1&quot;</span><span class="p">,</span> <span class="s">&quot;azure2&quot;</span><span class="p">,</span> <span class="s">&quot;azure3&quot;</span><span class="p">,</span> <span class="s">&quot;azure4&quot;</span><span class="p">,</span>
            <span class="s">&quot;SlateBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;SlateBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;SlateBlue3&quot;</span><span class="p">,</span> <span class="s">&quot;SlateBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;RoyalBlue1&quot;</span><span class="p">,</span>
            <span class="s">&quot;RoyalBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;RoyalBlue3&quot;</span><span class="p">,</span> <span class="s">&quot;RoyalBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;blue1&quot;</span><span class="p">,</span> <span class="s">&quot;blue2&quot;</span><span class="p">,</span> <span class="s">&quot;blue3&quot;</span><span class="p">,</span> <span class="s">&quot;blue4&quot;</span><span class="p">,</span>
            <span class="s">&quot;DodgerBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;DodgerBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;DodgerBlue3&quot;</span><span class="p">,</span> <span class="s">&quot;DodgerBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;SteelBlue1&quot;</span><span class="p">,</span>
            <span class="s">&quot;SteelBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;SteelBlue3&quot;</span><span class="p">,</span> <span class="s">&quot;SteelBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;DeepSkyBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;DeepSkyBlue2&quot;</span><span class="p">,</span>
            <span class="s">&quot;DeepSkyBlue3&quot;</span><span class="p">,</span> <span class="s">&quot;DeepSkyBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;SkyBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;SkyBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;SkyBlue3&quot;</span><span class="p">,</span>
            <span class="s">&quot;SkyBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;LightSkyBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;LightSkyBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;LightSkyBlue3&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightSkyBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;SlateGray1&quot;</span><span class="p">,</span> <span class="s">&quot;SlateGray2&quot;</span><span class="p">,</span> <span class="s">&quot;SlateGray3&quot;</span><span class="p">,</span> <span class="s">&quot;SlateGray4&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightSteelBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;LightSteelBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;LightSteelBlue3&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightSteelBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;LightBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;LightBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;LightBlue3&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;LightCyan1&quot;</span><span class="p">,</span> <span class="s">&quot;LightCyan2&quot;</span><span class="p">,</span> <span class="s">&quot;LightCyan3&quot;</span><span class="p">,</span> <span class="s">&quot;LightCyan4&quot;</span><span class="p">,</span>
            <span class="s">&quot;PaleTurquoise1&quot;</span><span class="p">,</span> <span class="s">&quot;PaleTurquoise2&quot;</span><span class="p">,</span> <span class="s">&quot;PaleTurquoise3&quot;</span><span class="p">,</span> <span class="s">&quot;PaleTurquoise4&quot;</span><span class="p">,</span>
            <span class="s">&quot;CadetBlue1&quot;</span><span class="p">,</span> <span class="s">&quot;CadetBlue2&quot;</span><span class="p">,</span> <span class="s">&quot;CadetBlue3&quot;</span><span class="p">,</span> <span class="s">&quot;CadetBlue4&quot;</span><span class="p">,</span> <span class="s">&quot;turquoise1&quot;</span><span class="p">,</span>
            <span class="s">&quot;turquoise2&quot;</span><span class="p">,</span> <span class="s">&quot;turquoise3&quot;</span><span class="p">,</span> <span class="s">&quot;turquoise4&quot;</span><span class="p">,</span> <span class="s">&quot;cyan1&quot;</span><span class="p">,</span> <span class="s">&quot;cyan2&quot;</span><span class="p">,</span> <span class="s">&quot;cyan3&quot;</span><span class="p">,</span> <span class="s">&quot;cyan4&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkSlateGray1&quot;</span><span class="p">,</span> <span class="s">&quot;DarkSlateGray2&quot;</span><span class="p">,</span> <span class="s">&quot;DarkSlateGray3&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkSlateGray4&quot;</span><span class="p">,</span> <span class="s">&quot;aquamarine1&quot;</span><span class="p">,</span> <span class="s">&quot;aquamarine2&quot;</span><span class="p">,</span> <span class="s">&quot;aquamarine3&quot;</span><span class="p">,</span>
            <span class="s">&quot;aquamarine4&quot;</span><span class="p">,</span> <span class="s">&quot;DarkSeaGreen1&quot;</span><span class="p">,</span> <span class="s">&quot;DarkSeaGreen2&quot;</span><span class="p">,</span> <span class="s">&quot;DarkSeaGreen3&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkSeaGreen4&quot;</span><span class="p">,</span> <span class="s">&quot;SeaGreen1&quot;</span><span class="p">,</span> <span class="s">&quot;SeaGreen2&quot;</span><span class="p">,</span> <span class="s">&quot;SeaGreen3&quot;</span><span class="p">,</span> <span class="s">&quot;SeaGreen4&quot;</span><span class="p">,</span>
            <span class="s">&quot;PaleGreen1&quot;</span><span class="p">,</span> <span class="s">&quot;PaleGreen2&quot;</span><span class="p">,</span> <span class="s">&quot;PaleGreen3&quot;</span><span class="p">,</span> <span class="s">&quot;PaleGreen4&quot;</span><span class="p">,</span> <span class="s">&quot;SpringGreen1&quot;</span><span class="p">,</span>
            <span class="s">&quot;SpringGreen2&quot;</span><span class="p">,</span> <span class="s">&quot;SpringGreen3&quot;</span><span class="p">,</span> <span class="s">&quot;SpringGreen4&quot;</span><span class="p">,</span> <span class="s">&quot;green1&quot;</span><span class="p">,</span> <span class="s">&quot;green2&quot;</span><span class="p">,</span>
            <span class="s">&quot;green3&quot;</span><span class="p">,</span> <span class="s">&quot;green4&quot;</span><span class="p">,</span> <span class="s">&quot;chartreuse1&quot;</span><span class="p">,</span> <span class="s">&quot;chartreuse2&quot;</span><span class="p">,</span> <span class="s">&quot;chartreuse3&quot;</span><span class="p">,</span>
            <span class="s">&quot;chartreuse4&quot;</span><span class="p">,</span> <span class="s">&quot;OliveDrab1&quot;</span><span class="p">,</span> <span class="s">&quot;OliveDrab2&quot;</span><span class="p">,</span> <span class="s">&quot;OliveDrab3&quot;</span><span class="p">,</span> <span class="s">&quot;OliveDrab4&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkOliveGreen1&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOliveGreen2&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOliveGreen3&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkOliveGreen4&quot;</span><span class="p">,</span> <span class="s">&quot;khaki1&quot;</span><span class="p">,</span> <span class="s">&quot;khaki2&quot;</span><span class="p">,</span> <span class="s">&quot;khaki3&quot;</span><span class="p">,</span> <span class="s">&quot;khaki4&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightGoldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;LightGoldenrod2&quot;</span><span class="p">,</span> <span class="s">&quot;LightGoldenrod3&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightGoldenrod4&quot;</span><span class="p">,</span> <span class="s">&quot;LightYellow1&quot;</span><span class="p">,</span> <span class="s">&quot;LightYellow2&quot;</span><span class="p">,</span> <span class="s">&quot;LightYellow3&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightYellow4&quot;</span><span class="p">,</span> <span class="s">&quot;yellow1&quot;</span><span class="p">,</span> <span class="s">&quot;yellow2&quot;</span><span class="p">,</span> <span class="s">&quot;yellow3&quot;</span><span class="p">,</span> <span class="s">&quot;yellow4&quot;</span><span class="p">,</span> <span class="s">&quot;gold1&quot;</span><span class="p">,</span> <span class="s">&quot;gold2&quot;</span><span class="p">,</span>
            <span class="s">&quot;gold3&quot;</span><span class="p">,</span> <span class="s">&quot;gold4&quot;</span><span class="p">,</span> <span class="s">&quot;goldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;goldenrod2&quot;</span><span class="p">,</span> <span class="s">&quot;goldenrod3&quot;</span><span class="p">,</span> <span class="s">&quot;goldenrod4&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkGoldenrod1&quot;</span><span class="p">,</span> <span class="s">&quot;DarkGoldenrod2&quot;</span><span class="p">,</span> <span class="s">&quot;DarkGoldenrod3&quot;</span><span class="p">,</span> <span class="s">&quot;DarkGoldenrod4&quot;</span><span class="p">,</span>
            <span class="s">&quot;RosyBrown1&quot;</span><span class="p">,</span> <span class="s">&quot;RosyBrown2&quot;</span><span class="p">,</span> <span class="s">&quot;RosyBrown3&quot;</span><span class="p">,</span> <span class="s">&quot;RosyBrown4&quot;</span><span class="p">,</span> <span class="s">&quot;IndianRed1&quot;</span><span class="p">,</span>
            <span class="s">&quot;IndianRed2&quot;</span><span class="p">,</span> <span class="s">&quot;IndianRed3&quot;</span><span class="p">,</span> <span class="s">&quot;IndianRed4&quot;</span><span class="p">,</span> <span class="s">&quot;sienna1&quot;</span><span class="p">,</span> <span class="s">&quot;sienna2&quot;</span><span class="p">,</span> <span class="s">&quot;sienna3&quot;</span><span class="p">,</span>
            <span class="s">&quot;sienna4&quot;</span><span class="p">,</span> <span class="s">&quot;burlywood1&quot;</span><span class="p">,</span> <span class="s">&quot;burlywood2&quot;</span><span class="p">,</span> <span class="s">&quot;burlywood3&quot;</span><span class="p">,</span> <span class="s">&quot;burlywood4&quot;</span><span class="p">,</span> <span class="s">&quot;wheat1&quot;</span><span class="p">,</span>
            <span class="s">&quot;wheat2&quot;</span><span class="p">,</span> <span class="s">&quot;wheat3&quot;</span><span class="p">,</span> <span class="s">&quot;wheat4&quot;</span><span class="p">,</span> <span class="s">&quot;tan1&quot;</span><span class="p">,</span> <span class="s">&quot;tan2&quot;</span><span class="p">,</span> <span class="s">&quot;tan3&quot;</span><span class="p">,</span> <span class="s">&quot;tan4&quot;</span><span class="p">,</span> <span class="s">&quot;chocolate1&quot;</span><span class="p">,</span>
            <span class="s">&quot;chocolate2&quot;</span><span class="p">,</span> <span class="s">&quot;chocolate3&quot;</span><span class="p">,</span> <span class="s">&quot;chocolate4&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick1&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick2&quot;</span><span class="p">,</span>
            <span class="s">&quot;firebrick3&quot;</span><span class="p">,</span> <span class="s">&quot;firebrick4&quot;</span><span class="p">,</span> <span class="s">&quot;brown1&quot;</span><span class="p">,</span> <span class="s">&quot;brown2&quot;</span><span class="p">,</span> <span class="s">&quot;brown3&quot;</span><span class="p">,</span> <span class="s">&quot;brown4&quot;</span><span class="p">,</span> <span class="s">&quot;salmon1&quot;</span><span class="p">,</span>
            <span class="s">&quot;salmon2&quot;</span><span class="p">,</span> <span class="s">&quot;salmon3&quot;</span><span class="p">,</span> <span class="s">&quot;salmon4&quot;</span><span class="p">,</span> <span class="s">&quot;LightSalmon1&quot;</span><span class="p">,</span> <span class="s">&quot;LightSalmon2&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightSalmon3&quot;</span><span class="p">,</span> <span class="s">&quot;LightSalmon4&quot;</span><span class="p">,</span> <span class="s">&quot;orange1&quot;</span><span class="p">,</span> <span class="s">&quot;orange2&quot;</span><span class="p">,</span> <span class="s">&quot;orange3&quot;</span><span class="p">,</span> <span class="s">&quot;orange4&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkOrange1&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOrange2&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOrange3&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOrange4&quot;</span><span class="p">,</span> <span class="s">&quot;coral1&quot;</span><span class="p">,</span>
            <span class="s">&quot;coral2&quot;</span><span class="p">,</span> <span class="s">&quot;coral3&quot;</span><span class="p">,</span> <span class="s">&quot;coral4&quot;</span><span class="p">,</span> <span class="s">&quot;tomato1&quot;</span><span class="p">,</span> <span class="s">&quot;tomato2&quot;</span><span class="p">,</span> <span class="s">&quot;tomato3&quot;</span><span class="p">,</span> <span class="s">&quot;tomato4&quot;</span><span class="p">,</span>
            <span class="s">&quot;OrangeRed1&quot;</span><span class="p">,</span> <span class="s">&quot;OrangeRed2&quot;</span><span class="p">,</span> <span class="s">&quot;OrangeRed3&quot;</span><span class="p">,</span> <span class="s">&quot;OrangeRed4&quot;</span><span class="p">,</span> <span class="s">&quot;red1&quot;</span><span class="p">,</span> <span class="s">&quot;red2&quot;</span><span class="p">,</span> <span class="s">&quot;red3&quot;</span><span class="p">,</span>
            <span class="s">&quot;red4&quot;</span><span class="p">,</span> <span class="s">&quot;DeepPink1&quot;</span><span class="p">,</span> <span class="s">&quot;DeepPink2&quot;</span><span class="p">,</span> <span class="s">&quot;DeepPink3&quot;</span><span class="p">,</span> <span class="s">&quot;DeepPink4&quot;</span><span class="p">,</span> <span class="s">&quot;HotPink1&quot;</span><span class="p">,</span>
            <span class="s">&quot;HotPink2&quot;</span><span class="p">,</span> <span class="s">&quot;HotPink3&quot;</span><span class="p">,</span> <span class="s">&quot;HotPink4&quot;</span><span class="p">,</span> <span class="s">&quot;pink1&quot;</span><span class="p">,</span> <span class="s">&quot;pink2&quot;</span><span class="p">,</span> <span class="s">&quot;pink3&quot;</span><span class="p">,</span> <span class="s">&quot;pink4&quot;</span><span class="p">,</span>
            <span class="s">&quot;LightPink1&quot;</span><span class="p">,</span> <span class="s">&quot;LightPink2&quot;</span><span class="p">,</span> <span class="s">&quot;LightPink3&quot;</span><span class="p">,</span> <span class="s">&quot;LightPink4&quot;</span><span class="p">,</span> <span class="s">&quot;PaleVioletRed1&quot;</span><span class="p">,</span>
            <span class="s">&quot;PaleVioletRed2&quot;</span><span class="p">,</span> <span class="s">&quot;PaleVioletRed3&quot;</span><span class="p">,</span> <span class="s">&quot;PaleVioletRed4&quot;</span><span class="p">,</span> <span class="s">&quot;maroon1&quot;</span><span class="p">,</span>
            <span class="s">&quot;maroon2&quot;</span><span class="p">,</span> <span class="s">&quot;maroon3&quot;</span><span class="p">,</span> <span class="s">&quot;maroon4&quot;</span><span class="p">,</span> <span class="s">&quot;VioletRed1&quot;</span><span class="p">,</span> <span class="s">&quot;VioletRed2&quot;</span><span class="p">,</span> <span class="s">&quot;VioletRed3&quot;</span><span class="p">,</span>
            <span class="s">&quot;VioletRed4&quot;</span><span class="p">,</span> <span class="s">&quot;magenta1&quot;</span><span class="p">,</span> <span class="s">&quot;magenta2&quot;</span><span class="p">,</span> <span class="s">&quot;magenta3&quot;</span><span class="p">,</span> <span class="s">&quot;magenta4&quot;</span><span class="p">,</span> <span class="s">&quot;orchid1&quot;</span><span class="p">,</span>
            <span class="s">&quot;orchid2&quot;</span><span class="p">,</span> <span class="s">&quot;orchid3&quot;</span><span class="p">,</span> <span class="s">&quot;orchid4&quot;</span><span class="p">,</span> <span class="s">&quot;plum1&quot;</span><span class="p">,</span> <span class="s">&quot;plum2&quot;</span><span class="p">,</span> <span class="s">&quot;plum3&quot;</span><span class="p">,</span> <span class="s">&quot;plum4&quot;</span><span class="p">,</span>
            <span class="s">&quot;MediumOrchid1&quot;</span><span class="p">,</span> <span class="s">&quot;MediumOrchid2&quot;</span><span class="p">,</span> <span class="s">&quot;MediumOrchid3&quot;</span><span class="p">,</span> <span class="s">&quot;MediumOrchid4&quot;</span><span class="p">,</span>
            <span class="s">&quot;DarkOrchid1&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOrchid2&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOrchid3&quot;</span><span class="p">,</span> <span class="s">&quot;DarkOrchid4&quot;</span><span class="p">,</span> <span class="s">&quot;purple1&quot;</span><span class="p">,</span>
            <span class="s">&quot;purple2&quot;</span><span class="p">,</span> <span class="s">&quot;purple3&quot;</span><span class="p">,</span> <span class="s">&quot;purple4&quot;</span><span class="p">,</span> <span class="s">&quot;MediumPurple1&quot;</span><span class="p">,</span> <span class="s">&quot;MediumPurple2&quot;</span><span class="p">,</span>
            <span class="s">&quot;MediumPurple3&quot;</span><span class="p">,</span> <span class="s">&quot;MediumPurple4&quot;</span><span class="p">,</span> <span class="s">&quot;thistle1&quot;</span><span class="p">,</span> <span class="s">&quot;thistle2&quot;</span><span class="p">,</span> <span class="s">&quot;thistle3&quot;</span><span class="p">,</span>
            <span class="s">&quot;thistle4&quot;</span> <span class="p">)</span>
        <span class="c">#@-&lt;&lt; define colors &gt;&gt;</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">textDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>

        <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&#39;background&#39;</span><span class="p">)</span>

        <span class="n">outer</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">outer</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">;</span> <span class="n">f1</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">;</span> <span class="n">f2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">;</span> <span class="n">f3</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;Color name or value...&#39;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="c">#@+&lt;&lt; create optionMenu and callback &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.292: *5* &lt;&lt; create optionMenu and callback &gt;&gt;</span>
        <span class="n">colorBox</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">scrolledlist_items</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">colorBox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">colorCallback</span> <span class="p">(</span><span class="n">newName</span><span class="p">):</span> 
            <span class="n">label</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="n">newName</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">theFrame</span> <span class="ow">in</span> <span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">outer</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">):</span>
                    <span class="n">theFrame</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">newName</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span> <span class="c"># Ignore invalid names.</span>

        <span class="n">colorBox</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">selectioncommand</span><span class="o">=</span><span class="n">colorCallback</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create optionMenu and callback &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create picker button and callback &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.293: *5* &lt;&lt; create picker button and callback &gt;&gt;</span>
        <span class="k">def</span> <span class="nf">pickerCallback</span> <span class="p">():</span>
            <span class="n">rgb</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="n">tkColorChooser</span><span class="o">.</span><span class="n">askcolor</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span><span class="n">initialcolor</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&#39;background&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">rgb</span> <span class="ow">or</span> <span class="n">val</span><span class="p">:</span>
                <span class="c"># label.configure(text=val)</span>
                <span class="n">label</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
                <span class="n">label</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">theFrame</span> <span class="ow">in</span> <span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">outer</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">):</span>
                    <span class="n">theFrame</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">f3</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Color Picker...&quot;</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="n">pickerCallback</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create picker button and callback &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.294: *4* tkLog font tab stuff</span>
    <span class="c">#@+node:ekr.20081121110412.295: *5* createFontPicker</span></div>
<div class="viewcode-block" id="leoTkinterLog.createFontPicker"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createFontPicker">[docs]</a>    <span class="k">def</span> <span class="nf">createFontPicker</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">frameDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">textDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">pack_forget</span><span class="p">()</span>

        <span class="n">bg</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&#39;background&#39;</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFont</span><span class="p">()</span>
        <span class="c">#@+&lt;&lt; create the frames &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.296: *6* &lt;&lt; create the frames &gt;&gt;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span> <span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">pack</span> <span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>     <span class="p">;</span> <span class="n">f1</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>     <span class="p">;</span> <span class="n">f2</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>     <span class="p">;</span> <span class="n">f3</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>     <span class="p">;</span> <span class="n">f4</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the frames &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the family combo box &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.297: *6* &lt;&lt; create the family combo box &gt;&gt;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">families</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;&lt;None&gt;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">familyBox</span> <span class="o">=</span> <span class="n">familyBox</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span>
            <span class="n">labelpos</span><span class="o">=</span><span class="s">&quot;we&quot;</span><span class="p">,</span><span class="n">label_text</span><span class="o">=</span><span class="s">&#39;Family:&#39;</span><span class="p">,</span><span class="n">label_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">label_background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
            <span class="n">arrowbutton_background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
            <span class="n">scrolledlist_items</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>

        <span class="n">familyBox</span><span class="o">.</span><span class="n">selectitem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">familyBox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the family combo box &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the size entry &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.298: *6* &lt;&lt; create the size entry &gt;&gt;</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;Size:&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">)</span>

        <span class="n">sizeEntry</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">sizeEntry</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;12&#39;</span><span class="p">)</span>
        <span class="n">sizeEntry</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the size entry &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the weight combo box &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.299: *6* &lt;&lt; create the weight combo box &gt;&gt;</span>
        <span class="n">weightBox</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="n">f3</span><span class="p">,</span>
            <span class="n">labelpos</span><span class="o">=</span><span class="s">&quot;we&quot;</span><span class="p">,</span><span class="n">label_text</span><span class="o">=</span><span class="s">&quot;Weight:&quot;</span><span class="p">,</span><span class="n">label_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">label_background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
            <span class="n">arrowbutton_background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
            <span class="n">scrolledlist_items</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="s">&#39;bold&#39;</span><span class="p">])</span>

        <span class="n">weightBox</span><span class="o">.</span><span class="n">selectitem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">weightBox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the weight combo box &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the slant combo box &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.300: *6* &lt;&lt; create the slant combo box&gt;&gt;</span>
        <span class="n">slantBox</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="n">f4</span><span class="p">,</span>
            <span class="n">labelpos</span><span class="o">=</span><span class="s">&quot;we&quot;</span><span class="p">,</span><span class="n">label_text</span><span class="o">=</span><span class="s">&quot;Slant:&quot;</span><span class="p">,</span><span class="n">label_width</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">label_background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
            <span class="n">arrowbutton_background</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
            <span class="n">scrolledlist_items</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;roman&#39;</span><span class="p">,</span><span class="s">&#39;italic&#39;</span><span class="p">])</span>

        <span class="n">slantBox</span><span class="o">.</span><span class="n">selectitem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">slantBox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the slant combo box &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create the sample text widget &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.301: *6* &lt;&lt; create the sample text widget &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampleWidget</span> <span class="o">=</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">sample</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;The quick brown fox</span><span class="se">\n</span><span class="s">jumped over the lazy dog.</span><span class="se">\n</span><span class="s">0123456789&#39;</span>
        <span class="n">sample</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create the sample text widget &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create and bind the callbacks &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.302: *6* &lt;&lt; create and bind the callbacks &gt;&gt;</span>
        <span class="k">def</span> <span class="nf">fontCallback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">familyBox</span><span class="p">,</span><span class="n">sizeEntry</span><span class="p">,</span><span class="n">slantBox</span><span class="p">,</span><span class="n">weightBox</span><span class="p">,</span><span class="n">sample</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">(</span><span class="n">familyBox</span><span class="p">,</span><span class="n">slantBox</span><span class="p">,</span><span class="n">weightBox</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">selectioncommand</span><span class="o">=</span><span class="n">fontCallback</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">sizeEntry</span><span class="p">,</span><span class="s">&#39;&lt;Return&gt;&#39;</span><span class="p">,</span><span class="n">fontCallback</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create and bind the callbacks &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createBindings</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.303: *5* createBindings (fontPicker)</span></div>
<div class="viewcode-block" id="leoTkinterLog.createBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.createBindings">[docs]</a>    <span class="k">def</span> <span class="nf">createBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-1&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-3&gt;&#39;</span><span class="p">,</span>  <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span>       <span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&lt;Escape&gt;&quot;</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">hideFontTab</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampleWidget</span>
        <span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>

        <span class="n">k</span><span class="o">.</span><span class="n">completeAllBindingsForWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.304: *5* getFont</span></div>
<div class="viewcode-block" id="leoTkinterLog.getFont"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.getFont">[docs]</a>    <span class="k">def</span> <span class="nf">getFont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">slant</span><span class="o">=</span><span class="s">&#39;roman&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="o">=</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting font&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;family,size,slant,weight:&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">family</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
            <span class="c"># g.es_exception() # This just confuses people.</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultFont</span>
    <span class="c">#@+node:ekr.20081121110412.305: *5* setFont</span></div>
<div class="viewcode-block" id="leoTkinterLog.setFont"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.setFont">[docs]</a>    <span class="k">def</span> <span class="nf">setFont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">familyBox</span><span class="p">,</span><span class="n">sizeEntry</span><span class="p">,</span><span class="n">slantBox</span><span class="p">,</span><span class="n">weightBox</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">box</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">familyBox</span><span class="p">,</span> <span class="s">&#39;family&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">None</span><span class="p">,</span>      <span class="s">&#39;size&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">slantBox</span><span class="p">,</span>  <span class="s">&#39;slant&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">weightBox</span><span class="p">,</span> <span class="s">&#39;weight&#39;</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">box</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">sizeEntry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
                <span class="k">try</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;&lt;none&gt;&#39;</span><span class="p">,):</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="n">family</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;family&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">size</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;size&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">weight</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;weight&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
        <span class="n">slant</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;slant&#39;</span><span class="p">,</span><span class="s">&#39;roman&#39;</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFont</span><span class="p">(</span><span class="n">family</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">slant</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.306: *5* hideFontTab</span></div>
<div class="viewcode-block" id="leoTkinterLog.hideFontTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterLog.hideFontTab">[docs]</a>    <span class="k">def</span> <span class="nf">hideFontTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">selectTab</span><span class="p">(</span><span class="s">&#39;Log&#39;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.408: *3* class leoTkinterMenu</span></div></div>
<div class="viewcode-block" id="leoTkinterMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterMenu</span> <span class="p">(</span><span class="n">leoMenu</span><span class="o">.</span><span class="n">leoMenu</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class that represents a Leo window.&quot;&quot;&quot;</span>
    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.409: *4* Birth &amp; death</span>
    <span class="c">#@+node:ekr.20081121110412.410: *5* leoTkinterMenu.__init__</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">leoMenu</span><span class="o">.</span><span class="n">leoMenu</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span>
            <span class="s">&#39;menu_text_font_family&#39;</span><span class="p">,</span> <span class="s">&#39;menu_text_font_size&#39;</span><span class="p">,</span>
            <span class="s">&#39;menu_text_font_slant&#39;</span><span class="p">,</span>  <span class="s">&#39;menu_text_font_weight&#39;</span><span class="p">,</span>
            <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultMenuFontSize</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.411: *4* Activate menu commands</span>
    <span class="c">#@+node:ekr.20081121110412.412: *5* tkMenu.activateMenu</span>
<div class="viewcode-block" id="leoTkinterMenu.activateMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.activateMenu">[docs]</a>    <span class="k">def</span> <span class="nf">activateMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menuName</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span>  <span class="n">top</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">top</span>
        <span class="n">topx</span><span class="p">,</span><span class="n">topy</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">(),</span><span class="n">top</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">getMenu</span><span class="p">(</span><span class="n">menuName</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeMenuPositions</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">menuName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops, no menu offset: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">menuName</span><span class="p">)</span>

            <span class="n">menu</span><span class="o">.</span><span class="n">tk_popup</span><span class="p">(</span><span class="n">topx</span><span class="o">+</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">menuName</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">topy</span><span class="p">)</span> <span class="c"># Fix by caugm.  Thanks!</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops, no menu: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">menuName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.413: *5* tkMenu.computeMenuPositions</span></div>
<div class="viewcode-block" id="leoTkinterMenu.computeMenuPositions"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.computeMenuPositions">[docs]</a>    <span class="k">def</span> <span class="nf">computeMenuPositions</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># A hack.  It would be better to set this when creating the menus.</span>
        <span class="n">menus</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;File&#39;</span><span class="p">,</span><span class="s">&#39;Edit&#39;</span><span class="p">,</span><span class="s">&#39;Outline&#39;</span><span class="p">,</span><span class="s">&#39;Plugins&#39;</span><span class="p">,</span><span class="s">&#39;Cmds&#39;</span><span class="p">,</span><span class="s">&#39;Window&#39;</span><span class="p">,</span><span class="s">&#39;Help&#39;</span><span class="p">)</span>

        <span class="c"># Compute the *approximate* x offsets of each menu.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">menus</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenu</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">fontName</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&#39;font&#39;</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">fontName</span><span class="p">)</span>
            <span class="c"># g.pr(&#39;%8s&#39; % (z),menu.winfo_reqwidth(),menu.master,menu.winfo_x())</span>
            <span class="n">d</span> <span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="c"># A total hack: sorta works on windows.</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="n">font</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">return</span> <span class="n">d</span>
    <span class="c">#@+node:ekr.20081121110412.414: *4* Tkinter menu bindings</span>
    <span class="c"># See the Tk docs for what these routines are to do</span>
    <span class="c">#@+node:ekr.20081121110412.415: *5* Methods with Tk spellings</span>
    <span class="c">#@+node:ekr.20081121110412.416: *6* add_cascade</span></div>
<div class="viewcode-block" id="leoTkinterMenu.add_cascade"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.add_cascade">[docs]</a>    <span class="k">def</span> <span class="nf">add_cascade</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">underline</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter add_cascade menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">underline</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.417: *6* add_command</span></div>
<div class="viewcode-block" id="leoTkinterMenu.add_command"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.add_command">[docs]</a>    <span class="k">def</span> <span class="nf">add_command</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter add_command menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="o">**</span><span class="n">keys</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.418: *6* add_separator</span></div>
<div class="viewcode-block" id="leoTkinterMenu.add_separator"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.add_separator">[docs]</a>    <span class="k">def</span> <span class="nf">add_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter add_separator menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.419: *6* bind (not called)</span></div>
<div class="viewcode-block" id="leoTkinterMenu.bind"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bind_shortcut</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter bind menu method.&quot;&quot;&quot;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">bind_shortcut</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="n">bind_shortcut</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.420: *6* delete</span></div>
<div class="viewcode-block" id="leoTkinterMenu.delete"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">realItemName</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter delete menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">menu</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">realItemName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.421: *6* delete_range</span></div>
<div class="viewcode-block" id="leoTkinterMenu.delete_range"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.delete_range">[docs]</a>    <span class="k">def</span> <span class="nf">delete_range</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter delete menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">menu</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;delete_range failed, printing traceback to stdout&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>

    <span class="c">#@+node:ekr.20081121110412.422: *6* destroy</span></div>
<div class="viewcode-block" id="leoTkinterMenu.destroy"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter destroy menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">menu</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.423: *6* insert</span></div>
<div class="viewcode-block" id="leoTkinterMenu.insert"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menuName</span><span class="p">,</span><span class="n">position</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">command</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenu</span><span class="p">(</span><span class="n">menuName</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">underline</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="s">&#39;command&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="s">&#39;command&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">underline</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.424: *6* insert_cascade</span></div>
<div class="viewcode-block" id="leoTkinterMenu.insert_cascade"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.insert_cascade">[docs]</a>    <span class="k">def</span> <span class="nf">insert_cascade</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">underline</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter insert_cascade menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">insert_cascade</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">underline</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.425: *6* new_menu</span></div>
<div class="viewcode-block" id="leoTkinterMenu.new_menu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.new_menu">[docs]</a>    <span class="k">def</span> <span class="nf">new_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span> <span class="c"># label is for debugging.</span>

        <span class="sd">&quot;&quot;&quot;Wrapper for the Tkinter new_menu menu method.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="n">tearoff</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="n">tearoff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="n">tearoff</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.426: *5* Methods with other spellings (Tkmenu)</span>
    <span class="c">#@+node:ekr.20081121110412.427: *6* clearAccel</span></div>
<div class="viewcode-block" id="leoTkinterMenu.clearAccel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.clearAccel">[docs]</a>    <span class="k">def</span> <span class="nf">clearAccel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">realName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRealMenuName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">realName</span> <span class="o">=</span> <span class="n">realName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">realName</span><span class="p">,</span><span class="n">accelerator</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.428: *6* createMenuBar (Tkmenu)</span></div>
<div class="viewcode-block" id="leoTkinterMenu.createMenuBar"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.createMenuBar">[docs]</a>    <span class="k">def</span> <span class="nf">createMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">):</span>

        <span class="n">top</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">top</span>

        <span class="c"># Note: font setting has no effect here.</span>
        <span class="n">topMenu</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">top</span><span class="p">,</span><span class="n">postcommand</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updateAllMenus</span><span class="p">)</span>

        <span class="c"># Do gui-independent stuff.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">topMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createMenusFromTables</span><span class="p">()</span>

        <span class="n">top</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">topMenu</span><span class="p">)</span> <span class="c"># Display the menu.</span>
    <span class="c">#@+node:ekr.20081121110412.429: *6* createOpenWithMenu (Tkmenu)</span></div>
<div class="viewcode-block" id="leoTkinterMenu.createOpenWithMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.createOpenWithMenu">[docs]</a>    <span class="k">def</span> <span class="nf">createOpenWithMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">amp_index</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Create a submenu.&#39;&#39;&#39;</span>

        <span class="c"># g.trace(g.callers(5))</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">insert_cascade</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">menu</span><span class="o">=</span><span class="n">menu</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">amp_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">menu</span>
    <span class="c">#@+node:ekr.20081121110412.430: *6* disableMenu</span></div>
<div class="viewcode-block" id="leoTkinterMenu.disableMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.disableMenu">[docs]</a>    <span class="k">def</span> <span class="nf">disableMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">try</span><span class="p">:</span>
                <span class="n">realName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRealMenuName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">realName</span> <span class="o">=</span> <span class="n">realName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">realName</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;disableMenu menu,name:&quot;</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.431: *6* enableMenu</span>
    <span class="c"># Fail gracefully if the item name does not exist.</span>
</div>
<div class="viewcode-block" id="leoTkinterMenu.enableMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.enableMenu">[docs]</a>    <span class="k">def</span> <span class="nf">enableMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="s">&quot;disabled&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">realName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRealMenuName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">realName</span> <span class="o">=</span> <span class="n">realName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">realName</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;enableMenu menu,name,val:&quot;</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.432: *6* getMenuLabel</span></div>
<div class="viewcode-block" id="leoTkinterMenu.getMenuLabel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.getMenuLabel">[docs]</a>    <span class="k">def</span> <span class="nf">getMenuLabel</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the index of the menu item whose name (or offset) is given.</span>
<span class="sd">        Return None if there is no such menu item.&#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">index</span>
    <span class="c">#@+node:ekr.20081121110412.433: *6* setMenuLabel</span></div>
<div class="viewcode-block" id="leoTkinterMenu.setMenuLabel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.setMenuLabel">[docs]</a>    <span class="k">def</span> <span class="nf">setMenuLabel</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">underline</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">menu</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="c"># &quot;name&quot; is actually an index into the menu.</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">underline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Bug fix: 2/16/03: use translated name.</span>
                <span class="n">realName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRealMenuName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">realName</span> <span class="o">=</span> <span class="n">realName</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="c"># Bug fix: 3/25/03&quot; use tranlasted label.</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRealMenuName</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">entryconfig</span><span class="p">(</span><span class="n">realName</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="n">underline</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;setMenuLabel menu,name,label:&quot;</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.434: *4* getMacHelpMenu</span></div>
<div class="viewcode-block" id="leoTkinterMenu.getMacHelpMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterMenu.getMacHelpMenu">[docs]</a>    <span class="k">def</span> <span class="nf">getMacHelpMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>

        <span class="n">defaultTable</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c"># &amp;: a,b,c,d,e,f,h,l,m,n,o,p,r,s,t,u</span>
                <span class="p">(</span><span class="s">&#39;&amp;About Leo...&#39;</span><span class="p">,</span>           <span class="s">&#39;about-leo&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Online &amp;Home Page&#39;</span><span class="p">,</span>       <span class="s">&#39;open-online-home&#39;</span><span class="p">),</span>
                <span class="s">&#39;*open-online-&amp;tutorial&#39;</span><span class="p">,</span>
                <span class="s">&#39;*open-&amp;users-guide&#39;</span><span class="p">,</span>
                <span class="s">&#39;-&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s">&#39;Open Leo&amp;Docs.leo&#39;</span><span class="p">,</span>       <span class="s">&#39;open-leoDocs-leo&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Open Leo&amp;Plugins.leo&#39;</span><span class="p">,</span>    <span class="s">&#39;open-leoPlugins-leo&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Open Leo&amp;Settings.leo&#39;</span><span class="p">,</span>   <span class="s">&#39;open-leoSettings-leo&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Open &amp;myLeoSettings.leo&#39;</span><span class="p">,</span> <span class="s">&#39;open-myLeoSettings-leo&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;Open scr&amp;ipts.leo&#39;</span><span class="p">,</span>       <span class="s">&#39;open-scripts-leo&#39;</span><span class="p">),</span>
                <span class="s">&#39;-&#39;</span><span class="p">,</span>
                <span class="s">&#39;*he&amp;lp-for-minibuffer&#39;</span><span class="p">,</span>
                <span class="s">&#39;*help-for-&amp;command&#39;</span><span class="p">,</span>
                <span class="s">&#39;-&#39;</span><span class="p">,</span>
                <span class="s">&#39;*&amp;apropos-autocompletion&#39;</span><span class="p">,</span>
                <span class="s">&#39;*apropos-&amp;bindings&#39;</span><span class="p">,</span>
                <span class="s">&#39;*apropos-&amp;debugging-commands&#39;</span><span class="p">,</span>
                <span class="s">&#39;*apropos-&amp;find-commands&#39;</span><span class="p">,</span>
                <span class="s">&#39;-&#39;</span><span class="p">,</span>
                <span class="s">&#39;*pri&amp;nt-bindings&#39;</span><span class="p">,</span>
                <span class="s">&#39;*print-c&amp;ommands&#39;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">topMenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenu</span><span class="p">(</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
            <span class="c"># Use the name argument to create the special Macintosh Help menu.</span>
            <span class="n">helpMenu</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">topMenu</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;help&#39;</span><span class="p">,</span><span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">topMenu</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Help&#39;</span><span class="p">,</span><span class="n">menu</span><span class="o">=</span><span class="n">helpMenu</span><span class="p">,</span><span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createMenuEntries</span><span class="p">(</span><span class="n">helpMenu</span><span class="p">,</span><span class="n">table</span> <span class="ow">or</span> <span class="n">defaultTable</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">helpMenu</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;Can not get MacOS Help menu&#39;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.435: *3* class leoTkinterTree</span></div></div>
<div class="viewcode-block" id="leoTkinterTree"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterTree</span> <span class="p">(</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">leoTree</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Leo tkinter tree class.&quot;&quot;&quot;</span>

    <span class="n">callbacksInjected</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">#@+&lt;&lt; about drawing &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.436: *4*   &lt;&lt; About drawing &gt;&gt;</span>
    <span class="c">#@+at</span>
    <span class="c"># </span>
    <span class="c"># New in Leo 4.5: The &#39;Newest World Order&#39;:</span>
    <span class="c"># </span>
    <span class="c"># - Redrawing the screen and setting focus only happen in c.outerUpdate.</span>
    <span class="c"># - c.redraw only requests a redraw.</span>
    <span class="c"># - c.redraw_now is equivalent to c.redraw() followed by c.outerUpdate.</span>
    <span class="c"># - c.beginUpdate does nothing.  c.endUpdate(False) does nothing.</span>
    <span class="c"># - c.endUpdate() is equivalent to c.redraw()</span>
    <span class="c"># - There is no longer any need to ensure c.endUpdate is called for every c.beginUpdate.</span>
    <span class="c">#   Thus, there is no need for the associated try/finally statements.</span>
    <span class="c">#@-&lt;&lt; about drawing &gt;&gt;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.442: *4*  Birth... (tkTree)</span>
    <span class="c">#@+node:ekr.20081121110412.443: *5* __init__ (tkTree)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">canvas</span><span class="p">):</span>

        <span class="c"># Init the base class.</span>
        <span class="n">leoFrame</span><span class="o">.</span><span class="n">leoTree</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">)</span>

        <span class="c"># Configuration and debugging settings.</span>
        <span class="c"># These must be defined here to eliminate memory leaks.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_clone_drags</span>          <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;allow_clone_drags&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_selected_tree_node</span>  <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;center_selected_tree_node&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_drag_messages</span>       <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&quot;enable_drag_messages&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expanded_click_area</span>        <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;expanded_click_area&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc_before_redraw</span>           <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;gc_before_redraw&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_foreground_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&#39;headline_text_editing_foreground_color&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_background_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&#39;headline_text_editing_background_color&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_foreground_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&#39;headline_text_editing_selection_foreground_color&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_background_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&#39;headline_text_editing_selection_background_color&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_selected_foreground_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&quot;headline_text_selected_foreground_color&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_selected_background_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&quot;headline_text_selected_background_color&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_foreground_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&quot;headline_text_editing_selection_foreground_color&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_background_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&quot;headline_text_editing_selection_background_color&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_unselected_foreground_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&#39;headline_text_unselected_foreground_color&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_unselected_background_color</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span>
            <span class="s">&#39;headline_text_unselected_background_color&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">idle_redraw</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;idle_redraw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialClickExpandsOrContractsNode</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span>
            <span class="s">&#39;initialClickExpandsOrContractsNode&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">look_for_control_drag_on_mouse_down</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span>
            <span class="s">&#39;look_for_control_drag_on_mouse_down&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_all_text_when_editing_headlines</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span>
            <span class="s">&#39;select_all_text_when_editing_headlines&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stayInTree</span>     <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;stayInTreeAfterSelect&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span>          <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_tree&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span>    <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_tree_alloc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_chapters</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_chapters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_edit</span>     <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_tree_edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_gc</span>       <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_tree_gc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_redraw</span>   <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_tree_redraw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_select</span>   <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;trace_select&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_stats</span>    <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;show_tree_stats&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_chapters</span>   <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getBool</span><span class="p">(</span><span class="s">&#39;use_chapters&#39;</span><span class="p">)</span>

        <span class="c"># Objects associated with this tree.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>

        <span class="c">#@+&lt;&lt; define drawing constants &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.444: *6* &lt;&lt; define drawing constants &gt;&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_padding</span> <span class="o">=</span> <span class="mi">5</span> <span class="c"># extra padding between box and icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box_width</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_padding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icon_width</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_indent</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># extra padding between icon and tex</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hline_y</span> <span class="o">=</span> <span class="mi">7</span> <span class="c"># Vertical offset of horizontal line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_left</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_top</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_line_height</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">+</span> <span class="mi">2</span> <span class="c"># default if can&#39;t set line_height from font.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_line_height</span>
        <span class="c">#@-&lt;&lt; define drawing constants &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; old ivars &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.445: *6* &lt;&lt; old ivars &gt;&gt;</span>
        <span class="c"># Miscellaneous info.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># Image cache set by getIconImage().</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True if present headline is active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_editPosition</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Returned by leoTree.editPosition()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># y offset for this headline.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastClickFrameId</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># id of last entered clickBox.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastColoredText</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># last colored text widget.</span>

        <span class="c"># Set self.font and self.fontName.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFontFromConfig</span><span class="p">()</span>

        <span class="c"># Drag and drop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controlDrag</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True: control was down when drag started.</span>

        <span class="c"># Keep track of popup menu so we can handle behavior better on Linux Context menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popupMenu</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Incremental redraws:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># True: enable incremental redraws.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expandedVisibleArea</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">bar1</span><span class="p">,</span><span class="s">&quot;&lt;Button-1-ButtonRelease&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; old ivars &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; inject callbacks into the position class &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.446: *6* &lt;&lt; inject callbacks into the position class &gt;&gt;</span>
        <span class="c"># The new code injects 3 callbacks for the colorizer.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">leoTkinterTree</span><span class="o">.</span><span class="n">callbacksInjected</span><span class="p">:</span> <span class="c"># Class var.</span>
            <span class="n">leoTkinterTree</span><span class="o">.</span><span class="n">callbacksInjected</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">injectCallbacks</span><span class="p">()</span>
        <span class="c">#@-&lt;&lt; inject callbacks into the position class &gt;&gt;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prevPositions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redrawing</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Used only to disable traces.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Count for debugging.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revertHeadline</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Previous headline text for abortEditLabel.</span>

        <span class="c"># New in 4.4: We should stay in the tree to use per-pane bindings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textBindings</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># Set in setBindings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textNumber</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># To make names unique.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># Drawing is enabled only if self.updateCount &lt;= 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setEditPosition</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># Set positions returned by leoTree.editPosition()</span>

        <span class="c"># Keys are id&#39;s, values are positions...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconIds</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Lists of visible (in-use) widgets...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span>  <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># Pre 4.4b2: Keys are vnodes, values are Tk.Text widgets.</span>
            <span class="c">#     4.4b2: Keys are p.key(), values are Tk.Text widgets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleUserIcons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Dictionaries of free, hidden widgets...</span>
        <span class="c"># Keys are id&#39;s, values are widgets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeBoxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeClickBoxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeIcons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeLines</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeText</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># New in 4.4b2: a list of free Tk.Text widgets</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freeUserIcons</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_block_canvas_menu</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.447: *5* tkTtree.setBindings &amp; helper</span>
<div class="viewcode-block" id="leoTkinterTree.setBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setBindings">[docs]</a>    <span class="k">def</span> <span class="nf">setBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,):</span>

        <span class="sd">&#39;&#39;&#39;Create master bindings for all headlines.&#39;&#39;&#39;</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="c"># g.trace(&#39;self&#39;,self,&#39;canvas&#39;,self.canvas)</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">setBindingsHelper</span><span class="p">()</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">setCanvasBindings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

        <span class="n">k</span><span class="o">.</span><span class="n">completeAllBindingsForWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>

        <span class="n">k</span><span class="o">.</span><span class="n">completeAllBindingsForWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bindingWidget</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20081121110412.448: *6* tkTree.setBindingsHelper</span></div>
<div class="viewcode-block" id="leoTkinterTree.setBindingsHelper"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setBindingsHelper">[docs]</a>    <span class="k">def</span> <span class="nf">setBindingsHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bindingWidget</span> <span class="o">=</span> <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;bindingWidget&#39;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span>       <span class="n">k</span><span class="o">.</span><span class="n">masterClickHandler</span><span class="p">,</span>          <span class="n">tree</span><span class="o">.</span><span class="n">onHeadlineClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>       <span class="n">k</span><span class="o">.</span><span class="n">masterClick3Handler</span><span class="p">,</span>         <span class="n">tree</span><span class="o">.</span><span class="n">onHeadlineRightClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-Button-1&gt;&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">masterDoubleClickHandler</span><span class="p">,</span>    <span class="n">tree</span><span class="o">.</span><span class="n">onHeadlineClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&lt;Double-Button-3&gt;&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">masterDoubleClick3Handler</span><span class="p">,</span>   <span class="n">tree</span><span class="o">.</span><span class="n">onHeadlineRightClick</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">handler</span><span class="p">,</span><span class="n">func</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">treeBindingCallback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">handler</span><span class="o">=</span><span class="n">handler</span><span class="p">,</span><span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">):</span>
                <span class="c"># g.trace(&#39;func&#39;,func)</span>
                <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">func</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">treeBindingCallback</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">textBindings</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">bindtags</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.449: *5* tkTree.setCanvasBindings</span></div>
<div class="viewcode-block" id="leoTkinterTree.setCanvasBindings"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setCanvasBindings">[docs]</a>    <span class="k">def</span> <span class="nf">setCanvasBindings</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">canvas</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>

        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&#39;&lt;Key&gt;&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">masterKeyHandler</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onTreeClick</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onTreeRightClick</span><span class="p">)</span>
        <span class="c"># c.bind(canvas,&#39;&lt;FocusIn&gt;&#39;,self.onFocusIn)</span>

        <span class="c">#@+&lt;&lt; make bindings for tagged items on the canvas &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.450: *6* &lt;&lt; make bindings for tagged items on the canvas &gt;&gt;</span>
        <span class="n">where</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expanded_click_area</span><span class="p">,</span><span class="s">&#39;clickBox&#39;</span><span class="p">,</span><span class="s">&#39;plusBox&#39;</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">where</span><span class="p">,</span>    <span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onClickBoxClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onIconBoxClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Double-1&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onIconBoxDoubleClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onIconBoxRightClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Double-3&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onIconBoxRightClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;B1-Motion&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onDrag</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Any-ButtonRelease-1&gt;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onEndDrag</span><span class="p">),</span>

            <span class="p">(</span><span class="s">&#39;plusBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onPlusBoxRightClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;plusBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClickBoxClick</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;clickBox&#39;</span><span class="p">,</span><span class="s">&#39;&lt;Button-3&gt;&#39;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">onClickBoxRightClick</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span><span class="n">event_kind</span><span class="p">,</span><span class="n">callback</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">event_kind</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; make bindings for tagged items on the canvas &gt;&gt;</span>
        <span class="c">#@+&lt;&lt; create baloon bindings for tagged items on the canvas &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.451: *6* &lt;&lt; create baloon bindings for tagged items on the canvas &gt;&gt;</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># I find these very irritating.</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="c"># (&#39;plusBox&#39;,&#39;plusBox&#39;),</span>
                <span class="p">(</span><span class="s">&#39;iconBox&#39;</span><span class="p">,</span><span class="s">&#39;Icon Box&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;selectBox&#39;</span><span class="p">,</span><span class="s">&#39;Click to select&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;clickBox&#39;</span><span class="p">,</span><span class="s">&#39;Click to expand or contract&#39;</span><span class="p">),</span>
                <span class="c"># (&#39;textBox&#39;,&#39;Headline&#39;),</span>
            <span class="p">):</span>
                <span class="c"># A fairly long wait is best.</span>
                <span class="n">balloon</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">Balloon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">initwait</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
                <span class="n">balloon</span><span class="o">.</span><span class="n">tagbind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">balloonHelp</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
        <span class="c">#@-&lt;&lt; create baloon bindings for tagged items on the canvas &gt;&gt;</span>
    <span class="c">#@+node:ekr.20081121110412.452: *4* Allocation...</span>
    <span class="c">#@+node:ekr.20081121110412.453: *5* newBox</span></div>
<div class="viewcode-block" id="leoTkinterTree.newBox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.newBox">[docs]</a>    <span class="k">def</span> <span class="nf">newBox</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="p">;</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;plusBox&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeBoxes</span><span class="p">:</span>
            <span class="c"># theId = self.freeBoxes.pop(0)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeBoxes</span> <span class="p">;</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span> <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">itemconfigure</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theId</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">),</span><span class="n">align</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">theId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">return</span> <span class="n">theId</span>
    <span class="c">#@+node:ekr.20081121110412.454: *5* newClickBox</span></div>
<div class="viewcode-block" id="leoTkinterTree.newClickBox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.newClickBox">[docs]</a>    <span class="k">def</span> <span class="nf">newClickBox</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="p">;</span> <span class="n">defaultColor</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">(),</span><span class="s">&#39;clickBox&#39;</span><span class="p">,</span><span class="s">&#39;selectBox&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeClickBoxes</span><span class="p">:</span>
            <span class="c"># theId = self.freeClickBoxes.pop(0)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeClickBoxes</span> <span class="p">;</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span> <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">itemconfig</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">defaultColor</span><span class="p">,</span><span class="n">outline</span><span class="o">=</span><span class="n">defaultColor</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">),</span><span class="n">align</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">theId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">return</span> <span class="n">theId</span>
    <span class="c">#@+node:ekr.20081121110412.455: *5* newIcon</span></div>
<div class="viewcode-block" id="leoTkinterTree.newIcon"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.newIcon">[docs]</a>    <span class="k">def</span> <span class="nf">newIcon</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="p">;</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;iconBox&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeIcons</span><span class="p">:</span>
            <span class="c"># theId = self.freeIcons.pop(0)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeIcons</span> <span class="p">;</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span> <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">itemconfigure</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theId</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;nw&quot;</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">),</span><span class="n">align</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">theId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iconIds</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="c"># Remember which vnode belongs to the icon.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">return</span> <span class="n">theId</span>
    <span class="c">#@+node:ekr.20081121110412.456: *5* newLine</span></div>
<div class="viewcode-block" id="leoTkinterTree.newLine"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.newLine">[docs]</a>    <span class="k">def</span> <span class="nf">newLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeLines</span><span class="p">:</span>
            <span class="c"># theId = self.freeLines.pop(0)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeLines</span> <span class="p">;</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span> <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theId</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="s">&quot;lines&quot;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;gray50&quot;</span><span class="p">)</span> <span class="c"># stipple=&quot;gray25&quot;)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">),</span><span class="n">align</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>

        <span class="k">if</span> <span class="n">theId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">theId</span>
    <span class="c">#@+node:ekr.20081121110412.457: *5* newText (tkTree) and helper</span></div>
<div class="viewcode-block" id="leoTkinterTree.newText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.newText">[docs]</a>    <span class="k">def</span> <span class="nf">newText</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="p">;</span> <span class="n">tag</span> <span class="o">=</span> <span class="s">&quot;textBox&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span>  <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">k</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeText</span><span class="p">:</span>
            <span class="c"># w,theId = self.freeText.pop()</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeText</span> <span class="p">;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span> <span class="n">w</span><span class="p">,</span><span class="n">theId</span> <span class="o">=</span> <span class="n">data</span> <span class="p">;</span> <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">data</span><span class="p">]</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c"># Make the window visible again.</span>
                <span class="c"># theId is the id of the *window* not the text.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Tags are not valid in Tk.Text widgets.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textNumber</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">plainTextWidget</span><span class="p">(</span>
                <span class="n">canvas</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;head-</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">textNumber</span><span class="p">,</span>
                <span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span><span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">relief</span><span class="o">=</span><span class="s">&quot;flat&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">bindtags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textBindings</span><span class="p">)</span> <span class="c"># Set the bindings for this widget.</span>

            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Crashes on XP.</span>
                <span class="c">#@+&lt;&lt; patch by Maciej Kalisiak to handle scroll-wheel events &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.458: *6* &lt;&lt; patch by Maciej Kalisiak  to handle scroll-wheel events &gt;&gt;</span>
                <span class="k">def</span> <span class="nf">PropagateButton4</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&quot;&lt;Button-4&gt;&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s">&quot;break&quot;</span>

                <span class="k">def</span> <span class="nf">PropagateButton5</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&quot;&lt;Button-5&gt;&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s">&quot;break&quot;</span>

                <span class="k">def</span> <span class="nf">PropagateMouseWheel</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&quot;&lt;MouseWheel&gt;&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s">&quot;break&quot;</span>

                <span class="n">instance_tag</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">bindtags</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">w</span><span class="o">.</span><span class="n">bind_class</span><span class="p">(</span><span class="n">instance_tag</span><span class="p">,</span> <span class="s">&quot;&lt;Button-4&gt;&quot;</span><span class="p">,</span> <span class="n">PropagateButton4</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">bind_class</span><span class="p">(</span><span class="n">instance_tag</span><span class="p">,</span> <span class="s">&quot;&lt;Button-5&gt;&quot;</span><span class="p">,</span> <span class="n">PropagateButton5</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">bind_class</span><span class="p">(</span><span class="n">instance_tag</span><span class="p">,</span> <span class="s">&quot;&lt;MouseWheel&gt;&quot;</span><span class="p">,</span><span class="n">PropagateMouseWheel</span><span class="p">)</span>
                <span class="c">#@-&lt;&lt; patch by Maciej Kalisiak to handle scroll-wheel events &gt;&gt;</span>

            <span class="n">theId</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_window</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">anchor</span><span class="o">=</span><span class="s">&quot;nw&quot;</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="n">w</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_window_id</span> <span class="o">=</span> <span class="n">theId</span> <span class="c"># Never changes.</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%6s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">w</span><span class="p">)),</span><span class="n">align</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

        <span class="c"># Common configuration.</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># Doesn&#39;t seem to work.</span>
            <span class="n">balloon</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">Balloon</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="n">initwait</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
            <span class="n">balloon</span><span class="o">.</span><span class="n">tagbind</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="n">theId</span><span class="p">,</span><span class="n">balloonHelp</span><span class="o">=</span><span class="s">&#39;Headline&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span> <span class="c"># Add the id of the *window*</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setHeadlineText</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headWidth</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">))</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_position</span> <span class="o">=</span> <span class="n">p</span> <span class="c"># This p never changes.</span>
                <span class="c"># *Required*: onHeadlineClick uses w.leo_position to get p.</span>

            <span class="c"># Keys are p.key().  Entries are (w,theId)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">key</span><span class="p">()]</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span><span class="n">theId</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;**** can not happen.  No p&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.459: *6* tree.setHeadlineText</span></div>
<div class="viewcode-block" id="leoTkinterTree.setHeadlineText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setHeadlineText">[docs]</a>    <span class="k">def</span> <span class="nf">setHeadlineText</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theId</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;All changes to text widgets should come here.&quot;&quot;&quot;</span>

        <span class="c"># if self.trace_alloc: g.trace(&#39;%4d %6s %s&#39; % (theId,self.textAddr(w),s),align=-20)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;state&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s">&quot;normal&quot;</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
        <span class="c"># Important: do not allow newlines in headlines.</span>
        <span class="k">while</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
        <span class="c"># g.trace(repr(s))</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s">&quot;normal&quot;</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.460: *5* recycleWidgets</span></div>
<div class="viewcode-block" id="leoTkinterTree.recycleWidgets"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.recycleWidgets">[docs]</a>    <span class="k">def</span> <span class="nf">recycleWidgets</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>

        <span class="k">for</span> <span class="n">theId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span><span class="p">:</span>
            <span class="c"># if theId not in self.freeBoxes:</span>
                <span class="c"># self.freeBoxes.append(theId)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeBoxes</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">theId</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">theId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeClickBoxes</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">theId</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">theId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeIcons</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">theId</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">theId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeLines</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">theId</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">aList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span><span class="n">theId</span> <span class="o">=</span> <span class="n">data</span>
            <span class="c"># assert theId == w.leo_window_id</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">coords</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">leo_position</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Allow the position to be freed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeText</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># g.trace(&#39;deleting visible user icons!&#39;)</span>
        <span class="k">for</span> <span class="n">theId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleUserIcons</span><span class="p">:</span>
            <span class="c"># The present code does not recycle user Icons.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleUserIcons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#@+node:ekr.20081121110412.461: *5* destroyWidgets</span></div>
<div class="viewcode-block" id="leoTkinterTree.destroyWidgets"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.destroyWidgets">[docs]</a>    <span class="k">def</span> <span class="nf">destroyWidgets</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleUserIcons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freeText</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeBoxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeClickBoxes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeIcons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freeLines</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.462: *5* showStats</span></div>
<div class="viewcode-block" id="leoTkinterTree.showStats"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.showStats">[docs]</a>    <span class="k">def</span> <span class="nf">showStats</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">kind</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;boxes&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibleBoxes</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">freeBoxes</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;clickBoxes&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibleClickBoxes</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">freeClickBoxes</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;icons&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibleIcons</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">freeIcons</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;lines&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibleLines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">freeLines</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;tesxt&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">freeText</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%10s</span><span class="s"> used: </span><span class="si">%4d</span><span class="s"> free: </span><span class="si">%4d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.463: *4* Config &amp; Measuring...</span>
    <span class="c">#@+node:ekr.20081121110412.464: *5* tree.getFont,setFont,setFontFromConfig</span></div>
<div class="viewcode-block" id="leoTkinterTree.getFont"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.getFont">[docs]</a>    <span class="k">def</span> <span class="nf">getFont</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.setFont"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setFont">[docs]</a>    <span class="k">def</span> <span class="nf">setFont</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fontName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># ESSENTIAL: retain a link to font.</span>
        <span class="k">if</span> <span class="n">fontName</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontName</span> <span class="o">=</span> <span class="n">fontName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">tkFont</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="n">fontName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontName</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLineHeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>

    <span class="c"># Called by ctor and when config params are reloaded.</span></div>
<div class="viewcode-block" id="leoTkinterTree.setFontFromConfig"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setFontFromConfig">[docs]</a>    <span class="k">def</span> <span class="nf">setFontFromConfig</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="c"># g.trace()</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getFontFromParams</span><span class="p">(</span>
            <span class="s">&quot;headline_text_font_family&quot;</span><span class="p">,</span> <span class="s">&quot;headline_text_font_size&quot;</span><span class="p">,</span>
            <span class="s">&quot;headline_text_font_slant&quot;</span><span class="p">,</span>  <span class="s">&quot;headline_text_font_weight&quot;</span><span class="p">,</span>
            <span class="n">c</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaultTreeFontSize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.465: *5* headWidth &amp; widthInPixels</span></div>
<div class="viewcode-block" id="leoTkinterTree.headWidth"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.headWidth">[docs]</a>    <span class="k">def</span> <span class="nf">headWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Returns the proper width of the entry widget for the headline.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">p</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

</div>
<div class="viewcode-block" id="leoTkinterTree.widthInPixels"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.widthInPixels">[docs]</a>    <span class="k">def</span> <span class="nf">widthInPixels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">toEncodedString</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.466: *5* setLineHeight</span></div>
<div class="viewcode-block" id="leoTkinterTree.setLineHeight"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setLineHeight">[docs]</a>    <span class="k">def</span> <span class="nf">setLineHeight</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">font</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">metrics</span><span class="p">()</span>
            <span class="n">linespace</span> <span class="o">=</span> <span class="n">metrics</span> <span class="p">[</span><span class="s">&quot;linespace&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">=</span> <span class="n">linespace</span> <span class="o">+</span> <span class="mi">5</span> <span class="c"># Same as before for the default font on Windows.</span>
            <span class="c"># g.pr(metrics)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_line_height</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception setting outline line height&quot;</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.467: *4* Debugging...</span>
    <span class="c">#@+node:ekr.20081121110412.468: *5* textAddr</span></div>
<div class="viewcode-block" id="leoTkinterTree.textAddr"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.textAddr">[docs]</a>    <span class="k">def</span> <span class="nf">textAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Return the address part of repr(Tk.Text).&quot;&quot;&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;id: &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
    <span class="c">#@+node:ekr.20081121110412.469: *5* traceIds (Not used)</span>
    <span class="c"># Verbose tracing is much more useful than this because we can see the recent past.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.traceIds"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.traceIds">[docs]</a>    <span class="k">def</span> <span class="nf">traceIds</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">for</span> <span class="n">theDict</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">flag</span> <span class="ow">in</span> <span class="p">((</span><span class="n">tree</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span><span class="s">&quot;ids&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">),(</span><span class="n">tree</span><span class="o">.</span><span class="n">iconIds</span><span class="p">,</span><span class="s">&quot;icon ids&quot;</span><span class="p">,</span><span class="bp">False</span><span class="p">)):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s">...&quot;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">theDict</span><span class="p">):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># For lines.</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> None&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">full</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
                <span class="n">seenValues</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">theDict</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seenValues</span><span class="p">:</span>
                        <span class="n">seenValues</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">theDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="o">=</span> <span class="n">item</span>
                            <span class="k">if</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.470: *4* Drawing... (tkTree)</span>
    <span class="c">#@+node:ekr.20090110073024.10: *5* Entry points (tkTree)</span>
    <span class="c">#@+node:ekr.20081121110412.471: *6* tree.begin/endUpdate</span></div>
<div class="viewcode-block" id="leoTkinterTree.beginUpdate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.beginUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">beginUpdate</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># g.trace(&#39;tree&#39;,id(self),self.updateCount,g.callers())</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.endUpdate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.endUpdate">[docs]</a>    <span class="k">def</span> <span class="nf">endUpdate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flag</span><span class="p">,</span><span class="n">scroll</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">updateCount</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c"># g.trace(self.updateCount,&#39;scroll&#39;,scroll,g.callers())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateCount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">(</span><span class="n">scroll</span><span class="o">=</span><span class="n">scroll</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateCount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Can&#39;t happen: negative updateCount&quot;</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
    <span class="c">#@+node:ekr.20081121110412.472: *6* tree.redraw_now &amp; helper (tkTree)</span>
    <span class="c"># New in 4.4b2: suppress scrolling by default.</span>
    <span class="c"># New in 4.6: enable scrolling by default.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.redraw_now"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.redraw_now">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_now</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">scroll</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">forceDraw</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Redraw immediately.</span>
<span class="sd">        forceDraw is used to eliminate draws while dragging.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quitting</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowList</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">forceDraw</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setCurrentPosition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc_before_redraw</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">collectGarbage</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">trace_gc_verbose</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">printGcSummary</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_redraw</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_alloc</span><span class="p">:</span>
                <span class="c"># g.trace(self.redrawCount,g.callers())</span>
                <span class="c"># g.trace(c.rootPosition().h,&#39;canvas:&#39;,id(self.canvas),g.callers())</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_stats</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">()</span>

        <span class="c"># New in 4.4b2: Call endEditLabel, but suppress the redraw.</span>
        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span> <span class="c">#### A major change.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beginUpdate</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endUpdate</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># Do the actual redraw. (c.redraw has called c.expandAllAncestors.)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idle_redraw</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">idleRedrawCallback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">scroll</span><span class="o">=</span><span class="n">scroll</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redrawHelper</span><span class="p">(</span><span class="n">scroll</span><span class="o">=</span><span class="n">scroll</span><span class="p">,</span><span class="n">forceDraw</span><span class="o">=</span><span class="n">forceDraw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">after_idle</span><span class="p">(</span><span class="n">idleRedrawCallback</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redrawHelper</span><span class="p">(</span><span class="n">scroll</span><span class="o">=</span><span class="n">scroll</span><span class="p">,</span><span class="n">forceDraw</span><span class="o">=</span><span class="n">forceDraw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span> <span class="c"># Important for unit tests.</span>
</div>
    <span class="n">redraw</span> <span class="o">=</span> <span class="n">redraw_now</span> <span class="c"># Compatibility</span>
    <span class="c">#@+node:ekr.20081121110412.473: *7* redrawHelper</span>
<div class="viewcode-block" id="leoTkinterTree.redrawHelper"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.redrawHelper">[docs]</a>    <span class="k">def</span> <span class="nf">redrawHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scroll</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">forceDraw</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="c"># This can be called at idle time, so there are shutdown issues.</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quitting</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowList</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">forceDraw</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">oldcursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">[</span><span class="s">&#39;cursor&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">[</span><span class="s">&#39;cursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;watch&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;redraw-entire-outline&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">):</span>

            <span class="n">c</span><span class="o">.</span><span class="n">setTopVnode</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setVisibleAreaToFullCanvas</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawTopTree</span><span class="p">()</span>
            <span class="c"># Set up the scroll region after the tree has been redrawn.</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;bbox&#39;</span><span class="p">,</span><span class="n">bbox</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">bbox</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">scrollregion</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">scroll</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">update_idletasks</span><span class="p">()</span> <span class="c"># Essential.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scrollTo</span><span class="p">()</span>

        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;after-redraw-outline&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">[</span><span class="s">&#39;cursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldcursor</span>
    <span class="c">#@+node:ekr.20090110134111.11: *6* redraw_after_contract</span></div>
<div class="viewcode-block" id="leoTkinterTree.redraw_after_contract"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.redraw_after_contract">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_after_contract</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20090110073024.11: *6* redraw_after_head_changed (tkTree)</span></div>
<div class="viewcode-block" id="leoTkinterTree.redraw_after_head_changed"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.redraw_after_head_changed">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_after_head_changed</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Fix bug 518823: 2010/02/16. Redraw the entire tree.</span>
        <span class="c"># The changed node may be a non-cloned descendant of a cloned node.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20090110073024.13: *6* redraw_after_icons_changed</span></div>
<div class="viewcode-block" id="leoTkinterTree.redraw_after_icons_changed"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.redraw_after_icons_changed">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_after_icons_changed</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span><span class="p">:</span>
            <span class="c"># A terrible hack.  Don&#39;t switch edit widget.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20090110073024.12: *6* redraw_after_select</span></div>
<div class="viewcode-block" id="leoTkinterTree.redraw_after_select"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.redraw_after_select">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_after_select</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">edit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">editAll</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.474: *5* idle_second_redraw</span></div>
<div class="viewcode-block" id="leoTkinterTree.idle_second_redraw"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.idle_second_redraw">[docs]</a>    <span class="k">def</span> <span class="nf">idle_second_redraw</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Erase and redraw the entire tree the SECOND time.</span>
        <span class="c"># This ensures that all visible nodes are allocated.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">setTopVnode</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setVisibleArea</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawTopTree</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.475: *5* drawX...</span>
    <span class="c">#@+node:ekr.20081121110412.476: *6* drawBox</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawBox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawBox">[docs]</a>    <span class="k">def</span> <span class="nf">drawBox</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="mi">7</span> <span class="c"># draw the box at x, y+7</span>

        <span class="n">theId</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;draw-outline-box&quot;</span><span class="p">,</span><span class="n">tree</span><span class="o">=</span><span class="n">tree</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">theId</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># if self.trace_gc: g.printNewObjects(tag=&#39;box 1&#39;)</span>
            <span class="n">iconname</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">(),</span><span class="s">&quot;minusnode.gif&quot;</span><span class="p">,</span> <span class="s">&quot;plusnode.gif&quot;</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIconImage</span><span class="p">(</span><span class="n">iconname</span><span class="p">)</span>
            <span class="n">theId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>
            <span class="c"># if self.trace_gc: g.printNewObjects(tag=&#39;box 2&#39;)</span>
            <span class="k">return</span> <span class="n">theId</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">theId</span>
    <span class="c">#@+node:ekr.20081121110412.477: *6* drawClickBox</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawClickBox"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawClickBox">[docs]</a>    <span class="k">def</span> <span class="nf">drawClickBox</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>

        <span class="c"># Define a slighly larger rect to catch clicks.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expanded_click_area</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newClickBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.478: *6* drawIcon</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawIcon"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawIcon">[docs]</a>    <span class="k">def</span> <span class="nf">drawIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Draws icon for position p at x,y, or at p.v.iconx,p.v.icony if x,y = None,None&quot;&quot;&quot;</span>

        <span class="c"># if self.trace_gc: g.printNewObjects(tag=&#39;icon 1&#39;)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span>
        <span class="c">#@+&lt;&lt; compute x,y and iconVal &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.479: *7* &lt;&lt; compute x,y and iconVal &gt;&gt;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">iconx</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">icony</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c"># Inject the ivars.</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">iconx</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">icony</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Inject the ivars.</span>
            <span class="n">v</span><span class="o">.</span><span class="n">iconx</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">icony</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>

        <span class="n">y</span> <span class="o">+=</span> <span class="mi">2</span> <span class="c"># draw icon at y + 2</span>

        <span class="c"># Always recompute v.iconVal.</span>
        <span class="c"># This is an important drawing optimization.</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">computeIcon</span><span class="p">()</span>
        <span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">)</span>
        <span class="c"># g.trace(v,val)</span>
        <span class="c">#@-&lt;&lt; compute x,y and iconVal &gt;&gt;</span>
        <span class="n">v</span><span class="o">.</span><span class="n">iconVal</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;draw-outline-icon&quot;</span><span class="p">,</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">):</span>

            <span class="c"># Get the image.</span>
            <span class="n">imagename</span> <span class="o">=</span> <span class="s">&quot;box</span><span class="si">%02d</span><span class="s">.GIF&quot;</span> <span class="o">%</span> <span class="n">val</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIconImage</span><span class="p">(</span><span class="n">imagename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newIcon</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span><span class="p">,</span><span class="n">image</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">icon_width</span> <span class="c"># dummy icon height,width</span>
    <span class="c">#@+node:ekr.20081121110412.480: *6* drawLine</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawLine"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawLine">[docs]</a>    <span class="k">def</span> <span class="nf">drawLine</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">):</span>

        <span class="n">theId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newLine</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">theId</span>
    <span class="c">#@+node:ekr.20081121110412.481: *6* drawNode &amp; force_draw_node (good trace)</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawNode"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawNode">[docs]</a>    <span class="k">def</span> <span class="nf">drawNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># g.trace(x,y,p,id(self.canvas))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;draw-outline-node&quot;</span><span class="p">,</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">data</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">,</span><span class="s">&quot;unknownAttributes&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">unknownAttributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;lineYOffset&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Draw the horizontal line.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">7</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span><span class="p">,</span>
            <span class="n">x</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">box_width</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="mi">7</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inVisibleArea</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_draw_node</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span><span class="p">,</span><span class="mi">0</span>
    <span class="c">#@+node:ekr.20081121110412.482: *7* force_draw_node</span></div>
<div class="viewcode-block" id="leoTkinterTree.force_draw_node"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.force_draw_node">[docs]</a>    <span class="k">def</span> <span class="nf">force_draw_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># The total height of the line.</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># The amount to indent this line.</span>

        <span class="n">h2</span><span class="p">,</span><span class="n">w2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawUserIcons</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;beforeBox&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span> <span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">w2</span> <span class="p">;</span> <span class="n">indent</span> <span class="o">+=</span> <span class="n">w2</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

        <span class="n">indent</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_width</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">box_width</span> <span class="c"># even if box isn&#39;t drawn.</span>

        <span class="n">h2</span><span class="p">,</span><span class="n">w2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawUserIcons</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;beforeIcon&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span> <span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">w2</span> <span class="p">;</span> <span class="n">indent</span> <span class="o">+=</span> <span class="n">w2</span>

        <span class="n">h2</span><span class="p">,</span><span class="n">w2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawIcon</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span> <span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">w2</span> <span class="p">;</span> <span class="n">indent</span> <span class="o">+=</span> <span class="n">w2</span><span class="o">/</span><span class="mi">2</span>

        <span class="c"># Nothing after here affects indentation.</span>
        <span class="n">h2</span><span class="p">,</span><span class="n">w2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawUserIcons</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;beforeHeadline&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span> <span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">w2</span>

        <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawText</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widthInPixels</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>

        <span class="n">h2</span><span class="p">,</span><span class="n">w2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawUserIcons</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;afterHeadline&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawClickBox</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">indent</span>
    <span class="c">#@+node:ekr.20081121110412.483: *6* drawText</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawText">[docs]</a>    <span class="k">def</span> <span class="nf">drawText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;draw text for position p at nominal coordinates x,y.&quot;&quot;&quot;</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_indent</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;draw-outline-text-box&quot;</span><span class="p">,</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">newText</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lineyoffset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">configureTextState</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
    <span class="c">#@+node:ekr.20081121110412.484: *6* drawUserIcons &amp; helper</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawUserIcons"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawUserIcons">[docs]</a>    <span class="k">def</span> <span class="nf">drawUserIcons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">where</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Draw any icons specified by p.v.unknownAttributes[&quot;icons&quot;].&quot;&quot;&quot;</span>

        <span class="n">h</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="n">com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">editCommands</span>
        <span class="n">iconsList</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">getIconList</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iconsList</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">w</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">theDict</span> <span class="ow">in</span> <span class="n">iconsList</span><span class="p">:</span>
                <span class="n">h2</span><span class="p">,</span><span class="n">w2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawUserIcon</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">where</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">theDict</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">h2</span><span class="p">)</span> <span class="p">;</span> <span class="n">w</span> <span class="o">+=</span> <span class="n">w2</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>

        <span class="c"># g.trace(where,h,w)</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.485: *7* drawUserIcon</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawUserIcon"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawUserIcon">[docs]</a>    <span class="k">def</span> <span class="nf">drawUserIcon</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">where</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w2</span><span class="p">,</span><span class="n">theDict</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">h</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">where</span> <span class="o">!=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;where&quot;</span><span class="p">,</span><span class="s">&quot;beforeHeadline&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">w</span>

        <span class="c"># if self.trace_gc: g.printNewObjects(tag=&#39;userIcon 1&#39;)</span>

        <span class="c"># g.trace(where,x,y,theDict)</span>

        <span class="c">#@+&lt;&lt; set offsets and pads &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.486: *8* &lt;&lt; set offsets and pads &gt;&gt;</span>
        <span class="n">xoffset</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;xoffset&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>    <span class="n">xoffset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xoffset</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">xoffset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">yoffset</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;yoffset&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>    <span class="n">yoffset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">yoffset</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">yoffset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">xpad</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;xpad&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>    <span class="n">xpad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xpad</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">xpad</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">ypad</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;ypad&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>    <span class="n">ypad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ypad</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">ypad</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#@-&lt;&lt; set offsets and pads &gt;&gt;</span>
        <span class="n">theType</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">theType</span> <span class="o">==</span> <span class="s">&quot;icon&quot;</span><span class="p">:</span>
            <span class="c">### not ready yet.</span>
            <span class="c"># s = theDict.get(&quot;icon&quot;)</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">theType</span> <span class="o">==</span> <span class="s">&quot;file&quot;</span><span class="p">:</span>
            <span class="n">theFile</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">)</span>
            <span class="n">relPath</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;relPath&#39;</span><span class="p">)</span>
            <span class="c">#@+&lt;&lt; draw the icon at file &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.487: *8* &lt;&lt; draw the icon at file &gt;&gt;</span>
            <span class="k">if</span> <span class="n">relPath</span><span class="p">:</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&quot;..&quot;</span><span class="p">,</span><span class="s">&quot;Icons&quot;</span><span class="p">,</span><span class="n">relPath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&quot;..&quot;</span><span class="p">,</span><span class="s">&quot;Icons&quot;</span><span class="p">,</span><span class="n">theFile</span><span class="p">)</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_normpath</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>

            <span class="c"># Bug fix: the key must include distinguish nodes.</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">fullname</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>
                    <span class="n">image1</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">image1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c">#g.es_exception()</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">fullname</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c">#g.es_exception()</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="n">image</span><span class="p">:</span>
                <span class="n">theId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">+</span><span class="n">xoffset</span><span class="o">+</span><span class="n">w2</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">yoffset</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="s">&quot;nw&quot;</span><span class="p">,</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>

                <span class="n">tag</span><span class="o">=</span><span class="s">&#39;userIcon-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theId</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">itemconfigure</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">tag</span><span class="o">=</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="s">&#39;userIcon&#39;</span><span class="p">))</span> <span class="c">#BJ</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">[</span><span class="n">theId</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="k">def</span> <span class="nf">deleteButtonCallback</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">fullname</span><span class="o">=</span><span class="n">fullname</span><span class="p">,</span><span class="n">relPath</span><span class="o">=</span><span class="n">relPath</span><span class="p">):</span>
                    <span class="c">#g.trace()</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">editCommands</span><span class="o">.</span><span class="n">deleteIconByName</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">fullname</span><span class="p">,</span><span class="n">relPath</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_block_canvas_menu</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">return</span> <span class="s">&#39;break&#39;</span>

                <span class="n">c</span><span class="o">.</span><span class="n">tag_bind</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="s">&#39;&lt;3&gt;&#39;</span><span class="p">,</span><span class="n">deleteButtonCallback</span><span class="p">)</span>

                <span class="c"># assert(theId not in self.visibleIcons)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visibleUserIcons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>

                <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">+</span> <span class="n">yoffset</span> <span class="o">+</span> <span class="n">ypad</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>  <span class="o">+</span> <span class="n">xoffset</span> <span class="o">+</span> <span class="n">xpad</span>
            <span class="c">#@-&lt;&lt; draw the icon at file &gt;&gt;</span>
        <span class="k">elif</span> <span class="n">theType</span> <span class="o">==</span> <span class="s">&quot;url&quot;</span><span class="p">:</span>
            <span class="c">## url = theDict.get(&quot;url&quot;)</span>
            <span class="c">#@+&lt;&lt; draw the icon at url &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.488: *8* &lt;&lt; draw the icon at url &gt;&gt;</span>
            <span class="k">pass</span>
            <span class="c">#@-&lt;&lt; draw the icon at url &gt;&gt;</span>

        <span class="c"># Allow user to specify height, width explicitly.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;height&quot;</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>

        <span class="c"># if self.trace_gc: g.printNewObjects(tag=&#39;userIcon 2&#39;)</span>

        <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">w</span>
    <span class="c">#@+node:ekr.20081121110412.489: *6* drawTopTree (tk)</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawTopTree"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawTopTree">[docs]</a>    <span class="k">def</span> <span class="nf">drawTopTree</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Draws the top-level tree, taking into account the hoist state.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_redraw</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redrawing</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># Recycle all widgets and clear all widget lists.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recycleWidgets</span><span class="p">()</span>
        <span class="c"># Clear all ids so invisible id&#39;s don&#39;t confuse eventToPosition &amp; findPositionWithIconId</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iconIds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Disable drags across redraws.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;redrawCount&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">redrawCount</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
                <span class="c"># &#39;len(c.hoistStack)&#39;,len(c.hoistStack))</span>
            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">positions</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">prevPositions</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;**** gen: </span><span class="si">%-3d</span><span class="s"> positions: </span><span class="si">%5d</span><span class="s"> +</span><span class="si">%4d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span><span class="n">delta</span><span class="p">),</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prevPositions</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">positions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_gc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">printNewObjects</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;top 1&#39;</span><span class="p">)</span>

        <span class="n">hoistFlag</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">:</span>
            <span class="n">bunch</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">bunch</span><span class="o">.</span><span class="n">p</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;@chapter&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">firstChild</span><span class="p">()</span>
                <span class="n">hoistFlag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawTree</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root_left</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root_top</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">hoistFlag</span><span class="o">=</span><span class="n">hoistFlag</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_gc</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">printNewObjects</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="s">&#39;top 2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_stats</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">showStats</span><span class="p">()</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="s">&quot;lines&quot;</span><span class="p">)</span>  <span class="c"># Lowest.</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="s">&quot;textBox&quot;</span><span class="p">)</span> <span class="c"># Not the Tk.Text widget: it should be low.</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="s">&quot;clickBox&quot;</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="s">&quot;clickExpandBox&quot;</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="s">&quot;iconBox&quot;</span><span class="p">)</span> <span class="c"># Higest. BJ:Not now</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="s">&quot;plusBox&quot;</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="s">&quot;userIcon&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redrawing</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.490: *6* drawTree</span></div>
<div class="viewcode-block" id="leoTkinterTree.drawTree"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.drawTree">[docs]</a>    <span class="k">def</span> <span class="nf">drawTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">hoistFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="n">yfirst</span> <span class="o">=</span> <span class="n">ylast</span> <span class="o">=</span> <span class="n">y</span> <span class="p">;</span> <span class="n">h1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;draw-sub-outline&quot;</span><span class="p">,</span><span class="n">tree</span><span class="o">=</span><span class="n">tree</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span><span class="n">hoistFlag</span><span class="o">=</span><span class="n">hoistFlag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">data</span>

        <span class="k">while</span> <span class="n">p</span><span class="p">:</span> <span class="c"># Do not use iterator.</span>
            <span class="c"># This is the ONLY copy of p that needs to be made;</span>
            <span class="c"># no other drawing routine calls any p.moveTo method.</span>
            <span class="n">const_p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">h</span><span class="p">,</span><span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawNode</span><span class="p">(</span><span class="n">const_p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">h1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">h</span> <span class="c"># Set h1 *after* calling drawNode.</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">h</span> <span class="p">;</span> <span class="n">ylast</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">hasFirstChild</span><span class="p">():</span>
                <span class="c"># Must make an additional copy here by calling firstChild.</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawTree</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">firstChild</span><span class="p">(),</span><span class="n">x</span><span class="o">+</span><span class="n">indent</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hoistFlag</span><span class="p">:</span> <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>         <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="c"># Draw the vertical line.</span>
        <span class="k">if</span> <span class="n">h1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">level</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="n">yfirst</span><span class="o">+</span><span class="p">(</span><span class="n">h1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">yfirst</span><span class="o">-</span><span class="n">h1</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">ylast</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">hline_y</span><span class="o">-</span><span class="n">h</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>
    <span class="c">#@+node:ekr.20081121110412.491: *5* Helpers...</span>
    <span class="c">#@+node:ekr.20081121110412.492: *6* getIconImage</span></div>
<div class="viewcode-block" id="leoTkinterTree.getIconImage"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.getIconImage">[docs]</a>    <span class="k">def</span> <span class="nf">getIconImage</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="c"># Return the image from the cache if possible.</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c"># g.trace(name)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">loadDir</span><span class="p">,</span><span class="s">&quot;..&quot;</span><span class="p">,</span><span class="s">&quot;Icons&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_normpath</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span><span class="nb">file</span><span class="o">=</span><span class="n">fullname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iconimages</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
            <span class="k">return</span> <span class="n">image</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;exception loading:&quot;</span><span class="p">,</span><span class="n">fullname</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.493: *6* inVisibleArea &amp; inExpandedVisibleArea</span></div>
<div class="viewcode-block" id="leoTkinterTree.inVisibleArea"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.inVisibleArea">[docs]</a>    <span class="k">def</span> <span class="nf">inVisibleArea</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y1</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span><span class="p">:</span>
                <span class="n">vis1</span><span class="p">,</span><span class="n">vis2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
                <span class="k">return</span> <span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">vis1</span> <span class="ow">and</span> <span class="n">y1</span> <span class="o">&lt;=</span> <span class="n">vis2</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span> <span class="c"># This forces all nodes to be allocated on all redraws.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.inExpandedVisibleArea"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.inExpandedVisibleArea">[docs]</a>    <span class="k">def</span> <span class="nf">inExpandedVisibleArea</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">y1</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expandedVisibleArea</span><span class="p">:</span>
            <span class="n">vis1</span><span class="p">,</span><span class="n">vis2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expandedVisibleArea</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
            <span class="k">return</span> <span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">vis1</span> <span class="ow">and</span> <span class="n">y1</span> <span class="o">&lt;=</span> <span class="n">vis2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.494: *6* numberOfVisibleNodes</span></div>
<div class="viewcode-block" id="leoTkinterTree.numberOfVisibleNodes"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.numberOfVisibleNodes">[docs]</a>    <span class="k">def</span> <span class="nf">numberOfVisibleNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">p</span><span class="o">.</span><span class="n">moveToVisNext</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="c">#@+node:ekr.20081121110412.495: *6* scrollTo</span></div>
<div class="viewcode-block" id="leoTkinterTree.scrollTo"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.scrollTo">[docs]</a>    <span class="k">def</span> <span class="nf">scrollTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Scrolls the canvas so that p is in view.&quot;&quot;&quot;</span>

        <span class="c"># This can be called at idle time, so there are shutdown issues.</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">quitting</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">windowList</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span> <span class="p">;</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">positionExists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*** current position&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">positionExists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;current p does not exist&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">positionExists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no position&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;***&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span><span class="s">&#39;exists&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">positionExists</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yoffset</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_selected_tree_node</span><span class="p">:</span> <span class="c"># New in Leo 4.4.3.</span>
                <span class="c">#@+&lt;&lt; compute frac0 &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.496: *7* &lt;&lt; compute frac0 &gt;&gt;</span>
                <span class="c"># frac0 attempt to put the </span>
                <span class="n">scrollRegion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&#39;scrollregion&#39;</span><span class="p">)</span>
                <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">winfo_geometry</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">scrollRegion</span> <span class="ow">and</span> <span class="n">geom</span><span class="p">:</span>
                    <span class="n">scrollRegion</span> <span class="o">=</span> <span class="n">scrollRegion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                    <span class="c"># if trace: g.trace(&#39;scrollRegion&#39;,repr(scrollRegion))</span>
                    <span class="n">htot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scrollRegion</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">wh</span><span class="p">,</span><span class="n">junk</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span>
                    <span class="n">junk</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">wh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">h</span><span class="p">:</span> <span class="n">wtot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">wtot</span> <span class="o">=</span> <span class="mi">500</span>
                    <span class="c"># if trace: g.trace(&#39;geom&#39;,geom,&#39;wtot&#39;,wtot,&#39;htot&#39;,htot)</span>
                    <span class="k">if</span> <span class="n">htot</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                        <span class="n">frac0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">h1</span><span class="o">-</span><span class="n">wtot</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">htot</span><span class="p">)</span>
                        <span class="n">frac0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">frac0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">frac0</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">frac0</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">;</span> <span class="n">htot</span> <span class="o">=</span> <span class="n">wtot</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c">#@-&lt;&lt; compute frac0 &gt;&gt;</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span><span class="o">-</span><span class="n">frac0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;delta&#39;</span><span class="p">,</span><span class="n">delta</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span> <span class="o">=</span> <span class="n">frac0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="s">&quot;moveto&quot;</span><span class="p">,</span><span class="n">frac0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;frac0 </span><span class="si">%1.2f</span><span class="s"> h1 </span><span class="si">%3d</span><span class="s"> htot </span><span class="si">%3d</span><span class="s"> wtot </span><span class="si">%3d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">frac0</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">htot</span><span class="p">,</span><span class="n">wtot</span><span class="p">),</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">lastVisible</span><span class="p">()</span>
                <span class="n">nextToLast</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">visBack</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yoffset</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
                <span class="c">#@+&lt;&lt; compute approximate line height &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.497: *7* &lt;&lt; compute approximate line height &gt;&gt;</span>
                <span class="k">if</span> <span class="n">nextToLast</span><span class="p">:</span> <span class="c"># 2/2/03: compute approximate line height.</span>
                    <span class="n">lineHeight</span> <span class="o">=</span> <span class="n">h2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">yoffset</span><span class="p">(</span><span class="n">nextToLast</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lineHeight</span> <span class="o">=</span> <span class="mi">20</span> <span class="c"># A reasonable default.</span>
                <span class="c">#@-&lt;&lt; compute approximate line height &gt;&gt;</span>
                <span class="c">#@+&lt;&lt; Compute the fractions to scroll down/up &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.498: *7* &lt;&lt; Compute the fractions to scroll down/up &gt;&gt;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">leo_treeBar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="c"># Get the previous values of the scrollbar.</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">except</span><span class="p">:</span> <span class="n">lo</span><span class="p">,</span><span class="n">hi</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span>

                <span class="c"># h1 and h2 are the y offsets of the present and last nodes.</span>
                <span class="k">if</span> <span class="n">h2</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">frac</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span> <span class="c"># For scrolling down.</span>
                    <span class="n">frac2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">lineHeight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span> <span class="c"># For scrolling up.</span>
                    <span class="n">frac2</span> <span class="o">=</span> <span class="n">frac2</span> <span class="o">-</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">frac</span> <span class="o">=</span> <span class="n">frac2</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c"># probably any value would work here.</span>

                <span class="n">frac</span> <span class="o">=</span>  <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">frac2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">frac2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="c">#@-&lt;&lt; Compute the fractions to scroll down/up &gt;&gt;</span>
                <span class="k">if</span> <span class="n">frac</span> <span class="o">&lt;=</span> <span class="n">lo</span><span class="p">:</span> <span class="c"># frac is for scrolling down.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span> <span class="o">!=</span> <span class="n">frac</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span> <span class="o">=</span> <span class="n">frac</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="s">&quot;moveto&quot;</span><span class="p">,</span><span class="n">frac</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;frac  </span><span class="si">%1.2f</span><span class="s"> h1 </span><span class="si">%3d</span><span class="s"> h2 </span><span class="si">%3d</span><span class="s"> lo </span><span class="si">%1.2f</span><span class="s"> hi </span><span class="si">%1.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">frac</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">hi</span><span class="p">),</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">frac2</span> <span class="o">+</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">hi</span><span class="p">:</span> <span class="c"># frac2 is for scrolling up.</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span> <span class="o">!=</span> <span class="n">frac2</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">prevMoveToFrac</span> <span class="o">=</span> <span class="n">frac2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="s">&quot;moveto&quot;</span><span class="p">,</span><span class="n">frac2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;frac2 </span><span class="si">%1.2f</span><span class="s"> h1 </span><span class="si">%3d</span><span class="s"> h2 </span><span class="si">%3d</span><span class="s"> lo </span><span class="si">%1.2f</span><span class="s"> hi </span><span class="si">%1.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">frac2</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">h2</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">hi</span><span class="p">),</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">after_idle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idle_second_redraw</span><span class="p">)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">setTopVnode</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># 1/30/04: remember a pseudo &quot;top&quot; node.</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
</div>
    <span class="n">idle_scrollTo</span> <span class="o">=</span> <span class="n">scrollTo</span> <span class="c"># For compatibility.</span>
    <span class="c">#@+node:ekr.20081121110412.499: *6* yoffset (tkTree)</span>
    <span class="c">#@+at We can&#39;t just return icony because the tree hasn&#39;t been redrawn yet.</span>
    <span class="c"># For the same reason we can&#39;t rely on any TK canvas methods here.</span>
    <span class="c">#@@c</span>

<div class="viewcode-block" id="leoTkinterTree.yoffset"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.yoffset">[docs]</a>    <span class="k">def</span> <span class="nf">yoffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p1</span><span class="p">):</span>
        <span class="c"># if not p1.isVisible(): g.pr(&quot;yoffset not visible:&quot;,p1)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p1</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">:</span>
            <span class="n">bunch</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">bunch</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yoffsetTree</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">isTop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="c"># flag can be False during initialization.</span>
            <span class="c"># if not flag: g.pr(&quot;*** yoffset fails:&quot;,&#39;root&#39;,root,&#39;p1&#39;,p1,&#39;returns&#39;,h)</span>
            <span class="k">return</span> <span class="n">h</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.yoffsetTree"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.yoffsetTree">[docs]</a>    <span class="k">def</span> <span class="nf">yoffsetTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">isTop</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">;</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;entry&#39;</span><span class="p">,</span><span class="s">&#39;root&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span><span class="s">&#39;target&#39;</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p1</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">positionExists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*** does not exist&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="bp">False</span> <span class="c"># An extra precaution.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">isTop</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;c.hoistStack&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isTop</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">hoistStack</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">firstChild</span><span class="p">():</span>  <span class="n">theIter</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">firstChild</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>               <span class="n">theIter</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theIter</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">self_and_siblings</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">p2</span> <span class="ow">in</span> <span class="n">theIter</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">p1</span><span class="o">.</span><span class="n">h</span> <span class="o">==</span> <span class="n">p2</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;loop&#39;</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">stack</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p2</span> <span class="o">==</span> <span class="n">p1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;returns&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">p1</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="bp">True</span>
            <span class="n">h</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
            <span class="k">if</span> <span class="n">p2</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p2</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">():</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">firstChild</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;recursive call&#39;</span><span class="p">)</span>
                <span class="n">h2</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yoffsetTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">isTop</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">+=</span> <span class="n">h2</span>
                <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">trace</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;returns&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">p1</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;not found&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">p1</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="bp">False</span>
    <span class="c">#@+node:ekr.20081121110412.500: *5* tree.edraw_after methods (new)</span>
    <span class="c"># We now use the definitions in the base leoTree class.</span>

    <span class="c"># redraw_after_icons_changed  = redraw</span>
    <span class="c"># redraw_after_clone          = redraw</span>
    <span class="c"># redraw_after_contract       = redraw</span>
    <span class="c"># redraw_after_delete         = redraw</span>
    <span class="c"># redraw_after_expand         = redraw</span>
    <span class="c"># redraw_after_insert         = redraw</span>
    <span class="c"># redraw_after_move_down      = redraw</span>
    <span class="c"># redraw_after_move_left      = redraw</span>
    <span class="c"># redraw_after_move_right     = redraw</span>
    <span class="c"># redraw_after_move_up        = redraw</span>
    <span class="c"># redraw_after_select         = redraw</span>
    <span class="c">#@+node:ekr.20081121110412.501: *4* Event handlers (tkTree)</span>
    <span class="c">#@+node:ekr.20081121110412.502: *5* Helpers</span>
    <span class="c">#@+node:ekr.20081121110412.503: *6* checkWidgetList</span></div>
<div class="viewcode-block" id="leoTkinterTree.checkWidgetList"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.checkWidgetList">[docs]</a>    <span class="k">def</span> <span class="nf">checkWidgetList</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">True</span> <span class="c"># This will fail when the headline actually changes!</span>
    <span class="c">#@+node:ekr.20081121110412.504: *6* dumpWidgetList</span></div>
<div class="viewcode-block" id="leoTkinterTree.dumpWidgetList"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.dumpWidgetList">[docs]</a>    <span class="k">def</span> <span class="nf">dumpWidgetList</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tag</span><span class="p">):</span>

        <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">checkWidgetList: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tag</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span><span class="p">:</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_position</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="n">addr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textAddr</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;p:&quot;</span><span class="p">,</span><span class="n">addr</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="n">s</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;w:&quot;</span><span class="p">,</span><span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">addr</span><span class="p">),</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;w.leo_position == None&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.505: *6* tree.edit_widget</span></div>
<div class="viewcode-block" id="leoTkinterTree.edit_widget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.edit_widget">[docs]</a>    <span class="k">def</span> <span class="nf">edit_widget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Returns the Tk.Edit widget for position p.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findEditWidget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.506: *6* eventToPosition</span></div>
<div class="viewcode-block" id="leoTkinterTree.eventToPosition"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.eventToPosition">[docs]</a>    <span class="k">def</span> <span class="nf">eventToPosition</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
        <span class="n">y</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">find_overlapping</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># Item may be a tuple, possibly empty.</span>
        <span class="k">try</span><span class="p">:</span>    <span class="n">theId</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">theId</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>

        <span class="c"># A kludge: p will be None for vertical lines.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">find_overlapping</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>    <span class="n">theId</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">theId</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">es_print</span><span class="p">(</span><span class="s">&#39;oops:&#39;</span><span class="p">,</span><span class="s">&#39;eventToPosition&#39;</span><span class="p">,</span><span class="s">&#39;failed&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>
            <span class="c"># g.trace(&quot;was vertical line&quot;,p)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findEditWidget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">w</span><span class="p">)),</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="bp">None</span><span class="p">)</span>

        <span class="c"># defensive programming: this copy is not needed.</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c"># Make _sure_ nobody changes this table!</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.507: *6* findEditWidget (tkTree)</span></div>
<div class="viewcode-block" id="leoTkinterTree.findEditWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.findEditWidget">[docs]</a>    <span class="k">def</span> <span class="nf">findEditWidget</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Return the Tk.Text item corresponding to p.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># if trace: g.trace(g.callers())</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">c</span><span class="p">:</span>
            <span class="c"># if trace: g.trace(&#39;h&#39;,p.h,&#39;key&#39;,p.key())</span>
            <span class="n">aTuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleText</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">key</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">aTuple</span><span class="p">:</span>
                <span class="n">w</span><span class="p">,</span><span class="n">theId</span> <span class="o">=</span> <span class="n">aTuple</span>
                <span class="c"># if trace: g.trace(&#39;id(p.v):&#39;,id(p.v),&#39;%4d&#39; % (theId),self.textAddr(w),p.h)</span>
                <span class="k">return</span> <span class="n">w</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;oops: not found&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;not found&#39;</span><span class="p">,</span><span class="n">p</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.508: *6* findVnodeWithIconId</span></div>
<div class="viewcode-block" id="leoTkinterTree.findPositionWithIconId"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.findPositionWithIconId">[docs]</a>    <span class="k">def</span> <span class="nf">findPositionWithIconId</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theId</span><span class="p">):</span>

        <span class="c"># Due to an old bug, theId may be a tuple.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconIds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theId</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iconIds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">p</span><span class="p">,</span><span class="n">generation</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">if</span> <span class="n">generation</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">p</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;*** wrong generation: </span><span class="si">%d</span><span class="s"> ***&quot;</span> <span class="o">%</span> <span class="n">theId</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">theId</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="c">#@+node:ekr.20081121110412.509: *5* Click Box...</span>
    <span class="c">#@+node:ekr.20081121110412.510: *6* onClickBoxClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onClickBoxClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onClickBoxClick">[docs]</a>    <span class="k">def</span> <span class="nf">onClickBoxClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventToPosition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;boxclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">endEditing</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">p1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialClickExpandsOrContractsNode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">():</span> <span class="n">p</span><span class="o">.</span><span class="n">contract</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>              <span class="n">p</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="o">.</span><span class="n">handleUserClick</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stayInTree</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">treeWantsFocus</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bodyWantsFocus</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;boxclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>

        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.511: *6* onClickBoxRightClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onClickBoxRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onClickBoxRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onClickBoxRightClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c">#g.trace()</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.512: *6* onPlusBoxRightClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onPlusBoxRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onPlusBoxRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onPlusBoxRightClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_block_canvas_menu</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventToPosition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OnActivateHeadline</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>

        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&#39;rclick-popup&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span><span class="n">context_menu</span><span class="o">=</span><span class="s">&#39;plusbox&#39;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.513: *5* Dragging (tkTree)</span>
    <span class="c">#@+node:ekr.20081121110412.514: *6* endDrag</span></div>
<div class="viewcode-block" id="leoTkinterTree.endDrag"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.endDrag">[docs]</a>    <span class="k">def</span> <span class="nf">endDrag</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;The official helper of the onEndDrag event handler.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span>
        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="p">:</span> <span class="k">return</span>

        <span class="c">#@+&lt;&lt; set vdrag, childFlag &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.515: *7* &lt;&lt; set vdrag, childFlag &gt;&gt;</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="n">canvas_x</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">canvas_y</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">theId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">canvas_x</span><span class="p">,</span><span class="n">canvas_y</span><span class="p">)</span>
        <span class="c"># theId = self.canvas.find_overlapping(canvas_x,canvas_y,canvas_x,canvas_y)</span>

        <span class="n">vdrag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPositionWithIconId</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>
        <span class="n">childFlag</span> <span class="o">=</span> <span class="n">vdrag</span> <span class="ow">and</span> <span class="n">vdrag</span><span class="o">.</span><span class="n">hasChildren</span><span class="p">()</span> <span class="ow">and</span> <span class="n">vdrag</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()</span>
        <span class="c">#@-&lt;&lt; set vdrag, childFlag &gt;&gt;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_clone_drags</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_control_drag_on_mouse_down</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controlDrag</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">controlKeyIsDown</span>

        <span class="n">redrawFlag</span> <span class="o">=</span> <span class="n">vdrag</span> <span class="ow">and</span> <span class="n">vdrag</span><span class="o">.</span><span class="n">v</span> <span class="o">!=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span>
        <span class="k">if</span> <span class="n">redrawFlag</span><span class="p">:</span> <span class="c"># Disallow drag to joined node.</span>
            <span class="c">#@+&lt;&lt; drag p to vdrag &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.516: *7* &lt;&lt; drag p to vdrag &gt;&gt;</span>
            <span class="c"># g.trace(&quot;*** end drag   ***&quot;,theId,x,y,p.h,vdrag.h)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlDrag</span><span class="p">:</span> <span class="c"># Clone p and move the clone.</span>
                <span class="k">if</span> <span class="n">childFlag</span><span class="p">:</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">dragCloneToNthChildOf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">vdrag</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">dragCloneAfter</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">vdrag</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># Just drag p.</span>
                <span class="k">if</span> <span class="n">childFlag</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">dragToNthChildOf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">vdrag</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">dragAfter</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">vdrag</span><span class="p">)</span>
            <span class="c">#@-&lt;&lt; drag p to vdrag &gt;&gt;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Cancel drag&quot;</span><span class="p">)</span>

        <span class="c"># Reset the old cursor by brute force.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">[</span><span class="s">&#39;cursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;arrow&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Must set self.drag_p = None first.</span>
        <span class="k">if</span> <span class="n">redrawFlag</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">redraw_now</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">recolor_now</span><span class="p">()</span> <span class="c"># Dragging can affect coloring.</span>

        <span class="c"># g.trace(redrawFlag)</span>
    <span class="c">#@+node:ekr.20081121110412.517: *6* startDrag</span>
    <span class="c"># This precomputes numberOfVisibleNodes(), a significant optimization.</span>
    <span class="c"># We also indicate where findPositionWithIconId() should start looking for tree id&#39;s.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.startDrag"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.startDrag">[docs]</a>    <span class="k">def</span> <span class="nf">startDrag</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;The official helper of the onDrag event handler.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">canvasx</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">canvasy</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">theId</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="c"># theId = canvas.find_overlapping(canvas_x,canvas_y,canvas_x,canvas_y)</span>
            <span class="k">if</span> <span class="n">theId</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
            <span class="k">try</span><span class="p">:</span> <span class="n">theId</span> <span class="o">=</span> <span class="n">theId</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theId</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c"># defensive programming: not needed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># g.trace(&quot;*** start drag ***&quot;,theId,self.drag_p.h)</span>
        <span class="c"># Only do this once: greatly speeds drags.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savedNumberOfVisibleNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfVisibleNodes</span><span class="p">()</span>
        <span class="c"># g.trace(&#39;self.controlDrag&#39;,self.controlDrag)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_clone_drags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controlDrag</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">controlKeyIsDown</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_control_drag_on_mouse_down</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_drag_messages</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlDrag</span><span class="p">:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;dragged node will be cloned&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s">&quot;dragged node will be moved&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlDrag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">[</span><span class="s">&#39;cursor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hand2&quot;</span> <span class="c"># &quot;center_ptr&quot;</span>
    <span class="c">#@+node:ekr.20081121110412.518: *6* onContinueDrag</span></div>
<div class="viewcode-block" id="leoTkinterTree.onContinueDrag"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onContinueDrag">[docs]</a>    <span class="k">def</span> <span class="nf">onContinueDrag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="p">;</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">winfo_pointerx</span><span class="p">(),</span><span class="n">frame</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">winfo_pointery</span><span class="p">()</span>
                <span class="c"># Stop the scrolling if we go outside the entire window.</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span><span class="p">:</span> <span class="c"># This gets cleared by onEndDrag()</span>
                <span class="c">#@+&lt;&lt; scroll the canvas as needed &gt;&gt;</span>
                <span class="c">#@+node:ekr.20081121110412.519: *7* &lt;&lt; scroll the canvas as needed &gt;&gt;</span>
                <span class="c"># Scroll the screen up or down one line if the cursor (y) is outside the canvas.</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
                    <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">leo_treeBar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">savedNumberOfVisibleNodes</span>
                    <span class="n">line_frac</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">frac</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lo</span> <span class="o">-</span> <span class="n">line_frac</span><span class="p">,</span> <span class="n">lo</span> <span class="o">+</span> <span class="n">line_frac</span><span class="p">)</span>
                    <span class="n">frac</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
                    <span class="n">frac</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="s">&quot;moveto&quot;</span><span class="p">,</span> <span class="n">frac</span><span class="p">)</span>

                    <span class="c"># Queue up another event to keep scrolling while the cursor is outside the canvas.</span>
                    <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">leo_treeBar</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lo</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="n">hi</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">):</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">after_idle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onContinueDrag</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="c"># Don&#39;t propagate the event.</span>
                <span class="c">#@-&lt;&lt; scroll the canvas as needed &gt;&gt;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;continue drag&quot;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.520: *6* onDrag</span></div>
<div class="viewcode-block" id="leoTkinterTree.onDrag"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onDrag">[docs]</a>    <span class="k">def</span> <span class="nf">onDrag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragging</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;drag1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">startDrag</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;drag2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;dragging1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onContinueDrag</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;dragging2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.521: *6* onEndDrag</span></div>
<div class="viewcode-block" id="leoTkinterTree.onEndDrag"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onEndDrag">[docs]</a>    <span class="k">def</span> <span class="nf">onEndDrag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Tree end-of-drag handler called from vnode event handler.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_p</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;enddrag1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endDrag</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;enddrag2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.522: *5* Icon Box...</span>
    <span class="c">#@+node:ekr.20081121110412.523: *6* onIconBoxClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onIconBoxClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onIconBoxClick">[docs]</a>    <span class="k">def</span> <span class="nf">onIconBoxClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventToPosition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;iconclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onDrag</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">scroll</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="o">.</span><span class="n">handleUserClick</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;iconclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span> <span class="c"># disable expanded box handling.</span>
    <span class="c">#@+node:ekr.20081121110412.524: *6* onIconBoxRightClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onIconBoxRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onIconBoxRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onIconBoxRightClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a right click in any outline widget.&quot;&quot;&quot;</span>

        <span class="c">#g.trace()</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventToPosition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;iconrclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnActivateHeadline</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&#39;rclick-popup&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">context_menu</span><span class="o">=</span><span class="s">&#39;iconbox&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">OnPopup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;iconrclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;iconrclick&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_block_canvas_menu</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.525: *6* onIconBoxDoubleClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onIconBoxDoubleClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onIconBoxDoubleClick">[docs]</a>    <span class="k">def</span> <span class="nf">onIconBoxDoubleClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventToPosition</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;icondclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span> <span class="c"># Bug fix: 11/30/05</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnIconDoubleClick</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># Call the method in the base class.</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;icondclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;icondclick&quot;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.526: *5* OnActivateHeadline (tkTree)</span></div>
<div class="viewcode-block" id="leoTkinterTree.OnActivateHeadline"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.OnActivateHeadline">[docs]</a>    <span class="k">def</span> <span class="nf">OnActivateHeadline</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle common process when any part of a headline is clicked.&#39;&#39;&#39;</span>

        <span class="c"># g.trace(p.h)</span>

        <span class="n">returnVal</span> <span class="o">=</span> <span class="s">&#39;break&#39;</span> <span class="c"># Default: do nothing more.</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>
            <span class="c">#@+&lt;&lt; activate this window &gt;&gt;</span>
            <span class="c">#@+node:ekr.20081121110412.527: *6* &lt;&lt; activate this window &gt;&gt;</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;current&#39;</span><span class="p">,</span><span class="s">&#39;active&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editLabel</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># sets focus.</span>
                <span class="c"># If we are active, pass the event along so the click gets handled.</span>
                <span class="c"># Otherwise, do *not* pass the event along so the focus stays the same.</span>
                <span class="n">returnVal</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">,</span><span class="s">&#39;continue&#39;</span><span class="p">,</span><span class="s">&#39;break&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;not current&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">w</span>  <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">bodyCtrl</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="p">:</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">findPanel</span><span class="o">.</span><span class="n">handleUserClick</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">insertSpot</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">spot</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">insertSpot</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">spot</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c"># An important detail.</span>
                <span class="c"># The *canvas* (not the headline) gets the focus so that</span>
                <span class="c"># tree bindings take priority over text bindings.</span>
                <span class="n">c</span><span class="o">.</span><span class="n">treeWantsFocusNow</span><span class="p">()</span> <span class="c"># Now. New in Leo 4.5.</span>
                <span class="c">### c.outerUpdate()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">returnVal</span> <span class="o">=</span> <span class="s">&#39;break&#39;</span>
            <span class="c">#@-&lt;&lt; activate this window &gt;&gt;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;activate tree&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">returnVal</span>
    <span class="c">#@+node:ekr.20081121110412.528: *5* Text Box...</span>
    <span class="c">#@+node:ekr.20081121110412.529: *6* configureTextState</span></div>
<div class="viewcode-block" id="leoTkinterTree.configureTextState"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.configureTextState">[docs]</a>    <span class="k">def</span> <span class="nf">configureTextState</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span>

        <span class="c"># g.trace(c.isCurrentPosition(p),self.c._currentPosition,p)</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isCurrentPosition</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">editPosition</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setEditLabelState</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># selected, editing.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setSelectedLabelState</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># selected, not editing.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUnselectedLabelState</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># unselected</span>
    <span class="c">#@+node:ekr.20081121110412.530: *6* onCtontrolT</span>
    <span class="c"># This works around an apparent Tk bug.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.onControlT"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onControlT">[docs]</a>    <span class="k">def</span> <span class="nf">onControlT</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># If we don&#39;t inhibit further processing the Tx.Text widget switches characters!</span>
        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@+node:ekr.20081121110412.531: *6* onHeadlineClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onHeadlineClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onHeadlineClick">[docs]</a>    <span class="k">def</span> <span class="nf">onHeadlineClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># g.trace(&#39;p&#39;,p)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_position</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="s">&#39;oops&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;break&#39;</span>

        <span class="c"># g.trace(g.app.gui.widget_name(w),p and p.h)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;headclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="n">returnVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnActivateHeadline</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;headclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">returnVal</span> <span class="o">=</span> <span class="s">&#39;break&#39;</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;headclick&quot;</span><span class="p">)</span>

        <span class="c"># &#39;continue&#39; is sometimes correct here.</span>
        <span class="c"># &#39;break&#39; would make it impossible to unselect the headline text.</span>
        <span class="c"># g.trace(&#39;returnVal&#39;,returnVal,&#39;stayInTree&#39;,self.stayInTree)</span>
        <span class="k">return</span> <span class="n">returnVal</span>
    <span class="c">#@+node:ekr.20081121110412.532: *6* onHeadlineRightClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onHeadlineRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onHeadlineRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onHeadlineRightClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle a right click in any outline widget.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">widget</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_position</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="s">&#39;oops&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;break&#39;</span>

        <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;headrclick1&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnActivateHeadline</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&#39;rclick-popup&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">context_menu</span><span class="o">=</span><span class="s">&#39;headline&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">OnPopup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;headrclick2&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_event_exception</span><span class="p">(</span><span class="s">&quot;headrclick&quot;</span><span class="p">)</span>

        <span class="c"># &#39;continue&#39; *is* correct here.</span>
        <span class="c"># &#39;break&#39; would make it impossible to unselect the headline text.</span>

        <span class="k">return</span> <span class="s">&#39;continue&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.533: *5* tree.OnDeactivate</span></div>
<div class="viewcode-block" id="leoTkinterTree.OnDeactivate"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.OnDeactivate">[docs]</a>    <span class="k">def</span> <span class="nf">OnDeactivate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Deactivate the tree pane, dimming any headline being edited.&quot;&quot;&quot;</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">tree</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">dimEditLabel</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.534: *5* tree.OnPopup &amp; allies</span></div>
<div class="viewcode-block" id="leoTkinterTree.OnPopup"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.OnPopup">[docs]</a>    <span class="k">def</span> <span class="nf">OnPopup</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Handle right-clicks in the outline.</span>

<span class="sd">        This is *not* an event handler: it is called from other event handlers.&quot;&quot;&quot;</span>

        <span class="c"># Note: &quot;headrclick&quot; hooks handled by vnode callback routine.</span>

        <span class="k">if</span> <span class="n">event</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setLog</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;create-popup-menu&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createPopupMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;enable-popup-menu-items&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enablePopupMenuItems</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&quot;show-popup-menu&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showPopupMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;break&quot;</span>
    <span class="c">#@+node:ekr.20081121110412.535: *6* OnPopupFocusLost</span>
    <span class="c">#@+at</span>
    <span class="c"># On Linux we must do something special to make the popup menu &quot;unpost&quot; if the</span>
    <span class="c"># mouse is clicked elsewhere. So we have to catch the &lt;FocusOut&gt; event and</span>
    <span class="c"># explicitly unpost. In order to process the &lt;FocusOut&gt; event, we need to be able</span>
    <span class="c"># to find the reference to the popup window again, so this needs to be an</span>
    <span class="c"># attribute of the tree object; hence, &quot;self.popupMenu&quot;.</span>
    <span class="c"># </span>
    <span class="c"># Aside: though Tk tries to be muli-platform, the interaction with different</span>
    <span class="c"># window managers does cause small differences that will need to be compensated by</span>
    <span class="c"># system specific application code. :-(</span>
    <span class="c">#@@c</span>

    <span class="c"># 20-SEP-2002 DTHEIN: This event handler is only needed for Linux.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.OnPopupFocusLost"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.OnPopupFocusLost">[docs]</a>    <span class="k">def</span> <span class="nf">OnPopupFocusLost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popupMenu</span><span class="o">.</span><span class="n">unpost</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.536: *6* createPopupMenu</span></div>
<div class="viewcode-block" id="leoTkinterTree.createPopupMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.createPopupMenu">[docs]</a>    <span class="k">def</span> <span class="nf">createPopupMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">popupMenu</span> <span class="o">=</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># Add the Open With entries if they exist.</span>
        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">openWithTable</span><span class="p">:</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">createOpenWithMenuItemsFromTable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">openWithTable</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">createMenuEntries</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">table</span><span class="p">)</span>

        <span class="c">#@+&lt;&lt; Create the menu table &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.537: *7* &lt;&lt; Create the menu table &gt;&gt;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&quot;&amp;Read @file Nodes&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">readAtFileNodes</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Write @file Nodes&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">fileCommands</span><span class="o">.</span><span class="n">writeAtFileNodes</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Tangle&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">tangle</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Untangle&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">untangle</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Toggle Angle &amp;Brackets&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">toggleAngleBrackets</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Cut Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">cutOutline</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Copy Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">copyOutline</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Paste Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">pasteOutline</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Delete Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">deleteOutline</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Insert Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">insertHeadline</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Clone Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">clone</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Sort C&amp;hildren&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">sortChildren</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;&amp;Sort Siblings&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">sortSiblings</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&quot;Contract Parent&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">contractParent</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c">#@-&lt;&lt; Create the menu table &gt;&gt;</span>

        <span class="c"># New in 4.4.  There is no need for a dontBind argument because</span>
        <span class="c"># Bindings from tables are ignored.</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">createMenuEntries</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">table</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.538: *6* enablePopupMenuItems</span></div>
<div class="viewcode-block" id="leoTkinterTree.enablePopupMenuItems"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.enablePopupMenuItems">[docs]</a>    <span class="k">def</span> <span class="nf">enablePopupMenuItems</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Enable and disable items in the popup menu.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popupMenu</span>

        <span class="c">#@+&lt;&lt; set isAtRoot and isAtFile if v&#39;s tree contains @root or @file nodes &gt;&gt;</span>
        <span class="c">#@+node:ekr.20081121110412.539: *7* &lt;&lt; set isAtRoot and isAtFile if v&#39;s tree contains @root or @file nodes &gt;&gt;</span>
        <span class="n">isAtFile</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">isAtRoot</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">self_and_subtree</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">isAtFile</span> <span class="ow">and</span> <span class="n">isAtRoot</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">isAtFileNode</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">v2</span><span class="o">.</span><span class="n">isAtAsisFileNode</span><span class="p">()</span> <span class="ow">or</span>
                <span class="n">v2</span><span class="o">.</span><span class="n">isAtNoSentFileNode</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">isAtFile</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">isRoot</span><span class="p">,</span><span class="n">junk</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">is_special</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">bodyString</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;@root&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isRoot</span><span class="p">:</span>
                <span class="n">isAtRoot</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c">#@-&lt;&lt; set isAtRoot and isAtFile if v&#39;s tree contains @root or @file nodes &gt;&gt;</span>
        <span class="n">isAtFile</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">isAtFile</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">isAtRoot</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">isAtRoot</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">canContract</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">None</span>
        <span class="n">canContract</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">canContract</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">enable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">enableMenu</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;Read @file Nodes&quot;</span><span class="p">,</span> <span class="s">&quot;Write @file Nodes&quot;</span><span class="p">):</span>
            <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">isAtFile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;Tangle&quot;</span><span class="p">,</span> <span class="s">&quot;Untangle&quot;</span><span class="p">):</span>
            <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">isAtRoot</span><span class="p">)</span>

        <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="s">&quot;Cut Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">canCutOutline</span><span class="p">())</span>
        <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="s">&quot;Delete Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">canDeleteHeadline</span><span class="p">())</span>
        <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="s">&quot;Paste Node&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">canPasteOutline</span><span class="p">())</span>
        <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="s">&quot;Sort Children&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">canSortChildren</span><span class="p">())</span>
        <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="s">&quot;Sort Siblings&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">canSortSiblings</span><span class="p">())</span>
        <span class="n">enable</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span><span class="s">&quot;Contract Parent&quot;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">canContractParent</span><span class="p">())</span>
    <span class="c">#@+node:ekr.20081121110412.540: *6* showPopupMenu</span></div>
<div class="viewcode-block" id="leoTkinterTree.showPopupMenu"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.showPopupMenu">[docs]</a>    <span class="k">def</span> <span class="nf">showPopupMenu</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Show a popup menu.&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popupMenu</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">postPopupMenu</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">menu</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">x_root</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y_root</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popupMenu</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Set the focus immediately so we know when we lose it.</span>
        <span class="c">#c.widgetWantsFocus(menu)</span>
    <span class="c">#@+node:ekr.20081121110412.541: *5* onTreeClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onTreeClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onTreeClick">[docs]</a>    <span class="k">def</span> <span class="nf">onTreeClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Handle an event in the tree canvas, outside of any tree widget.&#39;&#39;&#39;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># New in Leo 4.4.2: a kludge: disable later event handling after a double-click.</span>
        <span class="c"># This allows focus to stick in newly-opened files opened by double-clicking an @url node.</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">doubleClickFlag</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">doubleClickFlag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">treeWantsFocus</span><span class="p">()</span>

        <span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">gui</span><span class="o">.</span><span class="n">killPopupMenu</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.542: *5* onTreeRightClick</span></div>
<div class="viewcode-block" id="leoTkinterTree.onTreeRightClick"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.onTreeRightClick">[docs]</a>    <span class="k">def</span> <span class="nf">onTreeRightClick</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_canvas_menu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_block_canvas_menu</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="s">&#39;break&#39;</span>

        <span class="n">g</span><span class="o">.</span><span class="n">doHook</span><span class="p">(</span><span class="s">&#39;rclick-popup&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">,</span><span class="n">context_menu</span><span class="o">=</span><span class="s">&#39;canvas&#39;</span><span class="p">)</span>

        <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
        <span class="k">return</span> <span class="s">&#39;break&#39;</span>
    <span class="c">#@+node:ekr.20081121110412.543: *4* Incremental drawing...</span>
    <span class="c">#@+node:ekr.20081121110412.544: *5* allocateNodes</span></div>
<div class="viewcode-block" id="leoTkinterTree.allocateNodes"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.allocateNodes">[docs]</a>    <span class="k">def</span> <span class="nf">allocateNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">where</span><span class="p">,</span><span class="n">lines</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Allocate Tk widgets in nodes that will become visible as the result of an upcoming scroll&quot;&quot;&quot;</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">where</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;above&quot;</span><span class="p">,</span><span class="s">&quot;below&quot;</span><span class="p">))</span>

        <span class="c"># g.pr(&quot;allocateNodes: %d lines %s visible area&quot; % (lines,where))</span>

        <span class="c"># Expand the visible area: a little extra delta is safer.</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">lines</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">y1</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span>

        <span class="k">if</span> <span class="n">where</span> <span class="o">==</span> <span class="s">&quot;below&quot;</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">+=</span> <span class="n">delta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">y1</span><span class="o">-</span><span class="n">delta</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expandedVisibleArea</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span>
        <span class="c"># g.pr(&quot;expandedArea:   %5.1f %5.1f&quot; % (y1,y2))</span>

        <span class="c"># Allocate all nodes in expanded visible area.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatedNodeCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">rootPosition</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">root_left</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root_top</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># if self.updatedNodeCount: g.pr(&quot;updatedNodeCount:&quot;, self.updatedNodeCount)</span>
    <span class="c">#@+node:ekr.20081121110412.545: *5* allocateNodesBeforeScrolling</span></div>
<div class="viewcode-block" id="leoTkinterTree.allocateNodesBeforeScrolling"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.allocateNodesBeforeScrolling">[docs]</a>    <span class="k">def</span> <span class="nf">allocateNodesBeforeScrolling</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Calculate the nodes that will become visible as the result of an upcoming scroll.</span>

<span class="sd">        args is the tuple passed to the Tk.Canvas.yview method&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocateOnlyVisibleNodes</span><span class="p">:</span> <span class="k">return</span>

        <span class="c"># g.pr(&quot;allocateNodesBeforeScrolling:&quot;,self.redrawCount,args)</span>

        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">kind</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span> <span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="mi">2</span> <span class="c"># Update by 2 lines to account for rounding.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s">&quot;moveto&quot;</span><span class="p">)</span>
            <span class="n">frac1</span><span class="p">,</span><span class="n">frac2</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="n">frac1</span><span class="p">:</span>
                <span class="n">where</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="n">frac1</span><span class="p">,</span><span class="s">&quot;above&quot;</span><span class="p">,</span><span class="s">&quot;below&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allocateNodes</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span><span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">kind</span><span class="o">==</span><span class="s">&quot;scroll&quot;</span><span class="p">)</span>
            <span class="n">linesPerPage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">;</span> <span class="k">assert</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span><span class="s">&quot;below&quot;</span><span class="p">,</span><span class="s">&quot;above&quot;</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;pages&quot;</span><span class="p">,</span><span class="n">linesPerPage</span><span class="p">,</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allocateNodes</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span><span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.546: *5* updateNode</span></div>
<div class="viewcode-block" id="leoTkinterTree.updateNode"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.updateNode">[docs]</a>    <span class="k">def</span> <span class="nf">updateNode</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Draw a node that may have become visible as a result of a scrolling operation&quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inExpandedVisibleArea</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
            <span class="c"># This check is a major optimization.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_draw_node</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
    <span class="c">#@+node:ekr.20081121110412.547: *5* setVisibleAreaToFullCanvas</span></div>
<div class="viewcode-block" id="leoTkinterTree.setVisibleAreaToFullCanvas"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setVisibleAreaToFullCanvas">[docs]</a>    <span class="k">def</span> <span class="nf">setVisibleAreaToFullCanvas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span><span class="p">:</span>
            <span class="n">y1</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">y1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span> <span class="o">=</span> <span class="n">y1</span><span class="p">,</span><span class="n">y2</span>
    <span class="c">#@+node:ekr.20081121110412.548: *5* setVisibleArea</span></div>
<div class="viewcode-block" id="leoTkinterTree.setVisibleArea"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setVisibleArea">[docs]</a>    <span class="k">def</span> <span class="nf">setVisibleArea</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>

        <span class="n">r1</span><span class="p">,</span><span class="n">r2</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">r1</span><span class="p">,</span><span class="n">r2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span><span class="nb">float</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="c"># g.pr(&quot;scroll ratios:&quot;,r1,r2)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&quot;scrollregion&quot;</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">scanf</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>

        <span class="n">scroll_h</span> <span class="o">=</span> <span class="n">y2</span><span class="o">-</span><span class="n">y1</span>
        <span class="c"># g.pr(&quot;height of scrollregion:&quot;, scroll_h)</span>

        <span class="n">vy1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="p">(</span><span class="n">scroll_h</span><span class="o">*</span><span class="n">r1</span><span class="p">)</span>
        <span class="n">vy2</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="p">(</span><span class="n">scroll_h</span><span class="o">*</span><span class="n">r2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visibleArea</span> <span class="o">=</span> <span class="n">vy1</span><span class="p">,</span><span class="n">vy2</span>
        <span class="c"># g.pr(&quot;setVisibleArea: %5.1f %5.1f&quot; % (vy1,vy2))</span>
    <span class="c">#@+node:ekr.20081121110412.549: *5* tree.updateTree</span></div>
<div class="viewcode-block" id="leoTkinterTree.updateTree"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.updateTree">[docs]</a>    <span class="k">def</span> <span class="nf">updateTree</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">level</span><span class="p">):</span>

        <span class="n">yfirst</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="n">level</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">yfirst</span> <span class="o">+=</span> <span class="mi">10</span>
        <span class="k">while</span> <span class="n">v</span><span class="p">:</span>
            <span class="c"># g.trace(x,y,v)</span>
            <span class="n">h</span><span class="p">,</span><span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateNode</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">h</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">firstChild</span><span class="p">():</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updateTree</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">firstChild</span><span class="p">(),</span><span class="n">x</span><span class="o">+</span><span class="n">indent</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">y</span>
    <span class="c">#@+node:ekr.20081121110412.550: *4* Selecting &amp; editing... (tkTree)</span>
    <span class="c">#@+node:ekr.20081121110412.551: *5* dimEditLabel, undimEditLabel</span>
    <span class="c"># Convenience methods so the caller doesn&#39;t have to know the present edit node.</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.dimEditLabel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.dimEditLabel">[docs]</a>    <span class="k">def</span> <span class="nf">dimEditLabel</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectedLabelState</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkinterTree.undimEditLabel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.undimEditLabel">[docs]</a>    <span class="k">def</span> <span class="nf">undimEditLabel</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">currentPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectedLabelState</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.552: *5* tree.editLabel (tkTree)</span></div>
<div class="viewcode-block" id="leoTkinterTree.editLabel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.editLabel">[docs]</a>    <span class="k">def</span> <span class="nf">editLabel</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">selectAll</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">selection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Start editing p&#39;s headline.&quot;&quot;&quot;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_edit</span><span class="p">)</span> <span class="ow">and</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editPosition</span><span class="p">():</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">endEditLabel</span><span class="p">()</span>
            <span class="c"># This redraw was formerly needed so that c.edit_widget(p)</span>
            <span class="c"># would exist.  However, Leo&#39;s core now guarantees a redraw</span>
            <span class="c"># before each call to c.editPosition.</span>
            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
                <span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setEditPosition</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c"># That is, self._editPosition = p</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">w</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revertHeadline</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">h</span> <span class="c"># New in 4.4b2: helps undo.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEditLabelState</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">selectAll</span><span class="o">=</span><span class="n">selectAll</span><span class="p">,</span><span class="n">selection</span><span class="o">=</span><span class="n">selection</span><span class="p">)</span>
                <span class="c"># Sets the focus immediately.</span>
            <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocus</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">showStateAndMode</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;*** Error: no edit widget for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.553: *5* tree.set...LabelState</span>
    <span class="c">#@+node:ekr.20081121110412.554: *6* setEditLabelState</span></div>
<div class="viewcode-block" id="leoTkinterTree.setEditLabelState"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setEditLabelState">[docs]</a>    <span class="k">def</span> <span class="nf">setEditLabelState</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">selectAll</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">selection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="c"># selected, editing</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">widgetWantsFocusNow</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEditHeadlineColors</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">selectAll</span> <span class="o">=</span> <span class="n">selectAll</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_all_text_when_editing_headlines</span>
            <span class="k">if</span> <span class="n">selection</span><span class="p">:</span>
                <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ins</span> <span class="o">=</span> <span class="n">selection</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="n">ins</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">selectAll</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span> <span class="c"># Clears insert point.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;no edit_widget&#39;</span><span class="p">)</span>
</div>
    <span class="n">setNormalLabelState</span> <span class="o">=</span> <span class="n">setEditLabelState</span> <span class="c"># For compatibility.</span>
    <span class="c">#@+node:ekr.20081121110412.555: *6* setSelectedLabelState</span>
    <span class="n">trace_n</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="leoTkinterTree.setSelectedLabelState"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setSelectedLabelState">[docs]</a>    <span class="k">def</span> <span class="nf">setSelectedLabelState</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span> <span class="c"># selected, disabled</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># g.trace(p,c.edit_widget(p))</span>


        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

            <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_n</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>
                <span class="c"># g.trace(g.callers(6))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trace_n</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setDisabledHeadlineColors</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.556: *6* setUnselectedLabelState</span></div>
<div class="viewcode-block" id="leoTkinterTree.setUnselectedLabelState"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setUnselectedLabelState">[docs]</a>    <span class="k">def</span> <span class="nf">setUnselectedLabelState</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span> <span class="c"># not selected.</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUnselectedHeadlineColors</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.557: *6* setDisabledHeadlineColors</span></div>
<div class="viewcode-block" id="leoTkinterTree.setDisabledHeadlineColors"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setDisabledHeadlineColors">[docs]</a>    <span class="k">def</span> <span class="nf">setDisabledHeadlineColors</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">False</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%10s</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;disabled&quot;</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">w</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
            <span class="c"># import traceback ; traceback.print_stack(limit=6)</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_selected_foreground_color</span> <span class="ow">or</span> <span class="s">&#39;black&#39;</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_selected_background_color</span> <span class="ow">or</span> <span class="s">&#39;grey80&#39;</span>
        <span class="n">selfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_foreground_color</span>
        <span class="n">selbg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_background_color</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">,</span><span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fg</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
                <span class="n">selectbackground</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">selectforeground</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span><span class="n">highlightbackground</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.558: *6* setEditHeadlineColors</span></div>
<div class="viewcode-block" id="leoTkinterTree.setEditHeadlineColors"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setEditHeadlineColors">[docs]</a>    <span class="k">def</span> <span class="nf">setEditHeadlineColors</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">redrawing</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%10s</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;edit&quot;</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>

        <span class="n">fg</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_foreground_color</span> <span class="ow">or</span> <span class="s">&#39;black&#39;</span>
        <span class="n">bg</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_background_color</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>
        <span class="n">selfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_foreground_color</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>
        <span class="n">selbg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_editing_selection_background_color</span> <span class="ow">or</span> <span class="s">&#39;black&#39;</span>

        <span class="k">try</span><span class="p">:</span> <span class="c"># Use system defaults for selection foreground/background</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">,</span><span class="n">highlightthickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">fg</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">selectforeground</span><span class="o">=</span><span class="n">selfg</span><span class="p">,</span><span class="n">selectbackground</span><span class="o">=</span><span class="n">selbg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.559: *6* setUnselectedHeadlineColors</span></div>
<div class="viewcode-block" id="leoTkinterTree.setUnselectedHeadlineColors"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setUnselectedHeadlineColors">[docs]</a>    <span class="k">def</span> <span class="nf">setUnselectedHeadlineColors</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="p">;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">redrawing</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">pr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%10s</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;unselect&quot;</span><span class="p">,</span><span class="nb">id</span><span class="p">(</span><span class="n">w</span><span class="p">),</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
                <span class="c"># import traceback ; traceback.print_stack(limit=6)</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_unselected_foreground_color</span> <span class="ow">or</span> <span class="s">&#39;black&#39;</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline_text_unselected_background_color</span> <span class="ow">or</span> <span class="s">&#39;white&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">,</span><span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fg</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span>
                <span class="n">selectbackground</span><span class="o">=</span><span class="n">bg</span><span class="p">,</span><span class="n">selectforeground</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span><span class="n">highlightbackground</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">es_exception</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.560: *5* tree.setHeadline (tkTree)</span></div>
<div class="viewcode-block" id="leoTkinterTree.setHeadline"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTree.setHeadline">[docs]</a>    <span class="k">def</span> <span class="nf">setHeadline</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the actual text of the headline widget.</span>

<span class="sd">        This is called from unit tests to restore the text before redrawing.&#39;&#39;&#39;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edit_widget</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">w</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">revertHeadline</span> <span class="o">=</span> <span class="n">s</span>

        <span class="c"># else: g.trace(&#39;-&#39;*20,&#39;oops&#39;)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.307: *3* class leoTkinterTreeTab</span></div></div>
<div class="viewcode-block" id="leoTkinterTreeTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab">[docs]</a><span class="k">class</span> <span class="nc">leoTkinterTreeTab</span> <span class="p">(</span><span class="n">leoFrame</span><span class="o">.</span><span class="n">leoTreeTab</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class representing a tabbed outline pane drawn with Tkinter.&#39;&#39;&#39;</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.308: *4*  Birth &amp; death</span>
    <span class="c">#@+node:ekr.20081121110412.309: *5*  ctor (leoTreeTab)</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">,</span><span class="n">chapterController</span><span class="p">):</span>

        <span class="n">leoFrame</span><span class="o">.</span><span class="n">leoTreeTab</span><span class="o">.</span><span class="n">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">chapterController</span><span class="p">,</span><span class="n">parentFrame</span><span class="p">)</span>
            <span class="c"># Init the base class.  Sets self.c, self.cc and self.parentFrame.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tabNames</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># The list of tab names.  Changes when tabs are renamed.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createControl</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.310: *5* tt.createControl</span>
<div class="viewcode-block" id="leoTkinterTreeTab.createControl"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab.createControl">[docs]</a>    <span class="k">def</span> <span class="nf">createControl</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">c</span>

        <span class="c"># Create the main container, possibly in a new row.</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">getNewIconFrame</span><span class="p">()</span>

        <span class="c"># Create the chapter menu.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chapterVar</span> <span class="o">=</span> <span class="n">var</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">()</span>
        <span class="n">var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">)</span>

        <span class="n">tt</span><span class="o">.</span><span class="n">chapterMenu</span> <span class="o">=</span> <span class="n">menu</span> <span class="o">=</span> <span class="n">Pmw</span><span class="o">.</span><span class="n">OptionMenu</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">labelpos</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">label_text</span> <span class="o">=</span> <span class="s">&#39;chapter&#39;</span><span class="p">,</span>
            <span class="n">menubutton_textvariable</span> <span class="o">=</span> <span class="n">var</span><span class="p">,</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">selectTab</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c"># Actually add tt.frame to the icon row.</span>
        <span class="n">c</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">addIconWidget</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.311: *4* Tabs...</span>
    <span class="c">#@+node:ekr.20081121110412.312: *5* tt.createTab</span></div>
<div class="viewcode-block" id="leoTkinterTreeTab.createTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab.createTab">[docs]</a>    <span class="k">def</span> <span class="nf">createTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">,</span><span class="n">select</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tt</span><span class="o">.</span><span class="n">tabNames</span><span class="p">:</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">tabNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">setNames</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.313: *5* tt.destroyTab</span></div>
<div class="viewcode-block" id="leoTkinterTreeTab.destroyTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab.destroyTab">[docs]</a>    <span class="k">def</span> <span class="nf">destroyTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="ow">in</span> <span class="n">tt</span><span class="o">.</span><span class="n">tabNames</span><span class="p">:</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">tabNames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">setNames</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.314: *5* tt.selectTab</span></div>
<div class="viewcode-block" id="leoTkinterTreeTab.selectTab"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab.selectTab">[docs]</a>    <span class="k">def</span> <span class="nf">selectTab</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="n">tabName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabNames</span><span class="p">:</span>
            <span class="n">tt</span><span class="o">.</span><span class="n">createTab</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="n">tt</span><span class="o">.</span><span class="n">cc</span><span class="o">.</span><span class="n">selectChapterByName</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">outerUpdate</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.315: *5* tt.setTabLabel</span></div>
<div class="viewcode-block" id="leoTkinterTreeTab.setTabLabel"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab.setTabLabel">[docs]</a>    <span class="k">def</span> <span class="nf">setTabLabel</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tabName</span><span class="p">):</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">tt</span><span class="o">.</span><span class="n">chapterVar</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">tabName</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.316: *5* tt.setNames</span></div>
<div class="viewcode-block" id="leoTkinterTreeTab.setNames"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkinterTreeTab.setNames">[docs]</a>    <span class="k">def</span> <span class="nf">setNames</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Recreate the list of items.&#39;&#39;&#39;</span>

        <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">tabNames</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="s">&#39;main&#39;</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span> <span class="n">names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;main&#39;</span><span class="p">)</span>
    <span class="c">#@-others</span>
<span class="c">#@+node:ekr.20081121110412.317: *3* class leoTkTextWidget (Tk.Text)</span></div></div>
<div class="viewcode-block" id="leoTkTextWidget"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget">[docs]</a><span class="k">class</span> <span class="nc">leoTkTextWidget</span> <span class="p">(</span><span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;A class to wrap the Tk.Text widget.</span>
<span class="sd">    Translates Python (integer) indices to and from Tk (string) indices.</span>

<span class="sd">    This class inherits almost all tkText methods: you call use them as usual.&#39;&#39;&#39;</span>

    <span class="c"># The signatures of tag_add and insert are different from the Tk.Text signatures.</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;_name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">or</span> <span class="s">&#39;&lt;no name&gt;&#39;</span>
        <span class="k">return</span> <span class="s">&#39;leoTkTextWidget id: </span><span class="si">%s</span><span class="s"> name: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span><span class="n">name</span><span class="p">)</span>

    <span class="c">#@+others</span>
    <span class="c">#@+node:ekr.20081121110412.318: *4* bindings (not used)</span>
    <span class="c"># Specify the names of widget-specific methods.</span>
    <span class="c"># These particular names are the names of wx.TextCtrl methods.</span>

    <span class="c"># def _appendText(self,s):            return self.widget.insert(s)</span>
    <span class="c"># def _get(self,i,j):                 return self.widget.get(i,j)</span>
    <span class="c"># def _getAllText(self):              return self.widget.get(&#39;1.0&#39;,&#39;end&#39;)</span>
    <span class="c"># def _getFocus(self):                return self.widget.focus_get()</span>
    <span class="c"># def _getInsertPoint(self):          return self.widget.index(&#39;insert&#39;)</span>
    <span class="c"># def _getLastPosition(self):         return self.widget.index(&#39;end&#39;)</span>
    <span class="c"># def _getSelectedText(self):         return self.widget.get(&#39;sel.start&#39;,&#39;sel.end&#39;)</span>
    <span class="c"># def _getSelectionRange(self):       return self.widget.index(&#39;sel.start&#39;),self.widget.index(&#39;sel.end&#39;)</span>
    <span class="c"># def _hitTest(self,pos):             pass</span>
    <span class="c"># def _insertText(self,i,s):          return self.widget.insert(i,s)</span>
    <span class="c"># def _scrollLines(self,n):           pass</span>
    <span class="c"># def _see(self,i):                   return self.widget.see(i)</span>
    <span class="c"># def _setAllText(self,s):            self.widget.delete(&#39;1.0&#39;,&#39;end&#39;) ; self.widget.insert(&#39;1.0&#39;,s)</span>
    <span class="c"># def _setBackgroundColor(self,color): return self.widget.configure(background=color)</span>
    <span class="c"># def _setForegroundColor(self,color): return self.widget.configure(background=color)</span>
    <span class="c"># def _setFocus(self):                return self.widget.focus_set()</span>
    <span class="c"># def _setInsertPoint(self,i):        return self.widget.mark_set(&#39;insert&#39;,i)</span>
    <span class="c"># def _setSelectionRange(self,i,j):   return self.widget.SetSelection(i,j)</span>
    <span class="c">#@+node:ekr.20081121110412.319: *4* Index conversion (leoTextWidget)</span>
    <span class="c">#@+node:ekr.20090320101733.12: *5* w.toPythonIndexToRowCol</span>
    <span class="c"># New in Leo 4.6 b1.</span>

<div class="viewcode-block" id="leoTkTextWidget.toPythonIndexRowCol"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.toPythonIndexRowCol">[docs]</a>    <span class="k">def</span> <span class="nf">toPythonIndexRowCol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">convertPythonIndexToRowCol</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span>
    <span class="c">#@+node:ekr.20081121110412.320: *5* w.toGuiIndex</span></div>
<div class="viewcode-block" id="leoTkTextWidget.toGuiIndex"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.toGuiIndex">[docs]</a>    <span class="k">def</span> <span class="nf">toGuiIndex</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Convert a Python index to a Tk index as needed.&#39;&#39;&#39;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not happen: i is None&#39;</span><span class="p">,</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
            <span class="k">return</span> <span class="s">&#39;1.0&#39;</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">99</span><span class="p">):</span>
            <span class="c"># The &#39;s&#39; arg supports the threaded colorizer.</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># This *must* be &#39;end-1c&#39;, even if other code must change.</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end-1c&#39;</span><span class="p">)</span>
            <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">convertPythonIndexToRowCol</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
            <span class="c"># g.trace(len(s),i,repr(s))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c"># g.es_exception()</span>
                <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;Tk.Text.index failed:&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">g</span><span class="o">.</span><span class="n">callers</span><span class="p">())</span>
                <span class="n">i</span> <span class="o">=</span> <span class="s">&#39;1.0&#39;</span>
        <span class="k">return</span> <span class="n">i</span>
    <span class="c">#@+node:ekr.20081121110412.321: *5* w.toPythonIndex</span></div>
<div class="viewcode-block" id="leoTkTextWidget.toPythonIndex"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.toPythonIndex">[docs]</a>    <span class="k">def</span> <span class="nf">toPythonIndex</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Convert a Tk index to a Python index as needed.&#39;&#39;&#39;</span>
        <span class="n">w</span> <span class="o">=</span><span class="bp">self</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not happen: i is None&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">g</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span> <span class="c"># end-1c does not work.</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="c"># Convert to row/column form.</span>
            <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">row</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">convertRowColToPythonIndex</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
            <span class="c">#g.es_print(&#39;&#39;,i)</span>
        <span class="k">return</span> <span class="n">i</span>
    <span class="c">#@+node:ekr.20081121110412.322: *5* w.rowColToGuiIndex</span>
    <span class="c"># This method is called only from the colorizer.</span>
    <span class="c"># It provides a huge speedup over naive code.</span>
</div>
<div class="viewcode-block" id="leoTkTextWidget.rowColToGuiIndex"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.rowColToGuiIndex">[docs]</a>    <span class="k">def</span> <span class="nf">rowColToGuiIndex</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20100109114406.3729: *4* leoMoveCursorHelper (TK)</span></div>
<div class="viewcode-block" id="leoTkTextWidget.leoMoveCursorHelper"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.leoMoveCursorHelper">[docs]</a>    <span class="k">def</span> <span class="nf">leoMoveCursorHelper</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">linesPerPage</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Move the cursor in a QTextEdit.&#39;&#39;&#39;</span>

        <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">unitTesting</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="n">ins</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;leo_text_anchor&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span><span class="p">:</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span>
        <span class="n">si</span><span class="p">,</span><span class="n">sj</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">si</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sj</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;exchange&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="c"># dummy</span>
            <span class="s">&#39;down&#39;</span><span class="p">:</span>     <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">),</span>
            <span class="s">&#39;end&#39;</span><span class="p">:</span>      <span class="s">&#39;end&#39;</span><span class="p">,</span>
            <span class="s">&#39;end-line&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.end&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="s">&#39;home&#39;</span><span class="p">:</span>     <span class="s">&#39;1.0&#39;</span><span class="p">,</span>
            <span class="s">&#39;left&#39;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.end&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;1.0&#39;</span><span class="p">),</span> <span class="c"># start of line.</span>
                    <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
            <span class="s">&#39;page-down&#39;</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">linesPerPage</span><span class="p">,</span><span class="n">j</span><span class="p">),</span>
            <span class="s">&#39;page-up&#39;</span><span class="p">:</span>  <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="n">linesPerPage</span><span class="p">),</span><span class="n">j</span><span class="p">),</span>
            <span class="s">&#39;right&#39;</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span><span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s">&quot;&gt;=&quot;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.end&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)),</span>
                    <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                    <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span>
            <span class="s">&#39;start-line&#39;</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.0&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">),</span>
            <span class="s">&#39;up&#39;</span><span class="p">:</span>       <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">j</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">newIns</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trace</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;**Tk**&#39;</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="s">&#39;extend&#39;</span><span class="p">,</span><span class="n">extend</span><span class="p">,</span><span class="n">anchor</span><span class="p">,</span><span class="n">ins</span><span class="p">,</span><span class="n">newIns</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;exchange&#39;</span><span class="p">:</span> <span class="c"># exchange-point-and-mark.</span>
            <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">hasSelection</span><span class="p">():</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;sel&quot;</span><span class="p">)</span>
                <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">sel</span>
                <span class="c"># This is required for the unit test.</span>
                <span class="n">anchor</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">choose</span><span class="p">(</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;leo_text_anchor&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span><span class="p">,</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="n">extend</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">anchor</span><span class="p">,</span><span class="n">ins</span> <span class="o">=</span> <span class="n">ins</span><span class="p">,</span><span class="n">anchor</span>
                <span class="n">newIns</span> <span class="o">=</span> <span class="n">ins</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="n">newIns</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;sel&#39;</span><span class="p">,</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;insert&#39;</span><span class="p">,</span><span class="n">newIns</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extend</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">anchor</span><span class="p">,</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">newIns</span><span class="p">):</span>
                    <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;sel&#39;</span><span class="p">,</span><span class="n">newIns</span><span class="p">,</span><span class="n">anchor</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;sel&#39;</span><span class="p">,</span><span class="n">anchor</span><span class="p">,</span><span class="n">newIns</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span> <span class="o">=</span> <span class="n">anchor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s">&#39;can not happen: bad kind: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">kind</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.323: *4* Wrapper methods (leoTextWidget)</span>
    <span class="c">#@+node:ekr.20081121110412.324: *5* delete</span></div>
<div class="viewcode-block" id="leoTkTextWidget.delete"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.325: *5* flashCharacter</span></div>
<div class="viewcode-block" id="leoTkTextWidget.flashCharacter"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.flashCharacter">[docs]</a>    <span class="k">def</span> <span class="nf">flashCharacter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">bg</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">,</span><span class="n">fg</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="n">flashes</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="mi">75</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">def</span> <span class="nf">addFlashCallback</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
            <span class="c"># g.trace(count,index)</span>
            <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;flash&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">removeFlashCallback</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">removeFlashCallback</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
            <span class="c"># g.trace(count,index)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;flash&#39;</span><span class="p">,</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">addFlashCallback</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;flash&#39;</span><span class="p">,</span><span class="n">foreground</span><span class="o">=</span><span class="n">fg</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="n">bg</span><span class="p">)</span>
            <span class="n">addFlashCallback</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">flashes</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># g.es_exception()</span>
    <span class="c">#@+node:ekr.20081121110412.326: *5* get</span></div>
<div class="viewcode-block" id="leoTkTextWidget.get"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.327: *5* getAllText</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getAllText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getAllText">[docs]</a>    <span class="k">def</span> <span class="nf">getAllText</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="sd">&quot;&quot;&quot;Return all the text of Tk.Text widget w converted to unicode.&quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="s">&quot;end-1c&quot;</span><span class="p">)</span> <span class="c"># New in 4.4.1: use end-1c.</span>

        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">u</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">toUnicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.328: *5* getInsertPoint</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getInsertPoint"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getInsertPoint">[docs]</a>    <span class="k">def</span> <span class="nf">getInsertPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">i</span>
    <span class="c">#@+node:ekr.20081121110412.329: *5* getName</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getName"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;_name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">_name</span> <span class="ow">or</span> <span class="nb">repr</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.330: *5* getSelectedText</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getSelectedText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getSelectedText">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectedText</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">toUnicode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">u</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.331: *5* getSelectionRange</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getSelectionRange"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getSelectionRange">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectionRange</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="sd">&quot;&quot;&quot;Return a tuple representing the selected range.</span>

<span class="sd">        Return a tuple giving the insertion point if no range of text is selected.&quot;&quot;&quot;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;sel&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">sel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;insert&quot;</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">w</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>  
        <span class="k">if</span> <span class="n">sort</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span>
        <span class="k">return</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>
    <span class="c">#@+node:ekr.20081121110412.332: *5* getWidth</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getWidth"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getWidth">[docs]</a>    <span class="k">def</span> <span class="nf">getWidth</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Return the width of the widget.</span>
<span class="sd">        This is only called for headline widgets,</span>
<span class="sd">        and gui&#39;s may choose not to do anything here.&#39;&#39;&#39;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.333: *5* getYScrollPosition</span></div>
<div class="viewcode-block" id="leoTkTextWidget.getYScrollPosition"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.getYScrollPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getYScrollPosition</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">yview</span><span class="p">()</span>
    <span class="c">#@+node:ekr.20081121110412.334: *5* hasSelection</span></div>
<div class="viewcode-block" id="leoTkTextWidget.hasSelection"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.hasSelection">[docs]</a>    <span class="k">def</span> <span class="nf">hasSelection</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getSelectionRange</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span>
    <span class="c">#@+node:ekr.20081121110412.335: *5* indexIsVisible (tk)</span></div>
<div class="viewcode-block" id="leoTkTextWidget.indexIsVisible"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.indexIsVisible">[docs]</a>    <span class="k">def</span> <span class="nf">indexIsVisible</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">dlineinfo</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.336: *5* insert</span>
    <span class="c"># The signature is more restrictive than the Tk.Text.insert method.</span>
</div>
<div class="viewcode-block" id="leoTkTextWidget.insert"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20081121110412.338: *5* replace</span></div>
<div class="viewcode-block" id="leoTkTextWidget.replace"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.replace">[docs]</a>    <span class="k">def</span> <span class="nf">replace</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.339: *5* see</span></div>
<div class="viewcode-block" id="leoTkTextWidget.see"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.see">[docs]</a>    <span class="k">def</span> <span class="nf">see</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.340: *5* seeInsertPoint</span></div>
<div class="viewcode-block" id="leoTkTextWidget.seeInsertPoint"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.seeInsertPoint">[docs]</a>    <span class="k">def</span> <span class="nf">seeInsertPoint</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.341: *5* selectAllText</span></div>
<div class="viewcode-block" id="leoTkTextWidget.selectAllText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.selectAllText">[docs]</a>    <span class="k">def</span> <span class="nf">selectAllText</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="sd">&#39;&#39;&#39;Select all text of the widget, *not* including the extra newline.&#39;&#39;&#39;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span> <span class="p">;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">getAllText</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">insert</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">insert</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setSelectionRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="n">insert</span><span class="o">=</span><span class="n">insert</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.342: *5* setAllText</span></div>
<div class="viewcode-block" id="leoTkTextWidget.setAllText"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setAllText">[docs]</a>    <span class="k">def</span> <span class="nf">setAllText</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">new_p</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;state&quot;</span><span class="p">)</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="s">&quot;normal&quot;</span><span class="p">)</span>

        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="s">&#39;end&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">:</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span> <span class="c"># The &#39;if s:&#39; is a workaround for a fedora bug.</span>

        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.343: *5* setBackgroundColor &amp; setForegroundColor</span></div>
<div class="viewcode-block" id="leoTkTextWidget.setBackgroundColor"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setBackgroundColor">[docs]</a>    <span class="k">def</span> <span class="nf">setBackgroundColor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">color</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">background</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="leoTkTextWidget.setForegroundColor"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setForegroundColor">[docs]</a>    <span class="k">def</span> <span class="nf">setForegroundColor</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">color</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">foreground</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.344: *5* setInsertPoint</span></div>
<div class="viewcode-block" id="leoTkTextWidget.setInsertPoint"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setInsertPoint">[docs]</a>    <span class="k">def</span> <span class="nf">setInsertPoint</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="c"># tkTextWidget.</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c"># g.trace(i,g.callers())</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&#39;insert&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">leo_text_anchor</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">#@+node:ekr.20081121110412.345: *5* setSelectionRange</span></div>
<div class="viewcode-block" id="leoTkTextWidget.setSelectionRange"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setSelectionRange">[docs]</a>    <span class="k">def</span> <span class="nf">setSelectionRange</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">insert</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c"># g.trace(&#39;i,j,insert&#39;,repr(i),repr(j),repr(insert),g.callers())</span>

        <span class="c"># g.trace(&#39;i,j,insert&#39;,i,j,repr(insert))</span>
        <span class="k">if</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span><span class="n">i</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;sel&quot;</span><span class="p">,</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;sel&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;sel&quot;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">insert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setInsertPoint</span><span class="p">(</span><span class="n">insert</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.346: *5* setWidth</span></div>
<div class="viewcode-block" id="leoTkTextWidget.setWidth"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setWidth">[docs]</a>    <span class="k">def</span> <span class="nf">setWidth</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">width</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Set the width of the widget.</span>
<span class="sd">        This is only called for headline widgets,</span>
<span class="sd">        and gui&#39;s may choose not to do anything here.&#39;&#39;&#39;</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">w</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.347: *5* setYScrollPosition</span></div>
<div class="viewcode-block" id="leoTkTextWidget.setYScrollPosition"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.setYScrollPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setYScrollPosition</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">w</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="s">&#39;moveto&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.348: *5* tag_add</span>
    <span class="c"># The signature is slightly different than the Tk.Text.insert method.</span>
</div>
<div class="viewcode-block" id="leoTkTextWidget.tag_add"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.tag_add">[docs]</a>    <span class="k">def</span> <span class="nf">tag_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="c">#@+node:ekr.20081121110412.349: *5* tag_ranges</span></div>
<div class="viewcode-block" id="leoTkTextWidget.tag_ranges"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.tag_ranges">[docs]</a>    <span class="k">def</span> <span class="nf">tag_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">tagName</span><span class="p">)</span>
        <span class="n">aList</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">aList</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.350: *5* tag_remove</span>
    <span class="c"># The signature is slightly different than the Tk.Text.insert method.</span>
</div>
<div class="viewcode-block" id="leoTkTextWidget.tag_remove"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.tag_remove">[docs]</a>    <span class="k">def</span> <span class="nf">tag_remove</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toGuiIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">tagName</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>


    <span class="c">#@+node:ekr.20081121110412.351: *5* deleteTextSelection</span></div>
<div class="viewcode-block" id="leoTkTextWidget.deleteTextSelection"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.deleteTextSelection">[docs]</a>    <span class="k">def</span> <span class="nf">deleteTextSelection</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;sel&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="n">sel</span>
            <span class="k">if</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="s">&quot;!=&quot;</span><span class="p">,</span><span class="n">end</span><span class="p">):</span>
                <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
    <span class="c">#@+node:ekr.20081121110412.352: *5* xyToGui/PythonIndex</span></div>
<div class="viewcode-block" id="leoTkTextWidget.xyToGuiIndex"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.xyToGuiIndex">[docs]</a>    <span class="k">def</span> <span class="nf">xyToGuiIndex</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;@</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="leoTkTextWidget.xyToPythonIndex"><a class="viewcode-back" href="../../../leo.plugins.html#leo.plugins.tkGui.leoTkTextWidget.xyToPythonIndex">[docs]</a>    <span class="k">def</span> <span class="nf">xyToPythonIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span> <span class="c"># tkTextWidget</span>

        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Text</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;@</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">toPythonIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">i</span>
    <span class="c">#@-others</span>
<span class="c">#@-others</span>
<span class="c">#@-leo</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Leo API 4.11dev documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Ed K. Ream.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>