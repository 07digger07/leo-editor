;@+leo-ver=5-thin
;@+node:ekr.20101027070126.1602: * @thin ../../nsi-uninstall.txt
;@@language nsi

Section Uninstall

    DeleteRegKey HKLM "${leo_hklm}"

    ; Delete files & directories only if we own them!
    ReadRegStr $1 HKCR "${ext}" ""
    StrCmp $1 "${name}File" 0 FinishUninstall

    ; Delete files & directories only if there is no backup_val key.
    ReadRegStr $1 HKCR "${ext}" "backup_val"
    StrCmp $1 "" 0 DeleteKeysAndFiles
      DeleteRegKey HKCR "${ext}"
    Goto FinishUninstall

DeleteKeysAndFiles:
    WriteRegStr HKCR "${ext}" "" $1
    DeleteRegValue HKCR "${ext}" "backup_val"

; ---- Start of manifest-related data...

!include nsi-uninstall-files.txt

; ---- End of manifest related data.

FinishUninstall:

    Delete "$SMPROGRAMS\${name}\Uninstall.lnk"
    RMDir "$SMPROGRAMS\${name}-${version}"
    Delete "$DESKTOP\${name}.lnk"

    ; "Software\Microsoft\Windows\CurrentVersion\Uninstall\leo"
    DeleteRegKey HKLM "${uninst_key}" 
    SetAutoClose false

; end Uninstall section
SectionEnd
;@-leo
