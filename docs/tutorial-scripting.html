

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing Leo scripts in Python &mdash; Leo 6.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Useful Tips" href="tutorial-tips.html" />
    <link rel="prev" title="Creating Documents from Outlines" href="tutorial-rst3.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="leo_toc.html" class="icon icon-home"> Leo
          

          
            
            <img src="_static/Leo4-80-border.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="preliminaries.html">Preliminaries</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Downloading, Installing &amp; Running Leo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">Cheat Sheet</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="screencasts.html">Videos about Leo</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial-basics.html">Leo in 10 Minutes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-pim.html">Using Leo as a Personal Information Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-rst3.html">Creating Documents from Outlines</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing Leo scripts in Python</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hello-world">Hello world</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-outline-nodes">Create outline nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-an-output-file-from-nodes">Generate an output file from nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#predefined-symbols-c-g-and-p">Predefined symbols: c, g and p</a></li>
<li class="toctree-l3"><a class="reference internal" href="#positions-and-vnodes">Positions and vnodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generators">Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wrappers-vs-widgets">wrappers vs. widgets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-tips.html">Useful Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usersguide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="leoandotherprograms.html">Leo and Other Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="intermediatetopics.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices.html">Appendices</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="history.html">History of Leo</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="what-is-new.html">What's New</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="slides.html">Slides</a></li>
<li class="toctree-l1"><a class="reference internal" href="leoLinks.html">More Leo Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="screen-shots.html">Leo screen shots</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="leo_toc.html">Leo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="leo_toc.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorial.html">Leo’s Tutorials</a> &raquo;</li>
        
      <li>Writing Leo scripts in Python</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-leo-scripts-in-python">
<h1>Writing Leo scripts in Python<a class="headerlink" href="#writing-leo-scripts-in-python" title="Permalink to this headline">¶</a></h1>
<p>This chapter tells how to write <strong>Leo scripts</strong>, Python scripts run from any Leo node. This chapter is intended for those fairly comfortable with Python scripting. If you are not, please study the excellent <a class="reference external" href="http://docs.python.org/2/tutorial/">Python Tutorial</a>. Jacob Peck has written a more <a class="reference external" href="http://blog.suspended-chord.info/2014/01/28/intro-to-leo-scripting/">informal scripting tutorial</a>.</p>
<p>Three predefined symbols, <strong>c</strong>, <strong>g</strong> and <strong>p</strong> give Leo scripts easy access to all the data in the outline. These symbols also allow Leo scripts to execute any code in Leo’s own code base.</p>
<p><strong>Positions</strong> and <strong>vnodes</strong> are the foundation of Leo scripting. leo/core/leoNodes.py defines the corresponding Position and VNode classes. These classes provide access to all outline data, and allow Leo scripts to create and change outlines.</p>
<p><strong>Further study</strong>: The <a class="reference external" href="cheatsheet.html#scripting">scripting portion</a> of <a class="reference external" href="cheatsheet.html">Leo’s cheat sheet</a> contains more information about scripting.</p>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#hello-world" id="id2">Hello world</a></p></li>
<li><p><a class="reference internal" href="#create-outline-nodes" id="id3">Create outline nodes</a></p></li>
<li><p><a class="reference internal" href="#generate-an-output-file-from-nodes" id="id4">Generate an output file from nodes</a></p></li>
<li><p><a class="reference internal" href="#predefined-symbols-c-g-and-p" id="id5">Predefined symbols: c, g and p</a></p></li>
<li><p><a class="reference internal" href="#positions-and-vnodes" id="id6">Positions and vnodes</a></p></li>
<li><p><a class="reference internal" href="#generators" id="id7">Generators</a></p></li>
<li><p><a class="reference internal" href="#wrappers-vs-widgets" id="id8">wrappers vs. widgets</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id9">Summary</a></p></li>
</ul>
</div>
<div class="section" id="hello-world">
<h2><a class="toc-backref" href="#id2">Hello world</a><a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p id="index-0">Here is the obligatory “Hello World!” script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">)</span> <span class="c1"># g.es prints all its arguments to the log pane.</span>
</pre></div>
</div>
<p>In more detail:</p>
<ol class="arabic simple">
<li><p>Create a node anywhere in the outline.</p></li>
<li><p>Put g.es(‘hello, world!’) in the node’s body text.</p></li>
<li><p>Select the node and type Ctrl-B.</p></li>
</ol>
<p><strong>Important</strong> If text is selected, execute-script executes only the selected text. If you are in LeoDocs.leo, you can run the script from this node.</p>
</div>
<div class="section" id="create-outline-nodes">
<h2><a class="toc-backref" href="#id3">Create outline nodes</a><a class="headerlink" href="#create-outline-nodes" title="Permalink to this headline">¶</a></h2>
<p><strong>p.b</strong> is the body text associated with position p. Similarly, <strong>p.h</strong> is p’s headline.
p.b and p.h are python properties, so you can assign to p.b and p.h.</p>
<p>This script creates an outline node as the last top-level node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">lastTopLevel</span><span class="p">()</span><span class="o">.</span><span class="n">insertAfter</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="s1">&#39;my new node&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c1"># Selects the new node.</span>
</pre></div>
</div>
<p>This script creates multiple nodes, with different headlines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">lastTopLevel</span><span class="p">()</span><span class="o">.</span><span class="n">insertAfter</span><span class="p">()</span>
<span class="n">parent</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="s1">&#39;New nodes&#39;</span>
<span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;First node&#39;</span><span class="p">,</span> <span class="s1">&#39;Body text for first node&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Node 2&#39;</span><span class="p">,</span>     <span class="s1">&#39;Body text for node 2&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Last Node&#39;</span><span class="p">,</span>  <span class="s1">&#39;Body text for last node</span><span class="se">\n</span><span class="s1">Line 2&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">headline</span><span class="p">,</span> <span class="n">body</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">insertAsLastChild</span><span class="p">()</span>
    <span class="n">child</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="c1"># Ensure exactly one trailing newline.</span>
    <span class="n">child</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">headline</span>
<span class="n">c</span><span class="o">.</span><span class="n">selectPosition</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="c1"># Another way to select nodes.</span>
<span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">()</span>
</pre></div>
</div>
<p>This script creates a node containing today’s date in the body text:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">lastTopLevel</span><span class="p">()</span><span class="o">.</span><span class="n">insertAfter</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="s2">&quot;Today&#39;s date&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">redraw</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="generate-an-output-file-from-nodes">
<h2><a class="toc-backref" href="#id4">Generate an output file from nodes</a><a class="headerlink" href="#generate-an-output-file-from-nodes" title="Permalink to this headline">¶</a></h2>
<p>The script writes the body text of the presently selected node to ~/leo_output_file.txt and then prints it to the log pane:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">os_path_finalize_join</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">homeDir</span><span class="p">,</span> <span class="s1">&#39;leo_output_file.txt&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="predefined-symbols-c-g-and-p">
<h2><a class="toc-backref" href="#id5">Predefined symbols: c, g and p</a><a class="headerlink" href="#predefined-symbols-c-g-and-p" title="Permalink to this headline">¶</a></h2>
<p id="index-1">The execute-script command predefines the symbols c, g and p.</p>
<p>c is the <strong>commander</strong> of the outline containing the script. Commanders are instances of the Commands class, defined in leoCommands.py. Commanders provide access to all outline data <em>and</em> all of Leo’s source code.</p>
<p>g is Leo’s <strong>leo.core.leoGlobals</strong> containing many useful functions, including g.es.</p>
<p>p is the <strong>position</strong> of the presently selected node. Positions represent nodes at a particular location of an outline. Because of clones, the <em>same</em> node may appear at multiple positions in an outline. <strong>c.p</strong> is the outline’s presently selected position.</p>
</div>
<div class="section" id="positions-and-vnodes">
<h2><a class="toc-backref" href="#id6">Positions and vnodes</a><a class="headerlink" href="#positions-and-vnodes" title="Permalink to this headline">¶</a></h2>
<p>A <strong>position</strong> represents an outline node at a <em>specific position</em> in the outline. Positions provide methods to insert, delete and move outline nodes. The <a class="reference external" href="cheatsheet.html#scripting">scripting portion</a> of <a class="reference external" href="cheatsheet.html">Leo’s cheat sheet</a> lists the most important methods of the position class.</p>
<p>Because of clones, the <em>same</em> node may appear at <em>multiple positions</em> in the outline. A <strong>vnode</strong> represents the node’s data, which is shared all positions referring to that node.</p>
<p>For any position p, <strong>p.b</strong> is the node’s body text, <strong>p.h</strong> is the node’s headline and <strong>p.u</strong> is the node’s <a class="reference external" href="customizing.html#adding-extensible-attributes-to-nodes-and-leo-files">user attributes</a>, and <strong>p.v</strong> is the position’s vnode. Similarly, for any vnode v, <strong>v.b</strong> is the node’s body text, <strong>v.h</strong> is the node’s headline and <strong>v.u</strong> is the node’s user attributes.</p>
</div>
<div class="section" id="generators">
<h2><a class="toc-backref" href="#id7">Generators</a><a class="headerlink" href="#generators" title="Permalink to this headline">¶</a></h2>
<p id="index-3">Commanders and positions define several <a class="reference external" href="https://wiki.python.org/moin/Generators">Python generators</a> to traverse (step through) an outline. The <a class="reference external" href="cheatsheet.html#scripting">scripting portion</a> of <a class="reference external" href="cheatsheet.html">Leo’s cheat sheet</a> lists all of Leo’s generators. For example, c.all_positions() traverses the outline in outline order.  The following prints a properly-indented list of all headlines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">all_positions</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="n">p</span><span class="o">.</span><span class="n">level</span><span class="p">()</span><span class="o">+</span><span class="n">p</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
</pre></div>
</div>
<p id="index-4">Scripts may capture positions like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">all_positions</span><span class="p">())</span>
</pre></div>
</div>
<p><strong>Warning</strong>: stored positions become invalid when outline changes. <strong>c.positionExists(p)</strong> is True if p is valid in c’s outline.</p>
<p><strong>New in Leo 5.5</strong>: All generators now yield <em>copies</em> of positions.</p>
</div>
<div class="section" id="wrappers-vs-widgets">
<h2><a class="toc-backref" href="#id8">wrappers vs. widgets</a><a class="headerlink" href="#wrappers-vs-widgets" title="Permalink to this headline">¶</a></h2>
<p>Leo’s Gui code is built on wrapper and widget classes. A <strong>widget</strong> is an actual Qt widget. A <strong>wrapper</strong> is an object whose API hides the details of the underlying gui <strong>text</strong> widgets. Leo’s core code usually uses wrappers, not raw widgets.</p>
<p>There is a back door for special cases. All wrapper classes define an official <code class="docutils literal notranslate"><span class="pre">widget</span></code> ivar (instance variable), so core or plugin code can gain access to the real Qt widget using <code class="docutils literal notranslate"><span class="pre">wrapper.widget</span></code>. Searching for <code class="docutils literal notranslate"><span class="pre">wrapper.widget</span></code> should find all gui-dependent snippets of code in Leo’s core.</p>
<p>Wrappers allow the same text-handling code to work regardless of whether the actual text widgets are a QTextBrowser or a QsciScintilla object. Without wrappers, all of Leo’s text-editing commands would have to know the details of the api of the actual Qt text widget!</p>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id9">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>execute-script predefines c, g and p.</p></li>
<li><p>c is a commander, g is the leoGlobals module, and p is the current position.</p></li>
<li><p>Vnodes contain all outline data.</p></li>
<li><p>Positions provide easy access to vnodes.</p></li>
<li><p>Positions become invalid when outline nodes are inserted, deleted or moved.</p></li>
<li><p>Generators visit all or parts of the outline, in a specified order.</p></li>
</ul>
<p>For more information, consult <a class="reference external" href="cheatsheet.html">Leo’s cheat sheet</a> and <a class="reference external" href="scripting-miscellany.html">Leo’s scripting miscellany</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial-tips.html" class="btn btn-neutral float-right" title="Useful Tips" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial-rst3.html" class="btn btn-neutral float-left" title="Creating Documents from Outlines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1997-2019, Edward K. Ream
      <span class="lastupdated">
        Last updated on Jul 13, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>